
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Forecasting with spot">
      
      
        <meta name="author" content="bartzbeielstein">
      
      
      
        <link rel="prev" href="../forecaster/">
      
      
        <link rel="next" href="../utils/">
      
      
        
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>Model Selection - spotforecast2</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="purple">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#model-selection-module" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="spotforecast2" class="md-header__button md-logo" aria-label="spotforecast2" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            spotforecast2
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Model Selection
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="purple"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="teal" data-md-color-accent="lime"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../data/" class="md-tabs__link">
          
  
  
  API Reference

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../processing/model_persistence/" class="md-tabs__link">
          
  
  
  Processing Guides

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../preprocessing/outliers/" class="md-tabs__link">
          
  
  
  Preprocessing Guides

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="spotforecast2" class="md-nav__button md-logo" aria-label="spotforecast2" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    spotforecast2
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    API Reference
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    API Reference
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../data/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Data
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../preprocessing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Preprocessing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../forecaster/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Forecaster
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Model Selection
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Model Selection
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#spotforecast2.model_selection.validation" class="md-nav__link">
    <span class="md-ellipsis">
      
        validation
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="validation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#spotforecast2.model_selection.validation.backtesting_forecaster" class="md-nav__link">
    <span class="md-ellipsis">
      
        backtesting_forecaster
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spotforecast2.model_selection.grid_search" class="md-nav__link">
    <span class="md-ellipsis">
      
        grid_search
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="grid_search">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#spotforecast2.model_selection.grid_search.grid_search_forecaster" class="md-nav__link">
    <span class="md-ellipsis">
      
        grid_search_forecaster
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spotforecast2.model_selection.bayesian_search" class="md-nav__link">
    <span class="md-ellipsis">
      
        bayesian_search
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="bayesian_search">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#spotforecast2.model_selection.bayesian_search.bayesian_search_forecaster" class="md-nav__link">
    <span class="md-ellipsis">
      
        bayesian_search_forecaster
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spotforecast2.model_selection.split_ts_cv" class="md-nav__link">
    <span class="md-ellipsis">
      
        split_ts_cv
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="split_ts_cv">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#spotforecast2.model_selection.split_ts_cv.TimeSeriesFold" class="md-nav__link">
    <span class="md-ellipsis">
      
        TimeSeriesFold
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="TimeSeriesFold">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#spotforecast2.model_selection.split_ts_cv.TimeSeriesFold.__repr__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __repr__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#spotforecast2.model_selection.split_ts_cv.TimeSeriesFold.split" class="md-nav__link">
    <span class="md-ellipsis">
      
        split
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../utils/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Utils
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../weather/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Weather
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Processing Guides
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Processing Guides
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../processing/model_persistence/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Model Persistence
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Preprocessing Guides
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Preprocessing Guides
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../preprocessing/outliers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Outlier Detection
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../preprocessing/time_series_visualization/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Time Series Visualization
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#spotforecast2.model_selection.validation" class="md-nav__link">
    <span class="md-ellipsis">
      
        validation
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="validation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#spotforecast2.model_selection.validation.backtesting_forecaster" class="md-nav__link">
    <span class="md-ellipsis">
      
        backtesting_forecaster
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spotforecast2.model_selection.grid_search" class="md-nav__link">
    <span class="md-ellipsis">
      
        grid_search
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="grid_search">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#spotforecast2.model_selection.grid_search.grid_search_forecaster" class="md-nav__link">
    <span class="md-ellipsis">
      
        grid_search_forecaster
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spotforecast2.model_selection.bayesian_search" class="md-nav__link">
    <span class="md-ellipsis">
      
        bayesian_search
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="bayesian_search">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#spotforecast2.model_selection.bayesian_search.bayesian_search_forecaster" class="md-nav__link">
    <span class="md-ellipsis">
      
        bayesian_search_forecaster
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spotforecast2.model_selection.split_ts_cv" class="md-nav__link">
    <span class="md-ellipsis">
      
        split_ts_cv
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="split_ts_cv">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#spotforecast2.model_selection.split_ts_cv.TimeSeriesFold" class="md-nav__link">
    <span class="md-ellipsis">
      
        TimeSeriesFold
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="TimeSeriesFold">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#spotforecast2.model_selection.split_ts_cv.TimeSeriesFold.__repr__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __repr__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#spotforecast2.model_selection.split_ts_cv.TimeSeriesFold.split" class="md-nav__link">
    <span class="md-ellipsis">
      
        split
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="model-selection-module">Model Selection Module</h1>


<div class="doc doc-object doc-module">



<h2 id="spotforecast2.model_selection.validation" class="doc doc-heading">
            <code>spotforecast2.model_selection.validation</code>


</h2>

    <div class="doc doc-contents first">










<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="spotforecast2.model_selection.validation.backtesting_forecaster" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">backtesting_forecaster</span><span class="p">(</span><span class="n">forecaster</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">cv</span><span class="p">,</span> <span class="n">metric</span><span class="p">,</span> <span class="n">exog</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">interval_method</span><span class="o">=</span><span class="s1">&#39;bootstrapping&#39;</span><span class="p">,</span> <span class="n">n_boot</span><span class="o">=</span><span class="mi">250</span><span class="p">,</span> <span class="n">use_in_sample_residuals</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">use_binned_residuals</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">,</span> <span class="n">return_predictors</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">show_progress</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">suppress_warnings</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Backtesting of forecaster model following the folds generated by the TimeSeriesFold
class and using the metric(s) provided.</p>
<p>If <code>forecaster</code> is already trained and <code>initial_train_size</code> is set to <code>None</code> in the
TimeSeriesFold class, no initial train will be done and all data will be used
to evaluate the model. However, the first <code>len(forecaster.last_window)</code> observations
are needed to create the initial predictors, so no predictions are calculated for
them.</p>
<p>A copy of the original forecaster is created so that it is not modified during
the process.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>forecaster</code>
            </td>
            <td>
                  <code>(<span title="ForecasterRecursive">ForecasterRecursive</span>, <span title="ForecasterDirect">ForecasterDirect</span>, <span title="ForecasterEquivalentDate">ForecasterEquivalentDate</span>)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Forecaster model.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>y</code>
            </td>
            <td>
                  <code><span title="pandas.Series">Series</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Training time series.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>cv</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="TimeSeriesFold (spotforecast2.model_selection.split_ts_cv.TimeSeriesFold)" href="#spotforecast2.model_selection.split_ts_cv.TimeSeriesFold">TimeSeriesFold</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>TimeSeriesFold object with the information needed to
split the data into folds.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>metric</code>
            </td>
            <td>
                  <code><span title="str">str</span> | <span title="typing.Callable">Callable</span> | <span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Metric used to quantify the goodness of fit
of the model.</p>
<ul>
<li>If <code>str</code>: {'mean_squared_error', 'mean_absolute_error',
  'mean_absolute_percentage_error', 'mean_squared_log_error',
  'mean_absolute_scaled_error', 'root_mean_squared_scaled_error'}</li>
<li>If <code>Callable</code>: Function with arguments <code>y_true</code>, <code>y_pred</code> and <code>y_train</code>
  (Optional) that returns a float.</li>
<li>If <code>list</code>: List containing multiple strings and/or Callables.</li>
</ul>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>exog</code>
            </td>
            <td>
                  <code><span title="pandas.Series">Series</span> | <span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Exogenous variable/s included as
predictor/s. Must have the same number of observations as <code>y</code> and should
be aligned so that y[i] is regressed on exog[i]. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>interval</code>
            </td>
            <td>
                  <code><span title="float">float</span> | <span title="list">list</span> | <span title="tuple">tuple</span> | <span title="str">str</span> | <span title="object">object</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Specifies whether
probabilistic predictions should be estimated and the method to use.
The following options are supported:</p>
<ul>
<li>If <code>float</code>, represents the nominal (expected) coverage (between 0 and 1).
For instance, <code>interval=0.95</code> corresponds to <code>[2.5, 97.5]</code> percentiles.</li>
<li>If <code>list</code> or <code>tuple</code>: Sequence of percentiles to compute, each value must
  be between 0 and 100 inclusive. For example, a 95% confidence interval can
  be specified as <code>interval = [2.5, 97.5]</code> or multiple percentiles (e.g. 10,
  50 and 90) as <code>interval = [10, 50, 90]</code>.</li>
<li>If 'bootstrapping' (str): <code>n_boot</code> bootstrapping predictions will be
  generated.</li>
<li>If scipy.stats distribution object, the distribution parameters will
  be estimated for each prediction.</li>
<li>If None, no probabilistic predictions are estimated.
Defaults to None.</li>
</ul>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>interval_method</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Technique used to estimate prediction
intervals. Available options:</p>
<ul>
<li>'bootstrapping': Bootstrapping is used to generate prediction intervals.</li>
<li>'conformal': Employs the conformal prediction split method for
  interval estimation.
Defaults to 'bootstrapping'.</li>
</ul>
              </div>
            </td>
            <td>
                  <code>&#39;bootstrapping&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>n_boot</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of bootstrapping iterations to perform when
estimating prediction intervals. Defaults to 250.</p>
              </div>
            </td>
            <td>
                  <code>250</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>use_in_sample_residuals</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If <code>True</code>, residuals from the
training data are used as proxy of prediction error to create predictions.
If <code>False</code>, out of sample residuals (calibration) are used.
Out-of-sample residuals must be precomputed using Forecaster's
<code>set_out_sample_residuals()</code> method. Defaults to True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>use_binned_residuals</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If <code>True</code>, residuals are selected
based on the predicted values (binned selection).
If <code>False</code>, residuals are selected randomly. Defaults to True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>random_state</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Seed for the random number generator to
ensure reproducibility. Defaults to 123.</p>
              </div>
            </td>
            <td>
                  <code>123</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>return_predictors</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If <code>True</code>, the predictors used to make
the predictions are also returned. Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>n_jobs</code>
            </td>
            <td>
                  <code><span title="int">int</span> | <span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of jobs to run in parallel. If <code>-1</code>,
then the number of jobs is set to the number of cores. If 'auto', <code>n_jobs</code>
is set using the function <code>skforecast.utils.select_n_jobs_backtesting</code>.
Defaults to 'auto'.</p>
              </div>
            </td>
            <td>
                  <code>&#39;auto&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>verbose</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Print number of folds and index of training and
validation sets used for backtesting. Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>show_progress</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to show a progress bar.
Defaults to True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>suppress_warnings</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If <code>True</code>, spotforecast warnings will be
suppressed during the backtesting process. See
<code>spotforecast.exceptions.warn_skforecast_categories</code> for more information.
Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>tuple</code></td>            <td>
                  <code>(<span title="pandas.DataFrame">DataFrame</span>, <span title="pandas.DataFrame">DataFrame</span>)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <ul>
<li>metric_values: Value(s) of the metric(s).</li>
<li>
<p>backtest_predictions: Value of predictions. The DataFrame includes
  the following columns:</p>
</li>
<li>
<p>fold: Indicates the fold number where the prediction was made.</p>
</li>
<li>pred: Predicted values for the corresponding series and time steps.</li>
</ul>
<p>If <code>interval</code> is not <code>None</code>, additional columns are included depending
  on the method:</p>
<ul>
<li>For <code>float</code>: Columns <code>lower_bound</code> and <code>upper_bound</code>.</li>
<li>For <code>list</code> or <code>tuple</code> of 2 elements: Columns <code>lower_bound</code> and
    <code>upper_bound</code>.</li>
<li>For <code>list</code> or <code>tuple</code> with multiple percentiles: One column per
    percentile (e.g., <code>p_10</code>, <code>p_50</code>, <code>p_90</code>).</li>
<li>For <code>'bootstrapping'</code>: One column per bootstrapping iteration
    (e.g., <code>pred_boot_0</code>, <code>pred_boot_1</code>, ..., <code>pred_boot_n</code>).</li>
<li>For <code>scipy.stats</code> distribution objects: One column for each
    estimated parameter of the distribution (e.g., <code>loc</code>, <code>scale</code>).</li>
</ul>
<p>If <code>return_predictors</code> is <code>True</code>, one column per predictor is created.</p>
<p>Depending on the relation between <code>steps</code> and <code>fold_stride</code>, the output
  may include repeated indexes (if <code>fold_stride &lt; steps</code>) or gaps
  (if <code>fold_stride &gt; steps</code>). See Notes below for more details.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="notes" open>
  <summary>Notes</summary>
  <p>Note on <code>fold_stride</code> vs. <code>steps</code>:</p>
<ul>
<li>If <code>fold_stride == steps</code>, test sets are placed back-to-back without overlap.
  Each observation appears only once in the output DataFrame, so the
  index is unique.</li>
<li>If <code>fold_stride &lt; steps</code>, test sets overlap. Multiple forecasts are
  generated for the same observations and, therefore, the output
  DataFrame contains repeated indexes.</li>
<li>If <code>fold_stride &gt; steps</code>, there are gaps between consecutive test sets.
  Some observations in the series will not have associated predictions,
  so the output DataFrame has non-contiguous indexes.</li>
</ul>
</details>

<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.ensemble</span><span class="w"> </span><span class="kn">import</span> <span class="n">RandomForestRegressor</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">spotforecast2.forecaster.recursive</span><span class="w"> </span><span class="kn">import</span> <span class="n">ForecasterRecursive</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">spotforecast2.model_selection</span><span class="w"> </span><span class="kn">import</span> <span class="n">backtesting_forecaster</span><span class="p">,</span> <span class="n">TimeSeriesFold</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">y</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">forecaster</span> <span class="o">=</span> <span class="n">ForecasterRecursive</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">estimator</span><span class="o">=</span><span class="n">RandomForestRegressor</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">),</span>
<span class="gp">... </span>    <span class="n">lags</span><span class="o">=</span><span class="mi">2</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cv</span> <span class="o">=</span> <span class="n">TimeSeriesFold</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">steps</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">initial_train_size</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">refit</span><span class="o">=</span><span class="kc">False</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">metric_values</span><span class="p">,</span> <span class="n">backtest_predictions</span> <span class="o">=</span> <span class="n">backtesting_forecaster</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">forecaster</span><span class="o">=</span><span class="n">forecaster</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">cv</span><span class="o">=</span><span class="n">cv</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">metric</span><span class="o">=</span><span class="s1">&#39;mean_squared_error&#39;</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">metric_values</span>
<span class="go">   mean_squared_error</span>
<span class="go">0            0.201334</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">backtest_predictions</span>
<span class="go">   fold  pred</span>
<span class="go">5     0  5.18</span>
<span class="go">6     0  6.10</span>
<span class="go">7     1  7.36</span>
<span class="go">8     1  8.40</span>
<span class="go">9     2  9.31</span>
</code></pre></div>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/spotforecast2/model_selection/validation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">backtesting_forecaster</span><span class="p">(</span>
    <span class="n">forecaster</span><span class="p">:</span> <span class="nb">object</span><span class="p">,</span>
    <span class="n">y</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span>
    <span class="n">cv</span><span class="p">:</span> <span class="n">TimeSeriesFold</span><span class="p">,</span>
    <span class="n">metric</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Callable</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="n">Callable</span><span class="p">],</span>
    <span class="n">exog</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span> <span class="o">|</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">interval</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">object</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">interval_method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;bootstrapping&quot;</span><span class="p">,</span>
    <span class="n">n_boot</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">250</span><span class="p">,</span>
    <span class="n">use_in_sample_residuals</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">use_binned_residuals</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">random_state</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">123</span><span class="p">,</span>
    <span class="n">return_predictors</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">n_jobs</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;auto&quot;</span><span class="p">,</span>
    <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">show_progress</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">suppress_warnings</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Backtesting of forecaster model following the folds generated by the TimeSeriesFold</span>
<span class="sd">    class and using the metric(s) provided.</span>

<span class="sd">    If `forecaster` is already trained and `initial_train_size` is set to `None` in the</span>
<span class="sd">    TimeSeriesFold class, no initial train will be done and all data will be used</span>
<span class="sd">    to evaluate the model. However, the first `len(forecaster.last_window)` observations</span>
<span class="sd">    are needed to create the initial predictors, so no predictions are calculated for</span>
<span class="sd">    them.</span>

<span class="sd">    A copy of the original forecaster is created so that it is not modified during</span>
<span class="sd">    the process.</span>

<span class="sd">    Args:</span>
<span class="sd">        forecaster (ForecasterRecursive, ForecasterDirect, ForecasterEquivalentDate):</span>
<span class="sd">            Forecaster model.</span>
<span class="sd">        y (pd.Series): Training time series.</span>
<span class="sd">        cv (TimeSeriesFold): TimeSeriesFold object with the information needed to</span>
<span class="sd">            split the data into folds.</span>
<span class="sd">        metric (str | Callable | list): Metric used to quantify the goodness of fit</span>
<span class="sd">            of the model.</span>

<span class="sd">            - If `str`: {&#39;mean_squared_error&#39;, &#39;mean_absolute_error&#39;,</span>
<span class="sd">              &#39;mean_absolute_percentage_error&#39;, &#39;mean_squared_log_error&#39;,</span>
<span class="sd">              &#39;mean_absolute_scaled_error&#39;, &#39;root_mean_squared_scaled_error&#39;}</span>
<span class="sd">            - If `Callable`: Function with arguments `y_true`, `y_pred` and `y_train`</span>
<span class="sd">              (Optional) that returns a float.</span>
<span class="sd">            - If `list`: List containing multiple strings and/or Callables.</span>
<span class="sd">        exog (pd.Series | pd.DataFrame, optional): Exogenous variable/s included as</span>
<span class="sd">            predictor/s. Must have the same number of observations as `y` and should</span>
<span class="sd">            be aligned so that y[i] is regressed on exog[i]. Defaults to None.</span>
<span class="sd">        interval (float | list | tuple | str | object, optional): Specifies whether</span>
<span class="sd">            probabilistic predictions should be estimated and the method to use.</span>
<span class="sd">            The following options are supported:</span>

<span class="sd">            - If `float`, represents the nominal (expected) coverage (between 0 and 1).</span>
<span class="sd">            For instance, `interval=0.95` corresponds to `[2.5, 97.5]` percentiles.</span>
<span class="sd">            - If `list` or `tuple`: Sequence of percentiles to compute, each value must</span>
<span class="sd">              be between 0 and 100 inclusive. For example, a 95% confidence interval can</span>
<span class="sd">              be specified as `interval = [2.5, 97.5]` or multiple percentiles (e.g. 10,</span>
<span class="sd">              50 and 90) as `interval = [10, 50, 90]`.</span>
<span class="sd">            - If &#39;bootstrapping&#39; (str): `n_boot` bootstrapping predictions will be</span>
<span class="sd">              generated.</span>
<span class="sd">            - If scipy.stats distribution object, the distribution parameters will</span>
<span class="sd">              be estimated for each prediction.</span>
<span class="sd">            - If None, no probabilistic predictions are estimated.</span>
<span class="sd">            Defaults to None.</span>
<span class="sd">        interval_method (str, optional): Technique used to estimate prediction</span>
<span class="sd">            intervals. Available options:</span>

<span class="sd">            - &#39;bootstrapping&#39;: Bootstrapping is used to generate prediction intervals.</span>
<span class="sd">            - &#39;conformal&#39;: Employs the conformal prediction split method for</span>
<span class="sd">              interval estimation.</span>
<span class="sd">            Defaults to &#39;bootstrapping&#39;.</span>
<span class="sd">        n_boot (int, optional): Number of bootstrapping iterations to perform when</span>
<span class="sd">            estimating prediction intervals. Defaults to 250.</span>
<span class="sd">        use_in_sample_residuals (bool, optional): If `True`, residuals from the</span>
<span class="sd">            training data are used as proxy of prediction error to create predictions.</span>
<span class="sd">            If `False`, out of sample residuals (calibration) are used.</span>
<span class="sd">            Out-of-sample residuals must be precomputed using Forecaster&#39;s</span>
<span class="sd">            `set_out_sample_residuals()` method. Defaults to True.</span>
<span class="sd">        use_binned_residuals (bool, optional): If `True`, residuals are selected</span>
<span class="sd">            based on the predicted values (binned selection).</span>
<span class="sd">            If `False`, residuals are selected randomly. Defaults to True.</span>
<span class="sd">        random_state (int, optional): Seed for the random number generator to</span>
<span class="sd">            ensure reproducibility. Defaults to 123.</span>
<span class="sd">        return_predictors (bool, optional): If `True`, the predictors used to make</span>
<span class="sd">            the predictions are also returned. Defaults to False.</span>
<span class="sd">        n_jobs (int | str, optional): The number of jobs to run in parallel. If `-1`,</span>
<span class="sd">            then the number of jobs is set to the number of cores. If &#39;auto&#39;, `n_jobs`</span>
<span class="sd">            is set using the function `skforecast.utils.select_n_jobs_backtesting`.</span>
<span class="sd">            Defaults to &#39;auto&#39;.</span>
<span class="sd">        verbose (bool, optional): Print number of folds and index of training and</span>
<span class="sd">            validation sets used for backtesting. Defaults to False.</span>
<span class="sd">        show_progress (bool, optional): Whether to show a progress bar.</span>
<span class="sd">            Defaults to True.</span>
<span class="sd">        suppress_warnings (bool, optional): If `True`, spotforecast warnings will be</span>
<span class="sd">            suppressed during the backtesting process. See</span>
<span class="sd">            `spotforecast.exceptions.warn_skforecast_categories` for more information.</span>
<span class="sd">            Defaults to False.</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple (pd.DataFrame, pd.DataFrame):</span>
<span class="sd">            - metric_values: Value(s) of the metric(s).</span>
<span class="sd">            - backtest_predictions: Value of predictions. The DataFrame includes</span>
<span class="sd">              the following columns:</span>

<span class="sd">              - fold: Indicates the fold number where the prediction was made.</span>
<span class="sd">              - pred: Predicted values for the corresponding series and time steps.</span>

<span class="sd">              If `interval` is not `None`, additional columns are included depending</span>
<span class="sd">              on the method:</span>

<span class="sd">              - For `float`: Columns `lower_bound` and `upper_bound`.</span>
<span class="sd">              - For `list` or `tuple` of 2 elements: Columns `lower_bound` and</span>
<span class="sd">                `upper_bound`.</span>
<span class="sd">              - For `list` or `tuple` with multiple percentiles: One column per</span>
<span class="sd">                percentile (e.g., `p_10`, `p_50`, `p_90`).</span>
<span class="sd">              - For `&#39;bootstrapping&#39;`: One column per bootstrapping iteration</span>
<span class="sd">                (e.g., `pred_boot_0`, `pred_boot_1`, ..., `pred_boot_n`).</span>
<span class="sd">              - For `scipy.stats` distribution objects: One column for each</span>
<span class="sd">                estimated parameter of the distribution (e.g., `loc`, `scale`).</span>

<span class="sd">              If `return_predictors` is `True`, one column per predictor is created.</span>

<span class="sd">              Depending on the relation between `steps` and `fold_stride`, the output</span>
<span class="sd">              may include repeated indexes (if `fold_stride &lt; steps`) or gaps</span>
<span class="sd">              (if `fold_stride &gt; steps`). See Notes below for more details.</span>

<span class="sd">    Notes:</span>
<span class="sd">        Note on `fold_stride` vs. `steps`:</span>

<span class="sd">        - If `fold_stride == steps`, test sets are placed back-to-back without overlap.</span>
<span class="sd">          Each observation appears only once in the output DataFrame, so the</span>
<span class="sd">          index is unique.</span>
<span class="sd">        - If `fold_stride &lt; steps`, test sets overlap. Multiple forecasts are</span>
<span class="sd">          generated for the same observations and, therefore, the output</span>
<span class="sd">          DataFrame contains repeated indexes.</span>
<span class="sd">        - If `fold_stride &gt; steps`, there are gaps between consecutive test sets.</span>
<span class="sd">          Some observations in the series will not have associated predictions,</span>
<span class="sd">          so the output DataFrame has non-contiguous indexes.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; import pandas as pd</span>
<span class="sd">        &gt;&gt;&gt; from sklearn.ensemble import RandomForestRegressor</span>
<span class="sd">        &gt;&gt;&gt; from spotforecast2.forecaster.recursive import ForecasterRecursive</span>
<span class="sd">        &gt;&gt;&gt; from spotforecast2.model_selection import backtesting_forecaster, TimeSeriesFold</span>
<span class="sd">        &gt;&gt;&gt; y = pd.Series([1, 2, 3, 4, 5, 6, 7, 8, 9, 10])</span>
<span class="sd">        &gt;&gt;&gt; forecaster = ForecasterRecursive(</span>
<span class="sd">        ...     estimator=RandomForestRegressor(random_state=123),</span>
<span class="sd">        ...     lags=2</span>
<span class="sd">        ... )</span>
<span class="sd">        &gt;&gt;&gt; cv = TimeSeriesFold(</span>
<span class="sd">        ...     steps=2,</span>
<span class="sd">        ...     initial_train_size=5,</span>
<span class="sd">        ...     refit=False</span>
<span class="sd">        ... )</span>
<span class="sd">        &gt;&gt;&gt; metric_values, backtest_predictions = backtesting_forecaster(</span>
<span class="sd">        ...     forecaster=forecaster,</span>
<span class="sd">        ...     y=y,</span>
<span class="sd">        ...     cv=cv,</span>
<span class="sd">        ...     metric=&#39;mean_squared_error&#39;</span>
<span class="sd">        ... )</span>
<span class="sd">        &gt;&gt;&gt; metric_values</span>
<span class="sd">           mean_squared_error</span>
<span class="sd">        0            0.201334</span>
<span class="sd">        &gt;&gt;&gt; backtest_predictions</span>
<span class="sd">           fold  pred</span>
<span class="sd">        5     0  5.18</span>
<span class="sd">        6     0  6.10</span>
<span class="sd">        7     1  7.36</span>
<span class="sd">        8     1  8.40</span>
<span class="sd">        9     2  9.31</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">forecaters_allowed</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;ForecasterRecursive&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ForecasterDirect&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ForecasterEquivalentDate&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ForecasterRecursiveClassifier&quot;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">forecaster</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">forecaters_allowed</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;`forecaster` must be of type </span><span class="si">{</span><span class="n">forecaters_allowed</span><span class="si">}</span><span class="s2">. For all other &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;types of forecasters use the other functions available in the &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;`model_selection` module.&quot;</span>
        <span class="p">)</span>

    <span class="n">check_backtesting_input</span><span class="p">(</span>
        <span class="n">forecaster</span><span class="o">=</span><span class="n">forecaster</span><span class="p">,</span>
        <span class="n">cv</span><span class="o">=</span><span class="n">cv</span><span class="p">,</span>
        <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span>
        <span class="n">metric</span><span class="o">=</span><span class="n">metric</span><span class="p">,</span>
        <span class="n">interval</span><span class="o">=</span><span class="n">interval</span><span class="p">,</span>
        <span class="n">interval_method</span><span class="o">=</span><span class="n">interval_method</span><span class="p">,</span>
        <span class="n">n_boot</span><span class="o">=</span><span class="n">n_boot</span><span class="p">,</span>
        <span class="n">use_in_sample_residuals</span><span class="o">=</span><span class="n">use_in_sample_residuals</span><span class="p">,</span>
        <span class="n">use_binned_residuals</span><span class="o">=</span><span class="n">use_binned_residuals</span><span class="p">,</span>
        <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">,</span>
        <span class="n">return_predictors</span><span class="o">=</span><span class="n">return_predictors</span><span class="p">,</span>
        <span class="n">n_jobs</span><span class="o">=</span><span class="n">n_jobs</span><span class="p">,</span>
        <span class="n">show_progress</span><span class="o">=</span><span class="n">show_progress</span><span class="p">,</span>
        <span class="n">suppress_warnings</span><span class="o">=</span><span class="n">suppress_warnings</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">metric_values</span><span class="p">,</span> <span class="n">backtest_predictions</span> <span class="o">=</span> <span class="n">_backtesting_forecaster</span><span class="p">(</span>
        <span class="n">forecaster</span><span class="o">=</span><span class="n">forecaster</span><span class="p">,</span>
        <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span>
        <span class="n">cv</span><span class="o">=</span><span class="n">cv</span><span class="p">,</span>
        <span class="n">metric</span><span class="o">=</span><span class="n">metric</span><span class="p">,</span>
        <span class="n">exog</span><span class="o">=</span><span class="n">exog</span><span class="p">,</span>
        <span class="n">interval</span><span class="o">=</span><span class="n">interval</span><span class="p">,</span>
        <span class="n">interval_method</span><span class="o">=</span><span class="n">interval_method</span><span class="p">,</span>
        <span class="n">n_boot</span><span class="o">=</span><span class="n">n_boot</span><span class="p">,</span>
        <span class="n">use_in_sample_residuals</span><span class="o">=</span><span class="n">use_in_sample_residuals</span><span class="p">,</span>
        <span class="n">use_binned_residuals</span><span class="o">=</span><span class="n">use_binned_residuals</span><span class="p">,</span>
        <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">,</span>
        <span class="n">return_predictors</span><span class="o">=</span><span class="n">return_predictors</span><span class="p">,</span>
        <span class="n">n_jobs</span><span class="o">=</span><span class="n">n_jobs</span><span class="p">,</span>
        <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
        <span class="n">show_progress</span><span class="o">=</span><span class="n">show_progress</span><span class="p">,</span>
        <span class="n">suppress_warnings</span><span class="o">=</span><span class="n">suppress_warnings</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">metric_values</span><span class="p">,</span> <span class="n">backtest_predictions</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="spotforecast2.model_selection.grid_search" class="doc doc-heading">
            <code>spotforecast2.model_selection.grid_search</code>


</h2>

    <div class="doc doc-contents first">










<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="spotforecast2.model_selection.grid_search.grid_search_forecaster" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">grid_search_forecaster</span><span class="p">(</span><span class="n">forecaster</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">cv</span><span class="p">,</span> <span class="n">param_grid</span><span class="p">,</span> <span class="n">metric</span><span class="p">,</span> <span class="n">exog</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lags_grid</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">return_best</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">show_progress</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">suppress_warnings</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">output_file</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Exhaustive grid search over parameter values for a Forecaster.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/spotforecast2/model_selection/grid_search.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">grid_search_forecaster</span><span class="p">(</span>
    <span class="n">forecaster</span><span class="p">:</span> <span class="nb">object</span><span class="p">,</span>
    <span class="n">y</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span>
    <span class="n">cv</span><span class="p">:</span> <span class="n">TimeSeriesFold</span> <span class="o">|</span> <span class="n">OneStepAheadFold</span><span class="p">,</span>
    <span class="n">param_grid</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
    <span class="n">metric</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Callable</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="n">Callable</span><span class="p">],</span>
    <span class="n">exog</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span> <span class="o">|</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">lags_grid</span><span class="p">:</span> <span class="p">(</span>
        <span class="nb">list</span><span class="p">[</span><span class="nb">int</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="nb">range</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span>
        <span class="o">|</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="nb">range</span><span class="p">[</span><span class="nb">int</span><span class="p">]]]</span>
        <span class="o">|</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">return_best</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">n_jobs</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;auto&quot;</span><span class="p">,</span>
    <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">show_progress</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">suppress_warnings</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">output_file</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Exhaustive grid search over parameter values for a Forecaster.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">param_grid</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">ParameterGrid</span><span class="p">(</span><span class="n">param_grid</span><span class="p">))</span>

    <span class="n">results</span> <span class="o">=</span> <span class="n">_evaluate_grid_hyperparameters</span><span class="p">(</span>
        <span class="n">forecaster</span><span class="o">=</span><span class="n">forecaster</span><span class="p">,</span>
        <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span>
        <span class="n">cv</span><span class="o">=</span><span class="n">cv</span><span class="p">,</span>
        <span class="n">param_grid</span><span class="o">=</span><span class="n">param_grid</span><span class="p">,</span>
        <span class="n">metric</span><span class="o">=</span><span class="n">metric</span><span class="p">,</span>
        <span class="n">exog</span><span class="o">=</span><span class="n">exog</span><span class="p">,</span>
        <span class="n">lags_grid</span><span class="o">=</span><span class="n">lags_grid</span><span class="p">,</span>
        <span class="n">return_best</span><span class="o">=</span><span class="n">return_best</span><span class="p">,</span>
        <span class="n">n_jobs</span><span class="o">=</span><span class="n">n_jobs</span><span class="p">,</span>
        <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
        <span class="n">show_progress</span><span class="o">=</span><span class="n">show_progress</span><span class="p">,</span>
        <span class="n">suppress_warnings</span><span class="o">=</span><span class="n">suppress_warnings</span><span class="p">,</span>
        <span class="n">output_file</span><span class="o">=</span><span class="n">output_file</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">results</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="spotforecast2.model_selection.bayesian_search" class="doc doc-heading">
            <code>spotforecast2.model_selection.bayesian_search</code>


</h2>

    <div class="doc doc-contents first">

        <p>Bayesian hyperparameter search functions for forecasters using Optuna.</p>










<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="spotforecast2.model_selection.bayesian_search.bayesian_search_forecaster" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">bayesian_search_forecaster</span><span class="p">(</span><span class="n">forecaster</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">cv</span><span class="p">,</span> <span class="n">search_space</span><span class="p">,</span> <span class="n">metric</span><span class="p">,</span> <span class="n">exog</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">n_trials</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">,</span> <span class="n">return_best</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">show_progress</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">suppress_warnings</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">output_file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">kwargs_create_study</span><span class="o">=</span><span class="p">{},</span> <span class="n">kwargs_study_optimize</span><span class="o">=</span><span class="p">{})</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Bayesian hyperparameter optimization for a Forecaster using Optuna.</p>
<p>Performs Bayesian hyperparameter search using the Optuna library for a
Forecaster object. Validation is done using time series backtesting with
the provided cross-validation strategy.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>forecaster</code>
            </td>
            <td>
                  <code><span title="object">object</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Forecaster model. Can be ForecasterRecursive, ForecasterDirect,
or any compatible forecaster class.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>y</code>
            </td>
            <td>
                  <code><span title="pandas.Series">Series</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Training time series values. Must be a pandas Series with a
datetime or numeric index.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>cv</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="TimeSeriesFold (spotforecast2.model_selection.split_ts_cv.TimeSeriesFold)" href="#spotforecast2.model_selection.split_ts_cv.TimeSeriesFold">TimeSeriesFold</a> | <span title="spotforecast2.model_selection.split_one_step.OneStepAheadFold">OneStepAheadFold</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Cross-validation strategy with information needed to split the data
into folds. Must be an instance of TimeSeriesFold or OneStepAheadFold.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>search_space</code>
            </td>
            <td>
                  <code><span title="typing.Callable">Callable</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Callable function with argument <code>trial</code> that returns
a dictionary with parameter names (str) as keys and Trial objects
from optuna (trial.suggest_float, trial.suggest_int,
trial.suggest_categorical) as values. Can optionally include 'lags'
key to search over different lag configurations.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>metric</code>
            </td>
            <td>
                  <code><span title="str">str</span> | <span title="typing.Callable">Callable</span> | <span title="list">list</span>[<span title="str">str</span> | <span title="typing.Callable">Callable</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Metric(s) to quantify model goodness of fit. Can be:
- str: One of 'mean_squared_error', 'mean_absolute_error',
  'mean_absolute_percentage_error', 'mean_squared_log_error',
  'mean_absolute_scaled_error', 'root_mean_squared_scaled_error'.
- Callable: Function with arguments (y_true, y_pred) or
  (y_true, y_pred, y_train) that returns a float.
- list: List containing multiple strings and/or Callables.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>exog</code>
            </td>
            <td>
                  <code><span title="pandas.Series">Series</span> | <span title="pandas.DataFrame">DataFrame</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Exogenous variable(s) included as predictors. Must have the
same number of observations as <code>y</code> and aligned so that y[i] is
regressed on exog[i]. Default is None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>n_trials</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of parameter settings sampled during optimization.
Default is 10.</p>
              </div>
            </td>
            <td>
                  <code>10</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>random_state</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Seed for sampling reproducibility. When passing a custom
sampler in kwargs_create_study, set the seed within the sampler
(e.g., {'sampler': TPESampler(seed=145)}). Default is 123.</p>
              </div>
            </td>
            <td>
                  <code>123</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>return_best</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, refit the forecaster using the best parameters
found on the whole dataset at the end. Default is True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>n_jobs</code>
            </td>
            <td>
                  <code><span title="int">int</span> | <span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of parallel jobs. If -1, uses all cores. If 'auto',
uses spotforecast.skforecast.utils.select_n_jobs_backtesting to
automatically determine the number of jobs. Default is 'auto'.</p>
              </div>
            </td>
            <td>
                  <code>&#39;auto&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>verbose</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, print number of folds used for cross-validation.
Default is False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>show_progress</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to show an Optuna progress bar during
optimization. Default is True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>suppress_warnings</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, suppress spotforecast warnings during
hyperparameter search. Default is False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>output_file</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Filename or full path to save results as TSV. If None,
results are not saved to file. Default is None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>kwargs_create_study</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Additional keyword arguments passed to
optuna.create_study(). If not specified, direction is set to
'minimize' and TPESampler(seed=123) is used. Default is {}.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>kwargs_study_optimize</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Additional keyword arguments passed to
study.optimize(). Default is {}.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="tuple">tuple</span>[<span title="pandas.DataFrame">DataFrame</span>, <span title="object">object</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>tuple[pd.DataFrame, object]: A tuple containing:
- results: DataFrame with columns 'lags', 'params', metric values,
  and individual parameter columns. Sorted by the first metric.
- best_trial: Best optimization result as an optuna.FrozenTrial
  object containing the best parameters and metric value.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If exog length doesn't match y length when return_best=True.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="TypeError">TypeError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If cv is not an instance of TimeSeriesFold or OneStepAheadFold.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If metric list contains duplicate metric names.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/spotforecast2/model_selection/bayesian_search.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">bayesian_search_forecaster</span><span class="p">(</span>
    <span class="n">forecaster</span><span class="p">:</span> <span class="nb">object</span><span class="p">,</span>
    <span class="n">y</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span>
    <span class="n">cv</span><span class="p">:</span> <span class="n">TimeSeriesFold</span> <span class="o">|</span> <span class="n">OneStepAheadFold</span><span class="p">,</span>
    <span class="n">search_space</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span>
    <span class="n">metric</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Callable</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="n">Callable</span><span class="p">],</span>
    <span class="n">exog</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span> <span class="o">|</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">n_trials</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
    <span class="n">random_state</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">123</span><span class="p">,</span>
    <span class="n">return_best</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">n_jobs</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;auto&quot;</span><span class="p">,</span>
    <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">show_progress</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">suppress_warnings</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">output_file</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">kwargs_create_study</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span>
    <span class="n">kwargs_study_optimize</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="nb">object</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Bayesian hyperparameter optimization for a Forecaster using Optuna.</span>

<span class="sd">    Performs Bayesian hyperparameter search using the Optuna library for a</span>
<span class="sd">    Forecaster object. Validation is done using time series backtesting with</span>
<span class="sd">    the provided cross-validation strategy.</span>

<span class="sd">    Args:</span>
<span class="sd">        forecaster: Forecaster model. Can be ForecasterRecursive, ForecasterDirect,</span>
<span class="sd">            or any compatible forecaster class.</span>
<span class="sd">        y: Training time series values. Must be a pandas Series with a</span>
<span class="sd">            datetime or numeric index.</span>
<span class="sd">        cv: Cross-validation strategy with information needed to split the data</span>
<span class="sd">            into folds. Must be an instance of TimeSeriesFold or OneStepAheadFold.</span>
<span class="sd">        search_space: Callable function with argument `trial` that returns</span>
<span class="sd">            a dictionary with parameter names (str) as keys and Trial objects</span>
<span class="sd">            from optuna (trial.suggest_float, trial.suggest_int,</span>
<span class="sd">            trial.suggest_categorical) as values. Can optionally include &#39;lags&#39;</span>
<span class="sd">            key to search over different lag configurations.</span>
<span class="sd">        metric: Metric(s) to quantify model goodness of fit. Can be:</span>
<span class="sd">            - str: One of &#39;mean_squared_error&#39;, &#39;mean_absolute_error&#39;,</span>
<span class="sd">              &#39;mean_absolute_percentage_error&#39;, &#39;mean_squared_log_error&#39;,</span>
<span class="sd">              &#39;mean_absolute_scaled_error&#39;, &#39;root_mean_squared_scaled_error&#39;.</span>
<span class="sd">            - Callable: Function with arguments (y_true, y_pred) or</span>
<span class="sd">              (y_true, y_pred, y_train) that returns a float.</span>
<span class="sd">            - list: List containing multiple strings and/or Callables.</span>
<span class="sd">        exog: Exogenous variable(s) included as predictors. Must have the</span>
<span class="sd">            same number of observations as `y` and aligned so that y[i] is</span>
<span class="sd">            regressed on exog[i]. Default is None.</span>
<span class="sd">        n_trials: Number of parameter settings sampled during optimization.</span>
<span class="sd">            Default is 10.</span>
<span class="sd">        random_state: Seed for sampling reproducibility. When passing a custom</span>
<span class="sd">            sampler in kwargs_create_study, set the seed within the sampler</span>
<span class="sd">            (e.g., {&#39;sampler&#39;: TPESampler(seed=145)}). Default is 123.</span>
<span class="sd">        return_best: If True, refit the forecaster using the best parameters</span>
<span class="sd">            found on the whole dataset at the end. Default is True.</span>
<span class="sd">        n_jobs: Number of parallel jobs. If -1, uses all cores. If &#39;auto&#39;,</span>
<span class="sd">            uses spotforecast.skforecast.utils.select_n_jobs_backtesting to</span>
<span class="sd">            automatically determine the number of jobs. Default is &#39;auto&#39;.</span>
<span class="sd">        verbose: If True, print number of folds used for cross-validation.</span>
<span class="sd">            Default is False.</span>
<span class="sd">        show_progress: Whether to show an Optuna progress bar during</span>
<span class="sd">            optimization. Default is True.</span>
<span class="sd">        suppress_warnings: If True, suppress spotforecast warnings during</span>
<span class="sd">            hyperparameter search. Default is False.</span>
<span class="sd">        output_file: Filename or full path to save results as TSV. If None,</span>
<span class="sd">            results are not saved to file. Default is None.</span>
<span class="sd">        kwargs_create_study: Additional keyword arguments passed to</span>
<span class="sd">            optuna.create_study(). If not specified, direction is set to</span>
<span class="sd">            &#39;minimize&#39; and TPESampler(seed=123) is used. Default is {}.</span>
<span class="sd">        kwargs_study_optimize: Additional keyword arguments passed to</span>
<span class="sd">            study.optimize(). Default is {}.</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple[pd.DataFrame, object]: A tuple containing:</span>
<span class="sd">            - results: DataFrame with columns &#39;lags&#39;, &#39;params&#39;, metric values,</span>
<span class="sd">              and individual parameter columns. Sorted by the first metric.</span>
<span class="sd">            - best_trial: Best optimization result as an optuna.FrozenTrial</span>
<span class="sd">              object containing the best parameters and metric value.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If exog length doesn&#39;t match y length when return_best=True.</span>
<span class="sd">        TypeError: If cv is not an instance of TimeSeriesFold or OneStepAheadFold.</span>
<span class="sd">        ValueError: If metric list contains duplicate metric names.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">return_best</span> <span class="ow">and</span> <span class="n">exog</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">exog</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;`exog` must have same number of samples as `y`. &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;length `exog`: (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">exog</span><span class="p">)</span><span class="si">}</span><span class="s2">), length `y`: (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="p">)</span>

    <span class="n">results</span><span class="p">,</span> <span class="n">best_trial</span> <span class="o">=</span> <span class="n">_bayesian_search_optuna</span><span class="p">(</span>
        <span class="n">forecaster</span><span class="o">=</span><span class="n">forecaster</span><span class="p">,</span>
        <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span>
        <span class="n">cv</span><span class="o">=</span><span class="n">cv</span><span class="p">,</span>
        <span class="n">exog</span><span class="o">=</span><span class="n">exog</span><span class="p">,</span>
        <span class="n">search_space</span><span class="o">=</span><span class="n">search_space</span><span class="p">,</span>
        <span class="n">metric</span><span class="o">=</span><span class="n">metric</span><span class="p">,</span>
        <span class="n">n_trials</span><span class="o">=</span><span class="n">n_trials</span><span class="p">,</span>
        <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">,</span>
        <span class="n">return_best</span><span class="o">=</span><span class="n">return_best</span><span class="p">,</span>
        <span class="n">n_jobs</span><span class="o">=</span><span class="n">n_jobs</span><span class="p">,</span>
        <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
        <span class="n">show_progress</span><span class="o">=</span><span class="n">show_progress</span><span class="p">,</span>
        <span class="n">suppress_warnings</span><span class="o">=</span><span class="n">suppress_warnings</span><span class="p">,</span>
        <span class="n">output_file</span><span class="o">=</span><span class="n">output_file</span><span class="p">,</span>
        <span class="n">kwargs_create_study</span><span class="o">=</span><span class="n">kwargs_create_study</span><span class="p">,</span>
        <span class="n">kwargs_study_optimize</span><span class="o">=</span><span class="n">kwargs_study_optimize</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">results</span><span class="p">,</span> <span class="n">best_trial</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="spotforecast2.model_selection.split_ts_cv" class="doc doc-heading">
            <code>spotforecast2.model_selection.split_ts_cv</code>


</h2>

    <div class="doc doc-contents first">

        <p>Time series cross-validation splitting.</p>










<div class="doc doc-children">









<div class="doc doc-object doc-class">



<h3 id="spotforecast2.model_selection.split_ts_cv.TimeSeriesFold" class="doc doc-heading">
            <code>TimeSeriesFold</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="spotforecast2.model_selection.split_base.BaseFold">BaseFold</span></code></p>



        <p>Class to split time series data into train and test folds.</p>
<p>When used within a backtesting or hyperparameter search, the arguments
'initial_train_size', 'window_size' and 'differentiation' are not required
as they are automatically set by the backtesting or hyperparameter search
functions.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>steps</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of observations used to be predicted in each fold.
This is also commonly referred to as the forecast horizon or test size.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>initial_train_size</code>
            </td>
            <td>
                  <code><span title="int">int</span> | <span title="str">str</span> | <span title="pandas.Timestamp">Timestamp</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of observations used for initial training.</p>
<ul>
<li>If <code>None</code> or 0, the initial forecaster is not trained in the first fold.</li>
<li>If an integer, the number of observations used for initial training.</li>
<li>If a date string or pandas Timestamp, it is the last date included in
  the initial training set.</li>
</ul>
<p>Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>fold_stride</code>
            </td>
            <td>
                  <code><span title="int">int</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of observations that the start of the test set
advances between consecutive folds.</p>
<ul>
<li>If <code>None</code>, it defaults to the same value as <code>steps</code>, meaning that folds
  are placed back-to-back without overlap.</li>
<li>If <code>fold_stride &lt; steps</code>, test sets overlap and multiple forecasts will
  be generated for the same observations.</li>
<li>If <code>fold_stride &gt; steps</code>, gaps are left between consecutive test sets.</li>
</ul>
<p>Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>window_size</code>
            </td>
            <td>
                  <code><span title="int">int</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of observations needed to generate the
autoregressive predictors. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>differentiation</code>
            </td>
            <td>
                  <code><span title="int">int</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of observations to use for differentiation.
This is used to extend the <code>last_window</code> as many observations as the
differentiation order. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>refit</code>
            </td>
            <td>
                  <code><span title="bool">bool</span> | <span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to refit the forecaster in each fold.</p>
<ul>
<li>If <code>True</code>, the forecaster is refitted in each fold.</li>
<li>If <code>False</code>, the forecaster is trained only in the first fold.</li>
<li>If an integer, the forecaster is trained in the first fold and then refitted
  every <code>refit</code> folds.</li>
</ul>
<p>Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>fixed_train_size</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether the training size is fixed or increases
in each fold. Defaults to True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>gap</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of observations between the end of the training set
and the start of the test set. Defaults to 0.</p>
              </div>
            </td>
            <td>
                  <code>0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>skip_folds</code>
            </td>
            <td>
                  <code><span title="int">int</span> | <span title="list">list</span>[<span title="int">int</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of folds to skip.</p>
<ul>
<li>If an integer, every 'skip_folds'-th is returned.</li>
<li>If a list, the indexes of the folds to skip.</li>
</ul>
<p>For example, if <code>skip_folds=3</code> and there are 10 folds, the returned folds are
0, 3, 6, and 9. If <code>skip_folds=[1, 2, 3]</code>, the returned folds are 0, 4, 5, 6, 7,
8, and 9. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>allow_incomplete_fold</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to allow the last fold to include
fewer observations than <code>steps</code>. If <code>False</code>, the last fold is excluded if it
is incomplete. Defaults to True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>return_all_indexes</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to return all indexes or only the
start and end indexes of each fold. Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>verbose</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to print information about generated folds.
Defaults to True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="spotforecast2.model_selection.split_ts_cv.TimeSeriesFold.steps">steps</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of observations used to be predicted in each fold.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="spotforecast2.model_selection.split_ts_cv.TimeSeriesFold.initial_train_size">initial_train_size</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of observations used for initial training.
If <code>None</code> or 0, the initial forecaster is not trained in the first fold.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="spotforecast2.model_selection.split_ts_cv.TimeSeriesFold.fold_stride">fold_stride</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of observations that the start of the test set
advances between consecutive folds.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="spotforecast2.model_selection.split_ts_cv.TimeSeriesFold.overlapping_folds">overlapping_folds</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether the folds overlap.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="spotforecast2.model_selection.split_ts_cv.TimeSeriesFold.window_size">window_size</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of observations needed to generate the
autoregressive predictors.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="spotforecast2.model_selection.split_ts_cv.TimeSeriesFold.differentiation">differentiation</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of observations to use for differentiation.
This is used to extend the <code>last_window</code> as many observations as the
differentiation order.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="spotforecast2.model_selection.split_ts_cv.TimeSeriesFold.refit">refit</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to refit the forecaster in each fold.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="spotforecast2.model_selection.split_ts_cv.TimeSeriesFold.fixed_train_size">fixed_train_size</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether the training size is fixed or increases in each fold.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="spotforecast2.model_selection.split_ts_cv.TimeSeriesFold.gap">gap</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of observations between the end of the training set and the
start of the test set.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="spotforecast2.model_selection.split_ts_cv.TimeSeriesFold.skip_folds">skip_folds</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of folds to skip.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="spotforecast2.model_selection.split_ts_cv.TimeSeriesFold.allow_incomplete_fold">allow_incomplete_fold</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to allow the last fold to include fewer
observations than <code>steps</code>.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="spotforecast2.model_selection.split_ts_cv.TimeSeriesFold.return_all_indexes">return_all_indexes</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to return all indexes or only the start
and end indexes of each fold.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="spotforecast2.model_selection.split_ts_cv.TimeSeriesFold.verbose">verbose</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to print information about generated folds.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <p>Basic usage with fixed train size:</p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">spotforecast2.model_selection</span><span class="w"> </span><span class="kn">import</span> <span class="n">TimeSeriesFold</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Create sample time series data</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dates</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s1">&#39;2020-01-01&#39;</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;D&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">y</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="n">dates</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Create fold splitter</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cv</span> <span class="o">=</span> <span class="n">TimeSeriesFold</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">steps</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">initial_train_size</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">refit</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">fixed_train_size</span><span class="o">=</span><span class="kc">True</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Get folds</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">folds</span> <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of folds: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">folds</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="go">Number of folds: 4</span>
</code></pre></div>
    <p>Overlapping folds with custom stride:</p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">cv</span> <span class="o">=</span> <span class="n">TimeSeriesFold</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">steps</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">initial_train_size</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">fold_stride</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">fixed_train_size</span><span class="o">=</span><span class="kc">False</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">folds</span> <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># First test fold covers [50, 80), second [57, 87), etc.</span>
</code></pre></div>
    <p>Return as pandas DataFrame:</p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">cv</span> <span class="o">=</span> <span class="n">TimeSeriesFold</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">initial_train_size</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">folds_df</span> <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">as_pandas</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">folds_df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
<span class="go">[&#39;fold&#39;, &#39;train_start&#39;, &#39;train_end&#39;, &#39;last_window_start&#39;, &#39;last_window_end&#39;, &#39;test_start&#39;, &#39;test_end&#39;, &#39;test_start_with_gap&#39;, &#39;test_end_with_gap&#39;, &#39;fit_forecaster&#39;]</span>
</code></pre></div>
    <p>Skip folds for faster evaluation:</p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">cv</span> <span class="o">=</span> <span class="n">TimeSeriesFold</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">steps</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">initial_train_size</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">skip_folds</span><span class="o">=</span><span class="mi">2</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">folds</span> <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Returns folds 0, 2, 4, 6, ...</span>
</code></pre></div>


<details class="note" open>
  <summary>Note</summary>
  <p>Returned values are the positions of the observations and not the actual values of
the index, so they can be used to slice the data directly using iloc. For example,
if the input series is <code>X = [10, 11, 12, 13, 14, 15, 16, 17, 18, 19]</code>, the
<code>initial_train_size = 3</code>, <code>window_size = 2</code>, <code>steps = 4</code>, and <code>gap = 1</code>,
the output of the first fold will: [0, [0, 3], [1, 3], [3, 8], [4, 8], True].</p>
<p>The first element is the fold number, the first list <code>[0, 3]</code> indicates that
the training set goes from the first to the third observation. The second
list <code>[1, 3]</code> indicates that the last window seen by the forecaster during
training goes from the second to the third observation. The third list <code>[3, 8]</code>
indicates that the test set goes from the fourth to the eighth observation.
The fourth list <code>[4, 8]</code> indicates that the test set including the gap goes
from the fifth to the eighth observation. The boolean <code>False</code> indicates that
the forecaster should not be trained in this fold.</p>
<p>Following the python convention, the start index is inclusive and the end index is
exclusive. This means that the last index is not included in the slice.</p>
<p>As an example, with <code>initial_train_size=50</code>, <code>steps=30</code>, and <code>fold_stride=7</code>,
the first test fold will cover observations [50, 80), the second fold [57, 87),
and the third fold [64, 94). This configuration produces multiple forecasts
for the same observations, which is often desirable in rolling-origin
evaluation.</p>
</details>







              <details class="mkdocstrings-source">
                <summary>Source code in <code>src/spotforecast2/model_selection/split_ts_cv.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">TimeSeriesFold</span><span class="p">(</span><span class="n">BaseFold</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Class to split time series data into train and test folds.</span>

<span class="sd">    When used within a backtesting or hyperparameter search, the arguments</span>
<span class="sd">    &#39;initial_train_size&#39;, &#39;window_size&#39; and &#39;differentiation&#39; are not required</span>
<span class="sd">    as they are automatically set by the backtesting or hyperparameter search</span>
<span class="sd">    functions.</span>

<span class="sd">    Args:</span>
<span class="sd">        steps: Number of observations used to be predicted in each fold.</span>
<span class="sd">            This is also commonly referred to as the forecast horizon or test size.</span>
<span class="sd">        initial_train_size: Number of observations used for initial training.</span>

<span class="sd">            - If `None` or 0, the initial forecaster is not trained in the first fold.</span>
<span class="sd">            - If an integer, the number of observations used for initial training.</span>
<span class="sd">            - If a date string or pandas Timestamp, it is the last date included in</span>
<span class="sd">              the initial training set.</span>

<span class="sd">            Defaults to None.</span>
<span class="sd">        fold_stride: Number of observations that the start of the test set</span>
<span class="sd">            advances between consecutive folds.</span>

<span class="sd">            - If `None`, it defaults to the same value as `steps`, meaning that folds</span>
<span class="sd">              are placed back-to-back without overlap.</span>
<span class="sd">            - If `fold_stride &lt; steps`, test sets overlap and multiple forecasts will</span>
<span class="sd">              be generated for the same observations.</span>
<span class="sd">            - If `fold_stride &gt; steps`, gaps are left between consecutive test sets.</span>

<span class="sd">            Defaults to None.</span>
<span class="sd">        window_size: Number of observations needed to generate the</span>
<span class="sd">            autoregressive predictors. Defaults to None.</span>
<span class="sd">        differentiation: Number of observations to use for differentiation.</span>
<span class="sd">            This is used to extend the `last_window` as many observations as the</span>
<span class="sd">            differentiation order. Defaults to None.</span>
<span class="sd">        refit: Whether to refit the forecaster in each fold.</span>

<span class="sd">            - If `True`, the forecaster is refitted in each fold.</span>
<span class="sd">            - If `False`, the forecaster is trained only in the first fold.</span>
<span class="sd">            - If an integer, the forecaster is trained in the first fold and then refitted</span>
<span class="sd">              every `refit` folds.</span>

<span class="sd">            Defaults to False.</span>
<span class="sd">        fixed_train_size: Whether the training size is fixed or increases</span>
<span class="sd">            in each fold. Defaults to True.</span>
<span class="sd">        gap: Number of observations between the end of the training set</span>
<span class="sd">            and the start of the test set. Defaults to 0.</span>
<span class="sd">        skip_folds: Number of folds to skip.</span>

<span class="sd">            - If an integer, every &#39;skip_folds&#39;-th is returned.</span>
<span class="sd">            - If a list, the indexes of the folds to skip.</span>

<span class="sd">            For example, if `skip_folds=3` and there are 10 folds, the returned folds are</span>
<span class="sd">            0, 3, 6, and 9. If `skip_folds=[1, 2, 3]`, the returned folds are 0, 4, 5, 6, 7,</span>
<span class="sd">            8, and 9. Defaults to None.</span>
<span class="sd">        allow_incomplete_fold: Whether to allow the last fold to include</span>
<span class="sd">            fewer observations than `steps`. If `False`, the last fold is excluded if it</span>
<span class="sd">            is incomplete. Defaults to True.</span>
<span class="sd">        return_all_indexes: Whether to return all indexes or only the</span>
<span class="sd">            start and end indexes of each fold. Defaults to False.</span>
<span class="sd">        verbose: Whether to print information about generated folds.</span>
<span class="sd">            Defaults to True.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        steps: Number of observations used to be predicted in each fold.</span>
<span class="sd">        initial_train_size: Number of observations used for initial training.</span>
<span class="sd">            If `None` or 0, the initial forecaster is not trained in the first fold.</span>
<span class="sd">        fold_stride: Number of observations that the start of the test set</span>
<span class="sd">            advances between consecutive folds.</span>
<span class="sd">        overlapping_folds: Whether the folds overlap.</span>
<span class="sd">        window_size: Number of observations needed to generate the</span>
<span class="sd">            autoregressive predictors.</span>
<span class="sd">        differentiation: Number of observations to use for differentiation.</span>
<span class="sd">            This is used to extend the `last_window` as many observations as the</span>
<span class="sd">            differentiation order.</span>
<span class="sd">        refit: Whether to refit the forecaster in each fold.</span>
<span class="sd">        fixed_train_size: Whether the training size is fixed or increases in each fold.</span>
<span class="sd">        gap: Number of observations between the end of the training set and the</span>
<span class="sd">            start of the test set.</span>
<span class="sd">        skip_folds: Number of folds to skip.</span>
<span class="sd">        allow_incomplete_fold: Whether to allow the last fold to include fewer</span>
<span class="sd">            observations than `steps`.</span>
<span class="sd">        return_all_indexes: Whether to return all indexes or only the start</span>
<span class="sd">            and end indexes of each fold.</span>
<span class="sd">        verbose: Whether to print information about generated folds.</span>

<span class="sd">    Examples:</span>
<span class="sd">        Basic usage with fixed train size:</span>
<span class="sd">        &gt;&gt;&gt; import pandas as pd</span>
<span class="sd">        &gt;&gt;&gt; import numpy as np</span>
<span class="sd">        &gt;&gt;&gt; from spotforecast2.model_selection import TimeSeriesFold</span>
<span class="sd">        &gt;&gt;&gt; # Create sample time series data</span>
<span class="sd">        &gt;&gt;&gt; dates = pd.date_range(&#39;2020-01-01&#39;, periods=100, freq=&#39;D&#39;)</span>
<span class="sd">        &gt;&gt;&gt; y = pd.Series(np.arange(100), index=dates)</span>
<span class="sd">        &gt;&gt;&gt; # Create fold splitter</span>
<span class="sd">        &gt;&gt;&gt; cv = TimeSeriesFold(</span>
<span class="sd">        ...     steps=10,</span>
<span class="sd">        ...     initial_train_size=50,</span>
<span class="sd">        ...     refit=True,</span>
<span class="sd">        ...     fixed_train_size=True</span>
<span class="sd">        ... )</span>
<span class="sd">        &gt;&gt;&gt; # Get folds</span>
<span class="sd">        &gt;&gt;&gt; folds = cv.split(y)</span>
<span class="sd">        &gt;&gt;&gt; print(f&quot;Number of folds: {len(folds)}&quot;)</span>
<span class="sd">        Number of folds: 4</span>

<span class="sd">        Overlapping folds with custom stride:</span>
<span class="sd">        &gt;&gt;&gt; cv = TimeSeriesFold(</span>
<span class="sd">        ...     steps=30,</span>
<span class="sd">        ...     initial_train_size=50,</span>
<span class="sd">        ...     fold_stride=7,</span>
<span class="sd">        ...     fixed_train_size=False</span>
<span class="sd">        ... )</span>
<span class="sd">        &gt;&gt;&gt; folds = cv.split(y)</span>
<span class="sd">        &gt;&gt;&gt; # First test fold covers [50, 80), second [57, 87), etc.</span>

<span class="sd">        Return as pandas DataFrame:</span>
<span class="sd">        &gt;&gt;&gt; cv = TimeSeriesFold(steps=10, initial_train_size=50)</span>
<span class="sd">        &gt;&gt;&gt; folds_df = cv.split(y, as_pandas=True)</span>
<span class="sd">        &gt;&gt;&gt; print(folds_df.columns.tolist())</span>
<span class="sd">        [&#39;fold&#39;, &#39;train_start&#39;, &#39;train_end&#39;, &#39;last_window_start&#39;, &#39;last_window_end&#39;, &#39;test_start&#39;, &#39;test_end&#39;, &#39;test_start_with_gap&#39;, &#39;test_end_with_gap&#39;, &#39;fit_forecaster&#39;]</span>

<span class="sd">        Skip folds for faster evaluation:</span>
<span class="sd">        &gt;&gt;&gt; cv = TimeSeriesFold(</span>
<span class="sd">        ...     steps=5,</span>
<span class="sd">        ...     initial_train_size=50,</span>
<span class="sd">        ...     skip_folds=2</span>
<span class="sd">        ... )</span>
<span class="sd">        &gt;&gt;&gt; folds = cv.split(y)</span>
<span class="sd">        &gt;&gt;&gt; # Returns folds 0, 2, 4, 6, ...</span>

<span class="sd">    Note:</span>
<span class="sd">        Returned values are the positions of the observations and not the actual values of</span>
<span class="sd">        the index, so they can be used to slice the data directly using iloc. For example,</span>
<span class="sd">        if the input series is `X = [10, 11, 12, 13, 14, 15, 16, 17, 18, 19]`, the</span>
<span class="sd">        `initial_train_size = 3`, `window_size = 2`, `steps = 4`, and `gap = 1`,</span>
<span class="sd">        the output of the first fold will: [0, [0, 3], [1, 3], [3, 8], [4, 8], True].</span>

<span class="sd">        The first element is the fold number, the first list `[0, 3]` indicates that</span>
<span class="sd">        the training set goes from the first to the third observation. The second</span>
<span class="sd">        list `[1, 3]` indicates that the last window seen by the forecaster during</span>
<span class="sd">        training goes from the second to the third observation. The third list `[3, 8]`</span>
<span class="sd">        indicates that the test set goes from the fourth to the eighth observation.</span>
<span class="sd">        The fourth list `[4, 8]` indicates that the test set including the gap goes</span>
<span class="sd">        from the fifth to the eighth observation. The boolean `False` indicates that</span>
<span class="sd">        the forecaster should not be trained in this fold.</span>

<span class="sd">        Following the python convention, the start index is inclusive and the end index is</span>
<span class="sd">        exclusive. This means that the last index is not included in the slice.</span>

<span class="sd">        As an example, with `initial_train_size=50`, `steps=30`, and `fold_stride=7`,</span>
<span class="sd">        the first test fold will cover observations [50, 80), the second fold [57, 87),</span>
<span class="sd">        and the third fold [64, 94). This configuration produces multiple forecasts</span>
<span class="sd">        for the same observations, which is often desirable in rolling-origin</span>
<span class="sd">        evaluation.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">steps</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">initial_train_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">fold_stride</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">window_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">differentiation</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">refit</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">fixed_train_size</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">gap</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">skip_folds</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">allow_incomplete_fold</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">return_all_indexes</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">steps</span><span class="o">=</span><span class="n">steps</span><span class="p">,</span>
            <span class="n">initial_train_size</span><span class="o">=</span><span class="n">initial_train_size</span><span class="p">,</span>
            <span class="n">fold_stride</span><span class="o">=</span><span class="n">fold_stride</span><span class="p">,</span>
            <span class="n">window_size</span><span class="o">=</span><span class="n">window_size</span><span class="p">,</span>
            <span class="n">differentiation</span><span class="o">=</span><span class="n">differentiation</span><span class="p">,</span>
            <span class="n">refit</span><span class="o">=</span><span class="n">refit</span><span class="p">,</span>
            <span class="n">fixed_train_size</span><span class="o">=</span><span class="n">fixed_train_size</span><span class="p">,</span>
            <span class="n">gap</span><span class="o">=</span><span class="n">gap</span><span class="p">,</span>
            <span class="n">skip_folds</span><span class="o">=</span><span class="n">skip_folds</span><span class="p">,</span>
            <span class="n">allow_incomplete_fold</span><span class="o">=</span><span class="n">allow_incomplete_fold</span><span class="p">,</span>
            <span class="n">return_all_indexes</span><span class="o">=</span><span class="n">return_all_indexes</span><span class="p">,</span>
            <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">steps</span> <span class="o">=</span> <span class="n">steps</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fold_stride</span> <span class="o">=</span> <span class="n">fold_stride</span> <span class="k">if</span> <span class="n">fold_stride</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">steps</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">overlapping_folds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fold_stride</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">steps</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refit</span> <span class="o">=</span> <span class="n">refit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fixed_train_size</span> <span class="o">=</span> <span class="n">fixed_train_size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gap</span> <span class="o">=</span> <span class="n">gap</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">skip_folds</span> <span class="o">=</span> <span class="n">skip_folds</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">allow_incomplete_fold</span> <span class="o">=</span> <span class="n">allow_incomplete_fold</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Information displayed when printed.</span>

<span class="sd">        Returns:</span>
<span class="sd">            String representation of the TimeSeriesFold object.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">info</span> <span class="o">=</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;=&#39;</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;=&#39;</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;Initial train size    = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_train_size</span><span class="si">}</span><span class="s2">,</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;Steps                 = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">steps</span><span class="si">}</span><span class="s2">,</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;Fold stride           = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">fold_stride</span><span class="si">}</span><span class="s2">,</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;Overlapping folds     = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">overlapping_folds</span><span class="si">}</span><span class="s2">,</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;Window size           = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">window_size</span><span class="si">}</span><span class="s2">,</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;Differentiation       = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">differentiation</span><span class="si">}</span><span class="s2">,</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;Refit                 = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">refit</span><span class="si">}</span><span class="s2">,</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;Fixed train size      = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">fixed_train_size</span><span class="si">}</span><span class="s2">,</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;Gap                   = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">gap</span><span class="si">}</span><span class="s2">,</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;Skip folds            = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">skip_folds</span><span class="si">}</span><span class="s2">,</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;Allow incomplete fold = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">allow_incomplete_fold</span><span class="si">}</span><span class="s2">,</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;Return all indexes    = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">return_all_indexes</span><span class="si">}</span><span class="s2">,</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;Verbose               = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">info</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_repr_html_</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;HTML representation of the object.</span>

<span class="sd">        The &quot;General Information&quot; section is expanded by default.</span>

<span class="sd">        Returns:</span>
<span class="sd">            HTML string representation for Jupyter notebooks.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">style</span><span class="p">,</span> <span class="n">unique_id</span> <span class="o">=</span> <span class="n">get_style_repr_html</span><span class="p">()</span>
        <span class="n">content</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        &lt;div class=&quot;container-</span><span class="si">{</span><span class="n">unique_id</span><span class="si">}</span><span class="s2">&quot;&gt;</span>
<span class="s2">            &lt;p style=&quot;font-size: 1.5em; font-weight: bold; margin-block-start: 0.83em; margin-block-end: 0.83em;&quot;&gt;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&lt;/p&gt;</span>
<span class="s2">            &lt;details open&gt;</span>
<span class="s2">                &lt;summary&gt;General Information&lt;/summary&gt;</span>
<span class="s2">                &lt;ul&gt;</span>
<span class="s2">                    &lt;li&gt;&lt;strong&gt;Initial train size:&lt;/strong&gt; </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_train_size</span><span class="si">}</span><span class="s2">&lt;/li&gt;</span>
<span class="s2">                    &lt;li&gt;&lt;strong&gt;Steps:&lt;/strong&gt; </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">steps</span><span class="si">}</span><span class="s2">&lt;/li&gt;</span>
<span class="s2">                    &lt;li&gt;&lt;strong&gt;Fold stride:&lt;/strong&gt; </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">fold_stride</span><span class="si">}</span><span class="s2">&lt;/li&gt;</span>
<span class="s2">                    &lt;li&gt;&lt;strong&gt;Overlapping folds:&lt;/strong&gt; </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">overlapping_folds</span><span class="si">}</span><span class="s2">&lt;/li&gt;</span>
<span class="s2">                    &lt;li&gt;&lt;strong&gt;Window size:&lt;/strong&gt; </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">window_size</span><span class="si">}</span><span class="s2">&lt;/li&gt;</span>
<span class="s2">                    &lt;li&gt;&lt;strong&gt;Differentiation:&lt;/strong&gt; </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">differentiation</span><span class="si">}</span><span class="s2">&lt;/li&gt;</span>
<span class="s2">                    &lt;li&gt;&lt;strong&gt;Refit:&lt;/strong&gt; </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">refit</span><span class="si">}</span><span class="s2">&lt;/li&gt;</span>
<span class="s2">                    &lt;li&gt;&lt;strong&gt;Fixed train size:&lt;/strong&gt; </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">fixed_train_size</span><span class="si">}</span><span class="s2">&lt;/li&gt;</span>
<span class="s2">                    &lt;li&gt;&lt;strong&gt;Gap:&lt;/strong&gt; </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">gap</span><span class="si">}</span><span class="s2">&lt;/li&gt;</span>
<span class="s2">                    &lt;li&gt;&lt;strong&gt;Skip folds:&lt;/strong&gt; </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">skip_folds</span><span class="si">}</span><span class="s2">&lt;/li&gt;</span>
<span class="s2">                    &lt;li&gt;&lt;strong&gt;Allow incomplete fold:&lt;/strong&gt; </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">allow_incomplete_fold</span><span class="si">}</span><span class="s2">&lt;/li&gt;</span>
<span class="s2">                    &lt;li&gt;&lt;strong&gt;Return all indexes:&lt;/strong&gt; </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">return_all_indexes</span><span class="si">}</span><span class="s2">&lt;/li&gt;</span>
<span class="s2">                &lt;/ul&gt;</span>
<span class="s2">            &lt;/details&gt;</span>
<span class="s2">        &lt;/div&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="n">style</span> <span class="o">+</span> <span class="n">content</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">split</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">X</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span> <span class="o">|</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">|</span> <span class="n">pd</span><span class="o">.</span><span class="n">Index</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span> <span class="o">|</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">],</span>
        <span class="n">as_pandas</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span> <span class="o">|</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Split the time series data into train and test folds.</span>

<span class="sd">        Args:</span>
<span class="sd">            X: Time series data or index to split. Can be a pandas Series, DataFrame,</span>
<span class="sd">                Index, or a dictionary of Series/DataFrames.</span>
<span class="sd">            as_pandas: If True, the folds are returned as a DataFrame. This is useful</span>
<span class="sd">                to visualize the folds in a more interpretable way. Defaults to False.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A list of lists containing the indices (position) for each fold, or a</span>
<span class="sd">            DataFrame if `as_pandas=True`. Each list contains 4 lists and a boolean</span>
<span class="sd">            with the following information:</span>

<span class="sd">            - **fold**: fold number.</span>
<span class="sd">            - **[train_start, train_end]**: list with the start and end positions of</span>
<span class="sd">                    the training set.</span>
<span class="sd">            - **[last_window_start, last_window_end]**: list with the start and end</span>
<span class="sd">                    positions of the last window seen by the forecaster during training.</span>
<span class="sd">                    The last window is used to generate the lags use as predictors. If</span>
<span class="sd">                    `differentiation` is included, the interval is extended as many</span>
<span class="sd">                    observations as the differentiation order. If the argument `window_size`</span>
<span class="sd">                    is `None`, this list is empty.</span>
<span class="sd">            - **[test_start, test_end]**: list with the start and end positions of</span>
<span class="sd">                    the test set. These are the observations used to evaluate the forecaster.</span>
<span class="sd">            - **[test_start_with_gap, test_end_with_gap]**: list with the start and</span>
<span class="sd">                    end positions of the test set including the gap. The gap is the number</span>
<span class="sd">                    of observations between the end of the training set and the start of</span>
<span class="sd">                    the test set.</span>
<span class="sd">            - **fit_forecaster**: boolean indicating whether the forecaster should be</span>
<span class="sd">                    fitted in this fold.</span>

<span class="sd">        Note:</span>
<span class="sd">            The returned values are the positions of the observations and not the</span>
<span class="sd">            actual values of the index, so they can be used to slice the data directly</span>
<span class="sd">            using iloc.</span>

<span class="sd">            If `as_pandas` is `True`, the folds are returned as a DataFrame with the</span>
<span class="sd">            following columns: &#39;fold&#39;, &#39;train_start&#39;, &#39;train_end&#39;, &#39;last_window_start&#39;,</span>
<span class="sd">            &#39;last_window_end&#39;, &#39;test_start&#39;, &#39;test_end&#39;, &#39;test_start_with_gap&#39;,</span>
<span class="sd">            &#39;test_end_with_gap&#39;, &#39;fit_forecaster&#39;.</span>

<span class="sd">            Following the python convention, the start index is inclusive and the end</span>
<span class="sd">            index is exclusive. This means that the last index is not included in the</span>
<span class="sd">            slice.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Index</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;X must be a pandas Series, DataFrame, Index or a dictionary. &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;Got </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">X</span><span class="p">)</span><span class="si">}</span><span class="s2">.&quot;</span>
            <span class="p">)</span>

        <span class="n">window_size_as_date_offset</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">window_size</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">tseries</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">DateOffset</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">window_size_as_date_offset</span><span class="p">:</span>
            <span class="c1"># Calculate the window_size in steps. This is not a exact calculation</span>
            <span class="c1"># because the offset follows the calendar rules and the distance between</span>
            <span class="c1"># two dates may not be constant.</span>
            <span class="n">first_valid_index</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_size</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">window_size_idx_start</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_loc</span><span class="p">(</span><span class="n">first_valid_index</span><span class="p">)</span>
                <span class="n">window_size_idx_end</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_loc</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">window_size</span> <span class="o">=</span> <span class="n">window_size_idx_end</span> <span class="o">-</span> <span class="n">window_size_idx_start</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;The length of `y` (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)</span><span class="si">}</span><span class="s2">), must be greater than or equal &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;to the window size (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">window_size</span><span class="si">}</span><span class="s2">). This is because  &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;the offset (forecaster.offset) is larger than the available &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;data. Try to decrease the size of the offset (forecaster.offset), &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;the number of `n_offsets` (forecaster.n_offsets) or increase the &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;size of `y`.&quot;</span>
                <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_train_size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;To use split method when `initial_train_size` is None, &quot;</span>
                    <span class="s2">&quot;`window_size` must be an integer greater than 0. &quot;</span>
                    <span class="s2">&quot;Although no initial training is done and all data is used to &quot;</span>
                    <span class="s2">&quot;evaluate the model, the first `window_size` observations are &quot;</span>
                    <span class="s2">&quot;needed to create the initial predictors. Got `window_size` = None.&quot;</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">refit</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;`refit` is only allowed when `initial_train_size` is not `None`. &quot;</span>
                    <span class="s2">&quot;Set `refit` to `False` if you want to use `initial_train_size = None`.&quot;</span>
                <span class="p">)</span>
            <span class="n">externally_fitted</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">initial_train_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_size</span>  <span class="c1"># Reset to None later</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                    <span class="s2">&quot;Last window cannot be calculated because `window_size` is None.&quot;</span><span class="p">,</span>
                    <span class="n">IgnoredArgumentWarning</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="n">externally_fitted</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_index</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">index</span><span class="p">))</span>
        <span class="n">folds</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">initial_train_size</span> <span class="o">=</span> <span class="n">date_to_index_position</span><span class="p">(</span>
            <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">,</span>
            <span class="n">date_input</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_train_size</span><span class="p">,</span>
            <span class="n">method</span><span class="o">=</span><span class="s2">&quot;validation&quot;</span><span class="p">,</span>
            <span class="n">date_literal</span><span class="o">=</span><span class="s2">&quot;initial_train_size&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">window_size_as_date_offset</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_train_size</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_train_size</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_size</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;If `initial_train_size` is an integer, it must be greater than &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;the `window_size` of the forecaster (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">window_size</span><span class="si">}</span><span class="s2">) &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;and smaller than the length of the series (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)</span><span class="si">}</span><span class="s2">). If &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;it is a date, it must be within this range of the index.&quot;</span>
                    <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">allow_incomplete_fold</span><span class="p">:</span>
            <span class="c1"># At least one observation after the gap to allow incomplete fold</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">index</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_train_size</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">gap</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;The time series must have more than `initial_train_size + gap` &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;observations to create at least one fold.</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;    Time series length: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">index</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;    Required &gt; </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_train_size</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">gap</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;    initial_train_size: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_train_size</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;    gap: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">gap</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># At least one complete fold</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">index</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_train_size</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">gap</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">steps</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;The time series must have at least `initial_train_size + gap + steps` &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;observations to create a minimum of one complete fold &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;(allow_incomplete_fold=False).</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;    Time series length: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">index</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;    Required &gt;= </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_train_size</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">gap</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">steps</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;    initial_train_size: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_train_size</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;    gap: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">gap</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;    steps: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">steps</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="p">)</span>

        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_train_size</span> <span class="o">+</span> <span class="p">(</span><span class="n">i</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">fold_stride</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">gap</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">index</span><span class="p">):</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">refit</span><span class="p">:</span>
                <span class="c1"># NOTE: If `fixed_train_size` the train size doesn&#39;t increase but</span>
                <span class="c1"># moves by `fold_stride` positions in each iteration. If `False`,</span>
                <span class="c1"># the train size increases by `fold_stride` in each iteration.</span>
                <span class="n">train_iloc_start</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">i</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fold_stride</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fixed_train_size</span> <span class="k">else</span> <span class="mi">0</span>
                <span class="p">)</span>
                <span class="n">train_iloc_end</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_train_size</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fold_stride</span><span class="p">)</span>
                <span class="n">test_iloc_start</span> <span class="o">=</span> <span class="n">train_iloc_end</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># NOTE: The train size doesn&#39;t increase and doesn&#39;t move.</span>
                <span class="n">train_iloc_start</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">train_iloc_end</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_train_size</span>
                <span class="n">test_iloc_start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_train_size</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fold_stride</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_size</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">last_window_iloc_start</span> <span class="o">=</span> <span class="n">test_iloc_start</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_size</span>

            <span class="n">test_iloc_end</span> <span class="o">=</span> <span class="n">test_iloc_start</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">gap</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">steps</span>

            <span class="n">partitions</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">idx</span><span class="p">[</span><span class="n">train_iloc_start</span><span class="p">:</span><span class="n">train_iloc_end</span><span class="p">],</span>
                <span class="p">(</span>
                    <span class="n">idx</span><span class="p">[</span><span class="n">last_window_iloc_start</span><span class="p">:</span><span class="n">test_iloc_start</span><span class="p">]</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_size</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                    <span class="k">else</span> <span class="p">[]</span>
                <span class="p">),</span>
                <span class="n">idx</span><span class="p">[</span><span class="n">test_iloc_start</span><span class="p">:</span><span class="n">test_iloc_end</span><span class="p">],</span>
                <span class="n">idx</span><span class="p">[</span><span class="n">test_iloc_start</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">gap</span> <span class="p">:</span> <span class="n">test_iloc_end</span><span class="p">],</span>
            <span class="p">]</span>
            <span class="n">folds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">partitions</span><span class="p">)</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># NOTE: Delete all incomplete folds at the end if not allowed</span>
        <span class="n">n_removed_folds</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">allow_incomplete_fold</span><span class="p">:</span>
            <span class="c1"># NOTE: While folds and the last &quot;test_index_with_gap&quot; is incomplete,</span>
            <span class="c1"># calculating len of range objects</span>
            <span class="k">while</span> <span class="n">folds</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">folds</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">3</span><span class="p">])</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">steps</span><span class="p">:</span>
                <span class="n">folds</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                <span class="n">n_removed_folds</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># Replace partitions inside folds with length 0 with `None`</span>
        <span class="n">folds</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">[</span><span class="n">partition</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">partition</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">partition</span> <span class="ow">in</span> <span class="n">fold</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">fold</span> <span class="ow">in</span> <span class="n">folds</span>
        <span class="p">]</span>

        <span class="c1"># Create a flag to know whether to train the forecaster</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">refit</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">refit</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">refit</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
            <span class="n">fit_forecaster</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">refit</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">folds</span><span class="p">)</span>
            <span class="n">fit_forecaster</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fit_forecaster</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">folds</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">fit_forecaster</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">refit</span><span class="p">):</span>
                <span class="n">fit_forecaster</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">folds</span><span class="p">)):</span>
            <span class="n">folds</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
            <span class="n">folds</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fit_forecaster</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">fit_forecaster</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                <span class="n">folds</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">folds</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">index_to_skip</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">skip_folds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">skip_folds</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">integer</span><span class="p">))</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">skip_folds</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">index_to_keep</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">folds</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">skip_folds</span><span class="p">)</span>
                <span class="n">index_to_skip</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">setdiff1d</span><span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">folds</span><span class="p">)),</span> <span class="n">index_to_keep</span><span class="p">,</span> <span class="n">assume_unique</span><span class="o">=</span><span class="kc">True</span>
                <span class="p">)</span>
                <span class="n">index_to_skip</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">index_to_skip</span>
                <span class="p">]</span>  <span class="c1"># Required since numpy 2.0</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">skip_folds</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="n">index_to_skip</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">skip_folds</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">folds</span><span class="p">)]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_print_info</span><span class="p">(</span>
                <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">,</span>
                <span class="n">folds</span><span class="o">=</span><span class="n">folds</span><span class="p">,</span>
                <span class="n">externally_fitted</span><span class="o">=</span><span class="n">externally_fitted</span><span class="p">,</span>
                <span class="n">n_removed_folds</span><span class="o">=</span><span class="n">n_removed_folds</span><span class="p">,</span>
                <span class="n">index_to_skip</span><span class="o">=</span><span class="n">index_to_skip</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="n">folds</span> <span class="o">=</span> <span class="p">[</span><span class="n">fold</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">fold</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">folds</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">index_to_skip</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">return_all_indexes</span><span class="p">:</span>
            <span class="c1"># NOTE: +1 to prevent iloc pandas from deleting the last observation</span>
            <span class="n">folds</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">[</span>
                    <span class="n">fold</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                    <span class="p">[</span><span class="n">fold</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">fold</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span>
                    <span class="p">(</span>
                        <span class="p">[</span><span class="n">fold</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">fold</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_size</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                        <span class="k">else</span> <span class="p">[]</span>
                    <span class="p">),</span>
                    <span class="p">[</span><span class="n">fold</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">fold</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span>
                    <span class="p">[</span><span class="n">fold</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">fold</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span>
                    <span class="n">fold</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span>
                <span class="p">]</span>
                <span class="k">for</span> <span class="n">fold</span> <span class="ow">in</span> <span class="n">folds</span>
            <span class="p">]</span>

        <span class="k">if</span> <span class="n">externally_fitted</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">initial_train_size</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">folds</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">as_pandas</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">fold</span> <span class="ow">in</span> <span class="n">folds</span><span class="p">:</span>
                    <span class="n">fold</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">return_all_indexes</span><span class="p">:</span>
                <span class="n">folds</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
                    <span class="n">data</span><span class="o">=</span><span class="p">[</span>
                        <span class="p">[</span><span class="n">fold</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span><span class="o">*</span><span class="n">fold</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span> <span class="o">+</span> <span class="p">[</span><span class="n">fold</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
                        <span class="k">for</span> <span class="n">fold</span> <span class="ow">in</span> <span class="n">folds</span>
                    <span class="p">],</span>
                    <span class="n">columns</span><span class="o">=</span><span class="p">[</span>
                        <span class="s2">&quot;fold&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;train_start&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;train_end&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;last_window_start&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;last_window_end&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;test_start&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;test_end&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;test_start_with_gap&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;test_end_with_gap&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;fit_forecaster&quot;</span><span class="p">,</span>
                    <span class="p">],</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">folds</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
                    <span class="n">data</span><span class="o">=</span><span class="n">folds</span><span class="p">,</span>
                    <span class="n">columns</span><span class="o">=</span><span class="p">[</span>
                        <span class="s2">&quot;fold&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;train_index&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;last_window_index&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;test_index&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;test_index_with_gap&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;fit_forecaster&quot;</span><span class="p">,</span>
                    <span class="p">],</span>
                <span class="p">)</span>

        <span class="k">return</span> <span class="n">folds</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_print_info</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">index</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Index</span><span class="p">,</span>
        <span class="n">folds</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]],</span>
        <span class="n">externally_fitted</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
        <span class="n">n_removed_folds</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">index_to_skip</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Print information about folds.</span>

<span class="sd">        Args:</span>
<span class="sd">            index: Index of the time series data.</span>
<span class="sd">            folds: A list of lists containing the indices (position) for each fold.</span>
<span class="sd">            externally_fitted: Whether an already trained forecaster is to be used.</span>
<span class="sd">            n_removed_folds: Number of folds removed.</span>
<span class="sd">            index_to_skip: Number of folds skipped.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Information of folds&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;--------------------&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">externally_fitted</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;An already trained forecaster is to be used. Window size: &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">window_size</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">differentiation</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Number of observations used for initial training: &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_train_size</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Number of observations used for initial training: &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_train_size</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">differentiation</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;    First </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">differentiation</span><span class="si">}</span><span class="s2"> observation/s in training sets &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;are used for differentiation&quot;</span>
                <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Number of observations used for backtesting: &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">index</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">initial_train_size</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Number of folds: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">folds</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;    Number skipped folds: &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">index_to_skip</span><span class="p">)</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">index_to_skip</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">index_to_skip</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Number of steps per fold: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">steps</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">steps</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fold_stride</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;    Number of steps to the next fold (fold stride): </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">fold_stride</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;    Number of steps to exclude between last observed data &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;(last window) and predictions (gap): </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">gap</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">n_removed_folds</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;    The last </span><span class="si">{</span><span class="n">n_removed_folds</span><span class="si">}</span><span class="s2"> fold(s) have been excluded &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;because they were incomplete.&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">folds</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">4</span><span class="p">])</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">steps</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Last fold only includes </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">folds</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">4</span><span class="p">])</span><span class="si">}</span><span class="s2"> observations.&quot;</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">differentiation</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">differentiation</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">differentiation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">differentiation</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">fold</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">folds</span><span class="p">):</span>
            <span class="n">is_fold_skipped</span> <span class="o">=</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">index_to_skip</span>
            <span class="n">has_training</span> <span class="o">=</span> <span class="n">fold</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="mi">0</span> <span class="k">else</span> <span class="kc">True</span>
            <span class="n">training_start</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">index</span><span class="p">[</span><span class="n">fold</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">differentiation</span><span class="p">]</span> <span class="k">if</span> <span class="n">fold</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="p">)</span>
            <span class="n">training_end</span> <span class="o">=</span> <span class="n">index</span><span class="p">[</span><span class="n">fold</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span> <span class="k">if</span> <span class="n">fold</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="n">training_length</span> <span class="o">=</span> <span class="p">(</span>
                <span class="nb">len</span><span class="p">(</span><span class="n">fold</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="n">differentiation</span> <span class="k">if</span> <span class="n">fold</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">0</span>
            <span class="p">)</span>
            <span class="n">validation_start</span> <span class="o">=</span> <span class="n">index</span><span class="p">[</span><span class="n">fold</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
            <span class="n">validation_end</span> <span class="o">=</span> <span class="n">index</span><span class="p">[</span><span class="n">fold</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
            <span class="n">validation_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">fold</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>

            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fold: </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">is_fold_skipped</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    Fold skipped&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="n">externally_fitted</span> <span class="ow">and</span> <span class="n">has_training</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;    Training:   </span><span class="si">{</span><span class="n">training_start</span><span class="si">}</span><span class="s2"> -- </span><span class="si">{</span><span class="n">training_end</span><span class="si">}</span><span class="s2">  &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;(n=</span><span class="si">{</span><span class="n">training_length</span><span class="si">}</span><span class="s2">)&quot;</span>
                <span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;    Validation: </span><span class="si">{</span><span class="n">validation_start</span><span class="si">}</span><span class="s2"> -- </span><span class="si">{</span><span class="n">validation_end</span><span class="si">}</span><span class="s2">  &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;(n=</span><span class="si">{</span><span class="n">validation_length</span><span class="si">}</span><span class="s2">)&quot;</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    Training:   No training in this fold&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;    Validation: </span><span class="si">{</span><span class="n">validation_start</span><span class="si">}</span><span class="s2"> -- </span><span class="si">{</span><span class="n">validation_end</span><span class="si">}</span><span class="s2">  &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;(n=</span><span class="si">{</span><span class="n">validation_length</span><span class="si">}</span><span class="s2">)&quot;</span>
                <span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h4 id="spotforecast2.model_selection.split_ts_cv.TimeSeriesFold.__repr__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__repr__</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Information displayed when printed.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>String representation of the TimeSeriesFold object.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/spotforecast2/model_selection/split_ts_cv.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Information displayed when printed.</span>

<span class="sd">    Returns:</span>
<span class="sd">        String representation of the TimeSeriesFold object.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">info</span> <span class="o">=</span> <span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;=&#39;</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;=&#39;</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="sa">f</span><span class="s2">&quot;Initial train size    = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_train_size</span><span class="si">}</span><span class="s2">,</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="sa">f</span><span class="s2">&quot;Steps                 = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">steps</span><span class="si">}</span><span class="s2">,</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="sa">f</span><span class="s2">&quot;Fold stride           = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">fold_stride</span><span class="si">}</span><span class="s2">,</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="sa">f</span><span class="s2">&quot;Overlapping folds     = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">overlapping_folds</span><span class="si">}</span><span class="s2">,</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="sa">f</span><span class="s2">&quot;Window size           = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">window_size</span><span class="si">}</span><span class="s2">,</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="sa">f</span><span class="s2">&quot;Differentiation       = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">differentiation</span><span class="si">}</span><span class="s2">,</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="sa">f</span><span class="s2">&quot;Refit                 = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">refit</span><span class="si">}</span><span class="s2">,</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="sa">f</span><span class="s2">&quot;Fixed train size      = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">fixed_train_size</span><span class="si">}</span><span class="s2">,</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="sa">f</span><span class="s2">&quot;Gap                   = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">gap</span><span class="si">}</span><span class="s2">,</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="sa">f</span><span class="s2">&quot;Skip folds            = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">skip_folds</span><span class="si">}</span><span class="s2">,</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="sa">f</span><span class="s2">&quot;Allow incomplete fold = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">allow_incomplete_fold</span><span class="si">}</span><span class="s2">,</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="sa">f</span><span class="s2">&quot;Return all indexes    = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">return_all_indexes</span><span class="si">}</span><span class="s2">,</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="sa">f</span><span class="s2">&quot;Verbose               = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">info</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="spotforecast2.model_selection.split_ts_cv.TimeSeriesFold.split" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">as_pandas</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Split the time series data into train and test folds.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>X</code>
            </td>
            <td>
                  <code><span title="pandas.Series">Series</span> | <span title="pandas.DataFrame">DataFrame</span> | <span title="pandas.Index">Index</span> | <span title="dict">dict</span>[<span title="str">str</span>, <span title="pandas.Series">Series</span> | <span title="pandas.DataFrame">DataFrame</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Time series data or index to split. Can be a pandas Series, DataFrame,
Index, or a dictionary of Series/DataFrames.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>as_pandas</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, the folds are returned as a DataFrame. This is useful
to visualize the folds in a more interpretable way. Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span> | <span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of lists containing the indices (position) for each fold, or a</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span> | <span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>DataFrame if <code>as_pandas=True</code>. Each list contains 4 lists and a boolean</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span> | <span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>with the following information:</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span> | <span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <ul>
<li><strong>fold</strong>: fold number.</li>
</ul>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span> | <span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <ul>
<li><strong>[train_start, train_end]</strong>: list with the start and end positions of
    the training set.</li>
</ul>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span> | <span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <ul>
<li><strong>[last_window_start, last_window_end]</strong>: list with the start and end
    positions of the last window seen by the forecaster during training.
    The last window is used to generate the lags use as predictors. If
    <code>differentiation</code> is included, the interval is extended as many
    observations as the differentiation order. If the argument <code>window_size</code>
    is <code>None</code>, this list is empty.</li>
</ul>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span> | <span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <ul>
<li><strong>[test_start, test_end]</strong>: list with the start and end positions of
    the test set. These are the observations used to evaluate the forecaster.</li>
</ul>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span> | <span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <ul>
<li><strong>[test_start_with_gap, test_end_with_gap]</strong>: list with the start and
    end positions of the test set including the gap. The gap is the number
    of observations between the end of the training set and the start of
    the test set.</li>
</ul>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span> | <span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <ul>
<li><strong>fit_forecaster</strong>: boolean indicating whether the forecaster should be
    fitted in this fold.</li>
</ul>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Note</summary>
  <p>The returned values are the positions of the observations and not the
actual values of the index, so they can be used to slice the data directly
using iloc.</p>
<p>If <code>as_pandas</code> is <code>True</code>, the folds are returned as a DataFrame with the
following columns: 'fold', 'train_start', 'train_end', 'last_window_start',
'last_window_end', 'test_start', 'test_end', 'test_start_with_gap',
'test_end_with_gap', 'fit_forecaster'.</p>
<p>Following the python convention, the start index is inclusive and the end
index is exclusive. This means that the last index is not included in the
slice.</p>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/spotforecast2/model_selection/split_ts_cv.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">split</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">X</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span> <span class="o">|</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">|</span> <span class="n">pd</span><span class="o">.</span><span class="n">Index</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span> <span class="o">|</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">],</span>
    <span class="n">as_pandas</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span> <span class="o">|</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Split the time series data into train and test folds.</span>

<span class="sd">    Args:</span>
<span class="sd">        X: Time series data or index to split. Can be a pandas Series, DataFrame,</span>
<span class="sd">            Index, or a dictionary of Series/DataFrames.</span>
<span class="sd">        as_pandas: If True, the folds are returned as a DataFrame. This is useful</span>
<span class="sd">            to visualize the folds in a more interpretable way. Defaults to False.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A list of lists containing the indices (position) for each fold, or a</span>
<span class="sd">        DataFrame if `as_pandas=True`. Each list contains 4 lists and a boolean</span>
<span class="sd">        with the following information:</span>

<span class="sd">        - **fold**: fold number.</span>
<span class="sd">        - **[train_start, train_end]**: list with the start and end positions of</span>
<span class="sd">                the training set.</span>
<span class="sd">        - **[last_window_start, last_window_end]**: list with the start and end</span>
<span class="sd">                positions of the last window seen by the forecaster during training.</span>
<span class="sd">                The last window is used to generate the lags use as predictors. If</span>
<span class="sd">                `differentiation` is included, the interval is extended as many</span>
<span class="sd">                observations as the differentiation order. If the argument `window_size`</span>
<span class="sd">                is `None`, this list is empty.</span>
<span class="sd">        - **[test_start, test_end]**: list with the start and end positions of</span>
<span class="sd">                the test set. These are the observations used to evaluate the forecaster.</span>
<span class="sd">        - **[test_start_with_gap, test_end_with_gap]**: list with the start and</span>
<span class="sd">                end positions of the test set including the gap. The gap is the number</span>
<span class="sd">                of observations between the end of the training set and the start of</span>
<span class="sd">                the test set.</span>
<span class="sd">        - **fit_forecaster**: boolean indicating whether the forecaster should be</span>
<span class="sd">                fitted in this fold.</span>

<span class="sd">    Note:</span>
<span class="sd">        The returned values are the positions of the observations and not the</span>
<span class="sd">        actual values of the index, so they can be used to slice the data directly</span>
<span class="sd">        using iloc.</span>

<span class="sd">        If `as_pandas` is `True`, the folds are returned as a DataFrame with the</span>
<span class="sd">        following columns: &#39;fold&#39;, &#39;train_start&#39;, &#39;train_end&#39;, &#39;last_window_start&#39;,</span>
<span class="sd">        &#39;last_window_end&#39;, &#39;test_start&#39;, &#39;test_end&#39;, &#39;test_start_with_gap&#39;,</span>
<span class="sd">        &#39;test_end_with_gap&#39;, &#39;fit_forecaster&#39;.</span>

<span class="sd">        Following the python convention, the start index is inclusive and the end</span>
<span class="sd">        index is exclusive. This means that the last index is not included in the</span>
<span class="sd">        slice.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Index</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;X must be a pandas Series, DataFrame, Index or a dictionary. &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;Got </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">X</span><span class="p">)</span><span class="si">}</span><span class="s2">.&quot;</span>
        <span class="p">)</span>

    <span class="n">window_size_as_date_offset</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">window_size</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">tseries</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">DateOffset</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">window_size_as_date_offset</span><span class="p">:</span>
        <span class="c1"># Calculate the window_size in steps. This is not a exact calculation</span>
        <span class="c1"># because the offset follows the calendar rules and the distance between</span>
        <span class="c1"># two dates may not be constant.</span>
        <span class="n">first_valid_index</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_size</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">window_size_idx_start</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_loc</span><span class="p">(</span><span class="n">first_valid_index</span><span class="p">)</span>
            <span class="n">window_size_idx_end</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_loc</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">window_size</span> <span class="o">=</span> <span class="n">window_size_idx_end</span> <span class="o">-</span> <span class="n">window_size_idx_start</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;The length of `y` (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)</span><span class="si">}</span><span class="s2">), must be greater than or equal &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;to the window size (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">window_size</span><span class="si">}</span><span class="s2">). This is because  &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;the offset (forecaster.offset) is larger than the available &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;data. Try to decrease the size of the offset (forecaster.offset), &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;the number of `n_offsets` (forecaster.n_offsets) or increase the &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;size of `y`.&quot;</span>
            <span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_train_size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;To use split method when `initial_train_size` is None, &quot;</span>
                <span class="s2">&quot;`window_size` must be an integer greater than 0. &quot;</span>
                <span class="s2">&quot;Although no initial training is done and all data is used to &quot;</span>
                <span class="s2">&quot;evaluate the model, the first `window_size` observations are &quot;</span>
                <span class="s2">&quot;needed to create the initial predictors. Got `window_size` = None.&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">refit</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;`refit` is only allowed when `initial_train_size` is not `None`. &quot;</span>
                <span class="s2">&quot;Set `refit` to `False` if you want to use `initial_train_size = None`.&quot;</span>
            <span class="p">)</span>
        <span class="n">externally_fitted</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initial_train_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_size</span>  <span class="c1"># Reset to None later</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;Last window cannot be calculated because `window_size` is None.&quot;</span><span class="p">,</span>
                <span class="n">IgnoredArgumentWarning</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="n">externally_fitted</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_index</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">index</span><span class="p">))</span>
    <span class="n">folds</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">initial_train_size</span> <span class="o">=</span> <span class="n">date_to_index_position</span><span class="p">(</span>
        <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">,</span>
        <span class="n">date_input</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_train_size</span><span class="p">,</span>
        <span class="n">method</span><span class="o">=</span><span class="s2">&quot;validation&quot;</span><span class="p">,</span>
        <span class="n">date_literal</span><span class="o">=</span><span class="s2">&quot;initial_train_size&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">window_size_as_date_offset</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_train_size</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_train_size</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_size</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;If `initial_train_size` is an integer, it must be greater than &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;the `window_size` of the forecaster (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">window_size</span><span class="si">}</span><span class="s2">) &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;and smaller than the length of the series (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)</span><span class="si">}</span><span class="s2">). If &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;it is a date, it must be within this range of the index.&quot;</span>
                <span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">allow_incomplete_fold</span><span class="p">:</span>
        <span class="c1"># At least one observation after the gap to allow incomplete fold</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">index</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_train_size</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">gap</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;The time series must have more than `initial_train_size + gap` &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;observations to create at least one fold.</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;    Time series length: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">index</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;    Required &gt; </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_train_size</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">gap</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;    initial_train_size: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_train_size</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;    gap: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">gap</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># At least one complete fold</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">index</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_train_size</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">gap</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">steps</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;The time series must have at least `initial_train_size + gap + steps` &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;observations to create a minimum of one complete fold &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;(allow_incomplete_fold=False).</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;    Time series length: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">index</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;    Required &gt;= </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_train_size</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">gap</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">steps</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;    initial_train_size: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_train_size</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;    gap: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">gap</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;    steps: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">steps</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="p">)</span>

    <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_train_size</span> <span class="o">+</span> <span class="p">(</span><span class="n">i</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">fold_stride</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">gap</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">index</span><span class="p">):</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">refit</span><span class="p">:</span>
            <span class="c1"># NOTE: If `fixed_train_size` the train size doesn&#39;t increase but</span>
            <span class="c1"># moves by `fold_stride` positions in each iteration. If `False`,</span>
            <span class="c1"># the train size increases by `fold_stride` in each iteration.</span>
            <span class="n">train_iloc_start</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">i</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fold_stride</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fixed_train_size</span> <span class="k">else</span> <span class="mi">0</span>
            <span class="p">)</span>
            <span class="n">train_iloc_end</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_train_size</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fold_stride</span><span class="p">)</span>
            <span class="n">test_iloc_start</span> <span class="o">=</span> <span class="n">train_iloc_end</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># NOTE: The train size doesn&#39;t increase and doesn&#39;t move.</span>
            <span class="n">train_iloc_start</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">train_iloc_end</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_train_size</span>
            <span class="n">test_iloc_start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_train_size</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fold_stride</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_size</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">last_window_iloc_start</span> <span class="o">=</span> <span class="n">test_iloc_start</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_size</span>

        <span class="n">test_iloc_end</span> <span class="o">=</span> <span class="n">test_iloc_start</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">gap</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">steps</span>

        <span class="n">partitions</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">idx</span><span class="p">[</span><span class="n">train_iloc_start</span><span class="p">:</span><span class="n">train_iloc_end</span><span class="p">],</span>
            <span class="p">(</span>
                <span class="n">idx</span><span class="p">[</span><span class="n">last_window_iloc_start</span><span class="p">:</span><span class="n">test_iloc_start</span><span class="p">]</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_size</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                <span class="k">else</span> <span class="p">[]</span>
            <span class="p">),</span>
            <span class="n">idx</span><span class="p">[</span><span class="n">test_iloc_start</span><span class="p">:</span><span class="n">test_iloc_end</span><span class="p">],</span>
            <span class="n">idx</span><span class="p">[</span><span class="n">test_iloc_start</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">gap</span> <span class="p">:</span> <span class="n">test_iloc_end</span><span class="p">],</span>
        <span class="p">]</span>
        <span class="n">folds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">partitions</span><span class="p">)</span>
        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="c1"># NOTE: Delete all incomplete folds at the end if not allowed</span>
    <span class="n">n_removed_folds</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">allow_incomplete_fold</span><span class="p">:</span>
        <span class="c1"># NOTE: While folds and the last &quot;test_index_with_gap&quot; is incomplete,</span>
        <span class="c1"># calculating len of range objects</span>
        <span class="k">while</span> <span class="n">folds</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">folds</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">3</span><span class="p">])</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">steps</span><span class="p">:</span>
            <span class="n">folds</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
            <span class="n">n_removed_folds</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="c1"># Replace partitions inside folds with length 0 with `None`</span>
    <span class="n">folds</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">[</span><span class="n">partition</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">partition</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">partition</span> <span class="ow">in</span> <span class="n">fold</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">fold</span> <span class="ow">in</span> <span class="n">folds</span>
    <span class="p">]</span>

    <span class="c1"># Create a flag to know whether to train the forecaster</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">refit</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refit</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">refit</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
        <span class="n">fit_forecaster</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">refit</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">folds</span><span class="p">)</span>
        <span class="n">fit_forecaster</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fit_forecaster</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">folds</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">fit_forecaster</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">refit</span><span class="p">):</span>
            <span class="n">fit_forecaster</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">folds</span><span class="p">)):</span>
        <span class="n">folds</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
        <span class="n">folds</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fit_forecaster</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">fit_forecaster</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">folds</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">folds</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">index_to_skip</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">skip_folds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">skip_folds</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">integer</span><span class="p">))</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">skip_folds</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">index_to_keep</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">folds</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">skip_folds</span><span class="p">)</span>
            <span class="n">index_to_skip</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">setdiff1d</span><span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">folds</span><span class="p">)),</span> <span class="n">index_to_keep</span><span class="p">,</span> <span class="n">assume_unique</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>
            <span class="n">index_to_skip</span> <span class="o">=</span> <span class="p">[</span>
                <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">index_to_skip</span>
            <span class="p">]</span>  <span class="c1"># Required since numpy 2.0</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">skip_folds</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">index_to_skip</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">skip_folds</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">folds</span><span class="p">)]</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_print_info</span><span class="p">(</span>
            <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">,</span>
            <span class="n">folds</span><span class="o">=</span><span class="n">folds</span><span class="p">,</span>
            <span class="n">externally_fitted</span><span class="o">=</span><span class="n">externally_fitted</span><span class="p">,</span>
            <span class="n">n_removed_folds</span><span class="o">=</span><span class="n">n_removed_folds</span><span class="p">,</span>
            <span class="n">index_to_skip</span><span class="o">=</span><span class="n">index_to_skip</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="n">folds</span> <span class="o">=</span> <span class="p">[</span><span class="n">fold</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">fold</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">folds</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">index_to_skip</span><span class="p">]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">return_all_indexes</span><span class="p">:</span>
        <span class="c1"># NOTE: +1 to prevent iloc pandas from deleting the last observation</span>
        <span class="n">folds</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">[</span>
                <span class="n">fold</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                <span class="p">[</span><span class="n">fold</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">fold</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span>
                <span class="p">(</span>
                    <span class="p">[</span><span class="n">fold</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">fold</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_size</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                    <span class="k">else</span> <span class="p">[]</span>
                <span class="p">),</span>
                <span class="p">[</span><span class="n">fold</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">fold</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span>
                <span class="p">[</span><span class="n">fold</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">fold</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span>
                <span class="n">fold</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span>
            <span class="p">]</span>
            <span class="k">for</span> <span class="n">fold</span> <span class="ow">in</span> <span class="n">folds</span>
        <span class="p">]</span>

    <span class="k">if</span> <span class="n">externally_fitted</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initial_train_size</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">folds</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">if</span> <span class="n">as_pandas</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">fold</span> <span class="ow">in</span> <span class="n">folds</span><span class="p">:</span>
                <span class="n">fold</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">return_all_indexes</span><span class="p">:</span>
            <span class="n">folds</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
                <span class="n">data</span><span class="o">=</span><span class="p">[</span>
                    <span class="p">[</span><span class="n">fold</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span><span class="o">*</span><span class="n">fold</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span> <span class="o">+</span> <span class="p">[</span><span class="n">fold</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
                    <span class="k">for</span> <span class="n">fold</span> <span class="ow">in</span> <span class="n">folds</span>
                <span class="p">],</span>
                <span class="n">columns</span><span class="o">=</span><span class="p">[</span>
                    <span class="s2">&quot;fold&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;train_start&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;train_end&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;last_window_start&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;last_window_end&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;test_start&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;test_end&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;test_start_with_gap&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;test_end_with_gap&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;fit_forecaster&quot;</span><span class="p">,</span>
                <span class="p">],</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">folds</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
                <span class="n">data</span><span class="o">=</span><span class="n">folds</span><span class="p">,</span>
                <span class="n">columns</span><span class="o">=</span><span class="p">[</span>
                    <span class="s2">&quot;fold&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;train_index&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;last_window_index&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;test_index&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;test_index_with_gap&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;fit_forecaster&quot;</span><span class="p">,</span>
                <span class="p">],</span>
            <span class="p">)</span>

    <span class="k">return</span> <span class="n">folds</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../..", "features": ["navigation.tabs", "navigation.sections", "navigation.expand", "content.code.copy"], "search": "../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
    
  </body>
</html>