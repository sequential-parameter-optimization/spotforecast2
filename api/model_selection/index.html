
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Forecasting with spot">
      
      
        <meta name="author" content="bartzbeielstein">
      
      
        <link rel="canonical" href="https://sequential-parameter-optimization.github.io/spotforecast2/api/model_selection/">
      
      
        <link rel="prev" href="../forecaster/">
      
      
        <link rel="next" href="../stats/">
      
      
        
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>Model Selection - spotforecast2</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="purple">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#model-selection-module" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="spotforecast2" class="md-header__button md-logo" aria-label="spotforecast2" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            spotforecast2
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Model Selection
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="purple"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="teal" data-md-color-accent="lime"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/sequential-parameter-optimization/spotforecast2" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    spotforecast2
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../data/" class="md-tabs__link">
          
  
  
  API Reference

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../processing/model_persistence/" class="md-tabs__link">
          
  
  
  Processing Guides

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../preprocessing/outliers/" class="md-tabs__link">
          
  
  
  Preprocessing Guides

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../tasks/" class="md-tabs__link">
          
  
  
  Tasks

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="spotforecast2" class="md-nav__button md-logo" aria-label="spotforecast2" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    spotforecast2
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/sequential-parameter-optimization/spotforecast2" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    spotforecast2
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    API Reference
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    API Reference
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../data/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Data
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../preprocessing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Preprocessing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../forecaster/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Forecaster
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Model Selection
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Model Selection
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#model-selection-for-safety-critical-forecasting" class="md-nav__link">
    <span class="md-ellipsis">
      
        Model Selection for Safety-Critical Forecasting
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#validation-backtesting-forecaster" class="md-nav__link">
    <span class="md-ellipsis">
      
        Validation: Backtesting Forecaster
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spotforecast2_safe.model_selection.backtesting_forecaster" class="md-nav__link">
    <span class="md-ellipsis">
      
        backtesting_forecaster
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="backtesting_forecaster">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#design-philosophy-for-safety-critical-systems" class="md-nav__link">
    <span class="md-ellipsis">
      
        Design Philosophy for Safety-Critical Systems
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fallback-mechanisms-in-production" class="md-nav__link">
    <span class="md-ellipsis">
      
        Fallback Mechanisms in Production
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#understanding-probabilistic-forecasting" class="md-nav__link">
    <span class="md-ellipsis">
      
        Understanding Probabilistic Forecasting
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#probabilistic-forecasting-with-residuals" class="md-nav__link">
    <span class="md-ellipsis">
      
        Probabilistic Forecasting with Residuals
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#complete-examples" class="md-nav__link">
    <span class="md-ellipsis">
      
        Complete Examples
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Complete Examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example-0-safety-critical-energy-grid-forecasting" class="md-nav__link">
    <span class="md-ellipsis">
      
        Example 0: Safety-Critical Energy Grid Forecasting
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-1-bootstrapping-method" class="md-nav__link">
    <span class="md-ellipsis">
      
        Example 1: Bootstrapping Method
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-2-conformal-prediction-with-binned-residuals" class="md-nav__link">
    <span class="md-ellipsis">
      
        Example 2: Conformal Prediction with Binned Residuals
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-3-forecasting-with-exogenous-variables" class="md-nav__link">
    <span class="md-ellipsis">
      
        Example 3: Forecasting with Exogenous Variables
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#time-series-cross-validation-timeseriesfold" class="md-nav__link">
    <span class="md-ellipsis">
      
        Time Series Cross-Validation: TimeSeriesFold
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spotforecast2.model_selection.split_ts_cv.TimeSeriesFold" class="md-nav__link">
    <span class="md-ellipsis">
      
        TimeSeriesFold
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="TimeSeriesFold">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#spotforecast2.model_selection.split_ts_cv.TimeSeriesFold.__repr__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __repr__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#spotforecast2.model_selection.split_ts_cv.TimeSeriesFold.split" class="md-nav__link">
    <span class="md-ellipsis">
      
        split
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#design-philosophy-for-safety-critical-validation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Design Philosophy for Safety-Critical Validation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#timeseriesfold-as-a-fallback-mechanism" class="md-nav__link">
    <span class="md-ellipsis">
      
        TimeSeriesFold as a Fallback Mechanism
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#understanding-fold-configuration-parameters" class="md-nav__link">
    <span class="md-ellipsis">
      
        Understanding Fold Configuration Parameters
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#safety-critical-configuration-patterns" class="md-nav__link">
    <span class="md-ellipsis">
      
        Safety-Critical Configuration Patterns
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#complete-examples_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        Complete Examples
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Complete Examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example-1-medical-device-validation-expanding-window-strategy" class="md-nav__link">
    <span class="md-ellipsis">
      
        Example 1: Medical Device Validation - Expanding Window Strategy
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-2-high-frequency-trading-fixed-window-strategy" class="md-nav__link">
    <span class="md-ellipsis">
      
        Example 2: High-Frequency Trading - Fixed Window Strategy
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-3-overlapping-folds-for-robust-evaluation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Example 3: Overlapping Folds for Robust Evaluation
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#one-step-ahead-fold-simplified-validation-for-specific-use-cases" class="md-nav__link">
    <span class="md-ellipsis">
      
        One Step Ahead Fold: Simplified Validation for Specific Use Cases
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spotforecast2_safe.model_selection.OneStepAheadFold" class="md-nav__link">
    <span class="md-ellipsis">
      
        OneStepAheadFold
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="OneStepAheadFold">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#spotforecast2_safe.model_selection.OneStepAheadFold.__repr__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __repr__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#spotforecast2_safe.model_selection.OneStepAheadFold.split" class="md-nav__link">
    <span class="md-ellipsis">
      
        split
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#design-philosophy-for-safety-critical-validation_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        Design Philosophy for Safety-Critical Validation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#onestepaheadfold-as-a-fallback-mechanism" class="md-nav__link">
    <span class="md-ellipsis">
      
        OneStepAheadFold as a Fallback Mechanism
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#when-to-use-onestepaheadfold-vs-timeseriesfold" class="md-nav__link">
    <span class="md-ellipsis">
      
        When to Use OneStepAheadFold vs TimeSeriesFold
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#understanding-the-single-split-strategy" class="md-nav__link">
    <span class="md-ellipsis">
      
        Understanding the Single Split Strategy
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#complete-examples_2" class="md-nav__link">
    <span class="md-ellipsis">
      
        Complete Examples
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Complete Examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example-1-rapid-model-screening-for-safety-critical-deployment" class="md-nav__link">
    <span class="md-ellipsis">
      
        Example 1: Rapid Model Screening for Safety-Critical Deployment
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-2-static-model-deployment-validation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Example 2: Static Model Deployment Validation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-3-emergency-production-validation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Example 3: Emergency Production Validation
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#computational-efficiency-comparison" class="md-nav__link">
    <span class="md-ellipsis">
      
        Computational Efficiency Comparison
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#grid-search" class="md-nav__link">
    <span class="md-ellipsis">
      
        Grid Search
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spotforecast2.model_selection.grid_search" class="md-nav__link">
    <span class="md-ellipsis">
      
        grid_search
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="grid_search">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#spotforecast2.model_selection.grid_search.grid_search_forecaster" class="md-nav__link">
    <span class="md-ellipsis">
      
        grid_search_forecaster
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spotoptim-search" class="md-nav__link">
    <span class="md-ellipsis">
      
        spotoptim Search
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spotforecast2.model_selection.spotoptim_search" class="md-nav__link">
    <span class="md-ellipsis">
      
        spotoptim_search
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="spotoptim_search">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#spotforecast2.model_selection.spotoptim_search.spotoptim_search_forecaster" class="md-nav__link">
    <span class="md-ellipsis">
      
        spotoptim_search_forecaster
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bayesian-search" class="md-nav__link">
    <span class="md-ellipsis">
      
        Bayesian Search
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spotforecast2.model_selection.bayesian_search" class="md-nav__link">
    <span class="md-ellipsis">
      
        bayesian_search
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="bayesian_search">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#spotforecast2.model_selection.bayesian_search.bayesian_search_forecaster" class="md-nav__link">
    <span class="md-ellipsis">
      
        bayesian_search_forecaster
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#random-search" class="md-nav__link">
    <span class="md-ellipsis">
      
        Random Search
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spotforecast2.model_selection.random_search" class="md-nav__link">
    <span class="md-ellipsis">
      
        random_search
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="random_search">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#spotforecast2.model_selection.random_search.random_search_forecaster" class="md-nav__link">
    <span class="md-ellipsis">
      
        random_search_forecaster
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../stats/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Stats
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../utils/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Utils
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../weather/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Weather
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../exceptions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Exceptions
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../manager/configurator/config_entsoe/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Config Entsoe
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Processing Guides
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Processing Guides
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../processing/model_persistence/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Model Persistence
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Preprocessing Guides
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Preprocessing Guides
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../preprocessing/outliers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Outlier Detection
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../preprocessing/time_series_visualization/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Time Series Visualization
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Tasks
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Tasks
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tasks/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../entsoe/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ENTSO-E Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#model-selection-for-safety-critical-forecasting" class="md-nav__link">
    <span class="md-ellipsis">
      
        Model Selection for Safety-Critical Forecasting
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#validation-backtesting-forecaster" class="md-nav__link">
    <span class="md-ellipsis">
      
        Validation: Backtesting Forecaster
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spotforecast2_safe.model_selection.backtesting_forecaster" class="md-nav__link">
    <span class="md-ellipsis">
      
        backtesting_forecaster
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="backtesting_forecaster">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#design-philosophy-for-safety-critical-systems" class="md-nav__link">
    <span class="md-ellipsis">
      
        Design Philosophy for Safety-Critical Systems
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fallback-mechanisms-in-production" class="md-nav__link">
    <span class="md-ellipsis">
      
        Fallback Mechanisms in Production
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#understanding-probabilistic-forecasting" class="md-nav__link">
    <span class="md-ellipsis">
      
        Understanding Probabilistic Forecasting
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#probabilistic-forecasting-with-residuals" class="md-nav__link">
    <span class="md-ellipsis">
      
        Probabilistic Forecasting with Residuals
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#complete-examples" class="md-nav__link">
    <span class="md-ellipsis">
      
        Complete Examples
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Complete Examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example-0-safety-critical-energy-grid-forecasting" class="md-nav__link">
    <span class="md-ellipsis">
      
        Example 0: Safety-Critical Energy Grid Forecasting
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-1-bootstrapping-method" class="md-nav__link">
    <span class="md-ellipsis">
      
        Example 1: Bootstrapping Method
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-2-conformal-prediction-with-binned-residuals" class="md-nav__link">
    <span class="md-ellipsis">
      
        Example 2: Conformal Prediction with Binned Residuals
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-3-forecasting-with-exogenous-variables" class="md-nav__link">
    <span class="md-ellipsis">
      
        Example 3: Forecasting with Exogenous Variables
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#time-series-cross-validation-timeseriesfold" class="md-nav__link">
    <span class="md-ellipsis">
      
        Time Series Cross-Validation: TimeSeriesFold
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spotforecast2.model_selection.split_ts_cv.TimeSeriesFold" class="md-nav__link">
    <span class="md-ellipsis">
      
        TimeSeriesFold
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="TimeSeriesFold">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#spotforecast2.model_selection.split_ts_cv.TimeSeriesFold.__repr__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __repr__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#spotforecast2.model_selection.split_ts_cv.TimeSeriesFold.split" class="md-nav__link">
    <span class="md-ellipsis">
      
        split
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#design-philosophy-for-safety-critical-validation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Design Philosophy for Safety-Critical Validation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#timeseriesfold-as-a-fallback-mechanism" class="md-nav__link">
    <span class="md-ellipsis">
      
        TimeSeriesFold as a Fallback Mechanism
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#understanding-fold-configuration-parameters" class="md-nav__link">
    <span class="md-ellipsis">
      
        Understanding Fold Configuration Parameters
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#safety-critical-configuration-patterns" class="md-nav__link">
    <span class="md-ellipsis">
      
        Safety-Critical Configuration Patterns
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#complete-examples_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        Complete Examples
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Complete Examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example-1-medical-device-validation-expanding-window-strategy" class="md-nav__link">
    <span class="md-ellipsis">
      
        Example 1: Medical Device Validation - Expanding Window Strategy
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-2-high-frequency-trading-fixed-window-strategy" class="md-nav__link">
    <span class="md-ellipsis">
      
        Example 2: High-Frequency Trading - Fixed Window Strategy
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-3-overlapping-folds-for-robust-evaluation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Example 3: Overlapping Folds for Robust Evaluation
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#one-step-ahead-fold-simplified-validation-for-specific-use-cases" class="md-nav__link">
    <span class="md-ellipsis">
      
        One Step Ahead Fold: Simplified Validation for Specific Use Cases
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spotforecast2_safe.model_selection.OneStepAheadFold" class="md-nav__link">
    <span class="md-ellipsis">
      
        OneStepAheadFold
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="OneStepAheadFold">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#spotforecast2_safe.model_selection.OneStepAheadFold.__repr__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __repr__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#spotforecast2_safe.model_selection.OneStepAheadFold.split" class="md-nav__link">
    <span class="md-ellipsis">
      
        split
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#design-philosophy-for-safety-critical-validation_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        Design Philosophy for Safety-Critical Validation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#onestepaheadfold-as-a-fallback-mechanism" class="md-nav__link">
    <span class="md-ellipsis">
      
        OneStepAheadFold as a Fallback Mechanism
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#when-to-use-onestepaheadfold-vs-timeseriesfold" class="md-nav__link">
    <span class="md-ellipsis">
      
        When to Use OneStepAheadFold vs TimeSeriesFold
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#understanding-the-single-split-strategy" class="md-nav__link">
    <span class="md-ellipsis">
      
        Understanding the Single Split Strategy
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#complete-examples_2" class="md-nav__link">
    <span class="md-ellipsis">
      
        Complete Examples
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Complete Examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example-1-rapid-model-screening-for-safety-critical-deployment" class="md-nav__link">
    <span class="md-ellipsis">
      
        Example 1: Rapid Model Screening for Safety-Critical Deployment
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-2-static-model-deployment-validation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Example 2: Static Model Deployment Validation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-3-emergency-production-validation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Example 3: Emergency Production Validation
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#computational-efficiency-comparison" class="md-nav__link">
    <span class="md-ellipsis">
      
        Computational Efficiency Comparison
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#grid-search" class="md-nav__link">
    <span class="md-ellipsis">
      
        Grid Search
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spotforecast2.model_selection.grid_search" class="md-nav__link">
    <span class="md-ellipsis">
      
        grid_search
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="grid_search">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#spotforecast2.model_selection.grid_search.grid_search_forecaster" class="md-nav__link">
    <span class="md-ellipsis">
      
        grid_search_forecaster
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spotoptim-search" class="md-nav__link">
    <span class="md-ellipsis">
      
        spotoptim Search
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spotforecast2.model_selection.spotoptim_search" class="md-nav__link">
    <span class="md-ellipsis">
      
        spotoptim_search
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="spotoptim_search">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#spotforecast2.model_selection.spotoptim_search.spotoptim_search_forecaster" class="md-nav__link">
    <span class="md-ellipsis">
      
        spotoptim_search_forecaster
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bayesian-search" class="md-nav__link">
    <span class="md-ellipsis">
      
        Bayesian Search
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spotforecast2.model_selection.bayesian_search" class="md-nav__link">
    <span class="md-ellipsis">
      
        bayesian_search
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="bayesian_search">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#spotforecast2.model_selection.bayesian_search.bayesian_search_forecaster" class="md-nav__link">
    <span class="md-ellipsis">
      
        bayesian_search_forecaster
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#random-search" class="md-nav__link">
    <span class="md-ellipsis">
      
        Random Search
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spotforecast2.model_selection.random_search" class="md-nav__link">
    <span class="md-ellipsis">
      
        random_search
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="random_search">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#spotforecast2.model_selection.random_search.random_search_forecaster" class="md-nav__link">
    <span class="md-ellipsis">
      
        random_search_forecaster
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="model-selection-module">Model Selection Module</h1>
<h2 id="model-selection-for-safety-critical-forecasting">Model Selection for Safety-Critical Forecasting</h2>
<p>The model selection module provides robust validation and cross-validation tools designed for production environments where forecast reliability is paramount. These tools enable rigorous model evaluation through time series backtesting, ensuring models perform consistently across different temporal conditions.</p>
<h2 id="validation-backtesting-forecaster">Validation: Backtesting Forecaster</h2>


<div class="doc doc-object doc-function">


<h2 id="spotforecast2_safe.model_selection.backtesting_forecaster" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">spotforecast2_safe</span><span class="o">.</span><span class="n">model_selection</span><span class="o">.</span><span class="n">backtesting_forecaster</span><span class="p">(</span><span class="n">forecaster</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">cv</span><span class="p">,</span> <span class="n">metric</span><span class="p">,</span> <span class="n">exog</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">interval_method</span><span class="o">=</span><span class="s1">&#39;bootstrapping&#39;</span><span class="p">,</span> <span class="n">n_boot</span><span class="o">=</span><span class="mi">250</span><span class="p">,</span> <span class="n">use_in_sample_residuals</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">use_binned_residuals</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">,</span> <span class="n">return_predictors</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">show_progress</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">suppress_warnings</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents first">

        <p>Backtesting of forecaster model following the folds generated by the TimeSeriesFold
class and using the metric(s) provided.</p>
<p>If <code>forecaster</code> is already trained and <code>initial_train_size</code> is set to <code>None</code> in the
TimeSeriesFold class, no initial train will be done and all data will be used
to evaluate the model. However, the first <code>len(forecaster.last_window)</code> observations
are needed to create the initial predictors, so no predictions are calculated for
them.</p>
<p>A copy of the original forecaster is created so that it is not modified during
the process.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>forecaster</code>
            </td>
            <td>
                  <code>(<span title="ForecasterRecursive">ForecasterRecursive</span>, <span title="ForecasterDirect">ForecasterDirect</span>, <span title="ForecasterEquivalentDate">ForecasterEquivalentDate</span>)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Forecaster model.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>y</code>
            </td>
            <td>
                  <code><span title="pandas.Series">Series</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Training time series.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>cv</code>
            </td>
            <td>
                  <code><span title="spotforecast2_safe.model_selection.split_ts_cv.TimeSeriesFold">TimeSeriesFold</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>TimeSeriesFold object with the information needed to
split the data into folds.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>metric</code>
            </td>
            <td>
                  <code><span title="str">str</span> | <span title="typing.Callable">Callable</span> | <span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Metric used to quantify the goodness of fit
of the model.</p>
<ul>
<li>If <code>str</code>: {'mean_squared_error', 'mean_absolute_error',
  'mean_absolute_percentage_error', 'mean_squared_log_error',
  'mean_absolute_scaled_error', 'root_mean_squared_scaled_error'}</li>
<li>If <code>Callable</code>: Function with arguments <code>y_true</code>, <code>y_pred</code> and <code>y_train</code>
  (Optional) that returns a float.</li>
<li>If <code>list</code>: List containing multiple strings and/or Callables.</li>
</ul>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>exog</code>
            </td>
            <td>
                  <code><span title="pandas.Series">Series</span> | <span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Exogenous variable/s included as
predictor/s. Must have the same number of observations as <code>y</code> and should
be aligned so that y[i] is regressed on exog[i]. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>interval</code>
            </td>
            <td>
                  <code><span title="float">float</span> | <span title="list">list</span> | <span title="tuple">tuple</span> | <span title="str">str</span> | <span title="object">object</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Specifies whether
probabilistic predictions should be estimated and the method to use.
The following options are supported:</p>
<ul>
<li>If <code>float</code>, represents the nominal (expected) coverage (between 0 and 1).
For instance, <code>interval=0.95</code> corresponds to <code>[2.5, 97.5]</code> percentiles.</li>
<li>If <code>list</code> or <code>tuple</code>: Sequence of percentiles to compute, each value must
  be between 0 and 100 inclusive. For example, a 95% confidence interval can
  be specified as <code>interval = [2.5, 97.5]</code> or multiple percentiles (e.g. 10,
  50 and 90) as <code>interval = [10, 50, 90]</code>.</li>
<li>If 'bootstrapping' (str): <code>n_boot</code> bootstrapping predictions will be
  generated.</li>
<li>If scipy.stats distribution object, the distribution parameters will
  be estimated for each prediction.</li>
<li>If None, no probabilistic predictions are estimated.
Defaults to None.</li>
</ul>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>interval_method</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Technique used to estimate prediction
intervals. Available options:</p>
<ul>
<li>'bootstrapping': Bootstrapping is used to generate prediction intervals.</li>
<li>'conformal': Employs the conformal prediction split method for
  interval estimation.
Defaults to 'bootstrapping'.</li>
</ul>
              </div>
            </td>
            <td>
                  <code>&#39;bootstrapping&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>n_boot</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of bootstrapping iterations to perform when
estimating prediction intervals. Defaults to 250.</p>
              </div>
            </td>
            <td>
                  <code>250</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>use_in_sample_residuals</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If <code>True</code>, residuals from the
training data are used as proxy of prediction error to create predictions.
If <code>False</code>, out of sample residuals (calibration) are used.
Out-of-sample residuals must be precomputed using Forecaster's
<code>set_out_sample_residuals()</code> method. Defaults to True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>use_binned_residuals</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If <code>True</code>, residuals are selected
based on the predicted values (binned selection).
If <code>False</code>, residuals are selected randomly. Defaults to True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>random_state</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Seed for the random number generator to
ensure reproducibility. Defaults to 123.</p>
              </div>
            </td>
            <td>
                  <code>123</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>return_predictors</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If <code>True</code>, the predictors used to make
the predictions are also returned. Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>n_jobs</code>
            </td>
            <td>
                  <code><span title="int">int</span> | <span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of jobs to run in parallel. If <code>-1</code>,
then the number of jobs is set to the number of cores. If 'auto', <code>n_jobs</code>
is set using the function <code>skforecast.utils.select_n_jobs_backtesting</code>.
Defaults to 'auto'.</p>
              </div>
            </td>
            <td>
                  <code>&#39;auto&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>verbose</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Print number of folds and index of training and
validation sets used for backtesting. Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>show_progress</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to show a progress bar.
Defaults to True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>suppress_warnings</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If <code>True</code>, spotforecast warnings will be
suppressed during the backtesting process. See
<code>spotforecast.exceptions.warn_skforecast_categories</code> for more information.
Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>tuple</code></td>            <td>
                  <code>(<span title="pandas.DataFrame">DataFrame</span>, <span title="pandas.DataFrame">DataFrame</span>)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <ul>
<li>metric_values: Value(s) of the metric(s).</li>
<li>
<p>backtest_predictions: Value of predictions. The DataFrame includes
  the following columns:</p>
</li>
<li>
<p>fold: Indicates the fold number where the prediction was made.</p>
</li>
<li>pred: Predicted values for the corresponding series and time steps.</li>
</ul>
<p>If <code>interval</code> is not <code>None</code>, additional columns are included depending
  on the method:</p>
<ul>
<li>For <code>float</code>: Columns <code>lower_bound</code> and <code>upper_bound</code>.</li>
<li>For <code>list</code> or <code>tuple</code> of 2 elements: Columns <code>lower_bound</code> and
    <code>upper_bound</code>.</li>
<li>For <code>list</code> or <code>tuple</code> with multiple percentiles: One column per
    percentile (e.g., <code>p_10</code>, <code>p_50</code>, <code>p_90</code>).</li>
<li>For <code>'bootstrapping'</code>: One column per bootstrapping iteration
    (e.g., <code>pred_boot_0</code>, <code>pred_boot_1</code>, ..., <code>pred_boot_n</code>).</li>
<li>For <code>scipy.stats</code> distribution objects: One column for each
    estimated parameter of the distribution (e.g., <code>loc</code>, <code>scale</code>).</li>
</ul>
<p>If <code>return_predictors</code> is <code>True</code>, one column per predictor is created.</p>
<p>Depending on the relation between <code>steps</code> and <code>fold_stride</code>, the output
  may include repeated indexes (if <code>fold_stride &lt; steps</code>) or gaps
  (if <code>fold_stride &gt; steps</code>). See Notes below for more details.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="notes" open>
  <summary>Notes</summary>
  <p>Note on <code>fold_stride</code> vs. <code>steps</code>:</p>
<ul>
<li>If <code>fold_stride == steps</code>, test sets are placed back-to-back without overlap.
  Each observation appears only once in the output DataFrame, so the
  index is unique.</li>
<li>If <code>fold_stride &lt; steps</code>, test sets overlap. Multiple forecasts are
  generated for the same observations and, therefore, the output
  DataFrame contains repeated indexes.</li>
<li>If <code>fold_stride &gt; steps</code>, there are gaps between consecutive test sets.
  Some observations in the series will not have associated predictions,
  so the output DataFrame has non-contiguous indexes.</li>
</ul>
</details>

<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.ensemble</span><span class="w"> </span><span class="kn">import</span> <span class="n">RandomForestRegressor</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">spotforecast2_safe.forecaster.recursive</span><span class="w"> </span><span class="kn">import</span> <span class="n">ForecasterRecursive</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">spotforecast2_safe.model_selection</span><span class="w"> </span><span class="kn">import</span> <span class="n">backtesting_forecaster</span><span class="p">,</span> <span class="n">TimeSeriesFold</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">y</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">])</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">forecaster</span> <span class="o">=</span> <span class="n">ForecasterRecursive</span><span class="p">(</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="gp">... </span>    <span class="n">estimator</span><span class="o">=</span><span class="n">RandomForestRegressor</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">),</span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="gp">... </span>    <span class="n">lags</span><span class="o">=</span><span class="mi">2</span>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="gp">... </span><span class="p">)</span>
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">cv</span> <span class="o">=</span> <span class="n">TimeSeriesFold</span><span class="p">(</span>
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a><span class="gp">... </span>    <span class="n">steps</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
<a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a><span class="gp">... </span>    <span class="n">initial_train_size</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
<a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a><span class="gp">... </span>    <span class="n">refit</span><span class="o">=</span><span class="kc">False</span>
<a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a><span class="gp">... </span><span class="p">)</span>
<a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">metric_values</span><span class="p">,</span> <span class="n">backtest_predictions</span> <span class="o">=</span> <span class="n">backtesting_forecaster</span><span class="p">(</span>
<a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a><span class="gp">... </span>    <span class="n">forecaster</span><span class="o">=</span><span class="n">forecaster</span><span class="p">,</span>
<a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a><span class="gp">... </span>    <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span>
<a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a><span class="gp">... </span>    <span class="n">cv</span><span class="o">=</span><span class="n">cv</span><span class="p">,</span>
<a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a><span class="gp">... </span>    <span class="n">metric</span><span class="o">=</span><span class="s1">&#39;mean_squared_error&#39;</span>
<a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a><span class="gp">... </span><span class="p">)</span>
<a id="__codelineno-0-21" name="__codelineno-0-21" href="#__codelineno-0-21"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">metric_values</span>
<a id="__codelineno-0-22" name="__codelineno-0-22" href="#__codelineno-0-22"></a><span class="go">   mean_squared_error</span>
<a id="__codelineno-0-23" name="__codelineno-0-23" href="#__codelineno-0-23"></a><span class="go">0            0.201334</span>
<a id="__codelineno-0-24" name="__codelineno-0-24" href="#__codelineno-0-24"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">backtest_predictions</span>
<a id="__codelineno-0-25" name="__codelineno-0-25" href="#__codelineno-0-25"></a><span class="go">   fold  pred</span>
<a id="__codelineno-0-26" name="__codelineno-0-26" href="#__codelineno-0-26"></a><span class="go">5     0  5.18</span>
<a id="__codelineno-0-27" name="__codelineno-0-27" href="#__codelineno-0-27"></a><span class="go">6     0  6.10</span>
<a id="__codelineno-0-28" name="__codelineno-0-28" href="#__codelineno-0-28"></a><span class="go">7     1  7.36</span>
<a id="__codelineno-0-29" name="__codelineno-0-29" href="#__codelineno-0-29"></a><span class="go">8     1  8.40</span>
<a id="__codelineno-0-30" name="__codelineno-0-30" href="#__codelineno-0-30"></a><span class="go">9     2  9.31</span>
</code></pre></div>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>spotforecast2_safe/model_selection/validation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-646">646</a></span>
<span class="normal"><a href="#__codelineno-0-647">647</a></span>
<span class="normal"><a href="#__codelineno-0-648">648</a></span>
<span class="normal"><a href="#__codelineno-0-649">649</a></span>
<span class="normal"><a href="#__codelineno-0-650">650</a></span>
<span class="normal"><a href="#__codelineno-0-651">651</a></span>
<span class="normal"><a href="#__codelineno-0-652">652</a></span>
<span class="normal"><a href="#__codelineno-0-653">653</a></span>
<span class="normal"><a href="#__codelineno-0-654">654</a></span>
<span class="normal"><a href="#__codelineno-0-655">655</a></span>
<span class="normal"><a href="#__codelineno-0-656">656</a></span>
<span class="normal"><a href="#__codelineno-0-657">657</a></span>
<span class="normal"><a href="#__codelineno-0-658">658</a></span>
<span class="normal"><a href="#__codelineno-0-659">659</a></span>
<span class="normal"><a href="#__codelineno-0-660">660</a></span>
<span class="normal"><a href="#__codelineno-0-661">661</a></span>
<span class="normal"><a href="#__codelineno-0-662">662</a></span>
<span class="normal"><a href="#__codelineno-0-663">663</a></span>
<span class="normal"><a href="#__codelineno-0-664">664</a></span>
<span class="normal"><a href="#__codelineno-0-665">665</a></span>
<span class="normal"><a href="#__codelineno-0-666">666</a></span>
<span class="normal"><a href="#__codelineno-0-667">667</a></span>
<span class="normal"><a href="#__codelineno-0-668">668</a></span>
<span class="normal"><a href="#__codelineno-0-669">669</a></span>
<span class="normal"><a href="#__codelineno-0-670">670</a></span>
<span class="normal"><a href="#__codelineno-0-671">671</a></span>
<span class="normal"><a href="#__codelineno-0-672">672</a></span>
<span class="normal"><a href="#__codelineno-0-673">673</a></span>
<span class="normal"><a href="#__codelineno-0-674">674</a></span>
<span class="normal"><a href="#__codelineno-0-675">675</a></span>
<span class="normal"><a href="#__codelineno-0-676">676</a></span>
<span class="normal"><a href="#__codelineno-0-677">677</a></span>
<span class="normal"><a href="#__codelineno-0-678">678</a></span>
<span class="normal"><a href="#__codelineno-0-679">679</a></span>
<span class="normal"><a href="#__codelineno-0-680">680</a></span>
<span class="normal"><a href="#__codelineno-0-681">681</a></span>
<span class="normal"><a href="#__codelineno-0-682">682</a></span>
<span class="normal"><a href="#__codelineno-0-683">683</a></span>
<span class="normal"><a href="#__codelineno-0-684">684</a></span>
<span class="normal"><a href="#__codelineno-0-685">685</a></span>
<span class="normal"><a href="#__codelineno-0-686">686</a></span>
<span class="normal"><a href="#__codelineno-0-687">687</a></span>
<span class="normal"><a href="#__codelineno-0-688">688</a></span>
<span class="normal"><a href="#__codelineno-0-689">689</a></span>
<span class="normal"><a href="#__codelineno-0-690">690</a></span>
<span class="normal"><a href="#__codelineno-0-691">691</a></span>
<span class="normal"><a href="#__codelineno-0-692">692</a></span>
<span class="normal"><a href="#__codelineno-0-693">693</a></span>
<span class="normal"><a href="#__codelineno-0-694">694</a></span>
<span class="normal"><a href="#__codelineno-0-695">695</a></span>
<span class="normal"><a href="#__codelineno-0-696">696</a></span>
<span class="normal"><a href="#__codelineno-0-697">697</a></span>
<span class="normal"><a href="#__codelineno-0-698">698</a></span>
<span class="normal"><a href="#__codelineno-0-699">699</a></span>
<span class="normal"><a href="#__codelineno-0-700">700</a></span>
<span class="normal"><a href="#__codelineno-0-701">701</a></span>
<span class="normal"><a href="#__codelineno-0-702">702</a></span>
<span class="normal"><a href="#__codelineno-0-703">703</a></span>
<span class="normal"><a href="#__codelineno-0-704">704</a></span>
<span class="normal"><a href="#__codelineno-0-705">705</a></span>
<span class="normal"><a href="#__codelineno-0-706">706</a></span>
<span class="normal"><a href="#__codelineno-0-707">707</a></span>
<span class="normal"><a href="#__codelineno-0-708">708</a></span>
<span class="normal"><a href="#__codelineno-0-709">709</a></span>
<span class="normal"><a href="#__codelineno-0-710">710</a></span>
<span class="normal"><a href="#__codelineno-0-711">711</a></span>
<span class="normal"><a href="#__codelineno-0-712">712</a></span>
<span class="normal"><a href="#__codelineno-0-713">713</a></span>
<span class="normal"><a href="#__codelineno-0-714">714</a></span>
<span class="normal"><a href="#__codelineno-0-715">715</a></span>
<span class="normal"><a href="#__codelineno-0-716">716</a></span>
<span class="normal"><a href="#__codelineno-0-717">717</a></span>
<span class="normal"><a href="#__codelineno-0-718">718</a></span>
<span class="normal"><a href="#__codelineno-0-719">719</a></span>
<span class="normal"><a href="#__codelineno-0-720">720</a></span>
<span class="normal"><a href="#__codelineno-0-721">721</a></span>
<span class="normal"><a href="#__codelineno-0-722">722</a></span>
<span class="normal"><a href="#__codelineno-0-723">723</a></span>
<span class="normal"><a href="#__codelineno-0-724">724</a></span>
<span class="normal"><a href="#__codelineno-0-725">725</a></span>
<span class="normal"><a href="#__codelineno-0-726">726</a></span>
<span class="normal"><a href="#__codelineno-0-727">727</a></span>
<span class="normal"><a href="#__codelineno-0-728">728</a></span>
<span class="normal"><a href="#__codelineno-0-729">729</a></span>
<span class="normal"><a href="#__codelineno-0-730">730</a></span>
<span class="normal"><a href="#__codelineno-0-731">731</a></span>
<span class="normal"><a href="#__codelineno-0-732">732</a></span>
<span class="normal"><a href="#__codelineno-0-733">733</a></span>
<span class="normal"><a href="#__codelineno-0-734">734</a></span>
<span class="normal"><a href="#__codelineno-0-735">735</a></span>
<span class="normal"><a href="#__codelineno-0-736">736</a></span>
<span class="normal"><a href="#__codelineno-0-737">737</a></span>
<span class="normal"><a href="#__codelineno-0-738">738</a></span>
<span class="normal"><a href="#__codelineno-0-739">739</a></span>
<span class="normal"><a href="#__codelineno-0-740">740</a></span>
<span class="normal"><a href="#__codelineno-0-741">741</a></span>
<span class="normal"><a href="#__codelineno-0-742">742</a></span>
<span class="normal"><a href="#__codelineno-0-743">743</a></span>
<span class="normal"><a href="#__codelineno-0-744">744</a></span>
<span class="normal"><a href="#__codelineno-0-745">745</a></span>
<span class="normal"><a href="#__codelineno-0-746">746</a></span>
<span class="normal"><a href="#__codelineno-0-747">747</a></span>
<span class="normal"><a href="#__codelineno-0-748">748</a></span>
<span class="normal"><a href="#__codelineno-0-749">749</a></span>
<span class="normal"><a href="#__codelineno-0-750">750</a></span>
<span class="normal"><a href="#__codelineno-0-751">751</a></span>
<span class="normal"><a href="#__codelineno-0-752">752</a></span>
<span class="normal"><a href="#__codelineno-0-753">753</a></span>
<span class="normal"><a href="#__codelineno-0-754">754</a></span>
<span class="normal"><a href="#__codelineno-0-755">755</a></span>
<span class="normal"><a href="#__codelineno-0-756">756</a></span>
<span class="normal"><a href="#__codelineno-0-757">757</a></span>
<span class="normal"><a href="#__codelineno-0-758">758</a></span>
<span class="normal"><a href="#__codelineno-0-759">759</a></span>
<span class="normal"><a href="#__codelineno-0-760">760</a></span>
<span class="normal"><a href="#__codelineno-0-761">761</a></span>
<span class="normal"><a href="#__codelineno-0-762">762</a></span>
<span class="normal"><a href="#__codelineno-0-763">763</a></span>
<span class="normal"><a href="#__codelineno-0-764">764</a></span>
<span class="normal"><a href="#__codelineno-0-765">765</a></span>
<span class="normal"><a href="#__codelineno-0-766">766</a></span>
<span class="normal"><a href="#__codelineno-0-767">767</a></span>
<span class="normal"><a href="#__codelineno-0-768">768</a></span>
<span class="normal"><a href="#__codelineno-0-769">769</a></span>
<span class="normal"><a href="#__codelineno-0-770">770</a></span>
<span class="normal"><a href="#__codelineno-0-771">771</a></span>
<span class="normal"><a href="#__codelineno-0-772">772</a></span>
<span class="normal"><a href="#__codelineno-0-773">773</a></span>
<span class="normal"><a href="#__codelineno-0-774">774</a></span>
<span class="normal"><a href="#__codelineno-0-775">775</a></span>
<span class="normal"><a href="#__codelineno-0-776">776</a></span>
<span class="normal"><a href="#__codelineno-0-777">777</a></span>
<span class="normal"><a href="#__codelineno-0-778">778</a></span>
<span class="normal"><a href="#__codelineno-0-779">779</a></span>
<span class="normal"><a href="#__codelineno-0-780">780</a></span>
<span class="normal"><a href="#__codelineno-0-781">781</a></span>
<span class="normal"><a href="#__codelineno-0-782">782</a></span>
<span class="normal"><a href="#__codelineno-0-783">783</a></span>
<span class="normal"><a href="#__codelineno-0-784">784</a></span>
<span class="normal"><a href="#__codelineno-0-785">785</a></span>
<span class="normal"><a href="#__codelineno-0-786">786</a></span>
<span class="normal"><a href="#__codelineno-0-787">787</a></span>
<span class="normal"><a href="#__codelineno-0-788">788</a></span>
<span class="normal"><a href="#__codelineno-0-789">789</a></span>
<span class="normal"><a href="#__codelineno-0-790">790</a></span>
<span class="normal"><a href="#__codelineno-0-791">791</a></span>
<span class="normal"><a href="#__codelineno-0-792">792</a></span>
<span class="normal"><a href="#__codelineno-0-793">793</a></span>
<span class="normal"><a href="#__codelineno-0-794">794</a></span>
<span class="normal"><a href="#__codelineno-0-795">795</a></span>
<span class="normal"><a href="#__codelineno-0-796">796</a></span>
<span class="normal"><a href="#__codelineno-0-797">797</a></span>
<span class="normal"><a href="#__codelineno-0-798">798</a></span>
<span class="normal"><a href="#__codelineno-0-799">799</a></span>
<span class="normal"><a href="#__codelineno-0-800">800</a></span>
<span class="normal"><a href="#__codelineno-0-801">801</a></span>
<span class="normal"><a href="#__codelineno-0-802">802</a></span>
<span class="normal"><a href="#__codelineno-0-803">803</a></span>
<span class="normal"><a href="#__codelineno-0-804">804</a></span>
<span class="normal"><a href="#__codelineno-0-805">805</a></span>
<span class="normal"><a href="#__codelineno-0-806">806</a></span>
<span class="normal"><a href="#__codelineno-0-807">807</a></span>
<span class="normal"><a href="#__codelineno-0-808">808</a></span>
<span class="normal"><a href="#__codelineno-0-809">809</a></span>
<span class="normal"><a href="#__codelineno-0-810">810</a></span>
<span class="normal"><a href="#__codelineno-0-811">811</a></span>
<span class="normal"><a href="#__codelineno-0-812">812</a></span>
<span class="normal"><a href="#__codelineno-0-813">813</a></span>
<span class="normal"><a href="#__codelineno-0-814">814</a></span>
<span class="normal"><a href="#__codelineno-0-815">815</a></span>
<span class="normal"><a href="#__codelineno-0-816">816</a></span>
<span class="normal"><a href="#__codelineno-0-817">817</a></span>
<span class="normal"><a href="#__codelineno-0-818">818</a></span>
<span class="normal"><a href="#__codelineno-0-819">819</a></span>
<span class="normal"><a href="#__codelineno-0-820">820</a></span>
<span class="normal"><a href="#__codelineno-0-821">821</a></span>
<span class="normal"><a href="#__codelineno-0-822">822</a></span>
<span class="normal"><a href="#__codelineno-0-823">823</a></span>
<span class="normal"><a href="#__codelineno-0-824">824</a></span>
<span class="normal"><a href="#__codelineno-0-825">825</a></span>
<span class="normal"><a href="#__codelineno-0-826">826</a></span>
<span class="normal"><a href="#__codelineno-0-827">827</a></span>
<span class="normal"><a href="#__codelineno-0-828">828</a></span>
<span class="normal"><a href="#__codelineno-0-829">829</a></span>
<span class="normal"><a href="#__codelineno-0-830">830</a></span>
<span class="normal"><a href="#__codelineno-0-831">831</a></span>
<span class="normal"><a href="#__codelineno-0-832">832</a></span>
<span class="normal"><a href="#__codelineno-0-833">833</a></span>
<span class="normal"><a href="#__codelineno-0-834">834</a></span>
<span class="normal"><a href="#__codelineno-0-835">835</a></span>
<span class="normal"><a href="#__codelineno-0-836">836</a></span>
<span class="normal"><a href="#__codelineno-0-837">837</a></span>
<span class="normal"><a href="#__codelineno-0-838">838</a></span>
<span class="normal"><a href="#__codelineno-0-839">839</a></span>
<span class="normal"><a href="#__codelineno-0-840">840</a></span>
<span class="normal"><a href="#__codelineno-0-841">841</a></span>
<span class="normal"><a href="#__codelineno-0-842">842</a></span>
<span class="normal"><a href="#__codelineno-0-843">843</a></span>
<span class="normal"><a href="#__codelineno-0-844">844</a></span>
<span class="normal"><a href="#__codelineno-0-845">845</a></span>
<span class="normal"><a href="#__codelineno-0-846">846</a></span>
<span class="normal"><a href="#__codelineno-0-847">847</a></span>
<span class="normal"><a href="#__codelineno-0-848">848</a></span>
<span class="normal"><a href="#__codelineno-0-849">849</a></span>
<span class="normal"><a href="#__codelineno-0-850">850</a></span>
<span class="normal"><a href="#__codelineno-0-851">851</a></span>
<span class="normal"><a href="#__codelineno-0-852">852</a></span>
<span class="normal"><a href="#__codelineno-0-853">853</a></span>
<span class="normal"><a href="#__codelineno-0-854">854</a></span>
<span class="normal"><a href="#__codelineno-0-855">855</a></span>
<span class="normal"><a href="#__codelineno-0-856">856</a></span>
<span class="normal"><a href="#__codelineno-0-857">857</a></span>
<span class="normal"><a href="#__codelineno-0-858">858</a></span>
<span class="normal"><a href="#__codelineno-0-859">859</a></span>
<span class="normal"><a href="#__codelineno-0-860">860</a></span>
<span class="normal"><a href="#__codelineno-0-861">861</a></span>
<span class="normal"><a href="#__codelineno-0-862">862</a></span>
<span class="normal"><a href="#__codelineno-0-863">863</a></span>
<span class="normal"><a href="#__codelineno-0-864">864</a></span>
<span class="normal"><a href="#__codelineno-0-865">865</a></span>
<span class="normal"><a href="#__codelineno-0-866">866</a></span>
<span class="normal"><a href="#__codelineno-0-867">867</a></span>
<span class="normal"><a href="#__codelineno-0-868">868</a></span>
<span class="normal"><a href="#__codelineno-0-869">869</a></span>
<span class="normal"><a href="#__codelineno-0-870">870</a></span>
<span class="normal"><a href="#__codelineno-0-871">871</a></span>
<span class="normal"><a href="#__codelineno-0-872">872</a></span>
<span class="normal"><a href="#__codelineno-0-873">873</a></span>
<span class="normal"><a href="#__codelineno-0-874">874</a></span>
<span class="normal"><a href="#__codelineno-0-875">875</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-646" name="__codelineno-0-646"></a><span class="k">def</span><span class="w"> </span><span class="nf">backtesting_forecaster</span><span class="p">(</span>
<a id="__codelineno-0-647" name="__codelineno-0-647"></a>    <span class="n">forecaster</span><span class="p">:</span> <span class="nb">object</span><span class="p">,</span>
<a id="__codelineno-0-648" name="__codelineno-0-648"></a>    <span class="n">y</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span>
<a id="__codelineno-0-649" name="__codelineno-0-649"></a>    <span class="n">cv</span><span class="p">:</span> <span class="n">TimeSeriesFold</span><span class="p">,</span>
<a id="__codelineno-0-650" name="__codelineno-0-650"></a>    <span class="n">metric</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Callable</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="n">Callable</span><span class="p">],</span>
<a id="__codelineno-0-651" name="__codelineno-0-651"></a>    <span class="n">exog</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span> <span class="o">|</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-652" name="__codelineno-0-652"></a>    <span class="n">interval</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">object</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-653" name="__codelineno-0-653"></a>    <span class="n">interval_method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;bootstrapping&quot;</span><span class="p">,</span>
<a id="__codelineno-0-654" name="__codelineno-0-654"></a>    <span class="n">n_boot</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">250</span><span class="p">,</span>
<a id="__codelineno-0-655" name="__codelineno-0-655"></a>    <span class="n">use_in_sample_residuals</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-656" name="__codelineno-0-656"></a>    <span class="n">use_binned_residuals</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-657" name="__codelineno-0-657"></a>    <span class="n">random_state</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">123</span><span class="p">,</span>
<a id="__codelineno-0-658" name="__codelineno-0-658"></a>    <span class="n">return_predictors</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-659" name="__codelineno-0-659"></a>    <span class="n">n_jobs</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;auto&quot;</span><span class="p">,</span>
<a id="__codelineno-0-660" name="__codelineno-0-660"></a>    <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-661" name="__codelineno-0-661"></a>    <span class="n">show_progress</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-662" name="__codelineno-0-662"></a>    <span class="n">suppress_warnings</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-663" name="__codelineno-0-663"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]:</span>
<a id="__codelineno-0-664" name="__codelineno-0-664"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-665" name="__codelineno-0-665"></a><span class="sd">    Backtesting of forecaster model following the folds generated by the TimeSeriesFold</span>
<a id="__codelineno-0-666" name="__codelineno-0-666"></a><span class="sd">    class and using the metric(s) provided.</span>
<a id="__codelineno-0-667" name="__codelineno-0-667"></a>
<a id="__codelineno-0-668" name="__codelineno-0-668"></a><span class="sd">    If `forecaster` is already trained and `initial_train_size` is set to `None` in the</span>
<a id="__codelineno-0-669" name="__codelineno-0-669"></a><span class="sd">    TimeSeriesFold class, no initial train will be done and all data will be used</span>
<a id="__codelineno-0-670" name="__codelineno-0-670"></a><span class="sd">    to evaluate the model. However, the first `len(forecaster.last_window)` observations</span>
<a id="__codelineno-0-671" name="__codelineno-0-671"></a><span class="sd">    are needed to create the initial predictors, so no predictions are calculated for</span>
<a id="__codelineno-0-672" name="__codelineno-0-672"></a><span class="sd">    them.</span>
<a id="__codelineno-0-673" name="__codelineno-0-673"></a>
<a id="__codelineno-0-674" name="__codelineno-0-674"></a><span class="sd">    A copy of the original forecaster is created so that it is not modified during</span>
<a id="__codelineno-0-675" name="__codelineno-0-675"></a><span class="sd">    the process.</span>
<a id="__codelineno-0-676" name="__codelineno-0-676"></a>
<a id="__codelineno-0-677" name="__codelineno-0-677"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-678" name="__codelineno-0-678"></a><span class="sd">        forecaster (ForecasterRecursive, ForecasterDirect, ForecasterEquivalentDate):</span>
<a id="__codelineno-0-679" name="__codelineno-0-679"></a><span class="sd">            Forecaster model.</span>
<a id="__codelineno-0-680" name="__codelineno-0-680"></a><span class="sd">        y (pd.Series): Training time series.</span>
<a id="__codelineno-0-681" name="__codelineno-0-681"></a><span class="sd">        cv (TimeSeriesFold): TimeSeriesFold object with the information needed to</span>
<a id="__codelineno-0-682" name="__codelineno-0-682"></a><span class="sd">            split the data into folds.</span>
<a id="__codelineno-0-683" name="__codelineno-0-683"></a><span class="sd">        metric (str | Callable | list): Metric used to quantify the goodness of fit</span>
<a id="__codelineno-0-684" name="__codelineno-0-684"></a><span class="sd">            of the model.</span>
<a id="__codelineno-0-685" name="__codelineno-0-685"></a>
<a id="__codelineno-0-686" name="__codelineno-0-686"></a><span class="sd">            - If `str`: {&#39;mean_squared_error&#39;, &#39;mean_absolute_error&#39;,</span>
<a id="__codelineno-0-687" name="__codelineno-0-687"></a><span class="sd">              &#39;mean_absolute_percentage_error&#39;, &#39;mean_squared_log_error&#39;,</span>
<a id="__codelineno-0-688" name="__codelineno-0-688"></a><span class="sd">              &#39;mean_absolute_scaled_error&#39;, &#39;root_mean_squared_scaled_error&#39;}</span>
<a id="__codelineno-0-689" name="__codelineno-0-689"></a><span class="sd">            - If `Callable`: Function with arguments `y_true`, `y_pred` and `y_train`</span>
<a id="__codelineno-0-690" name="__codelineno-0-690"></a><span class="sd">              (Optional) that returns a float.</span>
<a id="__codelineno-0-691" name="__codelineno-0-691"></a><span class="sd">            - If `list`: List containing multiple strings and/or Callables.</span>
<a id="__codelineno-0-692" name="__codelineno-0-692"></a><span class="sd">        exog (pd.Series | pd.DataFrame, optional): Exogenous variable/s included as</span>
<a id="__codelineno-0-693" name="__codelineno-0-693"></a><span class="sd">            predictor/s. Must have the same number of observations as `y` and should</span>
<a id="__codelineno-0-694" name="__codelineno-0-694"></a><span class="sd">            be aligned so that y[i] is regressed on exog[i]. Defaults to None.</span>
<a id="__codelineno-0-695" name="__codelineno-0-695"></a><span class="sd">        interval (float | list | tuple | str | object, optional): Specifies whether</span>
<a id="__codelineno-0-696" name="__codelineno-0-696"></a><span class="sd">            probabilistic predictions should be estimated and the method to use.</span>
<a id="__codelineno-0-697" name="__codelineno-0-697"></a><span class="sd">            The following options are supported:</span>
<a id="__codelineno-0-698" name="__codelineno-0-698"></a>
<a id="__codelineno-0-699" name="__codelineno-0-699"></a><span class="sd">            - If `float`, represents the nominal (expected) coverage (between 0 and 1).</span>
<a id="__codelineno-0-700" name="__codelineno-0-700"></a><span class="sd">            For instance, `interval=0.95` corresponds to `[2.5, 97.5]` percentiles.</span>
<a id="__codelineno-0-701" name="__codelineno-0-701"></a><span class="sd">            - If `list` or `tuple`: Sequence of percentiles to compute, each value must</span>
<a id="__codelineno-0-702" name="__codelineno-0-702"></a><span class="sd">              be between 0 and 100 inclusive. For example, a 95% confidence interval can</span>
<a id="__codelineno-0-703" name="__codelineno-0-703"></a><span class="sd">              be specified as `interval = [2.5, 97.5]` or multiple percentiles (e.g. 10,</span>
<a id="__codelineno-0-704" name="__codelineno-0-704"></a><span class="sd">              50 and 90) as `interval = [10, 50, 90]`.</span>
<a id="__codelineno-0-705" name="__codelineno-0-705"></a><span class="sd">            - If &#39;bootstrapping&#39; (str): `n_boot` bootstrapping predictions will be</span>
<a id="__codelineno-0-706" name="__codelineno-0-706"></a><span class="sd">              generated.</span>
<a id="__codelineno-0-707" name="__codelineno-0-707"></a><span class="sd">            - If scipy.stats distribution object, the distribution parameters will</span>
<a id="__codelineno-0-708" name="__codelineno-0-708"></a><span class="sd">              be estimated for each prediction.</span>
<a id="__codelineno-0-709" name="__codelineno-0-709"></a><span class="sd">            - If None, no probabilistic predictions are estimated.</span>
<a id="__codelineno-0-710" name="__codelineno-0-710"></a><span class="sd">            Defaults to None.</span>
<a id="__codelineno-0-711" name="__codelineno-0-711"></a><span class="sd">        interval_method (str, optional): Technique used to estimate prediction</span>
<a id="__codelineno-0-712" name="__codelineno-0-712"></a><span class="sd">            intervals. Available options:</span>
<a id="__codelineno-0-713" name="__codelineno-0-713"></a>
<a id="__codelineno-0-714" name="__codelineno-0-714"></a><span class="sd">            - &#39;bootstrapping&#39;: Bootstrapping is used to generate prediction intervals.</span>
<a id="__codelineno-0-715" name="__codelineno-0-715"></a><span class="sd">            - &#39;conformal&#39;: Employs the conformal prediction split method for</span>
<a id="__codelineno-0-716" name="__codelineno-0-716"></a><span class="sd">              interval estimation.</span>
<a id="__codelineno-0-717" name="__codelineno-0-717"></a><span class="sd">            Defaults to &#39;bootstrapping&#39;.</span>
<a id="__codelineno-0-718" name="__codelineno-0-718"></a><span class="sd">        n_boot (int, optional): Number of bootstrapping iterations to perform when</span>
<a id="__codelineno-0-719" name="__codelineno-0-719"></a><span class="sd">            estimating prediction intervals. Defaults to 250.</span>
<a id="__codelineno-0-720" name="__codelineno-0-720"></a><span class="sd">        use_in_sample_residuals (bool, optional): If `True`, residuals from the</span>
<a id="__codelineno-0-721" name="__codelineno-0-721"></a><span class="sd">            training data are used as proxy of prediction error to create predictions.</span>
<a id="__codelineno-0-722" name="__codelineno-0-722"></a><span class="sd">            If `False`, out of sample residuals (calibration) are used.</span>
<a id="__codelineno-0-723" name="__codelineno-0-723"></a><span class="sd">            Out-of-sample residuals must be precomputed using Forecaster&#39;s</span>
<a id="__codelineno-0-724" name="__codelineno-0-724"></a><span class="sd">            `set_out_sample_residuals()` method. Defaults to True.</span>
<a id="__codelineno-0-725" name="__codelineno-0-725"></a><span class="sd">        use_binned_residuals (bool, optional): If `True`, residuals are selected</span>
<a id="__codelineno-0-726" name="__codelineno-0-726"></a><span class="sd">            based on the predicted values (binned selection).</span>
<a id="__codelineno-0-727" name="__codelineno-0-727"></a><span class="sd">            If `False`, residuals are selected randomly. Defaults to True.</span>
<a id="__codelineno-0-728" name="__codelineno-0-728"></a><span class="sd">        random_state (int, optional): Seed for the random number generator to</span>
<a id="__codelineno-0-729" name="__codelineno-0-729"></a><span class="sd">            ensure reproducibility. Defaults to 123.</span>
<a id="__codelineno-0-730" name="__codelineno-0-730"></a><span class="sd">        return_predictors (bool, optional): If `True`, the predictors used to make</span>
<a id="__codelineno-0-731" name="__codelineno-0-731"></a><span class="sd">            the predictions are also returned. Defaults to False.</span>
<a id="__codelineno-0-732" name="__codelineno-0-732"></a><span class="sd">        n_jobs (int | str, optional): The number of jobs to run in parallel. If `-1`,</span>
<a id="__codelineno-0-733" name="__codelineno-0-733"></a><span class="sd">            then the number of jobs is set to the number of cores. If &#39;auto&#39;, `n_jobs`</span>
<a id="__codelineno-0-734" name="__codelineno-0-734"></a><span class="sd">            is set using the function `skforecast.utils.select_n_jobs_backtesting`.</span>
<a id="__codelineno-0-735" name="__codelineno-0-735"></a><span class="sd">            Defaults to &#39;auto&#39;.</span>
<a id="__codelineno-0-736" name="__codelineno-0-736"></a><span class="sd">        verbose (bool, optional): Print number of folds and index of training and</span>
<a id="__codelineno-0-737" name="__codelineno-0-737"></a><span class="sd">            validation sets used for backtesting. Defaults to False.</span>
<a id="__codelineno-0-738" name="__codelineno-0-738"></a><span class="sd">        show_progress (bool, optional): Whether to show a progress bar.</span>
<a id="__codelineno-0-739" name="__codelineno-0-739"></a><span class="sd">            Defaults to True.</span>
<a id="__codelineno-0-740" name="__codelineno-0-740"></a><span class="sd">        suppress_warnings (bool, optional): If `True`, spotforecast warnings will be</span>
<a id="__codelineno-0-741" name="__codelineno-0-741"></a><span class="sd">            suppressed during the backtesting process. See</span>
<a id="__codelineno-0-742" name="__codelineno-0-742"></a><span class="sd">            `spotforecast.exceptions.warn_skforecast_categories` for more information.</span>
<a id="__codelineno-0-743" name="__codelineno-0-743"></a><span class="sd">            Defaults to False.</span>
<a id="__codelineno-0-744" name="__codelineno-0-744"></a>
<a id="__codelineno-0-745" name="__codelineno-0-745"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-746" name="__codelineno-0-746"></a><span class="sd">        tuple (pd.DataFrame, pd.DataFrame):</span>
<a id="__codelineno-0-747" name="__codelineno-0-747"></a><span class="sd">            - metric_values: Value(s) of the metric(s).</span>
<a id="__codelineno-0-748" name="__codelineno-0-748"></a><span class="sd">            - backtest_predictions: Value of predictions. The DataFrame includes</span>
<a id="__codelineno-0-749" name="__codelineno-0-749"></a><span class="sd">              the following columns:</span>
<a id="__codelineno-0-750" name="__codelineno-0-750"></a>
<a id="__codelineno-0-751" name="__codelineno-0-751"></a><span class="sd">              - fold: Indicates the fold number where the prediction was made.</span>
<a id="__codelineno-0-752" name="__codelineno-0-752"></a><span class="sd">              - pred: Predicted values for the corresponding series and time steps.</span>
<a id="__codelineno-0-753" name="__codelineno-0-753"></a>
<a id="__codelineno-0-754" name="__codelineno-0-754"></a><span class="sd">              If `interval` is not `None`, additional columns are included depending</span>
<a id="__codelineno-0-755" name="__codelineno-0-755"></a><span class="sd">              on the method:</span>
<a id="__codelineno-0-756" name="__codelineno-0-756"></a>
<a id="__codelineno-0-757" name="__codelineno-0-757"></a><span class="sd">              - For `float`: Columns `lower_bound` and `upper_bound`.</span>
<a id="__codelineno-0-758" name="__codelineno-0-758"></a><span class="sd">              - For `list` or `tuple` of 2 elements: Columns `lower_bound` and</span>
<a id="__codelineno-0-759" name="__codelineno-0-759"></a><span class="sd">                `upper_bound`.</span>
<a id="__codelineno-0-760" name="__codelineno-0-760"></a><span class="sd">              - For `list` or `tuple` with multiple percentiles: One column per</span>
<a id="__codelineno-0-761" name="__codelineno-0-761"></a><span class="sd">                percentile (e.g., `p_10`, `p_50`, `p_90`).</span>
<a id="__codelineno-0-762" name="__codelineno-0-762"></a><span class="sd">              - For `&#39;bootstrapping&#39;`: One column per bootstrapping iteration</span>
<a id="__codelineno-0-763" name="__codelineno-0-763"></a><span class="sd">                (e.g., `pred_boot_0`, `pred_boot_1`, ..., `pred_boot_n`).</span>
<a id="__codelineno-0-764" name="__codelineno-0-764"></a><span class="sd">              - For `scipy.stats` distribution objects: One column for each</span>
<a id="__codelineno-0-765" name="__codelineno-0-765"></a><span class="sd">                estimated parameter of the distribution (e.g., `loc`, `scale`).</span>
<a id="__codelineno-0-766" name="__codelineno-0-766"></a>
<a id="__codelineno-0-767" name="__codelineno-0-767"></a><span class="sd">              If `return_predictors` is `True`, one column per predictor is created.</span>
<a id="__codelineno-0-768" name="__codelineno-0-768"></a>
<a id="__codelineno-0-769" name="__codelineno-0-769"></a><span class="sd">              Depending on the relation between `steps` and `fold_stride`, the output</span>
<a id="__codelineno-0-770" name="__codelineno-0-770"></a><span class="sd">              may include repeated indexes (if `fold_stride &lt; steps`) or gaps</span>
<a id="__codelineno-0-771" name="__codelineno-0-771"></a><span class="sd">              (if `fold_stride &gt; steps`). See Notes below for more details.</span>
<a id="__codelineno-0-772" name="__codelineno-0-772"></a>
<a id="__codelineno-0-773" name="__codelineno-0-773"></a><span class="sd">    Notes:</span>
<a id="__codelineno-0-774" name="__codelineno-0-774"></a><span class="sd">        Note on `fold_stride` vs. `steps`:</span>
<a id="__codelineno-0-775" name="__codelineno-0-775"></a>
<a id="__codelineno-0-776" name="__codelineno-0-776"></a><span class="sd">        - If `fold_stride == steps`, test sets are placed back-to-back without overlap.</span>
<a id="__codelineno-0-777" name="__codelineno-0-777"></a><span class="sd">          Each observation appears only once in the output DataFrame, so the</span>
<a id="__codelineno-0-778" name="__codelineno-0-778"></a><span class="sd">          index is unique.</span>
<a id="__codelineno-0-779" name="__codelineno-0-779"></a><span class="sd">        - If `fold_stride &lt; steps`, test sets overlap. Multiple forecasts are</span>
<a id="__codelineno-0-780" name="__codelineno-0-780"></a><span class="sd">          generated for the same observations and, therefore, the output</span>
<a id="__codelineno-0-781" name="__codelineno-0-781"></a><span class="sd">          DataFrame contains repeated indexes.</span>
<a id="__codelineno-0-782" name="__codelineno-0-782"></a><span class="sd">        - If `fold_stride &gt; steps`, there are gaps between consecutive test sets.</span>
<a id="__codelineno-0-783" name="__codelineno-0-783"></a><span class="sd">          Some observations in the series will not have associated predictions,</span>
<a id="__codelineno-0-784" name="__codelineno-0-784"></a><span class="sd">          so the output DataFrame has non-contiguous indexes.</span>
<a id="__codelineno-0-785" name="__codelineno-0-785"></a>
<a id="__codelineno-0-786" name="__codelineno-0-786"></a><span class="sd">    Examples:</span>
<a id="__codelineno-0-787" name="__codelineno-0-787"></a><span class="sd">        &gt;&gt;&gt; import pandas as pd</span>
<a id="__codelineno-0-788" name="__codelineno-0-788"></a><span class="sd">        &gt;&gt;&gt; from sklearn.ensemble import RandomForestRegressor</span>
<a id="__codelineno-0-789" name="__codelineno-0-789"></a><span class="sd">        &gt;&gt;&gt; from spotforecast2_safe.forecaster.recursive import ForecasterRecursive</span>
<a id="__codelineno-0-790" name="__codelineno-0-790"></a><span class="sd">        &gt;&gt;&gt; from spotforecast2_safe.model_selection import backtesting_forecaster, TimeSeriesFold</span>
<a id="__codelineno-0-791" name="__codelineno-0-791"></a><span class="sd">        &gt;&gt;&gt; y = pd.Series([1, 2, 3, 4, 5, 6, 7, 8, 9, 10])</span>
<a id="__codelineno-0-792" name="__codelineno-0-792"></a><span class="sd">        &gt;&gt;&gt; forecaster = ForecasterRecursive(</span>
<a id="__codelineno-0-793" name="__codelineno-0-793"></a><span class="sd">        ...     estimator=RandomForestRegressor(random_state=123),</span>
<a id="__codelineno-0-794" name="__codelineno-0-794"></a><span class="sd">        ...     lags=2</span>
<a id="__codelineno-0-795" name="__codelineno-0-795"></a><span class="sd">        ... )</span>
<a id="__codelineno-0-796" name="__codelineno-0-796"></a><span class="sd">        &gt;&gt;&gt; cv = TimeSeriesFold(</span>
<a id="__codelineno-0-797" name="__codelineno-0-797"></a><span class="sd">        ...     steps=2,</span>
<a id="__codelineno-0-798" name="__codelineno-0-798"></a><span class="sd">        ...     initial_train_size=5,</span>
<a id="__codelineno-0-799" name="__codelineno-0-799"></a><span class="sd">        ...     refit=False</span>
<a id="__codelineno-0-800" name="__codelineno-0-800"></a><span class="sd">        ... )</span>
<a id="__codelineno-0-801" name="__codelineno-0-801"></a><span class="sd">        &gt;&gt;&gt; metric_values, backtest_predictions = backtesting_forecaster(</span>
<a id="__codelineno-0-802" name="__codelineno-0-802"></a><span class="sd">        ...     forecaster=forecaster,</span>
<a id="__codelineno-0-803" name="__codelineno-0-803"></a><span class="sd">        ...     y=y,</span>
<a id="__codelineno-0-804" name="__codelineno-0-804"></a><span class="sd">        ...     cv=cv,</span>
<a id="__codelineno-0-805" name="__codelineno-0-805"></a><span class="sd">        ...     metric=&#39;mean_squared_error&#39;</span>
<a id="__codelineno-0-806" name="__codelineno-0-806"></a><span class="sd">        ... )</span>
<a id="__codelineno-0-807" name="__codelineno-0-807"></a><span class="sd">        &gt;&gt;&gt; metric_values</span>
<a id="__codelineno-0-808" name="__codelineno-0-808"></a><span class="sd">           mean_squared_error</span>
<a id="__codelineno-0-809" name="__codelineno-0-809"></a><span class="sd">        0            0.201334</span>
<a id="__codelineno-0-810" name="__codelineno-0-810"></a><span class="sd">        &gt;&gt;&gt; backtest_predictions</span>
<a id="__codelineno-0-811" name="__codelineno-0-811"></a><span class="sd">           fold  pred</span>
<a id="__codelineno-0-812" name="__codelineno-0-812"></a><span class="sd">        5     0  5.18</span>
<a id="__codelineno-0-813" name="__codelineno-0-813"></a><span class="sd">        6     0  6.10</span>
<a id="__codelineno-0-814" name="__codelineno-0-814"></a><span class="sd">        7     1  7.36</span>
<a id="__codelineno-0-815" name="__codelineno-0-815"></a><span class="sd">        8     1  8.40</span>
<a id="__codelineno-0-816" name="__codelineno-0-816"></a><span class="sd">        9     2  9.31</span>
<a id="__codelineno-0-817" name="__codelineno-0-817"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-818" name="__codelineno-0-818"></a>
<a id="__codelineno-0-819" name="__codelineno-0-819"></a>    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">cv</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;OneStepAheadFold&quot;</span><span class="p">:</span>
<a id="__codelineno-0-820" name="__codelineno-0-820"></a>        <span class="k">return</span> <span class="n">backtesting_forecaster_one_step</span><span class="p">(</span>
<a id="__codelineno-0-821" name="__codelineno-0-821"></a>            <span class="n">forecaster</span><span class="o">=</span><span class="n">forecaster</span><span class="p">,</span>
<a id="__codelineno-0-822" name="__codelineno-0-822"></a>            <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span>
<a id="__codelineno-0-823" name="__codelineno-0-823"></a>            <span class="n">cv</span><span class="o">=</span><span class="n">cv</span><span class="p">,</span>
<a id="__codelineno-0-824" name="__codelineno-0-824"></a>            <span class="n">metric</span><span class="o">=</span><span class="n">metric</span><span class="p">,</span>
<a id="__codelineno-0-825" name="__codelineno-0-825"></a>            <span class="n">exog</span><span class="o">=</span><span class="n">exog</span><span class="p">,</span>
<a id="__codelineno-0-826" name="__codelineno-0-826"></a>            <span class="n">interval</span><span class="o">=</span><span class="n">interval</span><span class="p">,</span>
<a id="__codelineno-0-827" name="__codelineno-0-827"></a>            <span class="n">interval_method</span><span class="o">=</span><span class="n">interval_method</span><span class="p">,</span>
<a id="__codelineno-0-828" name="__codelineno-0-828"></a>            <span class="n">n_boot</span><span class="o">=</span><span class="n">n_boot</span><span class="p">,</span>
<a id="__codelineno-0-829" name="__codelineno-0-829"></a>            <span class="n">use_in_sample_residuals</span><span class="o">=</span><span class="n">use_in_sample_residuals</span><span class="p">,</span>
<a id="__codelineno-0-830" name="__codelineno-0-830"></a>            <span class="n">use_binned_residuals</span><span class="o">=</span><span class="n">use_binned_residuals</span><span class="p">,</span>
<a id="__codelineno-0-831" name="__codelineno-0-831"></a>            <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">,</span>
<a id="__codelineno-0-832" name="__codelineno-0-832"></a>            <span class="n">return_predictors</span><span class="o">=</span><span class="n">return_predictors</span><span class="p">,</span>
<a id="__codelineno-0-833" name="__codelineno-0-833"></a>            <span class="n">n_jobs</span><span class="o">=</span><span class="n">n_jobs</span><span class="p">,</span>
<a id="__codelineno-0-834" name="__codelineno-0-834"></a>            <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
<a id="__codelineno-0-835" name="__codelineno-0-835"></a>            <span class="n">show_progress</span><span class="o">=</span><span class="n">show_progress</span><span class="p">,</span>
<a id="__codelineno-0-836" name="__codelineno-0-836"></a>            <span class="n">suppress_warnings</span><span class="o">=</span><span class="n">suppress_warnings</span><span class="p">,</span>
<a id="__codelineno-0-837" name="__codelineno-0-837"></a>        <span class="p">)</span>
<a id="__codelineno-0-838" name="__codelineno-0-838"></a>
<a id="__codelineno-0-839" name="__codelineno-0-839"></a>    <span class="n">check_backtesting_input</span><span class="p">(</span>
<a id="__codelineno-0-840" name="__codelineno-0-840"></a>        <span class="n">forecaster</span><span class="o">=</span><span class="n">forecaster</span><span class="p">,</span>
<a id="__codelineno-0-841" name="__codelineno-0-841"></a>        <span class="n">cv</span><span class="o">=</span><span class="n">cv</span><span class="p">,</span>
<a id="__codelineno-0-842" name="__codelineno-0-842"></a>        <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span>
<a id="__codelineno-0-843" name="__codelineno-0-843"></a>        <span class="n">metric</span><span class="o">=</span><span class="n">metric</span><span class="p">,</span>
<a id="__codelineno-0-844" name="__codelineno-0-844"></a>        <span class="n">interval</span><span class="o">=</span><span class="n">interval</span><span class="p">,</span>
<a id="__codelineno-0-845" name="__codelineno-0-845"></a>        <span class="n">interval_method</span><span class="o">=</span><span class="n">interval_method</span><span class="p">,</span>
<a id="__codelineno-0-846" name="__codelineno-0-846"></a>        <span class="n">n_boot</span><span class="o">=</span><span class="n">n_boot</span><span class="p">,</span>
<a id="__codelineno-0-847" name="__codelineno-0-847"></a>        <span class="n">use_in_sample_residuals</span><span class="o">=</span><span class="n">use_in_sample_residuals</span><span class="p">,</span>
<a id="__codelineno-0-848" name="__codelineno-0-848"></a>        <span class="n">use_binned_residuals</span><span class="o">=</span><span class="n">use_binned_residuals</span><span class="p">,</span>
<a id="__codelineno-0-849" name="__codelineno-0-849"></a>        <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">,</span>
<a id="__codelineno-0-850" name="__codelineno-0-850"></a>        <span class="n">return_predictors</span><span class="o">=</span><span class="n">return_predictors</span><span class="p">,</span>
<a id="__codelineno-0-851" name="__codelineno-0-851"></a>        <span class="n">n_jobs</span><span class="o">=</span><span class="n">n_jobs</span><span class="p">,</span>
<a id="__codelineno-0-852" name="__codelineno-0-852"></a>        <span class="n">show_progress</span><span class="o">=</span><span class="n">show_progress</span><span class="p">,</span>
<a id="__codelineno-0-853" name="__codelineno-0-853"></a>        <span class="n">suppress_warnings</span><span class="o">=</span><span class="n">suppress_warnings</span><span class="p">,</span>
<a id="__codelineno-0-854" name="__codelineno-0-854"></a>    <span class="p">)</span>
<a id="__codelineno-0-855" name="__codelineno-0-855"></a>
<a id="__codelineno-0-856" name="__codelineno-0-856"></a>    <span class="n">metric_values</span><span class="p">,</span> <span class="n">backtest_predictions</span> <span class="o">=</span> <span class="n">_backtesting_forecaster</span><span class="p">(</span>
<a id="__codelineno-0-857" name="__codelineno-0-857"></a>        <span class="n">forecaster</span><span class="o">=</span><span class="n">forecaster</span><span class="p">,</span>
<a id="__codelineno-0-858" name="__codelineno-0-858"></a>        <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span>
<a id="__codelineno-0-859" name="__codelineno-0-859"></a>        <span class="n">cv</span><span class="o">=</span><span class="n">cv</span><span class="p">,</span>
<a id="__codelineno-0-860" name="__codelineno-0-860"></a>        <span class="n">metric</span><span class="o">=</span><span class="n">metric</span><span class="p">,</span>
<a id="__codelineno-0-861" name="__codelineno-0-861"></a>        <span class="n">exog</span><span class="o">=</span><span class="n">exog</span><span class="p">,</span>
<a id="__codelineno-0-862" name="__codelineno-0-862"></a>        <span class="n">interval</span><span class="o">=</span><span class="n">interval</span><span class="p">,</span>
<a id="__codelineno-0-863" name="__codelineno-0-863"></a>        <span class="n">interval_method</span><span class="o">=</span><span class="n">interval_method</span><span class="p">,</span>
<a id="__codelineno-0-864" name="__codelineno-0-864"></a>        <span class="n">n_boot</span><span class="o">=</span><span class="n">n_boot</span><span class="p">,</span>
<a id="__codelineno-0-865" name="__codelineno-0-865"></a>        <span class="n">use_in_sample_residuals</span><span class="o">=</span><span class="n">use_in_sample_residuals</span><span class="p">,</span>
<a id="__codelineno-0-866" name="__codelineno-0-866"></a>        <span class="n">use_binned_residuals</span><span class="o">=</span><span class="n">use_binned_residuals</span><span class="p">,</span>
<a id="__codelineno-0-867" name="__codelineno-0-867"></a>        <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">,</span>
<a id="__codelineno-0-868" name="__codelineno-0-868"></a>        <span class="n">return_predictors</span><span class="o">=</span><span class="n">return_predictors</span><span class="p">,</span>
<a id="__codelineno-0-869" name="__codelineno-0-869"></a>        <span class="n">n_jobs</span><span class="o">=</span><span class="n">n_jobs</span><span class="p">,</span>
<a id="__codelineno-0-870" name="__codelineno-0-870"></a>        <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
<a id="__codelineno-0-871" name="__codelineno-0-871"></a>        <span class="n">show_progress</span><span class="o">=</span><span class="n">show_progress</span><span class="p">,</span>
<a id="__codelineno-0-872" name="__codelineno-0-872"></a>        <span class="n">suppress_warnings</span><span class="o">=</span><span class="n">suppress_warnings</span><span class="p">,</span>
<a id="__codelineno-0-873" name="__codelineno-0-873"></a>    <span class="p">)</span>
<a id="__codelineno-0-874" name="__codelineno-0-874"></a>
<a id="__codelineno-0-875" name="__codelineno-0-875"></a>    <span class="k">return</span> <span class="n">metric_values</span><span class="p">,</span> <span class="n">backtest_predictions</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div><h3 id="design-philosophy-for-safety-critical-systems">Design Philosophy for Safety-Critical Systems</h3>
<p>In safety-critical environments (energy grid management, medical monitoring, industrial control systems), forecast failures can have severe consequences. The backtesting_forecaster function implements several defensive design patterns:</p>
<ol>
<li>Temporal Integrity: Strict enforcement of temporal ordering prevents data leakage that could mask model weaknesses</li>
<li>Refit Strategy Control: Configurable refit intervals allow balancing between model freshness and computational cost</li>
<li>Probabilistic Quantification: Prediction intervals provide uncertainty estimates essential for risk management</li>
<li>Parallel Execution Safety: Careful handling of stateful operations during parallelization prevents race conditions</li>
</ol>
<h3 id="fallback-mechanisms-in-production">Fallback Mechanisms in Production</h3>
<p>The backtesting framework serves as a critical fallback validation layer:</p>
<ul>
<li>Pre-deployment Validation: Comprehensive backtesting before model deployment catches issues that unit tests miss</li>
<li>Continuous Monitoring: Regular backtesting on recent data detects model degradation</li>
<li>A/B Testing Foundation: Provides fair comparison framework for evaluating model updates</li>
<li>Rollback Decision Support: Quantitative metrics guide decisions to revert problematic model changes</li>
</ul>
<h3 id="understanding-probabilistic-forecasting">Understanding Probabilistic Forecasting</h3>
<p>When forecasting in safety-critical contexts, point predictions alone are insufficient. Prediction intervals quantify uncertainty, enabling downstream systems to make risk-aware decisions. The backtesting_forecaster supports two interval estimation methods:</p>
<ol>
<li>Bootstrapping: Resamples residuals to generate empirical prediction distributions</li>
<li>Conformal Prediction: Provides distribution-free coverage guarantees under mild assumptions</li>
</ol>
<p>Both methods require residuals (forecast errors) for interval construction:</p>
<ul>
<li>In-sample residuals: Computed from training data (default, always available)</li>
<li>Out-of-sample residuals: Computed from held-out calibration data (more reliable, requires setup)</li>
<li>Binned residuals: Stratified by prediction magnitude for heteroscedastic errors (recommended)</li>
</ul>
<h3 id="probabilistic-forecasting-with-residuals">Probabilistic Forecasting with Residuals</h3>
<p>When using probabilistic forecasting methods (<code>interval</code> parameter), the forecaster requires residuals for generating prediction intervals:</p>
<ul>
<li>
<p>In-sample residuals: Automatically stored when <code>use_in_sample_residuals=True</code> (default). The <code>backtesting_forecaster</code> function handles this by setting <code>store_in_sample_residuals=True</code> during training.</p>
</li>
<li>
<p>Out-of-sample residuals: Used when <code>use_in_sample_residuals=False</code>. These must be precomputed using the forecaster's <code>set_out_sample_residuals(y_true, y_pred)</code> method before calling <code>backtesting_forecaster</code>.</p>
</li>
<li>
<p>Binned residuals: When <code>use_binned_residuals=True</code> (default), residuals are selected based on predicted values for improved interval accuracy. This requires the forecaster to have a binner configured during initialization.</p>
</li>
</ul>
<p>For conformal prediction (<code>interval_method='conformal'</code>), the method automatically uses the appropriate residuals based on the <code>use_in_sample_residuals</code> setting.</p>
<h3 id="complete-examples">Complete Examples</h3>
<h4 id="example-0-safety-critical-energy-grid-forecasting">Example 0: Safety-Critical Energy Grid Forecasting</h4>
<p>This comprehensive example demonstrates model validation for a production energy grid management system where forecast reliability is mission-critical. The example shows defensive programming practices, uncertainty quantification, and deployment decision support.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.ensemble</span><span class="w"> </span><span class="kn">import</span> <span class="n">GradientBoostingRegressor</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="kn">from</span><span class="w"> </span><span class="nn">spotforecast2_safe.forecaster.recursive</span><span class="w"> </span><span class="kn">import</span> <span class="n">ForecasterRecursive</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="kn">from</span><span class="w"> </span><span class="nn">spotforecast2.model_selection</span><span class="w"> </span><span class="kn">import</span> <span class="n">backtesting_forecaster</span><span class="p">,</span> <span class="n">TimeSeriesFold</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="c1"># Simulate realistic energy load data with daily and weekly patterns</span>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a><span class="n">dates</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s2">&quot;2023-01-01&quot;</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">365</span> <span class="o">*</span> <span class="mi">24</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s2">&quot;h&quot;</span><span class="p">)</span>
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a>
<a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a><span class="c1"># Base load + daily pattern + weekly pattern + noise</span>
<a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a><span class="n">hour_of_day</span> <span class="o">=</span> <span class="n">dates</span><span class="o">.</span><span class="n">hour</span>
<a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a><span class="n">day_of_week</span> <span class="o">=</span> <span class="n">dates</span><span class="o">.</span><span class="n">dayofweek</span>
<a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a><span class="n">base_load</span> <span class="o">=</span> <span class="mi">5000</span>
<a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a><span class="n">daily_pattern</span> <span class="o">=</span> <span class="mi">2000</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">hour_of_day</span> <span class="o">/</span> <span class="mi">24</span><span class="p">)</span>
<a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a><span class="n">weekly_pattern</span> <span class="o">=</span> <span class="mi">500</span> <span class="o">*</span> <span class="p">(</span><span class="n">day_of_week</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>  <span class="c1"># Weekday boost</span>
<a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a><span class="n">noise</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">dates</span><span class="p">))</span>
<a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a><span class="n">trend</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">dates</span><span class="p">))</span>  <span class="c1"># Gradual load increase</span>
<a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a>
<a id="__codelineno-0-21" name="__codelineno-0-21" href="#__codelineno-0-21"></a><span class="n">y</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span>
<a id="__codelineno-0-22" name="__codelineno-0-22" href="#__codelineno-0-22"></a>    <span class="n">base_load</span> <span class="o">+</span> <span class="n">daily_pattern</span> <span class="o">+</span> <span class="n">weekly_pattern</span> <span class="o">+</span> <span class="n">trend</span> <span class="o">+</span> <span class="n">noise</span><span class="p">,</span>
<a id="__codelineno-0-23" name="__codelineno-0-23" href="#__codelineno-0-23"></a>    <span class="n">index</span><span class="o">=</span><span class="n">dates</span><span class="p">,</span>
<a id="__codelineno-0-24" name="__codelineno-0-24" href="#__codelineno-0-24"></a>    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;grid_load_mw&quot;</span><span class="p">,</span>
<a id="__codelineno-0-25" name="__codelineno-0-25" href="#__codelineno-0-25"></a><span class="p">)</span>
<a id="__codelineno-0-26" name="__codelineno-0-26" href="#__codelineno-0-26"></a>
<a id="__codelineno-0-27" name="__codelineno-0-27" href="#__codelineno-0-27"></a><span class="c1"># Safety-critical configuration: Conservative forecaster with uncertainty quantification</span>
<a id="__codelineno-0-28" name="__codelineno-0-28" href="#__codelineno-0-28"></a><span class="n">forecaster</span> <span class="o">=</span> <span class="n">ForecasterRecursive</span><span class="p">(</span>
<a id="__codelineno-0-29" name="__codelineno-0-29" href="#__codelineno-0-29"></a>    <span class="n">estimator</span><span class="o">=</span><span class="n">GradientBoostingRegressor</span><span class="p">(</span>
<a id="__codelineno-0-30" name="__codelineno-0-30" href="#__codelineno-0-30"></a>        <span class="n">n_estimators</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span>
<a id="__codelineno-0-31" name="__codelineno-0-31" href="#__codelineno-0-31"></a>    <span class="p">),</span>
<a id="__codelineno-0-32" name="__codelineno-0-32" href="#__codelineno-0-32"></a>    <span class="n">lags</span><span class="o">=</span><span class="mi">24</span> <span class="o">*</span> <span class="mi">7</span><span class="p">,</span>  <span class="c1"># One week of hourly data</span>
<a id="__codelineno-0-33" name="__codelineno-0-33" href="#__codelineno-0-33"></a>    <span class="n">binner_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;n_bins&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">},</span>  <span class="c1"># Enable binned residuals for better intervals</span>
<a id="__codelineno-0-34" name="__codelineno-0-34" href="#__codelineno-0-34"></a><span class="p">)</span>
<a id="__codelineno-0-35" name="__codelineno-0-35" href="#__codelineno-0-35"></a>
<a id="__codelineno-0-36" name="__codelineno-0-36" href="#__codelineno-0-36"></a><span class="c1"># Cross-validation strategy: Realistic evaluation with weekly retraining</span>
<a id="__codelineno-0-37" name="__codelineno-0-37" href="#__codelineno-0-37"></a><span class="n">cv</span> <span class="o">=</span> <span class="n">TimeSeriesFold</span><span class="p">(</span>
<a id="__codelineno-0-38" name="__codelineno-0-38" href="#__codelineno-0-38"></a>    <span class="n">steps</span><span class="o">=</span><span class="mi">24</span><span class="p">,</span>  <span class="c1"># Forecast 24 hours ahead</span>
<a id="__codelineno-0-39" name="__codelineno-0-39" href="#__codelineno-0-39"></a>    <span class="n">initial_train_size</span><span class="o">=</span><span class="mi">24</span> <span class="o">*</span> <span class="mi">30</span> <span class="o">*</span> <span class="mi">6</span><span class="p">,</span>  <span class="c1"># 6 months initial training</span>
<a id="__codelineno-0-40" name="__codelineno-0-40" href="#__codelineno-0-40"></a>    <span class="n">refit</span><span class="o">=</span><span class="mi">24</span> <span class="o">*</span> <span class="mi">7</span><span class="p">,</span>  <span class="c1"># Retrain weekly (safety-critical: fresh models)</span>
<a id="__codelineno-0-41" name="__codelineno-0-41" href="#__codelineno-0-41"></a>    <span class="n">fixed_train_size</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>  <span class="c1"># Expanding window (use all available data)</span>
<a id="__codelineno-0-42" name="__codelineno-0-42" href="#__codelineno-0-42"></a>    <span class="n">fold_stride</span><span class="o">=</span><span class="mi">24</span> <span class="o">*</span> <span class="mi">7</span><span class="p">,</span>  <span class="c1"># Evaluate weekly</span>
<a id="__codelineno-0-43" name="__codelineno-0-43" href="#__codelineno-0-43"></a>    <span class="n">gap</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>  <span class="c1"># No gap (immediate forecasting)</span>
<a id="__codelineno-0-44" name="__codelineno-0-44" href="#__codelineno-0-44"></a><span class="p">)</span>
<a id="__codelineno-0-45" name="__codelineno-0-45" href="#__codelineno-0-45"></a>
<a id="__codelineno-0-46" name="__codelineno-0-46" href="#__codelineno-0-46"></a><span class="c1"># Perform backtesting with probabilistic forecasts</span>
<a id="__codelineno-0-47" name="__codelineno-0-47" href="#__codelineno-0-47"></a><span class="n">metric_values</span><span class="p">,</span> <span class="n">predictions</span> <span class="o">=</span> <span class="n">backtesting_forecaster</span><span class="p">(</span>
<a id="__codelineno-0-48" name="__codelineno-0-48" href="#__codelineno-0-48"></a>    <span class="n">forecaster</span><span class="o">=</span><span class="n">forecaster</span><span class="p">,</span>
<a id="__codelineno-0-49" name="__codelineno-0-49" href="#__codelineno-0-49"></a>    <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span>
<a id="__codelineno-0-50" name="__codelineno-0-50" href="#__codelineno-0-50"></a>    <span class="n">cv</span><span class="o">=</span><span class="n">cv</span><span class="p">,</span>
<a id="__codelineno-0-51" name="__codelineno-0-51" href="#__codelineno-0-51"></a>    <span class="n">metric</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;mean_absolute_error&quot;</span><span class="p">,</span> <span class="s2">&quot;mean_squared_error&quot;</span><span class="p">],</span>
<a id="__codelineno-0-52" name="__codelineno-0-52" href="#__codelineno-0-52"></a>    <span class="n">interval</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span>  <span class="c1"># 95% prediction interval for risk management</span>
<a id="__codelineno-0-53" name="__codelineno-0-53" href="#__codelineno-0-53"></a>    <span class="n">interval_method</span><span class="o">=</span><span class="s2">&quot;conformal&quot;</span><span class="p">,</span>  <span class="c1"># Distribution-free guarantees</span>
<a id="__codelineno-0-54" name="__codelineno-0-54" href="#__codelineno-0-54"></a>    <span class="n">use_in_sample_residuals</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-55" name="__codelineno-0-55" href="#__codelineno-0-55"></a>    <span class="n">use_binned_residuals</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># Account for heteroscedasticity</span>
<a id="__codelineno-0-56" name="__codelineno-0-56" href="#__codelineno-0-56"></a>    <span class="n">n_jobs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>  <span class="c1"># Sequential for safety (avoid race conditions)</span>
<a id="__codelineno-0-57" name="__codelineno-0-57" href="#__codelineno-0-57"></a>    <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-58" name="__codelineno-0-58" href="#__codelineno-0-58"></a>    <span class="n">show_progress</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-59" name="__codelineno-0-59" href="#__codelineno-0-59"></a><span class="p">)</span>
<a id="__codelineno-0-60" name="__codelineno-0-60" href="#__codelineno-0-60"></a>
<a id="__codelineno-0-61" name="__codelineno-0-61" href="#__codelineno-0-61"></a><span class="c1"># Safety metrics: Evaluate forecast reliability</span>
<a id="__codelineno-0-62" name="__codelineno-0-62" href="#__codelineno-0-62"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Safety-Critical Performance Metrics:&quot;</span><span class="p">)</span>
<a id="__codelineno-0-63" name="__codelineno-0-63" href="#__codelineno-0-63"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mean Absolute Error: </span><span class="si">{</span><span class="n">metric_values</span><span class="p">[</span><span class="s1">&#39;mean_absolute_error&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> MW&quot;</span><span class="p">)</span>
<a id="__codelineno-0-64" name="__codelineno-0-64" href="#__codelineno-0-64"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;RMSE: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">metric_values</span><span class="p">[</span><span class="s1">&#39;mean_squared_error&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> MW&quot;</span><span class="p">)</span>
<a id="__codelineno-0-65" name="__codelineno-0-65" href="#__codelineno-0-65"></a>
<a id="__codelineno-0-66" name="__codelineno-0-66" href="#__codelineno-0-66"></a><span class="c1"># Coverage analysis: Critical for safety applications</span>
<a id="__codelineno-0-67" name="__codelineno-0-67" href="#__codelineno-0-67"></a><span class="n">actual_coverage</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-68" name="__codelineno-0-68" href="#__codelineno-0-68"></a>    <span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">predictions</span><span class="o">.</span><span class="n">index</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">predictions</span><span class="p">[</span><span class="s2">&quot;lower_bound&quot;</span><span class="p">])</span>
<a id="__codelineno-0-69" name="__codelineno-0-69" href="#__codelineno-0-69"></a>    <span class="o">&amp;</span> <span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">predictions</span><span class="o">.</span><span class="n">index</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">predictions</span><span class="p">[</span><span class="s2">&quot;upper_bound&quot;</span><span class="p">])</span>
<a id="__codelineno-0-70" name="__codelineno-0-70" href="#__codelineno-0-70"></a><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<a id="__codelineno-0-71" name="__codelineno-0-71" href="#__codelineno-0-71"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Prediction Interval Coverage: </span><span class="si">{</span><span class="n">actual_coverage</span><span class="si">:</span><span class="s2">.1%</span><span class="si">}</span><span class="s2"> (target: 95.0%)&quot;</span><span class="p">)</span>
<a id="__codelineno-0-72" name="__codelineno-0-72" href="#__codelineno-0-72"></a>
<a id="__codelineno-0-73" name="__codelineno-0-73" href="#__codelineno-0-73"></a><span class="c1"># Decision support: Model deployment recommendation</span>
<a id="__codelineno-0-74" name="__codelineno-0-74" href="#__codelineno-0-74"></a><span class="k">if</span> <span class="n">actual_coverage</span> <span class="o">&gt;=</span> <span class="mf">0.93</span><span class="p">:</span>
<a id="__codelineno-0-75" name="__codelineno-0-75" href="#__codelineno-0-75"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; RECOMMENDATION: APPROVE for production deployment&quot;</span><span class="p">)</span>
<a id="__codelineno-0-76" name="__codelineno-0-76" href="#__codelineno-0-76"></a><span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-77" name="__codelineno-0-77" href="#__codelineno-0-77"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; RECOMMENDATION: REJECT - Coverage below safety threshold&quot;</span><span class="p">)</span>
</code></pre></div>
<p>Key safety-critical design elements:</p>
<ol>
<li>Expanding training window: Uses all historical data for maximum information</li>
<li>Regular retraining: Weekly updates prevent model staleness</li>
<li>Conformal intervals: Provides distribution-free coverage guarantees</li>
<li>Binned residuals: Accounts for heteroscedastic errors (variance changes with load level)</li>
<li>Sequential execution: Avoids parallelization race conditions in critical systems</li>
<li>Coverage monitoring: Validates that uncertainty estimates are calibrated</li>
<li>Deployment gates: Quantitative criteria for production approval</li>
</ol>
<h4 id="example-1-bootstrapping-method">Example 1: Bootstrapping Method</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.linear_model</span><span class="w"> </span><span class="kn">import</span> <span class="n">Ridge</span>
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="kn">from</span><span class="w"> </span><span class="nn">spotforecast2_safe.forecaster.recursive</span><span class="w"> </span><span class="kn">import</span> <span class="n">ForecasterRecursive</span>
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="kn">from</span><span class="w"> </span><span class="nn">spotforecast2.model_selection</span><span class="w"> </span><span class="kn">import</span> <span class="n">backtesting_forecaster</span><span class="p">,</span> <span class="n">TimeSeriesFold</span>
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a>
<a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a><span class="c1"># Create sample time series data</span>
<a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a><span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">(</span><span class="mi">123</span><span class="p">)</span>
<a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a><span class="n">dates</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s2">&quot;2020-01-01&quot;</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s2">&quot;D&quot;</span><span class="p">)</span>
<a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a><span class="n">y</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span>
<a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a>    <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">rng</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">200</span><span class="p">))</span> <span class="o">+</span> <span class="mi">50</span><span class="p">,</span>
<a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a>    <span class="n">index</span><span class="o">=</span><span class="n">dates</span><span class="p">,</span>
<a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a>    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;value&quot;</span>
<a id="__codelineno-1-15" name="__codelineno-1-15" href="#__codelineno-1-15"></a><span class="p">)</span>
<a id="__codelineno-1-16" name="__codelineno-1-16" href="#__codelineno-1-16"></a>
<a id="__codelineno-1-17" name="__codelineno-1-17" href="#__codelineno-1-17"></a><span class="c1"># Initialize forecaster</span>
<a id="__codelineno-1-18" name="__codelineno-1-18" href="#__codelineno-1-18"></a><span class="n">forecaster</span> <span class="o">=</span> <span class="n">ForecasterRecursive</span><span class="p">(</span>
<a id="__codelineno-1-19" name="__codelineno-1-19" href="#__codelineno-1-19"></a>    <span class="n">estimator</span><span class="o">=</span><span class="n">Ridge</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">),</span>
<a id="__codelineno-1-20" name="__codelineno-1-20" href="#__codelineno-1-20"></a>    <span class="n">lags</span><span class="o">=</span><span class="mi">14</span>
<a id="__codelineno-1-21" name="__codelineno-1-21" href="#__codelineno-1-21"></a><span class="p">)</span>
<a id="__codelineno-1-22" name="__codelineno-1-22" href="#__codelineno-1-22"></a>
<a id="__codelineno-1-23" name="__codelineno-1-23" href="#__codelineno-1-23"></a><span class="c1"># Configure cross-validation</span>
<a id="__codelineno-1-24" name="__codelineno-1-24" href="#__codelineno-1-24"></a><span class="n">cv</span> <span class="o">=</span> <span class="n">TimeSeriesFold</span><span class="p">(</span>
<a id="__codelineno-1-25" name="__codelineno-1-25" href="#__codelineno-1-25"></a>    <span class="n">steps</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
<a id="__codelineno-1-26" name="__codelineno-1-26" href="#__codelineno-1-26"></a>    <span class="n">initial_train_size</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span>
<a id="__codelineno-1-27" name="__codelineno-1-27" href="#__codelineno-1-27"></a>    <span class="n">refit</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-1-28" name="__codelineno-1-28" href="#__codelineno-1-28"></a>    <span class="n">fold_stride</span><span class="o">=</span><span class="mi">10</span>
<a id="__codelineno-1-29" name="__codelineno-1-29" href="#__codelineno-1-29"></a><span class="p">)</span>
<a id="__codelineno-1-30" name="__codelineno-1-30" href="#__codelineno-1-30"></a>
<a id="__codelineno-1-31" name="__codelineno-1-31" href="#__codelineno-1-31"></a><span class="c1"># Perform backtesting with bootstrapping method</span>
<a id="__codelineno-1-32" name="__codelineno-1-32" href="#__codelineno-1-32"></a><span class="n">metric_values</span><span class="p">,</span> <span class="n">predictions</span> <span class="o">=</span> <span class="n">backtesting_forecaster</span><span class="p">(</span>
<a id="__codelineno-1-33" name="__codelineno-1-33" href="#__codelineno-1-33"></a>    <span class="n">forecaster</span><span class="o">=</span><span class="n">forecaster</span><span class="p">,</span>
<a id="__codelineno-1-34" name="__codelineno-1-34" href="#__codelineno-1-34"></a>    <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span>
<a id="__codelineno-1-35" name="__codelineno-1-35" href="#__codelineno-1-35"></a>    <span class="n">cv</span><span class="o">=</span><span class="n">cv</span><span class="p">,</span>
<a id="__codelineno-1-36" name="__codelineno-1-36" href="#__codelineno-1-36"></a>    <span class="n">metric</span><span class="o">=</span><span class="s2">&quot;mean_absolute_error&quot;</span><span class="p">,</span>
<a id="__codelineno-1-37" name="__codelineno-1-37" href="#__codelineno-1-37"></a>    <span class="n">interval</span><span class="o">=</span><span class="s2">&quot;bootstrapping&quot;</span><span class="p">,</span>  <span class="c1"># Use bootstrapping for uncertainty quantification</span>
<a id="__codelineno-1-38" name="__codelineno-1-38" href="#__codelineno-1-38"></a>    <span class="n">interval_method</span><span class="o">=</span><span class="s2">&quot;bootstrapping&quot;</span><span class="p">,</span>
<a id="__codelineno-1-39" name="__codelineno-1-39" href="#__codelineno-1-39"></a>    <span class="n">n_boot</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>  <span class="c1"># Generate 50 bootstrap samples</span>
<a id="__codelineno-1-40" name="__codelineno-1-40" href="#__codelineno-1-40"></a>    <span class="n">use_in_sample_residuals</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-1-41" name="__codelineno-1-41" href="#__codelineno-1-41"></a>    <span class="n">random_state</span><span class="o">=</span><span class="mi">123</span>
<a id="__codelineno-1-42" name="__codelineno-1-42" href="#__codelineno-1-42"></a><span class="p">)</span>
<a id="__codelineno-1-43" name="__codelineno-1-43" href="#__codelineno-1-43"></a>
<a id="__codelineno-1-44" name="__codelineno-1-44" href="#__codelineno-1-44"></a><span class="c1"># Visualize results with bootstrap samples</span>
<a id="__codelineno-1-45" name="__codelineno-1-45" href="#__codelineno-1-45"></a><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<a id="__codelineno-1-46" name="__codelineno-1-46" href="#__codelineno-1-46"></a><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">y</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Actual&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-1-47" name="__codelineno-1-47" href="#__codelineno-1-47"></a><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">predictions</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">predictions</span><span class="p">[</span><span class="s2">&quot;pred&quot;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Prediction&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-1-48" name="__codelineno-1-48" href="#__codelineno-1-48"></a>
<a id="__codelineno-1-49" name="__codelineno-1-49" href="#__codelineno-1-49"></a><span class="c1"># Bootstrap samples are available when using interval=&quot;bootstrapping&quot;</span>
<a id="__codelineno-1-50" name="__codelineno-1-50" href="#__codelineno-1-50"></a><span class="c1"># These provide empirical prediction distributions</span>
<a id="__codelineno-1-51" name="__codelineno-1-51" href="#__codelineno-1-51"></a>
<a id="__codelineno-1-52" name="__codelineno-1-52" href="#__codelineno-1-52"></a><span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Date&quot;</span><span class="p">)</span>
<a id="__codelineno-1-53" name="__codelineno-1-53" href="#__codelineno-1-53"></a><span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Value&quot;</span><span class="p">)</span>
<a id="__codelineno-1-54" name="__codelineno-1-54" href="#__codelineno-1-54"></a><span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Bootstrapping Method: Predictions with Uncertainty&quot;</span><span class="p">)</span>
<a id="__codelineno-1-55" name="__codelineno-1-55" href="#__codelineno-1-55"></a><span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<a id="__codelineno-1-56" name="__codelineno-1-56" href="#__codelineno-1-56"></a><span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<a id="__codelineno-1-57" name="__codelineno-1-57" href="#__codelineno-1-57"></a><span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<a id="__codelineno-1-58" name="__codelineno-1-58" href="#__codelineno-1-58"></a><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<a id="__codelineno-1-59" name="__codelineno-1-59" href="#__codelineno-1-59"></a>
<a id="__codelineno-1-60" name="__codelineno-1-60" href="#__codelineno-1-60"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;MAE: </span><span class="si">{</span><span class="n">metric_values</span><span class="p">[</span><span class="s1">&#39;mean_absolute_error&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
<h4 id="example-2-conformal-prediction-with-binned-residuals">Example 2: Conformal Prediction with Binned Residuals</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.ensemble</span><span class="w"> </span><span class="kn">import</span> <span class="n">GradientBoostingRegressor</span>
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="kn">from</span><span class="w"> </span><span class="nn">spotforecast2_safe.forecaster.recursive</span><span class="w"> </span><span class="kn">import</span> <span class="n">ForecasterRecursive</span>
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="kn">from</span><span class="w"> </span><span class="nn">spotforecast2.model_selection</span><span class="w"> </span><span class="kn">import</span> <span class="n">backtesting_forecaster</span><span class="p">,</span> <span class="n">TimeSeriesFold</span>
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a>
<a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a><span class="c1"># Create sample time series with trend</span>
<a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a><span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">(</span><span class="mi">456</span><span class="p">)</span>
<a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a><span class="n">dates</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s2">&quot;2020-01-01&quot;</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s2">&quot;h&quot;</span><span class="p">)</span>
<a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a><span class="n">trend</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span>
<a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a><span class="n">seasonal</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">300</span><span class="p">)</span> <span class="o">/</span> <span class="mi">24</span><span class="p">)</span>
<a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a><span class="n">noise</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span>
<a id="__codelineno-2-14" name="__codelineno-2-14" href="#__codelineno-2-14"></a><span class="n">y</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">trend</span> <span class="o">+</span> <span class="n">seasonal</span> <span class="o">+</span> <span class="n">noise</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">dates</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;power&quot;</span><span class="p">)</span>
<a id="__codelineno-2-15" name="__codelineno-2-15" href="#__codelineno-2-15"></a>
<a id="__codelineno-2-16" name="__codelineno-2-16" href="#__codelineno-2-16"></a><span class="c1"># Initialize forecaster with binner for improved interval accuracy</span>
<a id="__codelineno-2-17" name="__codelineno-2-17" href="#__codelineno-2-17"></a><span class="n">forecaster</span> <span class="o">=</span> <span class="n">ForecasterRecursive</span><span class="p">(</span>
<a id="__codelineno-2-18" name="__codelineno-2-18" href="#__codelineno-2-18"></a>    <span class="n">estimator</span><span class="o">=</span><span class="n">GradientBoostingRegressor</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">456</span><span class="p">,</span> <span class="n">n_estimators</span><span class="o">=</span><span class="mi">50</span><span class="p">),</span>
<a id="__codelineno-2-19" name="__codelineno-2-19" href="#__codelineno-2-19"></a>    <span class="n">lags</span><span class="o">=</span><span class="mi">24</span><span class="p">,</span>
<a id="__codelineno-2-20" name="__codelineno-2-20" href="#__codelineno-2-20"></a>    <span class="n">binner_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;n_bins&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">}</span>
<a id="__codelineno-2-21" name="__codelineno-2-21" href="#__codelineno-2-21"></a><span class="p">)</span>
<a id="__codelineno-2-22" name="__codelineno-2-22" href="#__codelineno-2-22"></a>
<a id="__codelineno-2-23" name="__codelineno-2-23" href="#__codelineno-2-23"></a><span class="c1"># Configure cross-validation</span>
<a id="__codelineno-2-24" name="__codelineno-2-24" href="#__codelineno-2-24"></a><span class="n">cv</span> <span class="o">=</span> <span class="n">TimeSeriesFold</span><span class="p">(</span>
<a id="__codelineno-2-25" name="__codelineno-2-25" href="#__codelineno-2-25"></a>    <span class="n">steps</span><span class="o">=</span><span class="mi">24</span><span class="p">,</span>
<a id="__codelineno-2-26" name="__codelineno-2-26" href="#__codelineno-2-26"></a>    <span class="n">initial_train_size</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>
<a id="__codelineno-2-27" name="__codelineno-2-27" href="#__codelineno-2-27"></a>    <span class="n">refit</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-2-28" name="__codelineno-2-28" href="#__codelineno-2-28"></a>    <span class="n">fold_stride</span><span class="o">=</span><span class="mi">24</span>
<a id="__codelineno-2-29" name="__codelineno-2-29" href="#__codelineno-2-29"></a><span class="p">)</span>
<a id="__codelineno-2-30" name="__codelineno-2-30" href="#__codelineno-2-30"></a>
<a id="__codelineno-2-31" name="__codelineno-2-31" href="#__codelineno-2-31"></a><span class="c1"># Perform backtesting with conformal prediction</span>
<a id="__codelineno-2-32" name="__codelineno-2-32" href="#__codelineno-2-32"></a><span class="n">metric_values</span><span class="p">,</span> <span class="n">predictions</span> <span class="o">=</span> <span class="n">backtesting_forecaster</span><span class="p">(</span>
<a id="__codelineno-2-33" name="__codelineno-2-33" href="#__codelineno-2-33"></a>    <span class="n">forecaster</span><span class="o">=</span><span class="n">forecaster</span><span class="p">,</span>
<a id="__codelineno-2-34" name="__codelineno-2-34" href="#__codelineno-2-34"></a>    <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span>
<a id="__codelineno-2-35" name="__codelineno-2-35" href="#__codelineno-2-35"></a>    <span class="n">cv</span><span class="o">=</span><span class="n">cv</span><span class="p">,</span>
<a id="__codelineno-2-36" name="__codelineno-2-36" href="#__codelineno-2-36"></a>    <span class="n">metric</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;mean_absolute_error&quot;</span><span class="p">,</span> <span class="s2">&quot;mean_squared_error&quot;</span><span class="p">],</span>
<a id="__codelineno-2-37" name="__codelineno-2-37" href="#__codelineno-2-37"></a>    <span class="n">interval</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span>  <span class="c1"># 95% nominal coverage</span>
<a id="__codelineno-2-38" name="__codelineno-2-38" href="#__codelineno-2-38"></a>    <span class="n">interval_method</span><span class="o">=</span><span class="s2">&quot;conformal&quot;</span><span class="p">,</span>
<a id="__codelineno-2-39" name="__codelineno-2-39" href="#__codelineno-2-39"></a>    <span class="n">use_in_sample_residuals</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-2-40" name="__codelineno-2-40" href="#__codelineno-2-40"></a>    <span class="n">use_binned_residuals</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-2-41" name="__codelineno-2-41" href="#__codelineno-2-41"></a>    <span class="n">random_state</span><span class="o">=</span><span class="mi">456</span>
<a id="__codelineno-2-42" name="__codelineno-2-42" href="#__codelineno-2-42"></a><span class="p">)</span>
<a id="__codelineno-2-43" name="__codelineno-2-43" href="#__codelineno-2-43"></a>
<a id="__codelineno-2-44" name="__codelineno-2-44" href="#__codelineno-2-44"></a><span class="c1"># Visualize results with prediction intervals</span>
<a id="__codelineno-2-45" name="__codelineno-2-45" href="#__codelineno-2-45"></a><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
<a id="__codelineno-2-46" name="__codelineno-2-46" href="#__codelineno-2-46"></a><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">y</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Actual&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
<a id="__codelineno-2-47" name="__codelineno-2-47" href="#__codelineno-2-47"></a><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">predictions</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">predictions</span><span class="p">[</span><span class="s2">&quot;pred&quot;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Prediction&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-2-48" name="__codelineno-2-48" href="#__codelineno-2-48"></a><span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span>
<a id="__codelineno-2-49" name="__codelineno-2-49" href="#__codelineno-2-49"></a>    <span class="n">predictions</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
<a id="__codelineno-2-50" name="__codelineno-2-50" href="#__codelineno-2-50"></a>    <span class="n">predictions</span><span class="p">[</span><span class="s2">&quot;lower_bound&quot;</span><span class="p">],</span>
<a id="__codelineno-2-51" name="__codelineno-2-51" href="#__codelineno-2-51"></a>    <span class="n">predictions</span><span class="p">[</span><span class="s2">&quot;upper_bound&quot;</span><span class="p">],</span>
<a id="__codelineno-2-52" name="__codelineno-2-52" href="#__codelineno-2-52"></a>    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span>
<a id="__codelineno-2-53" name="__codelineno-2-53" href="#__codelineno-2-53"></a>    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span>
<a id="__codelineno-2-54" name="__codelineno-2-54" href="#__codelineno-2-54"></a>    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;95% Prediction Interval&quot;</span>
<a id="__codelineno-2-55" name="__codelineno-2-55" href="#__codelineno-2-55"></a><span class="p">)</span>
<a id="__codelineno-2-56" name="__codelineno-2-56" href="#__codelineno-2-56"></a>
<a id="__codelineno-2-57" name="__codelineno-2-57" href="#__codelineno-2-57"></a><span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Date&quot;</span><span class="p">)</span>
<a id="__codelineno-2-58" name="__codelineno-2-58" href="#__codelineno-2-58"></a><span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Power&quot;</span><span class="p">)</span>
<a id="__codelineno-2-59" name="__codelineno-2-59" href="#__codelineno-2-59"></a><span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Conformal Prediction with Binned Residuals (95% Interval)&quot;</span><span class="p">)</span>
<a id="__codelineno-2-60" name="__codelineno-2-60" href="#__codelineno-2-60"></a><span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<a id="__codelineno-2-61" name="__codelineno-2-61" href="#__codelineno-2-61"></a><span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<a id="__codelineno-2-62" name="__codelineno-2-62" href="#__codelineno-2-62"></a><span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<a id="__codelineno-2-63" name="__codelineno-2-63" href="#__codelineno-2-63"></a><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<a id="__codelineno-2-64" name="__codelineno-2-64" href="#__codelineno-2-64"></a>
<a id="__codelineno-2-65" name="__codelineno-2-65" href="#__codelineno-2-65"></a><span class="c1"># Verify prediction interval coverage</span>
<a id="__codelineno-2-66" name="__codelineno-2-66" href="#__codelineno-2-66"></a><span class="n">coverage</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-2-67" name="__codelineno-2-67" href="#__codelineno-2-67"></a>    <span class="p">(</span><span class="n">predictions</span><span class="p">[</span><span class="s2">&quot;pred&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">predictions</span><span class="p">[</span><span class="s2">&quot;lower_bound&quot;</span><span class="p">])</span> <span class="o">&amp;</span>
<a id="__codelineno-2-68" name="__codelineno-2-68" href="#__codelineno-2-68"></a>    <span class="p">(</span><span class="n">predictions</span><span class="p">[</span><span class="s2">&quot;pred&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">predictions</span><span class="p">[</span><span class="s2">&quot;upper_bound&quot;</span><span class="p">])</span>
<a id="__codelineno-2-69" name="__codelineno-2-69" href="#__codelineno-2-69"></a><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<a id="__codelineno-2-70" name="__codelineno-2-70" href="#__codelineno-2-70"></a>
<a id="__codelineno-2-71" name="__codelineno-2-71" href="#__codelineno-2-71"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Interval coverage: </span><span class="si">{</span><span class="n">coverage</span><span class="si">:</span><span class="s2">.2%</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-2-72" name="__codelineno-2-72" href="#__codelineno-2-72"></a><span class="nb">print</span><span class="p">(</span><span class="n">metric_values</span><span class="p">)</span>
</code></pre></div>
<h4 id="example-3-forecasting-with-exogenous-variables">Example 3: Forecasting with Exogenous Variables</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.linear_model</span><span class="w"> </span><span class="kn">import</span> <span class="n">LinearRegression</span>
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="kn">from</span><span class="w"> </span><span class="nn">spotforecast2_safe.forecaster.recursive</span><span class="w"> </span><span class="kn">import</span> <span class="n">ForecasterRecursive</span>
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a><span class="kn">from</span><span class="w"> </span><span class="nn">spotforecast2.model_selection</span><span class="w"> </span><span class="kn">import</span> <span class="n">backtesting_forecaster</span><span class="p">,</span> <span class="n">TimeSeriesFold</span>
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a>
<a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a><span class="c1"># Create time series with exogenous variable</span>
<a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a><span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">(</span><span class="mi">789</span><span class="p">)</span>
<a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a><span class="n">dates</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s2">&quot;2020-01-01&quot;</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">250</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s2">&quot;D&quot;</span><span class="p">)</span>
<a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a><span class="n">exog</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
<a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a>    <span class="s2">&quot;temperature&quot;</span><span class="p">:</span> <span class="n">rng</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">250</span><span class="p">),</span>
<a id="__codelineno-3-13" name="__codelineno-3-13" href="#__codelineno-3-13"></a>    <span class="s2">&quot;day_of_week&quot;</span><span class="p">:</span> <span class="n">dates</span><span class="o">.</span><span class="n">dayofweek</span>
<a id="__codelineno-3-14" name="__codelineno-3-14" href="#__codelineno-3-14"></a><span class="p">},</span> <span class="n">index</span><span class="o">=</span><span class="n">dates</span><span class="p">)</span>
<a id="__codelineno-3-15" name="__codelineno-3-15" href="#__codelineno-3-15"></a>
<a id="__codelineno-3-16" name="__codelineno-3-16" href="#__codelineno-3-16"></a><span class="n">y</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span>
<a id="__codelineno-3-17" name="__codelineno-3-17" href="#__codelineno-3-17"></a>    <span class="mi">10</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">exog</span><span class="p">[</span><span class="s2">&quot;temperature&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">exog</span><span class="p">[</span><span class="s2">&quot;day_of_week&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">)</span> <span class="o">+</span> <span class="n">rng</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">250</span><span class="p">),</span>
<a id="__codelineno-3-18" name="__codelineno-3-18" href="#__codelineno-3-18"></a>    <span class="n">index</span><span class="o">=</span><span class="n">dates</span><span class="p">,</span>
<a id="__codelineno-3-19" name="__codelineno-3-19" href="#__codelineno-3-19"></a>    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;demand&quot;</span>
<a id="__codelineno-3-20" name="__codelineno-3-20" href="#__codelineno-3-20"></a><span class="p">)</span>
<a id="__codelineno-3-21" name="__codelineno-3-21" href="#__codelineno-3-21"></a>
<a id="__codelineno-3-22" name="__codelineno-3-22" href="#__codelineno-3-22"></a><span class="c1"># Initialize forecaster</span>
<a id="__codelineno-3-23" name="__codelineno-3-23" href="#__codelineno-3-23"></a><span class="n">forecaster</span> <span class="o">=</span> <span class="n">ForecasterRecursive</span><span class="p">(</span>
<a id="__codelineno-3-24" name="__codelineno-3-24" href="#__codelineno-3-24"></a>    <span class="n">estimator</span><span class="o">=</span><span class="n">LinearRegression</span><span class="p">(),</span>
<a id="__codelineno-3-25" name="__codelineno-3-25" href="#__codelineno-3-25"></a>    <span class="n">lags</span><span class="o">=</span><span class="mi">7</span>
<a id="__codelineno-3-26" name="__codelineno-3-26" href="#__codelineno-3-26"></a><span class="p">)</span>
<a id="__codelineno-3-27" name="__codelineno-3-27" href="#__codelineno-3-27"></a>
<a id="__codelineno-3-28" name="__codelineno-3-28" href="#__codelineno-3-28"></a><span class="c1"># Configure cross-validation</span>
<a id="__codelineno-3-29" name="__codelineno-3-29" href="#__codelineno-3-29"></a><span class="n">cv</span> <span class="o">=</span> <span class="n">TimeSeriesFold</span><span class="p">(</span>
<a id="__codelineno-3-30" name="__codelineno-3-30" href="#__codelineno-3-30"></a>    <span class="n">steps</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span>
<a id="__codelineno-3-31" name="__codelineno-3-31" href="#__codelineno-3-31"></a>    <span class="n">initial_train_size</span><span class="o">=</span><span class="mi">180</span><span class="p">,</span>
<a id="__codelineno-3-32" name="__codelineno-3-32" href="#__codelineno-3-32"></a>    <span class="n">refit</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-3-33" name="__codelineno-3-33" href="#__codelineno-3-33"></a>    <span class="n">fold_stride</span><span class="o">=</span><span class="mi">7</span>
<a id="__codelineno-3-34" name="__codelineno-3-34" href="#__codelineno-3-34"></a><span class="p">)</span>
<a id="__codelineno-3-35" name="__codelineno-3-35" href="#__codelineno-3-35"></a>
<a id="__codelineno-3-36" name="__codelineno-3-36" href="#__codelineno-3-36"></a><span class="c1"># Perform backtesting with conformal prediction</span>
<a id="__codelineno-3-37" name="__codelineno-3-37" href="#__codelineno-3-37"></a><span class="n">metric_values</span><span class="p">,</span> <span class="n">predictions</span> <span class="o">=</span> <span class="n">backtesting_forecaster</span><span class="p">(</span>
<a id="__codelineno-3-38" name="__codelineno-3-38" href="#__codelineno-3-38"></a>    <span class="n">forecaster</span><span class="o">=</span><span class="n">forecaster</span><span class="p">,</span>
<a id="__codelineno-3-39" name="__codelineno-3-39" href="#__codelineno-3-39"></a>    <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span>
<a id="__codelineno-3-40" name="__codelineno-3-40" href="#__codelineno-3-40"></a>    <span class="n">exog</span><span class="o">=</span><span class="n">exog</span><span class="p">,</span>
<a id="__codelineno-3-41" name="__codelineno-3-41" href="#__codelineno-3-41"></a>    <span class="n">cv</span><span class="o">=</span><span class="n">cv</span><span class="p">,</span>
<a id="__codelineno-3-42" name="__codelineno-3-42" href="#__codelineno-3-42"></a>    <span class="n">metric</span><span class="o">=</span><span class="s2">&quot;mean_absolute_percentage_error&quot;</span><span class="p">,</span>
<a id="__codelineno-3-43" name="__codelineno-3-43" href="#__codelineno-3-43"></a>    <span class="n">interval</span><span class="o">=</span><span class="mf">0.90</span><span class="p">,</span>  <span class="c1"># 90% prediction interval</span>
<a id="__codelineno-3-44" name="__codelineno-3-44" href="#__codelineno-3-44"></a>    <span class="n">interval_method</span><span class="o">=</span><span class="s2">&quot;conformal&quot;</span><span class="p">,</span>
<a id="__codelineno-3-45" name="__codelineno-3-45" href="#__codelineno-3-45"></a>    <span class="n">use_in_sample_residuals</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-3-46" name="__codelineno-3-46" href="#__codelineno-3-46"></a>    <span class="n">random_state</span><span class="o">=</span><span class="mi">789</span>
<a id="__codelineno-3-47" name="__codelineno-3-47" href="#__codelineno-3-47"></a><span class="p">)</span>
<a id="__codelineno-3-48" name="__codelineno-3-48" href="#__codelineno-3-48"></a>
<a id="__codelineno-3-49" name="__codelineno-3-49" href="#__codelineno-3-49"></a><span class="c1"># Visualize results with prediction intervals and exogenous variable</span>
<a id="__codelineno-3-50" name="__codelineno-3-50" href="#__codelineno-3-50"></a><span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-3-51" name="__codelineno-3-51" href="#__codelineno-3-51"></a>
<a id="__codelineno-3-52" name="__codelineno-3-52" href="#__codelineno-3-52"></a><span class="c1"># Top plot: Predictions with intervals</span>
<a id="__codelineno-3-53" name="__codelineno-3-53" href="#__codelineno-3-53"></a><span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">y</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Actual Demand&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
<a id="__codelineno-3-54" name="__codelineno-3-54" href="#__codelineno-3-54"></a><span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">predictions</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">predictions</span><span class="p">[</span><span class="s2">&quot;pred&quot;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Prediction&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-3-55" name="__codelineno-3-55" href="#__codelineno-3-55"></a><span class="n">ax1</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span>
<a id="__codelineno-3-56" name="__codelineno-3-56" href="#__codelineno-3-56"></a>    <span class="n">predictions</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
<a id="__codelineno-3-57" name="__codelineno-3-57" href="#__codelineno-3-57"></a>    <span class="n">predictions</span><span class="p">[</span><span class="s2">&quot;lower_bound&quot;</span><span class="p">],</span>
<a id="__codelineno-3-58" name="__codelineno-3-58" href="#__codelineno-3-58"></a>    <span class="n">predictions</span><span class="p">[</span><span class="s2">&quot;upper_bound&quot;</span><span class="p">],</span>
<a id="__codelineno-3-59" name="__codelineno-3-59" href="#__codelineno-3-59"></a>    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span>
<a id="__codelineno-3-60" name="__codelineno-3-60" href="#__codelineno-3-60"></a>    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span>
<a id="__codelineno-3-61" name="__codelineno-3-61" href="#__codelineno-3-61"></a>    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;90% Prediction Interval&quot;</span>
<a id="__codelineno-3-62" name="__codelineno-3-62" href="#__codelineno-3-62"></a><span class="p">)</span>
<a id="__codelineno-3-63" name="__codelineno-3-63" href="#__codelineno-3-63"></a><span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Demand&quot;</span><span class="p">)</span>
<a id="__codelineno-3-64" name="__codelineno-3-64" href="#__codelineno-3-64"></a><span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Demand Forecasting with Exogenous Variables (90% Interval)&quot;</span><span class="p">)</span>
<a id="__codelineno-3-65" name="__codelineno-3-65" href="#__codelineno-3-65"></a><span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<a id="__codelineno-3-66" name="__codelineno-3-66" href="#__codelineno-3-66"></a><span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<a id="__codelineno-3-67" name="__codelineno-3-67" href="#__codelineno-3-67"></a>
<a id="__codelineno-3-68" name="__codelineno-3-68" href="#__codelineno-3-68"></a><span class="c1"># Bottom plot: Exogenous variable (temperature)</span>
<a id="__codelineno-3-69" name="__codelineno-3-69" href="#__codelineno-3-69"></a><span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">exog</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">exog</span><span class="p">[</span><span class="s2">&quot;temperature&quot;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Temperature&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
<a id="__codelineno-3-70" name="__codelineno-3-70" href="#__codelineno-3-70"></a><span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Date&quot;</span><span class="p">)</span>
<a id="__codelineno-3-71" name="__codelineno-3-71" href="#__codelineno-3-71"></a><span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Temperature (C)&quot;</span><span class="p">)</span>
<a id="__codelineno-3-72" name="__codelineno-3-72" href="#__codelineno-3-72"></a><span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Exogenous Variable: Temperature&quot;</span><span class="p">)</span>
<a id="__codelineno-3-73" name="__codelineno-3-73" href="#__codelineno-3-73"></a><span class="n">ax2</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<a id="__codelineno-3-74" name="__codelineno-3-74" href="#__codelineno-3-74"></a><span class="n">ax2</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<a id="__codelineno-3-75" name="__codelineno-3-75" href="#__codelineno-3-75"></a>
<a id="__codelineno-3-76" name="__codelineno-3-76" href="#__codelineno-3-76"></a><span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<a id="__codelineno-3-77" name="__codelineno-3-77" href="#__codelineno-3-77"></a><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<a id="__codelineno-3-78" name="__codelineno-3-78" href="#__codelineno-3-78"></a>
<a id="__codelineno-3-79" name="__codelineno-3-79" href="#__codelineno-3-79"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;MAPE: </span><span class="si">{</span><span class="n">metric_values</span><span class="p">[</span><span class="s1">&#39;mean_absolute_percentage_error&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
<h2 id="time-series-cross-validation-timeseriesfold">Time Series Cross-Validation: TimeSeriesFold</h2>
<p>The TimeSeriesFold class provides a robust framework for splitting time series data into training and validation folds while respecting temporal ordering. This is critical for safety-critical systems where data leakage from future observations could create dangerously optimistic performance estimates.</p>


<div class="doc doc-object doc-class">



<h2 id="spotforecast2.model_selection.split_ts_cv.TimeSeriesFold" class="doc doc-heading">
            <code>spotforecast2.model_selection.split_ts_cv.TimeSeriesFold</code>


</h2>


    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><span title="spotforecast2.model_selection.split_base.BaseFold">BaseFold</span></code></p>



        <p>Class to split time series data into train and test folds.</p>
<p>When used within a backtesting or hyperparameter search, the arguments
'initial_train_size', 'window_size' and 'differentiation' are not required
as they are automatically set by the backtesting or hyperparameter search
functions.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>steps</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of observations used to be predicted in each fold.
This is also commonly referred to as the forecast horizon or test size.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>initial_train_size</code>
            </td>
            <td>
                  <code><span title="int">int</span> | <span title="str">str</span> | <span title="pandas.Timestamp">Timestamp</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of observations used for initial training.</p>
<ul>
<li>If <code>None</code> or 0, the initial forecaster is not trained in the first fold.</li>
<li>If an integer, the number of observations used for initial training.</li>
<li>If a date string or pandas Timestamp, it is the last date included in
  the initial training set.</li>
</ul>
<p>Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>fold_stride</code>
            </td>
            <td>
                  <code><span title="int">int</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of observations that the start of the test set
advances between consecutive folds.</p>
<ul>
<li>If <code>None</code>, it defaults to the same value as <code>steps</code>, meaning that folds
  are placed back-to-back without overlap.</li>
<li>If <code>fold_stride &lt; steps</code>, test sets overlap and multiple forecasts will
  be generated for the same observations.</li>
<li>If <code>fold_stride &gt; steps</code>, gaps are left between consecutive test sets.</li>
</ul>
<p>Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>window_size</code>
            </td>
            <td>
                  <code><span title="int">int</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of observations needed to generate the
autoregressive predictors. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>differentiation</code>
            </td>
            <td>
                  <code><span title="int">int</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of observations to use for differentiation.
This is used to extend the <code>last_window</code> as many observations as the
differentiation order. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>refit</code>
            </td>
            <td>
                  <code><span title="bool">bool</span> | <span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to refit the forecaster in each fold.</p>
<ul>
<li>If <code>True</code>, the forecaster is refitted in each fold.</li>
<li>If <code>False</code>, the forecaster is trained only in the first fold.</li>
<li>If an integer, the forecaster is trained in the first fold and then refitted
  every <code>refit</code> folds.</li>
</ul>
<p>Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>fixed_train_size</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether the training size is fixed or increases
in each fold. Defaults to True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>gap</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of observations between the end of the training set
and the start of the test set. Defaults to 0.</p>
              </div>
            </td>
            <td>
                  <code>0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>skip_folds</code>
            </td>
            <td>
                  <code><span title="int">int</span> | <span title="list">list</span>[<span title="int">int</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of folds to skip.</p>
<ul>
<li>If an integer, every 'skip_folds'-th is returned.</li>
<li>If a list, the indexes of the folds to skip.</li>
</ul>
<p>For example, if <code>skip_folds=3</code> and there are 10 folds, the returned folds are
0, 3, 6, and 9. If <code>skip_folds=[1, 2, 3]</code>, the returned folds are 0, 4, 5, 6, 7,
8, and 9. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>allow_incomplete_fold</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to allow the last fold to include
fewer observations than <code>steps</code>. If <code>False</code>, the last fold is excluded if it
is incomplete. Defaults to True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>return_all_indexes</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to return all indexes or only the
start and end indexes of each fold. Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>verbose</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to print information about generated folds.
Defaults to True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="spotforecast2.model_selection.split_ts_cv.TimeSeriesFold.steps">steps</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of observations used to be predicted in each fold.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="spotforecast2.model_selection.split_ts_cv.TimeSeriesFold.initial_train_size">initial_train_size</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of observations used for initial training.
If <code>None</code> or 0, the initial forecaster is not trained in the first fold.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="spotforecast2.model_selection.split_ts_cv.TimeSeriesFold.fold_stride">fold_stride</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of observations that the start of the test set
advances between consecutive folds.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="spotforecast2.model_selection.split_ts_cv.TimeSeriesFold.overlapping_folds">overlapping_folds</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether the folds overlap.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="spotforecast2.model_selection.split_ts_cv.TimeSeriesFold.window_size">window_size</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of observations needed to generate the
autoregressive predictors.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="spotforecast2.model_selection.split_ts_cv.TimeSeriesFold.differentiation">differentiation</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of observations to use for differentiation.
This is used to extend the <code>last_window</code> as many observations as the
differentiation order.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="spotforecast2.model_selection.split_ts_cv.TimeSeriesFold.refit">refit</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to refit the forecaster in each fold.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="spotforecast2.model_selection.split_ts_cv.TimeSeriesFold.fixed_train_size">fixed_train_size</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether the training size is fixed or increases in each fold.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="spotforecast2.model_selection.split_ts_cv.TimeSeriesFold.gap">gap</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of observations between the end of the training set and the
start of the test set.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="spotforecast2.model_selection.split_ts_cv.TimeSeriesFold.skip_folds">skip_folds</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of folds to skip.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="spotforecast2.model_selection.split_ts_cv.TimeSeriesFold.allow_incomplete_fold">allow_incomplete_fold</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to allow the last fold to include fewer
observations than <code>steps</code>.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="spotforecast2.model_selection.split_ts_cv.TimeSeriesFold.return_all_indexes">return_all_indexes</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to return all indexes or only the start
and end indexes of each fold.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="spotforecast2.model_selection.split_ts_cv.TimeSeriesFold.verbose">verbose</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to print information about generated folds.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <p>Basic usage with fixed train size:</p>
    <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">spotforecast2.model_selection</span><span class="w"> </span><span class="kn">import</span> <span class="n">TimeSeriesFold</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Create sample time series data</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">dates</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s1">&#39;2020-01-01&#39;</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;D&#39;</span><span class="p">)</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">y</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="n">dates</span><span class="p">)</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Create fold splitter</span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">cv</span> <span class="o">=</span> <span class="n">TimeSeriesFold</span><span class="p">(</span>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="gp">... </span>    <span class="n">steps</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a><span class="gp">... </span>    <span class="n">initial_train_size</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a><span class="gp">... </span>    <span class="n">refit</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a><span class="gp">... </span>    <span class="n">fixed_train_size</span><span class="o">=</span><span class="kc">True</span>
<a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a><span class="gp">... </span><span class="p">)</span>
<a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Get folds</span>
<a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">folds</span> <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
<a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of folds: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">folds</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a><span class="go">Number of folds: 4</span>
</code></pre></div>
    <p>Overlapping folds with custom stride:</p>
    <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">cv</span> <span class="o">=</span> <span class="n">TimeSeriesFold</span><span class="p">(</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="gp">... </span>    <span class="n">steps</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="gp">... </span>    <span class="n">initial_train_size</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="gp">... </span>    <span class="n">fold_stride</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="gp">... </span>    <span class="n">fixed_train_size</span><span class="o">=</span><span class="kc">False</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="gp">... </span><span class="p">)</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">folds</span> <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="gp">&gt;&gt;&gt; </span><span class="c1"># First test fold covers [50, 80), second [57, 87), etc.</span>
</code></pre></div>
    <p>Return as pandas DataFrame:</p>
    <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">cv</span> <span class="o">=</span> <span class="n">TimeSeriesFold</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">initial_train_size</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">folds_df</span> <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">as_pandas</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">folds_df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="go">[&#39;fold&#39;, &#39;train_start&#39;, &#39;train_end&#39;, &#39;last_window_start&#39;, &#39;last_window_end&#39;, &#39;test_start&#39;, &#39;test_end&#39;, &#39;test_start_with_gap&#39;, &#39;test_end_with_gap&#39;, &#39;fit_forecaster&#39;]</span>
</code></pre></div>
    <p>Skip folds for faster evaluation:</p>
    <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">cv</span> <span class="o">=</span> <span class="n">TimeSeriesFold</span><span class="p">(</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="gp">... </span>    <span class="n">steps</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="gp">... </span>    <span class="n">initial_train_size</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="gp">... </span>    <span class="n">skip_folds</span><span class="o">=</span><span class="mi">2</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="gp">... </span><span class="p">)</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">folds</span> <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Returns folds 0, 2, 4, 6, ...</span>
</code></pre></div>


<details class="note" open>
  <summary>Note</summary>
  <p>Returned values are the positions of the observations and not the actual values of
the index, so they can be used to slice the data directly using iloc. For example,
if the input series is <code>X = [10, 11, 12, 13, 14, 15, 16, 17, 18, 19]</code>, the
<code>initial_train_size = 3</code>, <code>window_size = 2</code>, <code>steps = 4</code>, and <code>gap = 1</code>,
the output of the first fold will: [0, [0, 3], [1, 3], [3, 8], [4, 8], True].</p>
<p>The first element is the fold number, the first list <code>[0, 3]</code> indicates that
the training set goes from the first to the third observation. The second
list <code>[1, 3]</code> indicates that the last window seen by the forecaster during
training goes from the second to the third observation. The third list <code>[3, 8]</code>
indicates that the test set goes from the fourth to the eighth observation.
The fourth list <code>[4, 8]</code> indicates that the test set including the gap goes
from the fifth to the eighth observation. The boolean <code>False</code> indicates that
the forecaster should not be trained in this fold.</p>
<p>Following the python convention, the start index is inclusive and the end index is
exclusive. This means that the last index is not included in the slice.</p>
<p>As an example, with <code>initial_train_size=50</code>, <code>steps=30</code>, and <code>fold_stride=7</code>,
the first test fold will cover observations [50, 80), the second fold [57, 87),
and the third fold [64, 94). This configuration produces multiple forecasts
for the same observations, which is often desirable in rolling-origin
evaluation.</p>
</details>







              <details class="mkdocstrings-source">
                <summary>Source code in <code>src/spotforecast2/model_selection/split_ts_cv.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-0-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-0-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-0-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-0-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-0-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-0-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-0-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-0-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-0-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-0-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-0-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-0-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-0-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-0-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-0-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-0-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-0-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-0-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-0-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-0-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-0-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-0-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-0-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-0-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-0-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-0-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-0-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-0-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-0-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-0-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-0-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-0-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-0-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-0-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-0-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-0-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-0-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-0-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-0-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-0-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-0-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-0-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-0-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-0-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span>
<span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span>
<span class="normal"><a href="#__codelineno-0-267">267</a></span>
<span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span>
<span class="normal"><a href="#__codelineno-0-273">273</a></span>
<span class="normal"><a href="#__codelineno-0-274">274</a></span>
<span class="normal"><a href="#__codelineno-0-275">275</a></span>
<span class="normal"><a href="#__codelineno-0-276">276</a></span>
<span class="normal"><a href="#__codelineno-0-277">277</a></span>
<span class="normal"><a href="#__codelineno-0-278">278</a></span>
<span class="normal"><a href="#__codelineno-0-279">279</a></span>
<span class="normal"><a href="#__codelineno-0-280">280</a></span>
<span class="normal"><a href="#__codelineno-0-281">281</a></span>
<span class="normal"><a href="#__codelineno-0-282">282</a></span>
<span class="normal"><a href="#__codelineno-0-283">283</a></span>
<span class="normal"><a href="#__codelineno-0-284">284</a></span>
<span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span>
<span class="normal"><a href="#__codelineno-0-287">287</a></span>
<span class="normal"><a href="#__codelineno-0-288">288</a></span>
<span class="normal"><a href="#__codelineno-0-289">289</a></span>
<span class="normal"><a href="#__codelineno-0-290">290</a></span>
<span class="normal"><a href="#__codelineno-0-291">291</a></span>
<span class="normal"><a href="#__codelineno-0-292">292</a></span>
<span class="normal"><a href="#__codelineno-0-293">293</a></span>
<span class="normal"><a href="#__codelineno-0-294">294</a></span>
<span class="normal"><a href="#__codelineno-0-295">295</a></span>
<span class="normal"><a href="#__codelineno-0-296">296</a></span>
<span class="normal"><a href="#__codelineno-0-297">297</a></span>
<span class="normal"><a href="#__codelineno-0-298">298</a></span>
<span class="normal"><a href="#__codelineno-0-299">299</a></span>
<span class="normal"><a href="#__codelineno-0-300">300</a></span>
<span class="normal"><a href="#__codelineno-0-301">301</a></span>
<span class="normal"><a href="#__codelineno-0-302">302</a></span>
<span class="normal"><a href="#__codelineno-0-303">303</a></span>
<span class="normal"><a href="#__codelineno-0-304">304</a></span>
<span class="normal"><a href="#__codelineno-0-305">305</a></span>
<span class="normal"><a href="#__codelineno-0-306">306</a></span>
<span class="normal"><a href="#__codelineno-0-307">307</a></span>
<span class="normal"><a href="#__codelineno-0-308">308</a></span>
<span class="normal"><a href="#__codelineno-0-309">309</a></span>
<span class="normal"><a href="#__codelineno-0-310">310</a></span>
<span class="normal"><a href="#__codelineno-0-311">311</a></span>
<span class="normal"><a href="#__codelineno-0-312">312</a></span>
<span class="normal"><a href="#__codelineno-0-313">313</a></span>
<span class="normal"><a href="#__codelineno-0-314">314</a></span>
<span class="normal"><a href="#__codelineno-0-315">315</a></span>
<span class="normal"><a href="#__codelineno-0-316">316</a></span>
<span class="normal"><a href="#__codelineno-0-317">317</a></span>
<span class="normal"><a href="#__codelineno-0-318">318</a></span>
<span class="normal"><a href="#__codelineno-0-319">319</a></span>
<span class="normal"><a href="#__codelineno-0-320">320</a></span>
<span class="normal"><a href="#__codelineno-0-321">321</a></span>
<span class="normal"><a href="#__codelineno-0-322">322</a></span>
<span class="normal"><a href="#__codelineno-0-323">323</a></span>
<span class="normal"><a href="#__codelineno-0-324">324</a></span>
<span class="normal"><a href="#__codelineno-0-325">325</a></span>
<span class="normal"><a href="#__codelineno-0-326">326</a></span>
<span class="normal"><a href="#__codelineno-0-327">327</a></span>
<span class="normal"><a href="#__codelineno-0-328">328</a></span>
<span class="normal"><a href="#__codelineno-0-329">329</a></span>
<span class="normal"><a href="#__codelineno-0-330">330</a></span>
<span class="normal"><a href="#__codelineno-0-331">331</a></span>
<span class="normal"><a href="#__codelineno-0-332">332</a></span>
<span class="normal"><a href="#__codelineno-0-333">333</a></span>
<span class="normal"><a href="#__codelineno-0-334">334</a></span>
<span class="normal"><a href="#__codelineno-0-335">335</a></span>
<span class="normal"><a href="#__codelineno-0-336">336</a></span>
<span class="normal"><a href="#__codelineno-0-337">337</a></span>
<span class="normal"><a href="#__codelineno-0-338">338</a></span>
<span class="normal"><a href="#__codelineno-0-339">339</a></span>
<span class="normal"><a href="#__codelineno-0-340">340</a></span>
<span class="normal"><a href="#__codelineno-0-341">341</a></span>
<span class="normal"><a href="#__codelineno-0-342">342</a></span>
<span class="normal"><a href="#__codelineno-0-343">343</a></span>
<span class="normal"><a href="#__codelineno-0-344">344</a></span>
<span class="normal"><a href="#__codelineno-0-345">345</a></span>
<span class="normal"><a href="#__codelineno-0-346">346</a></span>
<span class="normal"><a href="#__codelineno-0-347">347</a></span>
<span class="normal"><a href="#__codelineno-0-348">348</a></span>
<span class="normal"><a href="#__codelineno-0-349">349</a></span>
<span class="normal"><a href="#__codelineno-0-350">350</a></span>
<span class="normal"><a href="#__codelineno-0-351">351</a></span>
<span class="normal"><a href="#__codelineno-0-352">352</a></span>
<span class="normal"><a href="#__codelineno-0-353">353</a></span>
<span class="normal"><a href="#__codelineno-0-354">354</a></span>
<span class="normal"><a href="#__codelineno-0-355">355</a></span>
<span class="normal"><a href="#__codelineno-0-356">356</a></span>
<span class="normal"><a href="#__codelineno-0-357">357</a></span>
<span class="normal"><a href="#__codelineno-0-358">358</a></span>
<span class="normal"><a href="#__codelineno-0-359">359</a></span>
<span class="normal"><a href="#__codelineno-0-360">360</a></span>
<span class="normal"><a href="#__codelineno-0-361">361</a></span>
<span class="normal"><a href="#__codelineno-0-362">362</a></span>
<span class="normal"><a href="#__codelineno-0-363">363</a></span>
<span class="normal"><a href="#__codelineno-0-364">364</a></span>
<span class="normal"><a href="#__codelineno-0-365">365</a></span>
<span class="normal"><a href="#__codelineno-0-366">366</a></span>
<span class="normal"><a href="#__codelineno-0-367">367</a></span>
<span class="normal"><a href="#__codelineno-0-368">368</a></span>
<span class="normal"><a href="#__codelineno-0-369">369</a></span>
<span class="normal"><a href="#__codelineno-0-370">370</a></span>
<span class="normal"><a href="#__codelineno-0-371">371</a></span>
<span class="normal"><a href="#__codelineno-0-372">372</a></span>
<span class="normal"><a href="#__codelineno-0-373">373</a></span>
<span class="normal"><a href="#__codelineno-0-374">374</a></span>
<span class="normal"><a href="#__codelineno-0-375">375</a></span>
<span class="normal"><a href="#__codelineno-0-376">376</a></span>
<span class="normal"><a href="#__codelineno-0-377">377</a></span>
<span class="normal"><a href="#__codelineno-0-378">378</a></span>
<span class="normal"><a href="#__codelineno-0-379">379</a></span>
<span class="normal"><a href="#__codelineno-0-380">380</a></span>
<span class="normal"><a href="#__codelineno-0-381">381</a></span>
<span class="normal"><a href="#__codelineno-0-382">382</a></span>
<span class="normal"><a href="#__codelineno-0-383">383</a></span>
<span class="normal"><a href="#__codelineno-0-384">384</a></span>
<span class="normal"><a href="#__codelineno-0-385">385</a></span>
<span class="normal"><a href="#__codelineno-0-386">386</a></span>
<span class="normal"><a href="#__codelineno-0-387">387</a></span>
<span class="normal"><a href="#__codelineno-0-388">388</a></span>
<span class="normal"><a href="#__codelineno-0-389">389</a></span>
<span class="normal"><a href="#__codelineno-0-390">390</a></span>
<span class="normal"><a href="#__codelineno-0-391">391</a></span>
<span class="normal"><a href="#__codelineno-0-392">392</a></span>
<span class="normal"><a href="#__codelineno-0-393">393</a></span>
<span class="normal"><a href="#__codelineno-0-394">394</a></span>
<span class="normal"><a href="#__codelineno-0-395">395</a></span>
<span class="normal"><a href="#__codelineno-0-396">396</a></span>
<span class="normal"><a href="#__codelineno-0-397">397</a></span>
<span class="normal"><a href="#__codelineno-0-398">398</a></span>
<span class="normal"><a href="#__codelineno-0-399">399</a></span>
<span class="normal"><a href="#__codelineno-0-400">400</a></span>
<span class="normal"><a href="#__codelineno-0-401">401</a></span>
<span class="normal"><a href="#__codelineno-0-402">402</a></span>
<span class="normal"><a href="#__codelineno-0-403">403</a></span>
<span class="normal"><a href="#__codelineno-0-404">404</a></span>
<span class="normal"><a href="#__codelineno-0-405">405</a></span>
<span class="normal"><a href="#__codelineno-0-406">406</a></span>
<span class="normal"><a href="#__codelineno-0-407">407</a></span>
<span class="normal"><a href="#__codelineno-0-408">408</a></span>
<span class="normal"><a href="#__codelineno-0-409">409</a></span>
<span class="normal"><a href="#__codelineno-0-410">410</a></span>
<span class="normal"><a href="#__codelineno-0-411">411</a></span>
<span class="normal"><a href="#__codelineno-0-412">412</a></span>
<span class="normal"><a href="#__codelineno-0-413">413</a></span>
<span class="normal"><a href="#__codelineno-0-414">414</a></span>
<span class="normal"><a href="#__codelineno-0-415">415</a></span>
<span class="normal"><a href="#__codelineno-0-416">416</a></span>
<span class="normal"><a href="#__codelineno-0-417">417</a></span>
<span class="normal"><a href="#__codelineno-0-418">418</a></span>
<span class="normal"><a href="#__codelineno-0-419">419</a></span>
<span class="normal"><a href="#__codelineno-0-420">420</a></span>
<span class="normal"><a href="#__codelineno-0-421">421</a></span>
<span class="normal"><a href="#__codelineno-0-422">422</a></span>
<span class="normal"><a href="#__codelineno-0-423">423</a></span>
<span class="normal"><a href="#__codelineno-0-424">424</a></span>
<span class="normal"><a href="#__codelineno-0-425">425</a></span>
<span class="normal"><a href="#__codelineno-0-426">426</a></span>
<span class="normal"><a href="#__codelineno-0-427">427</a></span>
<span class="normal"><a href="#__codelineno-0-428">428</a></span>
<span class="normal"><a href="#__codelineno-0-429">429</a></span>
<span class="normal"><a href="#__codelineno-0-430">430</a></span>
<span class="normal"><a href="#__codelineno-0-431">431</a></span>
<span class="normal"><a href="#__codelineno-0-432">432</a></span>
<span class="normal"><a href="#__codelineno-0-433">433</a></span>
<span class="normal"><a href="#__codelineno-0-434">434</a></span>
<span class="normal"><a href="#__codelineno-0-435">435</a></span>
<span class="normal"><a href="#__codelineno-0-436">436</a></span>
<span class="normal"><a href="#__codelineno-0-437">437</a></span>
<span class="normal"><a href="#__codelineno-0-438">438</a></span>
<span class="normal"><a href="#__codelineno-0-439">439</a></span>
<span class="normal"><a href="#__codelineno-0-440">440</a></span>
<span class="normal"><a href="#__codelineno-0-441">441</a></span>
<span class="normal"><a href="#__codelineno-0-442">442</a></span>
<span class="normal"><a href="#__codelineno-0-443">443</a></span>
<span class="normal"><a href="#__codelineno-0-444">444</a></span>
<span class="normal"><a href="#__codelineno-0-445">445</a></span>
<span class="normal"><a href="#__codelineno-0-446">446</a></span>
<span class="normal"><a href="#__codelineno-0-447">447</a></span>
<span class="normal"><a href="#__codelineno-0-448">448</a></span>
<span class="normal"><a href="#__codelineno-0-449">449</a></span>
<span class="normal"><a href="#__codelineno-0-450">450</a></span>
<span class="normal"><a href="#__codelineno-0-451">451</a></span>
<span class="normal"><a href="#__codelineno-0-452">452</a></span>
<span class="normal"><a href="#__codelineno-0-453">453</a></span>
<span class="normal"><a href="#__codelineno-0-454">454</a></span>
<span class="normal"><a href="#__codelineno-0-455">455</a></span>
<span class="normal"><a href="#__codelineno-0-456">456</a></span>
<span class="normal"><a href="#__codelineno-0-457">457</a></span>
<span class="normal"><a href="#__codelineno-0-458">458</a></span>
<span class="normal"><a href="#__codelineno-0-459">459</a></span>
<span class="normal"><a href="#__codelineno-0-460">460</a></span>
<span class="normal"><a href="#__codelineno-0-461">461</a></span>
<span class="normal"><a href="#__codelineno-0-462">462</a></span>
<span class="normal"><a href="#__codelineno-0-463">463</a></span>
<span class="normal"><a href="#__codelineno-0-464">464</a></span>
<span class="normal"><a href="#__codelineno-0-465">465</a></span>
<span class="normal"><a href="#__codelineno-0-466">466</a></span>
<span class="normal"><a href="#__codelineno-0-467">467</a></span>
<span class="normal"><a href="#__codelineno-0-468">468</a></span>
<span class="normal"><a href="#__codelineno-0-469">469</a></span>
<span class="normal"><a href="#__codelineno-0-470">470</a></span>
<span class="normal"><a href="#__codelineno-0-471">471</a></span>
<span class="normal"><a href="#__codelineno-0-472">472</a></span>
<span class="normal"><a href="#__codelineno-0-473">473</a></span>
<span class="normal"><a href="#__codelineno-0-474">474</a></span>
<span class="normal"><a href="#__codelineno-0-475">475</a></span>
<span class="normal"><a href="#__codelineno-0-476">476</a></span>
<span class="normal"><a href="#__codelineno-0-477">477</a></span>
<span class="normal"><a href="#__codelineno-0-478">478</a></span>
<span class="normal"><a href="#__codelineno-0-479">479</a></span>
<span class="normal"><a href="#__codelineno-0-480">480</a></span>
<span class="normal"><a href="#__codelineno-0-481">481</a></span>
<span class="normal"><a href="#__codelineno-0-482">482</a></span>
<span class="normal"><a href="#__codelineno-0-483">483</a></span>
<span class="normal"><a href="#__codelineno-0-484">484</a></span>
<span class="normal"><a href="#__codelineno-0-485">485</a></span>
<span class="normal"><a href="#__codelineno-0-486">486</a></span>
<span class="normal"><a href="#__codelineno-0-487">487</a></span>
<span class="normal"><a href="#__codelineno-0-488">488</a></span>
<span class="normal"><a href="#__codelineno-0-489">489</a></span>
<span class="normal"><a href="#__codelineno-0-490">490</a></span>
<span class="normal"><a href="#__codelineno-0-491">491</a></span>
<span class="normal"><a href="#__codelineno-0-492">492</a></span>
<span class="normal"><a href="#__codelineno-0-493">493</a></span>
<span class="normal"><a href="#__codelineno-0-494">494</a></span>
<span class="normal"><a href="#__codelineno-0-495">495</a></span>
<span class="normal"><a href="#__codelineno-0-496">496</a></span>
<span class="normal"><a href="#__codelineno-0-497">497</a></span>
<span class="normal"><a href="#__codelineno-0-498">498</a></span>
<span class="normal"><a href="#__codelineno-0-499">499</a></span>
<span class="normal"><a href="#__codelineno-0-500">500</a></span>
<span class="normal"><a href="#__codelineno-0-501">501</a></span>
<span class="normal"><a href="#__codelineno-0-502">502</a></span>
<span class="normal"><a href="#__codelineno-0-503">503</a></span>
<span class="normal"><a href="#__codelineno-0-504">504</a></span>
<span class="normal"><a href="#__codelineno-0-505">505</a></span>
<span class="normal"><a href="#__codelineno-0-506">506</a></span>
<span class="normal"><a href="#__codelineno-0-507">507</a></span>
<span class="normal"><a href="#__codelineno-0-508">508</a></span>
<span class="normal"><a href="#__codelineno-0-509">509</a></span>
<span class="normal"><a href="#__codelineno-0-510">510</a></span>
<span class="normal"><a href="#__codelineno-0-511">511</a></span>
<span class="normal"><a href="#__codelineno-0-512">512</a></span>
<span class="normal"><a href="#__codelineno-0-513">513</a></span>
<span class="normal"><a href="#__codelineno-0-514">514</a></span>
<span class="normal"><a href="#__codelineno-0-515">515</a></span>
<span class="normal"><a href="#__codelineno-0-516">516</a></span>
<span class="normal"><a href="#__codelineno-0-517">517</a></span>
<span class="normal"><a href="#__codelineno-0-518">518</a></span>
<span class="normal"><a href="#__codelineno-0-519">519</a></span>
<span class="normal"><a href="#__codelineno-0-520">520</a></span>
<span class="normal"><a href="#__codelineno-0-521">521</a></span>
<span class="normal"><a href="#__codelineno-0-522">522</a></span>
<span class="normal"><a href="#__codelineno-0-523">523</a></span>
<span class="normal"><a href="#__codelineno-0-524">524</a></span>
<span class="normal"><a href="#__codelineno-0-525">525</a></span>
<span class="normal"><a href="#__codelineno-0-526">526</a></span>
<span class="normal"><a href="#__codelineno-0-527">527</a></span>
<span class="normal"><a href="#__codelineno-0-528">528</a></span>
<span class="normal"><a href="#__codelineno-0-529">529</a></span>
<span class="normal"><a href="#__codelineno-0-530">530</a></span>
<span class="normal"><a href="#__codelineno-0-531">531</a></span>
<span class="normal"><a href="#__codelineno-0-532">532</a></span>
<span class="normal"><a href="#__codelineno-0-533">533</a></span>
<span class="normal"><a href="#__codelineno-0-534">534</a></span>
<span class="normal"><a href="#__codelineno-0-535">535</a></span>
<span class="normal"><a href="#__codelineno-0-536">536</a></span>
<span class="normal"><a href="#__codelineno-0-537">537</a></span>
<span class="normal"><a href="#__codelineno-0-538">538</a></span>
<span class="normal"><a href="#__codelineno-0-539">539</a></span>
<span class="normal"><a href="#__codelineno-0-540">540</a></span>
<span class="normal"><a href="#__codelineno-0-541">541</a></span>
<span class="normal"><a href="#__codelineno-0-542">542</a></span>
<span class="normal"><a href="#__codelineno-0-543">543</a></span>
<span class="normal"><a href="#__codelineno-0-544">544</a></span>
<span class="normal"><a href="#__codelineno-0-545">545</a></span>
<span class="normal"><a href="#__codelineno-0-546">546</a></span>
<span class="normal"><a href="#__codelineno-0-547">547</a></span>
<span class="normal"><a href="#__codelineno-0-548">548</a></span>
<span class="normal"><a href="#__codelineno-0-549">549</a></span>
<span class="normal"><a href="#__codelineno-0-550">550</a></span>
<span class="normal"><a href="#__codelineno-0-551">551</a></span>
<span class="normal"><a href="#__codelineno-0-552">552</a></span>
<span class="normal"><a href="#__codelineno-0-553">553</a></span>
<span class="normal"><a href="#__codelineno-0-554">554</a></span>
<span class="normal"><a href="#__codelineno-0-555">555</a></span>
<span class="normal"><a href="#__codelineno-0-556">556</a></span>
<span class="normal"><a href="#__codelineno-0-557">557</a></span>
<span class="normal"><a href="#__codelineno-0-558">558</a></span>
<span class="normal"><a href="#__codelineno-0-559">559</a></span>
<span class="normal"><a href="#__codelineno-0-560">560</a></span>
<span class="normal"><a href="#__codelineno-0-561">561</a></span>
<span class="normal"><a href="#__codelineno-0-562">562</a></span>
<span class="normal"><a href="#__codelineno-0-563">563</a></span>
<span class="normal"><a href="#__codelineno-0-564">564</a></span>
<span class="normal"><a href="#__codelineno-0-565">565</a></span>
<span class="normal"><a href="#__codelineno-0-566">566</a></span>
<span class="normal"><a href="#__codelineno-0-567">567</a></span>
<span class="normal"><a href="#__codelineno-0-568">568</a></span>
<span class="normal"><a href="#__codelineno-0-569">569</a></span>
<span class="normal"><a href="#__codelineno-0-570">570</a></span>
<span class="normal"><a href="#__codelineno-0-571">571</a></span>
<span class="normal"><a href="#__codelineno-0-572">572</a></span>
<span class="normal"><a href="#__codelineno-0-573">573</a></span>
<span class="normal"><a href="#__codelineno-0-574">574</a></span>
<span class="normal"><a href="#__codelineno-0-575">575</a></span>
<span class="normal"><a href="#__codelineno-0-576">576</a></span>
<span class="normal"><a href="#__codelineno-0-577">577</a></span>
<span class="normal"><a href="#__codelineno-0-578">578</a></span>
<span class="normal"><a href="#__codelineno-0-579">579</a></span>
<span class="normal"><a href="#__codelineno-0-580">580</a></span>
<span class="normal"><a href="#__codelineno-0-581">581</a></span>
<span class="normal"><a href="#__codelineno-0-582">582</a></span>
<span class="normal"><a href="#__codelineno-0-583">583</a></span>
<span class="normal"><a href="#__codelineno-0-584">584</a></span>
<span class="normal"><a href="#__codelineno-0-585">585</a></span>
<span class="normal"><a href="#__codelineno-0-586">586</a></span>
<span class="normal"><a href="#__codelineno-0-587">587</a></span>
<span class="normal"><a href="#__codelineno-0-588">588</a></span>
<span class="normal"><a href="#__codelineno-0-589">589</a></span>
<span class="normal"><a href="#__codelineno-0-590">590</a></span>
<span class="normal"><a href="#__codelineno-0-591">591</a></span>
<span class="normal"><a href="#__codelineno-0-592">592</a></span>
<span class="normal"><a href="#__codelineno-0-593">593</a></span>
<span class="normal"><a href="#__codelineno-0-594">594</a></span>
<span class="normal"><a href="#__codelineno-0-595">595</a></span>
<span class="normal"><a href="#__codelineno-0-596">596</a></span>
<span class="normal"><a href="#__codelineno-0-597">597</a></span>
<span class="normal"><a href="#__codelineno-0-598">598</a></span>
<span class="normal"><a href="#__codelineno-0-599">599</a></span>
<span class="normal"><a href="#__codelineno-0-600">600</a></span>
<span class="normal"><a href="#__codelineno-0-601">601</a></span>
<span class="normal"><a href="#__codelineno-0-602">602</a></span>
<span class="normal"><a href="#__codelineno-0-603">603</a></span>
<span class="normal"><a href="#__codelineno-0-604">604</a></span>
<span class="normal"><a href="#__codelineno-0-605">605</a></span>
<span class="normal"><a href="#__codelineno-0-606">606</a></span>
<span class="normal"><a href="#__codelineno-0-607">607</a></span>
<span class="normal"><a href="#__codelineno-0-608">608</a></span>
<span class="normal"><a href="#__codelineno-0-609">609</a></span>
<span class="normal"><a href="#__codelineno-0-610">610</a></span>
<span class="normal"><a href="#__codelineno-0-611">611</a></span>
<span class="normal"><a href="#__codelineno-0-612">612</a></span>
<span class="normal"><a href="#__codelineno-0-613">613</a></span>
<span class="normal"><a href="#__codelineno-0-614">614</a></span>
<span class="normal"><a href="#__codelineno-0-615">615</a></span>
<span class="normal"><a href="#__codelineno-0-616">616</a></span>
<span class="normal"><a href="#__codelineno-0-617">617</a></span>
<span class="normal"><a href="#__codelineno-0-618">618</a></span>
<span class="normal"><a href="#__codelineno-0-619">619</a></span>
<span class="normal"><a href="#__codelineno-0-620">620</a></span>
<span class="normal"><a href="#__codelineno-0-621">621</a></span>
<span class="normal"><a href="#__codelineno-0-622">622</a></span>
<span class="normal"><a href="#__codelineno-0-623">623</a></span>
<span class="normal"><a href="#__codelineno-0-624">624</a></span>
<span class="normal"><a href="#__codelineno-0-625">625</a></span>
<span class="normal"><a href="#__codelineno-0-626">626</a></span>
<span class="normal"><a href="#__codelineno-0-627">627</a></span>
<span class="normal"><a href="#__codelineno-0-628">628</a></span>
<span class="normal"><a href="#__codelineno-0-629">629</a></span>
<span class="normal"><a href="#__codelineno-0-630">630</a></span>
<span class="normal"><a href="#__codelineno-0-631">631</a></span>
<span class="normal"><a href="#__codelineno-0-632">632</a></span>
<span class="normal"><a href="#__codelineno-0-633">633</a></span>
<span class="normal"><a href="#__codelineno-0-634">634</a></span>
<span class="normal"><a href="#__codelineno-0-635">635</a></span>
<span class="normal"><a href="#__codelineno-0-636">636</a></span>
<span class="normal"><a href="#__codelineno-0-637">637</a></span>
<span class="normal"><a href="#__codelineno-0-638">638</a></span>
<span class="normal"><a href="#__codelineno-0-639">639</a></span>
<span class="normal"><a href="#__codelineno-0-640">640</a></span>
<span class="normal"><a href="#__codelineno-0-641">641</a></span>
<span class="normal"><a href="#__codelineno-0-642">642</a></span>
<span class="normal"><a href="#__codelineno-0-643">643</a></span>
<span class="normal"><a href="#__codelineno-0-644">644</a></span>
<span class="normal"><a href="#__codelineno-0-645">645</a></span>
<span class="normal"><a href="#__codelineno-0-646">646</a></span>
<span class="normal"><a href="#__codelineno-0-647">647</a></span>
<span class="normal"><a href="#__codelineno-0-648">648</a></span>
<span class="normal"><a href="#__codelineno-0-649">649</a></span>
<span class="normal"><a href="#__codelineno-0-650">650</a></span>
<span class="normal"><a href="#__codelineno-0-651">651</a></span>
<span class="normal"><a href="#__codelineno-0-652">652</a></span>
<span class="normal"><a href="#__codelineno-0-653">653</a></span>
<span class="normal"><a href="#__codelineno-0-654">654</a></span>
<span class="normal"><a href="#__codelineno-0-655">655</a></span>
<span class="normal"><a href="#__codelineno-0-656">656</a></span>
<span class="normal"><a href="#__codelineno-0-657">657</a></span>
<span class="normal"><a href="#__codelineno-0-658">658</a></span>
<span class="normal"><a href="#__codelineno-0-659">659</a></span>
<span class="normal"><a href="#__codelineno-0-660">660</a></span>
<span class="normal"><a href="#__codelineno-0-661">661</a></span>
<span class="normal"><a href="#__codelineno-0-662">662</a></span>
<span class="normal"><a href="#__codelineno-0-663">663</a></span>
<span class="normal"><a href="#__codelineno-0-664">664</a></span>
<span class="normal"><a href="#__codelineno-0-665">665</a></span>
<span class="normal"><a href="#__codelineno-0-666">666</a></span>
<span class="normal"><a href="#__codelineno-0-667">667</a></span>
<span class="normal"><a href="#__codelineno-0-668">668</a></span>
<span class="normal"><a href="#__codelineno-0-669">669</a></span>
<span class="normal"><a href="#__codelineno-0-670">670</a></span>
<span class="normal"><a href="#__codelineno-0-671">671</a></span>
<span class="normal"><a href="#__codelineno-0-672">672</a></span>
<span class="normal"><a href="#__codelineno-0-673">673</a></span>
<span class="normal"><a href="#__codelineno-0-674">674</a></span>
<span class="normal"><a href="#__codelineno-0-675">675</a></span>
<span class="normal"><a href="#__codelineno-0-676">676</a></span>
<span class="normal"><a href="#__codelineno-0-677">677</a></span>
<span class="normal"><a href="#__codelineno-0-678">678</a></span>
<span class="normal"><a href="#__codelineno-0-679">679</a></span>
<span class="normal"><a href="#__codelineno-0-680">680</a></span>
<span class="normal"><a href="#__codelineno-0-681">681</a></span>
<span class="normal"><a href="#__codelineno-0-682">682</a></span>
<span class="normal"><a href="#__codelineno-0-683">683</a></span>
<span class="normal"><a href="#__codelineno-0-684">684</a></span>
<span class="normal"><a href="#__codelineno-0-685">685</a></span>
<span class="normal"><a href="#__codelineno-0-686">686</a></span>
<span class="normal"><a href="#__codelineno-0-687">687</a></span>
<span class="normal"><a href="#__codelineno-0-688">688</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-20" name="__codelineno-0-20"></a><span class="k">class</span><span class="w"> </span><span class="nc">TimeSeriesFold</span><span class="p">(</span><span class="n">BaseFold</span><span class="p">):</span>
<a id="__codelineno-0-21" name="__codelineno-0-21"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Class to split time series data into train and test folds.</span>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a>
<a id="__codelineno-0-23" name="__codelineno-0-23"></a><span class="sd">    When used within a backtesting or hyperparameter search, the arguments</span>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a><span class="sd">    &#39;initial_train_size&#39;, &#39;window_size&#39; and &#39;differentiation&#39; are not required</span>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a><span class="sd">    as they are automatically set by the backtesting or hyperparameter search</span>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a><span class="sd">    functions.</span>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="sd">        steps: Number of observations used to be predicted in each fold.</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="sd">            This is also commonly referred to as the forecast horizon or test size.</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="sd">        initial_train_size: Number of observations used for initial training.</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="sd">            - If `None` or 0, the initial forecaster is not trained in the first fold.</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="sd">            - If an integer, the number of observations used for initial training.</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="sd">            - If a date string or pandas Timestamp, it is the last date included in</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="sd">              the initial training set.</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="sd">            Defaults to None.</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="sd">        fold_stride: Number of observations that the start of the test set</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a><span class="sd">            advances between consecutive folds.</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a><span class="sd">            - If `None`, it defaults to the same value as `steps`, meaning that folds</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a><span class="sd">              are placed back-to-back without overlap.</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a><span class="sd">            - If `fold_stride &lt; steps`, test sets overlap and multiple forecasts will</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a><span class="sd">              be generated for the same observations.</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="sd">            - If `fold_stride &gt; steps`, gaps are left between consecutive test sets.</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a><span class="sd">            Defaults to None.</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="sd">        window_size: Number of observations needed to generate the</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a><span class="sd">            autoregressive predictors. Defaults to None.</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a><span class="sd">        differentiation: Number of observations to use for differentiation.</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a><span class="sd">            This is used to extend the `last_window` as many observations as the</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="sd">            differentiation order. Defaults to None.</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="sd">        refit: Whether to refit the forecaster in each fold.</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a><span class="sd">            - If `True`, the forecaster is refitted in each fold.</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="sd">            - If `False`, the forecaster is trained only in the first fold.</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="sd">            - If an integer, the forecaster is trained in the first fold and then refitted</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="sd">              every `refit` folds.</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a><span class="sd">            Defaults to False.</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a><span class="sd">        fixed_train_size: Whether the training size is fixed or increases</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="sd">            in each fold. Defaults to True.</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a><span class="sd">        gap: Number of observations between the end of the training set</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a><span class="sd">            and the start of the test set. Defaults to 0.</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a><span class="sd">        skip_folds: Number of folds to skip.</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a><span class="sd">            - If an integer, every &#39;skip_folds&#39;-th is returned.</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a><span class="sd">            - If a list, the indexes of the folds to skip.</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a><span class="sd">            For example, if `skip_folds=3` and there are 10 folds, the returned folds are</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a><span class="sd">            0, 3, 6, and 9. If `skip_folds=[1, 2, 3]`, the returned folds are 0, 4, 5, 6, 7,</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a><span class="sd">            8, and 9. Defaults to None.</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="sd">        allow_incomplete_fold: Whether to allow the last fold to include</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="sd">            fewer observations than `steps`. If `False`, the last fold is excluded if it</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a><span class="sd">            is incomplete. Defaults to True.</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a><span class="sd">        return_all_indexes: Whether to return all indexes or only the</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="sd">            start and end indexes of each fold. Defaults to False.</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="sd">        verbose: Whether to print information about generated folds.</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a><span class="sd">            Defaults to True.</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="sd">    Attributes:</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a><span class="sd">        steps: Number of observations used to be predicted in each fold.</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a><span class="sd">        initial_train_size: Number of observations used for initial training.</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a><span class="sd">            If `None` or 0, the initial forecaster is not trained in the first fold.</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a><span class="sd">        fold_stride: Number of observations that the start of the test set</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a><span class="sd">            advances between consecutive folds.</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a><span class="sd">        overlapping_folds: Whether the folds overlap.</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a><span class="sd">        window_size: Number of observations needed to generate the</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a><span class="sd">            autoregressive predictors.</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a><span class="sd">        differentiation: Number of observations to use for differentiation.</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a><span class="sd">            This is used to extend the `last_window` as many observations as the</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a><span class="sd">            differentiation order.</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a><span class="sd">        refit: Whether to refit the forecaster in each fold.</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a><span class="sd">        fixed_train_size: Whether the training size is fixed or increases in each fold.</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a><span class="sd">        gap: Number of observations between the end of the training set and the</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a><span class="sd">            start of the test set.</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a><span class="sd">        skip_folds: Number of folds to skip.</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a><span class="sd">        allow_incomplete_fold: Whether to allow the last fold to include fewer</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a><span class="sd">            observations than `steps`.</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a><span class="sd">        return_all_indexes: Whether to return all indexes or only the start</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a><span class="sd">            and end indexes of each fold.</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a><span class="sd">        verbose: Whether to print information about generated folds.</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a><span class="sd">    Examples:</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a><span class="sd">        Basic usage with fixed train size:</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a><span class="sd">        &gt;&gt;&gt; import pandas as pd</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a><span class="sd">        &gt;&gt;&gt; import numpy as np</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a><span class="sd">        &gt;&gt;&gt; from spotforecast2.model_selection import TimeSeriesFold</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a><span class="sd">        &gt;&gt;&gt; # Create sample time series data</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a><span class="sd">        &gt;&gt;&gt; dates = pd.date_range(&#39;2020-01-01&#39;, periods=100, freq=&#39;D&#39;)</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a><span class="sd">        &gt;&gt;&gt; y = pd.Series(np.arange(100), index=dates)</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a><span class="sd">        &gt;&gt;&gt; # Create fold splitter</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a><span class="sd">        &gt;&gt;&gt; cv = TimeSeriesFold(</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a><span class="sd">        ...     steps=10,</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a><span class="sd">        ...     initial_train_size=50,</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a><span class="sd">        ...     refit=True,</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a><span class="sd">        ...     fixed_train_size=True</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a><span class="sd">        ... )</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a><span class="sd">        &gt;&gt;&gt; # Get folds</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a><span class="sd">        &gt;&gt;&gt; folds = cv.split(y)</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a><span class="sd">        &gt;&gt;&gt; print(f&quot;Number of folds: {len(folds)}&quot;)</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a><span class="sd">        Number of folds: 4</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a><span class="sd">        Overlapping folds with custom stride:</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a><span class="sd">        &gt;&gt;&gt; cv = TimeSeriesFold(</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a><span class="sd">        ...     steps=30,</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a><span class="sd">        ...     initial_train_size=50,</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a><span class="sd">        ...     fold_stride=7,</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a><span class="sd">        ...     fixed_train_size=False</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a><span class="sd">        ... )</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a><span class="sd">        &gt;&gt;&gt; folds = cv.split(y)</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a><span class="sd">        &gt;&gt;&gt; # First test fold covers [50, 80), second [57, 87), etc.</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a><span class="sd">        Return as pandas DataFrame:</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a><span class="sd">        &gt;&gt;&gt; cv = TimeSeriesFold(steps=10, initial_train_size=50)</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a><span class="sd">        &gt;&gt;&gt; folds_df = cv.split(y, as_pandas=True)</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a><span class="sd">        &gt;&gt;&gt; print(folds_df.columns.tolist())</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a><span class="sd">        [&#39;fold&#39;, &#39;train_start&#39;, &#39;train_end&#39;, &#39;last_window_start&#39;, &#39;last_window_end&#39;, &#39;test_start&#39;, &#39;test_end&#39;, &#39;test_start_with_gap&#39;, &#39;test_end_with_gap&#39;, &#39;fit_forecaster&#39;]</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a><span class="sd">        Skip folds for faster evaluation:</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a><span class="sd">        &gt;&gt;&gt; cv = TimeSeriesFold(</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a><span class="sd">        ...     steps=5,</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a><span class="sd">        ...     initial_train_size=50,</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a><span class="sd">        ...     skip_folds=2</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a><span class="sd">        ... )</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a><span class="sd">        &gt;&gt;&gt; folds = cv.split(y)</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a><span class="sd">        &gt;&gt;&gt; # Returns folds 0, 2, 4, 6, ...</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a><span class="sd">    Note:</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a><span class="sd">        Returned values are the positions of the observations and not the actual values of</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a><span class="sd">        the index, so they can be used to slice the data directly using iloc. For example,</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a><span class="sd">        if the input series is `X = [10, 11, 12, 13, 14, 15, 16, 17, 18, 19]`, the</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a><span class="sd">        `initial_train_size = 3`, `window_size = 2`, `steps = 4`, and `gap = 1`,</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a><span class="sd">        the output of the first fold will: [0, [0, 3], [1, 3], [3, 8], [4, 8], True].</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a><span class="sd">        The first element is the fold number, the first list `[0, 3]` indicates that</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a><span class="sd">        the training set goes from the first to the third observation. The second</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a><span class="sd">        list `[1, 3]` indicates that the last window seen by the forecaster during</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a><span class="sd">        training goes from the second to the third observation. The third list `[3, 8]`</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a><span class="sd">        indicates that the test set goes from the fourth to the eighth observation.</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a><span class="sd">        The fourth list `[4, 8]` indicates that the test set including the gap goes</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a><span class="sd">        from the fifth to the eighth observation. The boolean `False` indicates that</span>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a><span class="sd">        the forecaster should not be trained in this fold.</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a><span class="sd">        Following the python convention, the start index is inclusive and the end index is</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a><span class="sd">        exclusive. This means that the last index is not included in the slice.</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a><span class="sd">        As an example, with `initial_train_size=50`, `steps=30`, and `fold_stride=7`,</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a><span class="sd">        the first test fold will cover observations [50, 80), the second fold [57, 87),</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a><span class="sd">        and the third fold [64, 94). This configuration produces multiple forecasts</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a><span class="sd">        for the same observations, which is often desirable in rolling-origin</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a><span class="sd">        evaluation.</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a>        <span class="n">steps</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a>        <span class="n">initial_train_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a>        <span class="n">fold_stride</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a>        <span class="n">window_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a>        <span class="n">differentiation</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a>        <span class="n">refit</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a>        <span class="n">fixed_train_size</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a>        <span class="n">gap</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a>        <span class="n">skip_folds</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a>        <span class="n">allow_incomplete_fold</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a>        <span class="n">return_all_indexes</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a>        <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a>            <span class="n">steps</span><span class="o">=</span><span class="n">steps</span><span class="p">,</span>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a>            <span class="n">initial_train_size</span><span class="o">=</span><span class="n">initial_train_size</span><span class="p">,</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a>            <span class="n">fold_stride</span><span class="o">=</span><span class="n">fold_stride</span><span class="p">,</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a>            <span class="n">window_size</span><span class="o">=</span><span class="n">window_size</span><span class="p">,</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a>            <span class="n">differentiation</span><span class="o">=</span><span class="n">differentiation</span><span class="p">,</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a>            <span class="n">refit</span><span class="o">=</span><span class="n">refit</span><span class="p">,</span>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a>            <span class="n">fixed_train_size</span><span class="o">=</span><span class="n">fixed_train_size</span><span class="p">,</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a>            <span class="n">gap</span><span class="o">=</span><span class="n">gap</span><span class="p">,</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a>            <span class="n">skip_folds</span><span class="o">=</span><span class="n">skip_folds</span><span class="p">,</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a>            <span class="n">allow_incomplete_fold</span><span class="o">=</span><span class="n">allow_incomplete_fold</span><span class="p">,</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a>            <span class="n">return_all_indexes</span><span class="o">=</span><span class="n">return_all_indexes</span><span class="p">,</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a>            <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a>        <span class="p">)</span>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">steps</span> <span class="o">=</span> <span class="n">steps</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fold_stride</span> <span class="o">=</span> <span class="n">fold_stride</span> <span class="k">if</span> <span class="n">fold_stride</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">steps</span>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">overlapping_folds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fold_stride</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">steps</span>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">refit</span> <span class="o">=</span> <span class="n">refit</span>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fixed_train_size</span> <span class="o">=</span> <span class="n">fixed_train_size</span>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gap</span> <span class="o">=</span> <span class="n">gap</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">skip_folds</span> <span class="o">=</span> <span class="n">skip_folds</span>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">allow_incomplete_fold</span> <span class="o">=</span> <span class="n">allow_incomplete_fold</span>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Information displayed when printed.</span>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a><span class="sd">            String representation of the TimeSeriesFold object.</span>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a>        <span class="n">info</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a>            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;=&#39;</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a>            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a>            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;=&#39;</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a>            <span class="sa">f</span><span class="s2">&quot;Initial train size    = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_train_size</span><span class="si">}</span><span class="s2">,</span><span class="se">\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a>            <span class="sa">f</span><span class="s2">&quot;Steps                 = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">steps</span><span class="si">}</span><span class="s2">,</span><span class="se">\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a>            <span class="sa">f</span><span class="s2">&quot;Fold stride           = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">fold_stride</span><span class="si">}</span><span class="s2">,</span><span class="se">\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a>            <span class="sa">f</span><span class="s2">&quot;Overlapping folds     = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">overlapping_folds</span><span class="si">}</span><span class="s2">,</span><span class="se">\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a>            <span class="sa">f</span><span class="s2">&quot;Window size           = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">window_size</span><span class="si">}</span><span class="s2">,</span><span class="se">\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a>            <span class="sa">f</span><span class="s2">&quot;Differentiation       = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">differentiation</span><span class="si">}</span><span class="s2">,</span><span class="se">\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a>            <span class="sa">f</span><span class="s2">&quot;Refit                 = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">refit</span><span class="si">}</span><span class="s2">,</span><span class="se">\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a>            <span class="sa">f</span><span class="s2">&quot;Fixed train size      = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">fixed_train_size</span><span class="si">}</span><span class="s2">,</span><span class="se">\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a>            <span class="sa">f</span><span class="s2">&quot;Gap                   = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">gap</span><span class="si">}</span><span class="s2">,</span><span class="se">\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a>            <span class="sa">f</span><span class="s2">&quot;Skip folds            = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">skip_folds</span><span class="si">}</span><span class="s2">,</span><span class="se">\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a>            <span class="sa">f</span><span class="s2">&quot;Allow incomplete fold = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">allow_incomplete_fold</span><span class="si">}</span><span class="s2">,</span><span class="se">\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a>            <span class="sa">f</span><span class="s2">&quot;Return all indexes    = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">return_all_indexes</span><span class="si">}</span><span class="s2">,</span><span class="se">\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a>            <span class="sa">f</span><span class="s2">&quot;Verbose               = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a>        <span class="p">)</span>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a>        <span class="k">return</span> <span class="n">info</span>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_repr_html_</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;HTML representation of the object.</span>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a><span class="sd">        The &quot;General Information&quot; section is expanded by default.</span>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a><span class="sd">            HTML string representation for Jupyter notebooks.</span>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a>        <span class="n">style</span><span class="p">,</span> <span class="n">unique_id</span> <span class="o">=</span> <span class="n">get_style_repr_html</span><span class="p">()</span>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a>        <span class="n">content</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a><span class="s2">        &lt;div class=&quot;container-</span><span class="si">{</span><span class="n">unique_id</span><span class="si">}</span><span class="s2">&quot;&gt;</span>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a><span class="s2">            &lt;p style=&quot;font-size: 1.5em; font-weight: bold; margin-block-start: 0.83em; margin-block-end: 0.83em;&quot;&gt;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&lt;/p&gt;</span>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a><span class="s2">            &lt;details open&gt;</span>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a><span class="s2">                &lt;summary&gt;General Information&lt;/summary&gt;</span>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a><span class="s2">                &lt;ul&gt;</span>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a><span class="s2">                    &lt;li&gt;&lt;strong&gt;Initial train size:&lt;/strong&gt; </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_train_size</span><span class="si">}</span><span class="s2">&lt;/li&gt;</span>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a><span class="s2">                    &lt;li&gt;&lt;strong&gt;Steps:&lt;/strong&gt; </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">steps</span><span class="si">}</span><span class="s2">&lt;/li&gt;</span>
<a id="__codelineno-0-262" name="__codelineno-0-262"></a><span class="s2">                    &lt;li&gt;&lt;strong&gt;Fold stride:&lt;/strong&gt; </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">fold_stride</span><span class="si">}</span><span class="s2">&lt;/li&gt;</span>
<a id="__codelineno-0-263" name="__codelineno-0-263"></a><span class="s2">                    &lt;li&gt;&lt;strong&gt;Overlapping folds:&lt;/strong&gt; </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">overlapping_folds</span><span class="si">}</span><span class="s2">&lt;/li&gt;</span>
<a id="__codelineno-0-264" name="__codelineno-0-264"></a><span class="s2">                    &lt;li&gt;&lt;strong&gt;Window size:&lt;/strong&gt; </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">window_size</span><span class="si">}</span><span class="s2">&lt;/li&gt;</span>
<a id="__codelineno-0-265" name="__codelineno-0-265"></a><span class="s2">                    &lt;li&gt;&lt;strong&gt;Differentiation:&lt;/strong&gt; </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">differentiation</span><span class="si">}</span><span class="s2">&lt;/li&gt;</span>
<a id="__codelineno-0-266" name="__codelineno-0-266"></a><span class="s2">                    &lt;li&gt;&lt;strong&gt;Refit:&lt;/strong&gt; </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">refit</span><span class="si">}</span><span class="s2">&lt;/li&gt;</span>
<a id="__codelineno-0-267" name="__codelineno-0-267"></a><span class="s2">                    &lt;li&gt;&lt;strong&gt;Fixed train size:&lt;/strong&gt; </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">fixed_train_size</span><span class="si">}</span><span class="s2">&lt;/li&gt;</span>
<a id="__codelineno-0-268" name="__codelineno-0-268"></a><span class="s2">                    &lt;li&gt;&lt;strong&gt;Gap:&lt;/strong&gt; </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">gap</span><span class="si">}</span><span class="s2">&lt;/li&gt;</span>
<a id="__codelineno-0-269" name="__codelineno-0-269"></a><span class="s2">                    &lt;li&gt;&lt;strong&gt;Skip folds:&lt;/strong&gt; </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">skip_folds</span><span class="si">}</span><span class="s2">&lt;/li&gt;</span>
<a id="__codelineno-0-270" name="__codelineno-0-270"></a><span class="s2">                    &lt;li&gt;&lt;strong&gt;Allow incomplete fold:&lt;/strong&gt; </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">allow_incomplete_fold</span><span class="si">}</span><span class="s2">&lt;/li&gt;</span>
<a id="__codelineno-0-271" name="__codelineno-0-271"></a><span class="s2">                    &lt;li&gt;&lt;strong&gt;Return all indexes:&lt;/strong&gt; </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">return_all_indexes</span><span class="si">}</span><span class="s2">&lt;/li&gt;</span>
<a id="__codelineno-0-272" name="__codelineno-0-272"></a><span class="s2">                &lt;/ul&gt;</span>
<a id="__codelineno-0-273" name="__codelineno-0-273"></a><span class="s2">            &lt;/details&gt;</span>
<a id="__codelineno-0-274" name="__codelineno-0-274"></a><span class="s2">        &lt;/div&gt;</span>
<a id="__codelineno-0-275" name="__codelineno-0-275"></a><span class="s2">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-276" name="__codelineno-0-276"></a>
<a id="__codelineno-0-277" name="__codelineno-0-277"></a>        <span class="k">return</span> <span class="n">style</span> <span class="o">+</span> <span class="n">content</span>
<a id="__codelineno-0-278" name="__codelineno-0-278"></a>
<a id="__codelineno-0-279" name="__codelineno-0-279"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">split</span><span class="p">(</span>
<a id="__codelineno-0-280" name="__codelineno-0-280"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-281" name="__codelineno-0-281"></a>        <span class="n">X</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span> <span class="o">|</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">|</span> <span class="n">pd</span><span class="o">.</span><span class="n">Index</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span> <span class="o">|</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">],</span>
<a id="__codelineno-0-282" name="__codelineno-0-282"></a>        <span class="n">as_pandas</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-283" name="__codelineno-0-283"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span> <span class="o">|</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<a id="__codelineno-0-284" name="__codelineno-0-284"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Split the time series data into train and test folds.</span>
<a id="__codelineno-0-285" name="__codelineno-0-285"></a>
<a id="__codelineno-0-286" name="__codelineno-0-286"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-287" name="__codelineno-0-287"></a><span class="sd">            X: Time series data or index to split. Can be a pandas Series, DataFrame,</span>
<a id="__codelineno-0-288" name="__codelineno-0-288"></a><span class="sd">                Index, or a dictionary of Series/DataFrames.</span>
<a id="__codelineno-0-289" name="__codelineno-0-289"></a><span class="sd">            as_pandas: If True, the folds are returned as a DataFrame. This is useful</span>
<a id="__codelineno-0-290" name="__codelineno-0-290"></a><span class="sd">                to visualize the folds in a more interpretable way. Defaults to False.</span>
<a id="__codelineno-0-291" name="__codelineno-0-291"></a>
<a id="__codelineno-0-292" name="__codelineno-0-292"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-293" name="__codelineno-0-293"></a><span class="sd">            A list of lists containing the indices (position) for each fold, or a</span>
<a id="__codelineno-0-294" name="__codelineno-0-294"></a><span class="sd">            DataFrame if `as_pandas=True`. Each list contains 4 lists and a boolean</span>
<a id="__codelineno-0-295" name="__codelineno-0-295"></a><span class="sd">            with the following information:</span>
<a id="__codelineno-0-296" name="__codelineno-0-296"></a>
<a id="__codelineno-0-297" name="__codelineno-0-297"></a><span class="sd">            - **fold**: fold number.</span>
<a id="__codelineno-0-298" name="__codelineno-0-298"></a><span class="sd">            - **[train_start, train_end]**: list with the start and end positions of</span>
<a id="__codelineno-0-299" name="__codelineno-0-299"></a><span class="sd">                    the training set.</span>
<a id="__codelineno-0-300" name="__codelineno-0-300"></a><span class="sd">            - **[last_window_start, last_window_end]**: list with the start and end</span>
<a id="__codelineno-0-301" name="__codelineno-0-301"></a><span class="sd">                    positions of the last window seen by the forecaster during training.</span>
<a id="__codelineno-0-302" name="__codelineno-0-302"></a><span class="sd">                    The last window is used to generate the lags use as predictors. If</span>
<a id="__codelineno-0-303" name="__codelineno-0-303"></a><span class="sd">                    `differentiation` is included, the interval is extended as many</span>
<a id="__codelineno-0-304" name="__codelineno-0-304"></a><span class="sd">                    observations as the differentiation order. If the argument `window_size`</span>
<a id="__codelineno-0-305" name="__codelineno-0-305"></a><span class="sd">                    is `None`, this list is empty.</span>
<a id="__codelineno-0-306" name="__codelineno-0-306"></a><span class="sd">            - **[test_start, test_end]**: list with the start and end positions of</span>
<a id="__codelineno-0-307" name="__codelineno-0-307"></a><span class="sd">                    the test set. These are the observations used to evaluate the forecaster.</span>
<a id="__codelineno-0-308" name="__codelineno-0-308"></a><span class="sd">            - **[test_start_with_gap, test_end_with_gap]**: list with the start and</span>
<a id="__codelineno-0-309" name="__codelineno-0-309"></a><span class="sd">                    end positions of the test set including the gap. The gap is the number</span>
<a id="__codelineno-0-310" name="__codelineno-0-310"></a><span class="sd">                    of observations between the end of the training set and the start of</span>
<a id="__codelineno-0-311" name="__codelineno-0-311"></a><span class="sd">                    the test set.</span>
<a id="__codelineno-0-312" name="__codelineno-0-312"></a><span class="sd">            - **fit_forecaster**: boolean indicating whether the forecaster should be</span>
<a id="__codelineno-0-313" name="__codelineno-0-313"></a><span class="sd">                    fitted in this fold.</span>
<a id="__codelineno-0-314" name="__codelineno-0-314"></a>
<a id="__codelineno-0-315" name="__codelineno-0-315"></a><span class="sd">        Note:</span>
<a id="__codelineno-0-316" name="__codelineno-0-316"></a><span class="sd">            The returned values are the positions of the observations and not the</span>
<a id="__codelineno-0-317" name="__codelineno-0-317"></a><span class="sd">            actual values of the index, so they can be used to slice the data directly</span>
<a id="__codelineno-0-318" name="__codelineno-0-318"></a><span class="sd">            using iloc.</span>
<a id="__codelineno-0-319" name="__codelineno-0-319"></a>
<a id="__codelineno-0-320" name="__codelineno-0-320"></a><span class="sd">            If `as_pandas` is `True`, the folds are returned as a DataFrame with the</span>
<a id="__codelineno-0-321" name="__codelineno-0-321"></a><span class="sd">            following columns: &#39;fold&#39;, &#39;train_start&#39;, &#39;train_end&#39;, &#39;last_window_start&#39;,</span>
<a id="__codelineno-0-322" name="__codelineno-0-322"></a><span class="sd">            &#39;last_window_end&#39;, &#39;test_start&#39;, &#39;test_end&#39;, &#39;test_start_with_gap&#39;,</span>
<a id="__codelineno-0-323" name="__codelineno-0-323"></a><span class="sd">            &#39;test_end_with_gap&#39;, &#39;fit_forecaster&#39;.</span>
<a id="__codelineno-0-324" name="__codelineno-0-324"></a>
<a id="__codelineno-0-325" name="__codelineno-0-325"></a><span class="sd">            Following the python convention, the start index is inclusive and the end</span>
<a id="__codelineno-0-326" name="__codelineno-0-326"></a><span class="sd">            index is exclusive. This means that the last index is not included in the</span>
<a id="__codelineno-0-327" name="__codelineno-0-327"></a><span class="sd">            slice.</span>
<a id="__codelineno-0-328" name="__codelineno-0-328"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-329" name="__codelineno-0-329"></a>
<a id="__codelineno-0-330" name="__codelineno-0-330"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Index</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)):</span>
<a id="__codelineno-0-331" name="__codelineno-0-331"></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
<a id="__codelineno-0-332" name="__codelineno-0-332"></a>                <span class="sa">f</span><span class="s2">&quot;X must be a pandas Series, DataFrame, Index or a dictionary. &quot;</span>
<a id="__codelineno-0-333" name="__codelineno-0-333"></a>                <span class="sa">f</span><span class="s2">&quot;Got </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">X</span><span class="p">)</span><span class="si">}</span><span class="s2">.&quot;</span>
<a id="__codelineno-0-334" name="__codelineno-0-334"></a>            <span class="p">)</span>
<a id="__codelineno-0-335" name="__codelineno-0-335"></a>
<a id="__codelineno-0-336" name="__codelineno-0-336"></a>        <span class="n">window_size_as_date_offset</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span>
<a id="__codelineno-0-337" name="__codelineno-0-337"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">window_size</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">tseries</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">DateOffset</span>
<a id="__codelineno-0-338" name="__codelineno-0-338"></a>        <span class="p">)</span>
<a id="__codelineno-0-339" name="__codelineno-0-339"></a>        <span class="k">if</span> <span class="n">window_size_as_date_offset</span><span class="p">:</span>
<a id="__codelineno-0-340" name="__codelineno-0-340"></a>            <span class="c1"># Calculate the window_size in steps. This is not a exact calculation</span>
<a id="__codelineno-0-341" name="__codelineno-0-341"></a>            <span class="c1"># because the offset follows the calendar rules and the distance between</span>
<a id="__codelineno-0-342" name="__codelineno-0-342"></a>            <span class="c1"># two dates may not be constant.</span>
<a id="__codelineno-0-343" name="__codelineno-0-343"></a>            <span class="n">first_valid_index</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_size</span>
<a id="__codelineno-0-344" name="__codelineno-0-344"></a>            <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-345" name="__codelineno-0-345"></a>                <span class="n">window_size_idx_start</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_loc</span><span class="p">(</span><span class="n">first_valid_index</span><span class="p">)</span>
<a id="__codelineno-0-346" name="__codelineno-0-346"></a>                <span class="n">window_size_idx_end</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_loc</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<a id="__codelineno-0-347" name="__codelineno-0-347"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">window_size</span> <span class="o">=</span> <span class="n">window_size_idx_end</span> <span class="o">-</span> <span class="n">window_size_idx_start</span>
<a id="__codelineno-0-348" name="__codelineno-0-348"></a>            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
<a id="__codelineno-0-349" name="__codelineno-0-349"></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-350" name="__codelineno-0-350"></a>                    <span class="sa">f</span><span class="s2">&quot;The length of `y` (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)</span><span class="si">}</span><span class="s2">), must be greater than or equal &quot;</span>
<a id="__codelineno-0-351" name="__codelineno-0-351"></a>                    <span class="sa">f</span><span class="s2">&quot;to the window size (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">window_size</span><span class="si">}</span><span class="s2">). This is because  &quot;</span>
<a id="__codelineno-0-352" name="__codelineno-0-352"></a>                    <span class="sa">f</span><span class="s2">&quot;the offset (forecaster.offset) is larger than the available &quot;</span>
<a id="__codelineno-0-353" name="__codelineno-0-353"></a>                    <span class="sa">f</span><span class="s2">&quot;data. Try to decrease the size of the offset (forecaster.offset), &quot;</span>
<a id="__codelineno-0-354" name="__codelineno-0-354"></a>                    <span class="sa">f</span><span class="s2">&quot;the number of `n_offsets` (forecaster.n_offsets) or increase the &quot;</span>
<a id="__codelineno-0-355" name="__codelineno-0-355"></a>                    <span class="sa">f</span><span class="s2">&quot;size of `y`.&quot;</span>
<a id="__codelineno-0-356" name="__codelineno-0-356"></a>                <span class="p">)</span>
<a id="__codelineno-0-357" name="__codelineno-0-357"></a>
<a id="__codelineno-0-358" name="__codelineno-0-358"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_train_size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-359" name="__codelineno-0-359"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-360" name="__codelineno-0-360"></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-361" name="__codelineno-0-361"></a>                    <span class="s2">&quot;To use split method when `initial_train_size` is None, &quot;</span>
<a id="__codelineno-0-362" name="__codelineno-0-362"></a>                    <span class="s2">&quot;`window_size` must be an integer greater than 0. &quot;</span>
<a id="__codelineno-0-363" name="__codelineno-0-363"></a>                    <span class="s2">&quot;Although no initial training is done and all data is used to &quot;</span>
<a id="__codelineno-0-364" name="__codelineno-0-364"></a>                    <span class="s2">&quot;evaluate the model, the first `window_size` observations are &quot;</span>
<a id="__codelineno-0-365" name="__codelineno-0-365"></a>                    <span class="s2">&quot;needed to create the initial predictors. Got `window_size` = None.&quot;</span>
<a id="__codelineno-0-366" name="__codelineno-0-366"></a>                <span class="p">)</span>
<a id="__codelineno-0-367" name="__codelineno-0-367"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">refit</span><span class="p">:</span>
<a id="__codelineno-0-368" name="__codelineno-0-368"></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-369" name="__codelineno-0-369"></a>                    <span class="s2">&quot;`refit` is only allowed when `initial_train_size` is not `None`. &quot;</span>
<a id="__codelineno-0-370" name="__codelineno-0-370"></a>                    <span class="s2">&quot;Set `refit` to `False` if you want to use `initial_train_size = None`.&quot;</span>
<a id="__codelineno-0-371" name="__codelineno-0-371"></a>                <span class="p">)</span>
<a id="__codelineno-0-372" name="__codelineno-0-372"></a>            <span class="n">externally_fitted</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-373" name="__codelineno-0-373"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">initial_train_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_size</span>  <span class="c1"># Reset to None later</span>
<a id="__codelineno-0-374" name="__codelineno-0-374"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-375" name="__codelineno-0-375"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-376" name="__codelineno-0-376"></a>                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
<a id="__codelineno-0-377" name="__codelineno-0-377"></a>                    <span class="s2">&quot;Last window cannot be calculated because `window_size` is None.&quot;</span><span class="p">,</span>
<a id="__codelineno-0-378" name="__codelineno-0-378"></a>                    <span class="n">IgnoredArgumentWarning</span><span class="p">,</span>
<a id="__codelineno-0-379" name="__codelineno-0-379"></a>                <span class="p">)</span>
<a id="__codelineno-0-380" name="__codelineno-0-380"></a>            <span class="n">externally_fitted</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-381" name="__codelineno-0-381"></a>
<a id="__codelineno-0-382" name="__codelineno-0-382"></a>        <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_index</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<a id="__codelineno-0-383" name="__codelineno-0-383"></a>        <span class="n">idx</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">index</span><span class="p">))</span>
<a id="__codelineno-0-384" name="__codelineno-0-384"></a>        <span class="n">folds</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-385" name="__codelineno-0-385"></a>        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-386" name="__codelineno-0-386"></a>
<a id="__codelineno-0-387" name="__codelineno-0-387"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">initial_train_size</span> <span class="o">=</span> <span class="n">date_to_index_position</span><span class="p">(</span>
<a id="__codelineno-0-388" name="__codelineno-0-388"></a>            <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">,</span>
<a id="__codelineno-0-389" name="__codelineno-0-389"></a>            <span class="n">date_input</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_train_size</span><span class="p">,</span>
<a id="__codelineno-0-390" name="__codelineno-0-390"></a>            <span class="n">method</span><span class="o">=</span><span class="s2">&quot;validation&quot;</span><span class="p">,</span>
<a id="__codelineno-0-391" name="__codelineno-0-391"></a>            <span class="n">date_literal</span><span class="o">=</span><span class="s2">&quot;initial_train_size&quot;</span><span class="p">,</span>
<a id="__codelineno-0-392" name="__codelineno-0-392"></a>        <span class="p">)</span>
<a id="__codelineno-0-393" name="__codelineno-0-393"></a>
<a id="__codelineno-0-394" name="__codelineno-0-394"></a>        <span class="k">if</span> <span class="n">window_size_as_date_offset</span><span class="p">:</span>
<a id="__codelineno-0-395" name="__codelineno-0-395"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_train_size</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-396" name="__codelineno-0-396"></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_train_size</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_size</span><span class="p">:</span>
<a id="__codelineno-0-397" name="__codelineno-0-397"></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-398" name="__codelineno-0-398"></a>                        <span class="sa">f</span><span class="s2">&quot;If `initial_train_size` is an integer, it must be greater than &quot;</span>
<a id="__codelineno-0-399" name="__codelineno-0-399"></a>                        <span class="sa">f</span><span class="s2">&quot;the `window_size` of the forecaster (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">window_size</span><span class="si">}</span><span class="s2">) &quot;</span>
<a id="__codelineno-0-400" name="__codelineno-0-400"></a>                        <span class="sa">f</span><span class="s2">&quot;and smaller than the length of the series (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)</span><span class="si">}</span><span class="s2">). If &quot;</span>
<a id="__codelineno-0-401" name="__codelineno-0-401"></a>                        <span class="sa">f</span><span class="s2">&quot;it is a date, it must be within this range of the index.&quot;</span>
<a id="__codelineno-0-402" name="__codelineno-0-402"></a>                    <span class="p">)</span>
<a id="__codelineno-0-403" name="__codelineno-0-403"></a>
<a id="__codelineno-0-404" name="__codelineno-0-404"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">allow_incomplete_fold</span><span class="p">:</span>
<a id="__codelineno-0-405" name="__codelineno-0-405"></a>            <span class="c1"># At least one observation after the gap to allow incomplete fold</span>
<a id="__codelineno-0-406" name="__codelineno-0-406"></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">index</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_train_size</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">gap</span><span class="p">:</span>
<a id="__codelineno-0-407" name="__codelineno-0-407"></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-408" name="__codelineno-0-408"></a>                    <span class="sa">f</span><span class="s2">&quot;The time series must have more than `initial_train_size + gap` &quot;</span>
<a id="__codelineno-0-409" name="__codelineno-0-409"></a>                    <span class="sa">f</span><span class="s2">&quot;observations to create at least one fold.</span><span class="se">\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-410" name="__codelineno-0-410"></a>                    <span class="sa">f</span><span class="s2">&quot;    Time series length: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">index</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-411" name="__codelineno-0-411"></a>                    <span class="sa">f</span><span class="s2">&quot;    Required &gt; </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_train_size</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">gap</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-412" name="__codelineno-0-412"></a>                    <span class="sa">f</span><span class="s2">&quot;    initial_train_size: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_train_size</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-413" name="__codelineno-0-413"></a>                    <span class="sa">f</span><span class="s2">&quot;    gap: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">gap</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-414" name="__codelineno-0-414"></a>                <span class="p">)</span>
<a id="__codelineno-0-415" name="__codelineno-0-415"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-416" name="__codelineno-0-416"></a>            <span class="c1"># At least one complete fold</span>
<a id="__codelineno-0-417" name="__codelineno-0-417"></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">index</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_train_size</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">gap</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">steps</span><span class="p">:</span>
<a id="__codelineno-0-418" name="__codelineno-0-418"></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-419" name="__codelineno-0-419"></a>                    <span class="sa">f</span><span class="s2">&quot;The time series must have at least `initial_train_size + gap + steps` &quot;</span>
<a id="__codelineno-0-420" name="__codelineno-0-420"></a>                    <span class="sa">f</span><span class="s2">&quot;observations to create a minimum of one complete fold &quot;</span>
<a id="__codelineno-0-421" name="__codelineno-0-421"></a>                    <span class="sa">f</span><span class="s2">&quot;(allow_incomplete_fold=False).</span><span class="se">\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-422" name="__codelineno-0-422"></a>                    <span class="sa">f</span><span class="s2">&quot;    Time series length: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">index</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-423" name="__codelineno-0-423"></a>                    <span class="sa">f</span><span class="s2">&quot;    Required &gt;= </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_train_size</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">gap</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">steps</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-424" name="__codelineno-0-424"></a>                    <span class="sa">f</span><span class="s2">&quot;    initial_train_size: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_train_size</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-425" name="__codelineno-0-425"></a>                    <span class="sa">f</span><span class="s2">&quot;    gap: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">gap</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-426" name="__codelineno-0-426"></a>                    <span class="sa">f</span><span class="s2">&quot;    steps: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">steps</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-427" name="__codelineno-0-427"></a>                <span class="p">)</span>
<a id="__codelineno-0-428" name="__codelineno-0-428"></a>
<a id="__codelineno-0-429" name="__codelineno-0-429"></a>        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_train_size</span> <span class="o">+</span> <span class="p">(</span><span class="n">i</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">fold_stride</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">gap</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">index</span><span class="p">):</span>
<a id="__codelineno-0-430" name="__codelineno-0-430"></a>
<a id="__codelineno-0-431" name="__codelineno-0-431"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">refit</span><span class="p">:</span>
<a id="__codelineno-0-432" name="__codelineno-0-432"></a>                <span class="c1"># NOTE: If `fixed_train_size` the train size doesn&#39;t increase but</span>
<a id="__codelineno-0-433" name="__codelineno-0-433"></a>                <span class="c1"># moves by `fold_stride` positions in each iteration. If `False`,</span>
<a id="__codelineno-0-434" name="__codelineno-0-434"></a>                <span class="c1"># the train size increases by `fold_stride` in each iteration.</span>
<a id="__codelineno-0-435" name="__codelineno-0-435"></a>                <span class="n">train_iloc_start</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-436" name="__codelineno-0-436"></a>                    <span class="n">i</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fold_stride</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fixed_train_size</span> <span class="k">else</span> <span class="mi">0</span>
<a id="__codelineno-0-437" name="__codelineno-0-437"></a>                <span class="p">)</span>
<a id="__codelineno-0-438" name="__codelineno-0-438"></a>                <span class="n">train_iloc_end</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_train_size</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fold_stride</span><span class="p">)</span>
<a id="__codelineno-0-439" name="__codelineno-0-439"></a>                <span class="n">test_iloc_start</span> <span class="o">=</span> <span class="n">train_iloc_end</span>
<a id="__codelineno-0-440" name="__codelineno-0-440"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-441" name="__codelineno-0-441"></a>                <span class="c1"># NOTE: The train size doesn&#39;t increase and doesn&#39;t move.</span>
<a id="__codelineno-0-442" name="__codelineno-0-442"></a>                <span class="n">train_iloc_start</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-443" name="__codelineno-0-443"></a>                <span class="n">train_iloc_end</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_train_size</span>
<a id="__codelineno-0-444" name="__codelineno-0-444"></a>                <span class="n">test_iloc_start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_train_size</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fold_stride</span><span class="p">)</span>
<a id="__codelineno-0-445" name="__codelineno-0-445"></a>
<a id="__codelineno-0-446" name="__codelineno-0-446"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_size</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-447" name="__codelineno-0-447"></a>                <span class="n">last_window_iloc_start</span> <span class="o">=</span> <span class="n">test_iloc_start</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_size</span>
<a id="__codelineno-0-448" name="__codelineno-0-448"></a>
<a id="__codelineno-0-449" name="__codelineno-0-449"></a>            <span class="n">test_iloc_end</span> <span class="o">=</span> <span class="n">test_iloc_start</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">gap</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">steps</span>
<a id="__codelineno-0-450" name="__codelineno-0-450"></a>
<a id="__codelineno-0-451" name="__codelineno-0-451"></a>            <span class="n">partitions</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-452" name="__codelineno-0-452"></a>                <span class="n">idx</span><span class="p">[</span><span class="n">train_iloc_start</span><span class="p">:</span><span class="n">train_iloc_end</span><span class="p">],</span>
<a id="__codelineno-0-453" name="__codelineno-0-453"></a>                <span class="p">(</span>
<a id="__codelineno-0-454" name="__codelineno-0-454"></a>                    <span class="n">idx</span><span class="p">[</span><span class="n">last_window_iloc_start</span><span class="p">:</span><span class="n">test_iloc_start</span><span class="p">]</span>
<a id="__codelineno-0-455" name="__codelineno-0-455"></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_size</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
<a id="__codelineno-0-456" name="__codelineno-0-456"></a>                    <span class="k">else</span> <span class="p">[]</span>
<a id="__codelineno-0-457" name="__codelineno-0-457"></a>                <span class="p">),</span>
<a id="__codelineno-0-458" name="__codelineno-0-458"></a>                <span class="n">idx</span><span class="p">[</span><span class="n">test_iloc_start</span><span class="p">:</span><span class="n">test_iloc_end</span><span class="p">],</span>
<a id="__codelineno-0-459" name="__codelineno-0-459"></a>                <span class="n">idx</span><span class="p">[</span><span class="n">test_iloc_start</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">gap</span> <span class="p">:</span> <span class="n">test_iloc_end</span><span class="p">],</span>
<a id="__codelineno-0-460" name="__codelineno-0-460"></a>            <span class="p">]</span>
<a id="__codelineno-0-461" name="__codelineno-0-461"></a>            <span class="n">folds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">partitions</span><span class="p">)</span>
<a id="__codelineno-0-462" name="__codelineno-0-462"></a>            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-0-463" name="__codelineno-0-463"></a>
<a id="__codelineno-0-464" name="__codelineno-0-464"></a>        <span class="c1"># NOTE: Delete all incomplete folds at the end if not allowed</span>
<a id="__codelineno-0-465" name="__codelineno-0-465"></a>        <span class="n">n_removed_folds</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-466" name="__codelineno-0-466"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">allow_incomplete_fold</span><span class="p">:</span>
<a id="__codelineno-0-467" name="__codelineno-0-467"></a>            <span class="c1"># NOTE: While folds and the last &quot;test_index_with_gap&quot; is incomplete,</span>
<a id="__codelineno-0-468" name="__codelineno-0-468"></a>            <span class="c1"># calculating len of range objects</span>
<a id="__codelineno-0-469" name="__codelineno-0-469"></a>            <span class="k">while</span> <span class="n">folds</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">folds</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">3</span><span class="p">])</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">steps</span><span class="p">:</span>
<a id="__codelineno-0-470" name="__codelineno-0-470"></a>                <span class="n">folds</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
<a id="__codelineno-0-471" name="__codelineno-0-471"></a>                <span class="n">n_removed_folds</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-0-472" name="__codelineno-0-472"></a>
<a id="__codelineno-0-473" name="__codelineno-0-473"></a>        <span class="c1"># Replace partitions inside folds with length 0 with `None`</span>
<a id="__codelineno-0-474" name="__codelineno-0-474"></a>        <span class="n">folds</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-475" name="__codelineno-0-475"></a>            <span class="p">[</span><span class="n">partition</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">partition</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">partition</span> <span class="ow">in</span> <span class="n">fold</span><span class="p">]</span>
<a id="__codelineno-0-476" name="__codelineno-0-476"></a>            <span class="k">for</span> <span class="n">fold</span> <span class="ow">in</span> <span class="n">folds</span>
<a id="__codelineno-0-477" name="__codelineno-0-477"></a>        <span class="p">]</span>
<a id="__codelineno-0-478" name="__codelineno-0-478"></a>
<a id="__codelineno-0-479" name="__codelineno-0-479"></a>        <span class="c1"># Create a flag to know whether to train the forecaster</span>
<a id="__codelineno-0-480" name="__codelineno-0-480"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">refit</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-481" name="__codelineno-0-481"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">refit</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-482" name="__codelineno-0-482"></a>
<a id="__codelineno-0-483" name="__codelineno-0-483"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">refit</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
<a id="__codelineno-0-484" name="__codelineno-0-484"></a>            <span class="n">fit_forecaster</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">refit</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">folds</span><span class="p">)</span>
<a id="__codelineno-0-485" name="__codelineno-0-485"></a>            <span class="n">fit_forecaster</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-486" name="__codelineno-0-486"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-487" name="__codelineno-0-487"></a>            <span class="n">fit_forecaster</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">folds</span><span class="p">)</span>
<a id="__codelineno-0-488" name="__codelineno-0-488"></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">fit_forecaster</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">refit</span><span class="p">):</span>
<a id="__codelineno-0-489" name="__codelineno-0-489"></a>                <span class="n">fit_forecaster</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-490" name="__codelineno-0-490"></a>
<a id="__codelineno-0-491" name="__codelineno-0-491"></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">folds</span><span class="p">)):</span>
<a id="__codelineno-0-492" name="__codelineno-0-492"></a>            <span class="n">folds</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
<a id="__codelineno-0-493" name="__codelineno-0-493"></a>            <span class="n">folds</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fit_forecaster</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
<a id="__codelineno-0-494" name="__codelineno-0-494"></a>            <span class="k">if</span> <span class="n">fit_forecaster</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
<a id="__codelineno-0-495" name="__codelineno-0-495"></a>                <span class="n">folds</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">folds</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-496" name="__codelineno-0-496"></a>
<a id="__codelineno-0-497" name="__codelineno-0-497"></a>        <span class="n">index_to_skip</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-498" name="__codelineno-0-498"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">skip_folds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-499" name="__codelineno-0-499"></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">skip_folds</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">integer</span><span class="p">))</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">skip_folds</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-500" name="__codelineno-0-500"></a>                <span class="n">index_to_keep</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">folds</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">skip_folds</span><span class="p">)</span>
<a id="__codelineno-0-501" name="__codelineno-0-501"></a>                <span class="n">index_to_skip</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">setdiff1d</span><span class="p">(</span>
<a id="__codelineno-0-502" name="__codelineno-0-502"></a>                    <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">folds</span><span class="p">)),</span> <span class="n">index_to_keep</span><span class="p">,</span> <span class="n">assume_unique</span><span class="o">=</span><span class="kc">True</span>
<a id="__codelineno-0-503" name="__codelineno-0-503"></a>                <span class="p">)</span>
<a id="__codelineno-0-504" name="__codelineno-0-504"></a>                <span class="n">index_to_skip</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-505" name="__codelineno-0-505"></a>                    <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">index_to_skip</span>
<a id="__codelineno-0-506" name="__codelineno-0-506"></a>                <span class="p">]</span>  <span class="c1"># Required since numpy 2.0</span>
<a id="__codelineno-0-507" name="__codelineno-0-507"></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">skip_folds</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
<a id="__codelineno-0-508" name="__codelineno-0-508"></a>                <span class="n">index_to_skip</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">skip_folds</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">folds</span><span class="p">)]</span>
<a id="__codelineno-0-509" name="__codelineno-0-509"></a>
<a id="__codelineno-0-510" name="__codelineno-0-510"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
<a id="__codelineno-0-511" name="__codelineno-0-511"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_print_info</span><span class="p">(</span>
<a id="__codelineno-0-512" name="__codelineno-0-512"></a>                <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">,</span>
<a id="__codelineno-0-513" name="__codelineno-0-513"></a>                <span class="n">folds</span><span class="o">=</span><span class="n">folds</span><span class="p">,</span>
<a id="__codelineno-0-514" name="__codelineno-0-514"></a>                <span class="n">externally_fitted</span><span class="o">=</span><span class="n">externally_fitted</span><span class="p">,</span>
<a id="__codelineno-0-515" name="__codelineno-0-515"></a>                <span class="n">n_removed_folds</span><span class="o">=</span><span class="n">n_removed_folds</span><span class="p">,</span>
<a id="__codelineno-0-516" name="__codelineno-0-516"></a>                <span class="n">index_to_skip</span><span class="o">=</span><span class="n">index_to_skip</span><span class="p">,</span>
<a id="__codelineno-0-517" name="__codelineno-0-517"></a>            <span class="p">)</span>
<a id="__codelineno-0-518" name="__codelineno-0-518"></a>
<a id="__codelineno-0-519" name="__codelineno-0-519"></a>        <span class="n">folds</span> <span class="o">=</span> <span class="p">[</span><span class="n">fold</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">fold</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">folds</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">index_to_skip</span><span class="p">]</span>
<a id="__codelineno-0-520" name="__codelineno-0-520"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">return_all_indexes</span><span class="p">:</span>
<a id="__codelineno-0-521" name="__codelineno-0-521"></a>            <span class="c1"># NOTE: +1 to prevent iloc pandas from deleting the last observation</span>
<a id="__codelineno-0-522" name="__codelineno-0-522"></a>            <span class="n">folds</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-523" name="__codelineno-0-523"></a>                <span class="p">[</span>
<a id="__codelineno-0-524" name="__codelineno-0-524"></a>                    <span class="n">fold</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
<a id="__codelineno-0-525" name="__codelineno-0-525"></a>                    <span class="p">[</span><span class="n">fold</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">fold</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span>
<a id="__codelineno-0-526" name="__codelineno-0-526"></a>                    <span class="p">(</span>
<a id="__codelineno-0-527" name="__codelineno-0-527"></a>                        <span class="p">[</span><span class="n">fold</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">fold</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-528" name="__codelineno-0-528"></a>                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_size</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
<a id="__codelineno-0-529" name="__codelineno-0-529"></a>                        <span class="k">else</span> <span class="p">[]</span>
<a id="__codelineno-0-530" name="__codelineno-0-530"></a>                    <span class="p">),</span>
<a id="__codelineno-0-531" name="__codelineno-0-531"></a>                    <span class="p">[</span><span class="n">fold</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">fold</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span>
<a id="__codelineno-0-532" name="__codelineno-0-532"></a>                    <span class="p">[</span><span class="n">fold</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">fold</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span>
<a id="__codelineno-0-533" name="__codelineno-0-533"></a>                    <span class="n">fold</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span>
<a id="__codelineno-0-534" name="__codelineno-0-534"></a>                <span class="p">]</span>
<a id="__codelineno-0-535" name="__codelineno-0-535"></a>                <span class="k">for</span> <span class="n">fold</span> <span class="ow">in</span> <span class="n">folds</span>
<a id="__codelineno-0-536" name="__codelineno-0-536"></a>            <span class="p">]</span>
<a id="__codelineno-0-537" name="__codelineno-0-537"></a>
<a id="__codelineno-0-538" name="__codelineno-0-538"></a>        <span class="k">if</span> <span class="n">externally_fitted</span><span class="p">:</span>
<a id="__codelineno-0-539" name="__codelineno-0-539"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">initial_train_size</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-540" name="__codelineno-0-540"></a>            <span class="n">folds</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-541" name="__codelineno-0-541"></a>
<a id="__codelineno-0-542" name="__codelineno-0-542"></a>        <span class="k">if</span> <span class="n">as_pandas</span><span class="p">:</span>
<a id="__codelineno-0-543" name="__codelineno-0-543"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-544" name="__codelineno-0-544"></a>                <span class="k">for</span> <span class="n">fold</span> <span class="ow">in</span> <span class="n">folds</span><span class="p">:</span>
<a id="__codelineno-0-545" name="__codelineno-0-545"></a>                    <span class="n">fold</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
<a id="__codelineno-0-546" name="__codelineno-0-546"></a>
<a id="__codelineno-0-547" name="__codelineno-0-547"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">return_all_indexes</span><span class="p">:</span>
<a id="__codelineno-0-548" name="__codelineno-0-548"></a>                <span class="n">folds</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
<a id="__codelineno-0-549" name="__codelineno-0-549"></a>                    <span class="n">data</span><span class="o">=</span><span class="p">[</span>
<a id="__codelineno-0-550" name="__codelineno-0-550"></a>                        <span class="p">[</span><span class="n">fold</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span><span class="o">*</span><span class="n">fold</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span> <span class="o">+</span> <span class="p">[</span><span class="n">fold</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
<a id="__codelineno-0-551" name="__codelineno-0-551"></a>                        <span class="k">for</span> <span class="n">fold</span> <span class="ow">in</span> <span class="n">folds</span>
<a id="__codelineno-0-552" name="__codelineno-0-552"></a>                    <span class="p">],</span>
<a id="__codelineno-0-553" name="__codelineno-0-553"></a>                    <span class="n">columns</span><span class="o">=</span><span class="p">[</span>
<a id="__codelineno-0-554" name="__codelineno-0-554"></a>                        <span class="s2">&quot;fold&quot;</span><span class="p">,</span>
<a id="__codelineno-0-555" name="__codelineno-0-555"></a>                        <span class="s2">&quot;train_start&quot;</span><span class="p">,</span>
<a id="__codelineno-0-556" name="__codelineno-0-556"></a>                        <span class="s2">&quot;train_end&quot;</span><span class="p">,</span>
<a id="__codelineno-0-557" name="__codelineno-0-557"></a>                        <span class="s2">&quot;last_window_start&quot;</span><span class="p">,</span>
<a id="__codelineno-0-558" name="__codelineno-0-558"></a>                        <span class="s2">&quot;last_window_end&quot;</span><span class="p">,</span>
<a id="__codelineno-0-559" name="__codelineno-0-559"></a>                        <span class="s2">&quot;test_start&quot;</span><span class="p">,</span>
<a id="__codelineno-0-560" name="__codelineno-0-560"></a>                        <span class="s2">&quot;test_end&quot;</span><span class="p">,</span>
<a id="__codelineno-0-561" name="__codelineno-0-561"></a>                        <span class="s2">&quot;test_start_with_gap&quot;</span><span class="p">,</span>
<a id="__codelineno-0-562" name="__codelineno-0-562"></a>                        <span class="s2">&quot;test_end_with_gap&quot;</span><span class="p">,</span>
<a id="__codelineno-0-563" name="__codelineno-0-563"></a>                        <span class="s2">&quot;fit_forecaster&quot;</span><span class="p">,</span>
<a id="__codelineno-0-564" name="__codelineno-0-564"></a>                    <span class="p">],</span>
<a id="__codelineno-0-565" name="__codelineno-0-565"></a>                <span class="p">)</span>
<a id="__codelineno-0-566" name="__codelineno-0-566"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-567" name="__codelineno-0-567"></a>                <span class="n">folds</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
<a id="__codelineno-0-568" name="__codelineno-0-568"></a>                    <span class="n">data</span><span class="o">=</span><span class="n">folds</span><span class="p">,</span>
<a id="__codelineno-0-569" name="__codelineno-0-569"></a>                    <span class="n">columns</span><span class="o">=</span><span class="p">[</span>
<a id="__codelineno-0-570" name="__codelineno-0-570"></a>                        <span class="s2">&quot;fold&quot;</span><span class="p">,</span>
<a id="__codelineno-0-571" name="__codelineno-0-571"></a>                        <span class="s2">&quot;train_index&quot;</span><span class="p">,</span>
<a id="__codelineno-0-572" name="__codelineno-0-572"></a>                        <span class="s2">&quot;last_window_index&quot;</span><span class="p">,</span>
<a id="__codelineno-0-573" name="__codelineno-0-573"></a>                        <span class="s2">&quot;test_index&quot;</span><span class="p">,</span>
<a id="__codelineno-0-574" name="__codelineno-0-574"></a>                        <span class="s2">&quot;test_index_with_gap&quot;</span><span class="p">,</span>
<a id="__codelineno-0-575" name="__codelineno-0-575"></a>                        <span class="s2">&quot;fit_forecaster&quot;</span><span class="p">,</span>
<a id="__codelineno-0-576" name="__codelineno-0-576"></a>                    <span class="p">],</span>
<a id="__codelineno-0-577" name="__codelineno-0-577"></a>                <span class="p">)</span>
<a id="__codelineno-0-578" name="__codelineno-0-578"></a>
<a id="__codelineno-0-579" name="__codelineno-0-579"></a>        <span class="k">return</span> <span class="n">folds</span>
<a id="__codelineno-0-580" name="__codelineno-0-580"></a>
<a id="__codelineno-0-581" name="__codelineno-0-581"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_print_info</span><span class="p">(</span>
<a id="__codelineno-0-582" name="__codelineno-0-582"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-583" name="__codelineno-0-583"></a>        <span class="n">index</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Index</span><span class="p">,</span>
<a id="__codelineno-0-584" name="__codelineno-0-584"></a>        <span class="n">folds</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]],</span>
<a id="__codelineno-0-585" name="__codelineno-0-585"></a>        <span class="n">externally_fitted</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
<a id="__codelineno-0-586" name="__codelineno-0-586"></a>        <span class="n">n_removed_folds</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-587" name="__codelineno-0-587"></a>        <span class="n">index_to_skip</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
<a id="__codelineno-0-588" name="__codelineno-0-588"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-589" name="__codelineno-0-589"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Print information about folds.</span>
<a id="__codelineno-0-590" name="__codelineno-0-590"></a>
<a id="__codelineno-0-591" name="__codelineno-0-591"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-592" name="__codelineno-0-592"></a><span class="sd">            index: Index of the time series data.</span>
<a id="__codelineno-0-593" name="__codelineno-0-593"></a><span class="sd">            folds: A list of lists containing the indices (position) for each fold.</span>
<a id="__codelineno-0-594" name="__codelineno-0-594"></a><span class="sd">            externally_fitted: Whether an already trained forecaster is to be used.</span>
<a id="__codelineno-0-595" name="__codelineno-0-595"></a><span class="sd">            n_removed_folds: Number of folds removed.</span>
<a id="__codelineno-0-596" name="__codelineno-0-596"></a><span class="sd">            index_to_skip: Number of folds skipped.</span>
<a id="__codelineno-0-597" name="__codelineno-0-597"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-598" name="__codelineno-0-598"></a>
<a id="__codelineno-0-599" name="__codelineno-0-599"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Information of folds&quot;</span><span class="p">)</span>
<a id="__codelineno-0-600" name="__codelineno-0-600"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;--------------------&quot;</span><span class="p">)</span>
<a id="__codelineno-0-601" name="__codelineno-0-601"></a>        <span class="k">if</span> <span class="n">externally_fitted</span><span class="p">:</span>
<a id="__codelineno-0-602" name="__codelineno-0-602"></a>            <span class="nb">print</span><span class="p">(</span>
<a id="__codelineno-0-603" name="__codelineno-0-603"></a>                <span class="sa">f</span><span class="s2">&quot;An already trained forecaster is to be used. Window size: &quot;</span>
<a id="__codelineno-0-604" name="__codelineno-0-604"></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">window_size</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-605" name="__codelineno-0-605"></a>            <span class="p">)</span>
<a id="__codelineno-0-606" name="__codelineno-0-606"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-607" name="__codelineno-0-607"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">differentiation</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-608" name="__codelineno-0-608"></a>                <span class="nb">print</span><span class="p">(</span>
<a id="__codelineno-0-609" name="__codelineno-0-609"></a>                    <span class="sa">f</span><span class="s2">&quot;Number of observations used for initial training: &quot;</span>
<a id="__codelineno-0-610" name="__codelineno-0-610"></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_train_size</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-611" name="__codelineno-0-611"></a>                <span class="p">)</span>
<a id="__codelineno-0-612" name="__codelineno-0-612"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-613" name="__codelineno-0-613"></a>                <span class="nb">print</span><span class="p">(</span>
<a id="__codelineno-0-614" name="__codelineno-0-614"></a>                    <span class="sa">f</span><span class="s2">&quot;Number of observations used for initial training: &quot;</span>
<a id="__codelineno-0-615" name="__codelineno-0-615"></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_train_size</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">differentiation</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-616" name="__codelineno-0-616"></a>                <span class="p">)</span>
<a id="__codelineno-0-617" name="__codelineno-0-617"></a>                <span class="nb">print</span><span class="p">(</span>
<a id="__codelineno-0-618" name="__codelineno-0-618"></a>                    <span class="sa">f</span><span class="s2">&quot;    First </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">differentiation</span><span class="si">}</span><span class="s2"> observation/s in training sets &quot;</span>
<a id="__codelineno-0-619" name="__codelineno-0-619"></a>                    <span class="sa">f</span><span class="s2">&quot;are used for differentiation&quot;</span>
<a id="__codelineno-0-620" name="__codelineno-0-620"></a>                <span class="p">)</span>
<a id="__codelineno-0-621" name="__codelineno-0-621"></a>        <span class="nb">print</span><span class="p">(</span>
<a id="__codelineno-0-622" name="__codelineno-0-622"></a>            <span class="sa">f</span><span class="s2">&quot;Number of observations used for backtesting: &quot;</span>
<a id="__codelineno-0-623" name="__codelineno-0-623"></a>            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">index</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">initial_train_size</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-624" name="__codelineno-0-624"></a>        <span class="p">)</span>
<a id="__codelineno-0-625" name="__codelineno-0-625"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Number of folds: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">folds</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-626" name="__codelineno-0-626"></a>        <span class="nb">print</span><span class="p">(</span>
<a id="__codelineno-0-627" name="__codelineno-0-627"></a>            <span class="sa">f</span><span class="s2">&quot;    Number skipped folds: &quot;</span>
<a id="__codelineno-0-628" name="__codelineno-0-628"></a>            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">index_to_skip</span><span class="p">)</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">index_to_skip</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">index_to_skip</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-629" name="__codelineno-0-629"></a>        <span class="p">)</span>
<a id="__codelineno-0-630" name="__codelineno-0-630"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Number of steps per fold: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">steps</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-631" name="__codelineno-0-631"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">steps</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fold_stride</span><span class="p">:</span>
<a id="__codelineno-0-632" name="__codelineno-0-632"></a>            <span class="nb">print</span><span class="p">(</span>
<a id="__codelineno-0-633" name="__codelineno-0-633"></a>                <span class="sa">f</span><span class="s2">&quot;    Number of steps to the next fold (fold stride): </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">fold_stride</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-634" name="__codelineno-0-634"></a>            <span class="p">)</span>
<a id="__codelineno-0-635" name="__codelineno-0-635"></a>        <span class="nb">print</span><span class="p">(</span>
<a id="__codelineno-0-636" name="__codelineno-0-636"></a>            <span class="sa">f</span><span class="s2">&quot;    Number of steps to exclude between last observed data &quot;</span>
<a id="__codelineno-0-637" name="__codelineno-0-637"></a>            <span class="sa">f</span><span class="s2">&quot;(last window) and predictions (gap): </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">gap</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-638" name="__codelineno-0-638"></a>        <span class="p">)</span>
<a id="__codelineno-0-639" name="__codelineno-0-639"></a>        <span class="k">if</span> <span class="n">n_removed_folds</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-640" name="__codelineno-0-640"></a>            <span class="nb">print</span><span class="p">(</span>
<a id="__codelineno-0-641" name="__codelineno-0-641"></a>                <span class="sa">f</span><span class="s2">&quot;    The last </span><span class="si">{</span><span class="n">n_removed_folds</span><span class="si">}</span><span class="s2"> fold(s) have been excluded &quot;</span>
<a id="__codelineno-0-642" name="__codelineno-0-642"></a>                <span class="sa">f</span><span class="s2">&quot;because they were incomplete.&quot;</span>
<a id="__codelineno-0-643" name="__codelineno-0-643"></a>            <span class="p">)</span>
<a id="__codelineno-0-644" name="__codelineno-0-644"></a>
<a id="__codelineno-0-645" name="__codelineno-0-645"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">folds</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">4</span><span class="p">])</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">steps</span><span class="p">:</span>
<a id="__codelineno-0-646" name="__codelineno-0-646"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Last fold only includes </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">folds</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">4</span><span class="p">])</span><span class="si">}</span><span class="s2"> observations.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-647" name="__codelineno-0-647"></a>
<a id="__codelineno-0-648" name="__codelineno-0-648"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
<a id="__codelineno-0-649" name="__codelineno-0-649"></a>
<a id="__codelineno-0-650" name="__codelineno-0-650"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">differentiation</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-651" name="__codelineno-0-651"></a>            <span class="n">differentiation</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-652" name="__codelineno-0-652"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-653" name="__codelineno-0-653"></a>            <span class="n">differentiation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">differentiation</span>
<a id="__codelineno-0-654" name="__codelineno-0-654"></a>
<a id="__codelineno-0-655" name="__codelineno-0-655"></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">fold</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">folds</span><span class="p">):</span>
<a id="__codelineno-0-656" name="__codelineno-0-656"></a>            <span class="n">is_fold_skipped</span> <span class="o">=</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">index_to_skip</span>
<a id="__codelineno-0-657" name="__codelineno-0-657"></a>            <span class="n">has_training</span> <span class="o">=</span> <span class="n">fold</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="mi">0</span> <span class="k">else</span> <span class="kc">True</span>
<a id="__codelineno-0-658" name="__codelineno-0-658"></a>            <span class="n">training_start</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-659" name="__codelineno-0-659"></a>                <span class="n">index</span><span class="p">[</span><span class="n">fold</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">differentiation</span><span class="p">]</span> <span class="k">if</span> <span class="n">fold</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
<a id="__codelineno-0-660" name="__codelineno-0-660"></a>            <span class="p">)</span>
<a id="__codelineno-0-661" name="__codelineno-0-661"></a>            <span class="n">training_end</span> <span class="o">=</span> <span class="n">index</span><span class="p">[</span><span class="n">fold</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span> <span class="k">if</span> <span class="n">fold</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
<a id="__codelineno-0-662" name="__codelineno-0-662"></a>            <span class="n">training_length</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-663" name="__codelineno-0-663"></a>                <span class="nb">len</span><span class="p">(</span><span class="n">fold</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="n">differentiation</span> <span class="k">if</span> <span class="n">fold</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">0</span>
<a id="__codelineno-0-664" name="__codelineno-0-664"></a>            <span class="p">)</span>
<a id="__codelineno-0-665" name="__codelineno-0-665"></a>            <span class="n">validation_start</span> <span class="o">=</span> <span class="n">index</span><span class="p">[</span><span class="n">fold</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
<a id="__codelineno-0-666" name="__codelineno-0-666"></a>            <span class="n">validation_end</span> <span class="o">=</span> <span class="n">index</span><span class="p">[</span><span class="n">fold</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
<a id="__codelineno-0-667" name="__codelineno-0-667"></a>            <span class="n">validation_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">fold</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
<a id="__codelineno-0-668" name="__codelineno-0-668"></a>
<a id="__codelineno-0-669" name="__codelineno-0-669"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fold: </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-670" name="__codelineno-0-670"></a>            <span class="k">if</span> <span class="n">is_fold_skipped</span><span class="p">:</span>
<a id="__codelineno-0-671" name="__codelineno-0-671"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    Fold skipped&quot;</span><span class="p">)</span>
<a id="__codelineno-0-672" name="__codelineno-0-672"></a>            <span class="k">elif</span> <span class="ow">not</span> <span class="n">externally_fitted</span> <span class="ow">and</span> <span class="n">has_training</span><span class="p">:</span>
<a id="__codelineno-0-673" name="__codelineno-0-673"></a>                <span class="nb">print</span><span class="p">(</span>
<a id="__codelineno-0-674" name="__codelineno-0-674"></a>                    <span class="sa">f</span><span class="s2">&quot;    Training:   </span><span class="si">{</span><span class="n">training_start</span><span class="si">}</span><span class="s2"> -- </span><span class="si">{</span><span class="n">training_end</span><span class="si">}</span><span class="s2">  &quot;</span>
<a id="__codelineno-0-675" name="__codelineno-0-675"></a>                    <span class="sa">f</span><span class="s2">&quot;(n=</span><span class="si">{</span><span class="n">training_length</span><span class="si">}</span><span class="s2">)&quot;</span>
<a id="__codelineno-0-676" name="__codelineno-0-676"></a>                <span class="p">)</span>
<a id="__codelineno-0-677" name="__codelineno-0-677"></a>                <span class="nb">print</span><span class="p">(</span>
<a id="__codelineno-0-678" name="__codelineno-0-678"></a>                    <span class="sa">f</span><span class="s2">&quot;    Validation: </span><span class="si">{</span><span class="n">validation_start</span><span class="si">}</span><span class="s2"> -- </span><span class="si">{</span><span class="n">validation_end</span><span class="si">}</span><span class="s2">  &quot;</span>
<a id="__codelineno-0-679" name="__codelineno-0-679"></a>                    <span class="sa">f</span><span class="s2">&quot;(n=</span><span class="si">{</span><span class="n">validation_length</span><span class="si">}</span><span class="s2">)&quot;</span>
<a id="__codelineno-0-680" name="__codelineno-0-680"></a>                <span class="p">)</span>
<a id="__codelineno-0-681" name="__codelineno-0-681"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-682" name="__codelineno-0-682"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    Training:   No training in this fold&quot;</span><span class="p">)</span>
<a id="__codelineno-0-683" name="__codelineno-0-683"></a>                <span class="nb">print</span><span class="p">(</span>
<a id="__codelineno-0-684" name="__codelineno-0-684"></a>                    <span class="sa">f</span><span class="s2">&quot;    Validation: </span><span class="si">{</span><span class="n">validation_start</span><span class="si">}</span><span class="s2"> -- </span><span class="si">{</span><span class="n">validation_end</span><span class="si">}</span><span class="s2">  &quot;</span>
<a id="__codelineno-0-685" name="__codelineno-0-685"></a>                    <span class="sa">f</span><span class="s2">&quot;(n=</span><span class="si">{</span><span class="n">validation_length</span><span class="si">}</span><span class="s2">)&quot;</span>
<a id="__codelineno-0-686" name="__codelineno-0-686"></a>                <span class="p">)</span>
<a id="__codelineno-0-687" name="__codelineno-0-687"></a>
<a id="__codelineno-0-688" name="__codelineno-0-688"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="spotforecast2.model_selection.split_ts_cv.TimeSeriesFold.__repr__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__repr__</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Information displayed when printed.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>String representation of the TimeSeriesFold object.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/spotforecast2/model_selection/split_ts_cv.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-216" name="__codelineno-0-216"></a><span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Information displayed when printed.</span>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a><span class="sd">        String representation of the TimeSeriesFold object.</span>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a>    <span class="n">info</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a>        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;=&#39;</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a>        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a>        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;=&#39;</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a>        <span class="sa">f</span><span class="s2">&quot;Initial train size    = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_train_size</span><span class="si">}</span><span class="s2">,</span><span class="se">\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a>        <span class="sa">f</span><span class="s2">&quot;Steps                 = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">steps</span><span class="si">}</span><span class="s2">,</span><span class="se">\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a>        <span class="sa">f</span><span class="s2">&quot;Fold stride           = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">fold_stride</span><span class="si">}</span><span class="s2">,</span><span class="se">\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a>        <span class="sa">f</span><span class="s2">&quot;Overlapping folds     = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">overlapping_folds</span><span class="si">}</span><span class="s2">,</span><span class="se">\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a>        <span class="sa">f</span><span class="s2">&quot;Window size           = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">window_size</span><span class="si">}</span><span class="s2">,</span><span class="se">\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a>        <span class="sa">f</span><span class="s2">&quot;Differentiation       = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">differentiation</span><span class="si">}</span><span class="s2">,</span><span class="se">\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a>        <span class="sa">f</span><span class="s2">&quot;Refit                 = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">refit</span><span class="si">}</span><span class="s2">,</span><span class="se">\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a>        <span class="sa">f</span><span class="s2">&quot;Fixed train size      = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">fixed_train_size</span><span class="si">}</span><span class="s2">,</span><span class="se">\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a>        <span class="sa">f</span><span class="s2">&quot;Gap                   = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">gap</span><span class="si">}</span><span class="s2">,</span><span class="se">\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a>        <span class="sa">f</span><span class="s2">&quot;Skip folds            = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">skip_folds</span><span class="si">}</span><span class="s2">,</span><span class="se">\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a>        <span class="sa">f</span><span class="s2">&quot;Allow incomplete fold = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">allow_incomplete_fold</span><span class="si">}</span><span class="s2">,</span><span class="se">\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a>        <span class="sa">f</span><span class="s2">&quot;Return all indexes    = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">return_all_indexes</span><span class="si">}</span><span class="s2">,</span><span class="se">\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a>        <span class="sa">f</span><span class="s2">&quot;Verbose               = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a>    <span class="p">)</span>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a>    <span class="k">return</span> <span class="n">info</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="spotforecast2.model_selection.split_ts_cv.TimeSeriesFold.split" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">as_pandas</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Split the time series data into train and test folds.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>X</code>
            </td>
            <td>
                  <code><span title="pandas.Series">Series</span> | <span title="pandas.DataFrame">DataFrame</span> | <span title="pandas.Index">Index</span> | <span title="dict">dict</span>[<span title="str">str</span>, <span title="pandas.Series">Series</span> | <span title="pandas.DataFrame">DataFrame</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Time series data or index to split. Can be a pandas Series, DataFrame,
Index, or a dictionary of Series/DataFrames.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>as_pandas</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, the folds are returned as a DataFrame. This is useful
to visualize the folds in a more interpretable way. Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span> | <span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of lists containing the indices (position) for each fold, or a</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span> | <span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>DataFrame if <code>as_pandas=True</code>. Each list contains 4 lists and a boolean</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span> | <span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>with the following information:</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span> | <span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <ul>
<li><strong>fold</strong>: fold number.</li>
</ul>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span> | <span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <ul>
<li><strong>[train_start, train_end]</strong>: list with the start and end positions of
    the training set.</li>
</ul>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span> | <span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <ul>
<li><strong>[last_window_start, last_window_end]</strong>: list with the start and end
    positions of the last window seen by the forecaster during training.
    The last window is used to generate the lags use as predictors. If
    <code>differentiation</code> is included, the interval is extended as many
    observations as the differentiation order. If the argument <code>window_size</code>
    is <code>None</code>, this list is empty.</li>
</ul>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span> | <span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <ul>
<li><strong>[test_start, test_end]</strong>: list with the start and end positions of
    the test set. These are the observations used to evaluate the forecaster.</li>
</ul>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span> | <span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <ul>
<li><strong>[test_start_with_gap, test_end_with_gap]</strong>: list with the start and
    end positions of the test set including the gap. The gap is the number
    of observations between the end of the training set and the start of
    the test set.</li>
</ul>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span> | <span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <ul>
<li><strong>fit_forecaster</strong>: boolean indicating whether the forecaster should be
    fitted in this fold.</li>
</ul>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Note</summary>
  <p>The returned values are the positions of the observations and not the
actual values of the index, so they can be used to slice the data directly
using iloc.</p>
<p>If <code>as_pandas</code> is <code>True</code>, the folds are returned as a DataFrame with the
following columns: 'fold', 'train_start', 'train_end', 'last_window_start',
'last_window_end', 'test_start', 'test_end', 'test_start_with_gap',
'test_end_with_gap', 'fit_forecaster'.</p>
<p>Following the python convention, the start index is inclusive and the end
index is exclusive. This means that the last index is not included in the
slice.</p>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/spotforecast2/model_selection/split_ts_cv.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-279">279</a></span>
<span class="normal"><a href="#__codelineno-0-280">280</a></span>
<span class="normal"><a href="#__codelineno-0-281">281</a></span>
<span class="normal"><a href="#__codelineno-0-282">282</a></span>
<span class="normal"><a href="#__codelineno-0-283">283</a></span>
<span class="normal"><a href="#__codelineno-0-284">284</a></span>
<span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span>
<span class="normal"><a href="#__codelineno-0-287">287</a></span>
<span class="normal"><a href="#__codelineno-0-288">288</a></span>
<span class="normal"><a href="#__codelineno-0-289">289</a></span>
<span class="normal"><a href="#__codelineno-0-290">290</a></span>
<span class="normal"><a href="#__codelineno-0-291">291</a></span>
<span class="normal"><a href="#__codelineno-0-292">292</a></span>
<span class="normal"><a href="#__codelineno-0-293">293</a></span>
<span class="normal"><a href="#__codelineno-0-294">294</a></span>
<span class="normal"><a href="#__codelineno-0-295">295</a></span>
<span class="normal"><a href="#__codelineno-0-296">296</a></span>
<span class="normal"><a href="#__codelineno-0-297">297</a></span>
<span class="normal"><a href="#__codelineno-0-298">298</a></span>
<span class="normal"><a href="#__codelineno-0-299">299</a></span>
<span class="normal"><a href="#__codelineno-0-300">300</a></span>
<span class="normal"><a href="#__codelineno-0-301">301</a></span>
<span class="normal"><a href="#__codelineno-0-302">302</a></span>
<span class="normal"><a href="#__codelineno-0-303">303</a></span>
<span class="normal"><a href="#__codelineno-0-304">304</a></span>
<span class="normal"><a href="#__codelineno-0-305">305</a></span>
<span class="normal"><a href="#__codelineno-0-306">306</a></span>
<span class="normal"><a href="#__codelineno-0-307">307</a></span>
<span class="normal"><a href="#__codelineno-0-308">308</a></span>
<span class="normal"><a href="#__codelineno-0-309">309</a></span>
<span class="normal"><a href="#__codelineno-0-310">310</a></span>
<span class="normal"><a href="#__codelineno-0-311">311</a></span>
<span class="normal"><a href="#__codelineno-0-312">312</a></span>
<span class="normal"><a href="#__codelineno-0-313">313</a></span>
<span class="normal"><a href="#__codelineno-0-314">314</a></span>
<span class="normal"><a href="#__codelineno-0-315">315</a></span>
<span class="normal"><a href="#__codelineno-0-316">316</a></span>
<span class="normal"><a href="#__codelineno-0-317">317</a></span>
<span class="normal"><a href="#__codelineno-0-318">318</a></span>
<span class="normal"><a href="#__codelineno-0-319">319</a></span>
<span class="normal"><a href="#__codelineno-0-320">320</a></span>
<span class="normal"><a href="#__codelineno-0-321">321</a></span>
<span class="normal"><a href="#__codelineno-0-322">322</a></span>
<span class="normal"><a href="#__codelineno-0-323">323</a></span>
<span class="normal"><a href="#__codelineno-0-324">324</a></span>
<span class="normal"><a href="#__codelineno-0-325">325</a></span>
<span class="normal"><a href="#__codelineno-0-326">326</a></span>
<span class="normal"><a href="#__codelineno-0-327">327</a></span>
<span class="normal"><a href="#__codelineno-0-328">328</a></span>
<span class="normal"><a href="#__codelineno-0-329">329</a></span>
<span class="normal"><a href="#__codelineno-0-330">330</a></span>
<span class="normal"><a href="#__codelineno-0-331">331</a></span>
<span class="normal"><a href="#__codelineno-0-332">332</a></span>
<span class="normal"><a href="#__codelineno-0-333">333</a></span>
<span class="normal"><a href="#__codelineno-0-334">334</a></span>
<span class="normal"><a href="#__codelineno-0-335">335</a></span>
<span class="normal"><a href="#__codelineno-0-336">336</a></span>
<span class="normal"><a href="#__codelineno-0-337">337</a></span>
<span class="normal"><a href="#__codelineno-0-338">338</a></span>
<span class="normal"><a href="#__codelineno-0-339">339</a></span>
<span class="normal"><a href="#__codelineno-0-340">340</a></span>
<span class="normal"><a href="#__codelineno-0-341">341</a></span>
<span class="normal"><a href="#__codelineno-0-342">342</a></span>
<span class="normal"><a href="#__codelineno-0-343">343</a></span>
<span class="normal"><a href="#__codelineno-0-344">344</a></span>
<span class="normal"><a href="#__codelineno-0-345">345</a></span>
<span class="normal"><a href="#__codelineno-0-346">346</a></span>
<span class="normal"><a href="#__codelineno-0-347">347</a></span>
<span class="normal"><a href="#__codelineno-0-348">348</a></span>
<span class="normal"><a href="#__codelineno-0-349">349</a></span>
<span class="normal"><a href="#__codelineno-0-350">350</a></span>
<span class="normal"><a href="#__codelineno-0-351">351</a></span>
<span class="normal"><a href="#__codelineno-0-352">352</a></span>
<span class="normal"><a href="#__codelineno-0-353">353</a></span>
<span class="normal"><a href="#__codelineno-0-354">354</a></span>
<span class="normal"><a href="#__codelineno-0-355">355</a></span>
<span class="normal"><a href="#__codelineno-0-356">356</a></span>
<span class="normal"><a href="#__codelineno-0-357">357</a></span>
<span class="normal"><a href="#__codelineno-0-358">358</a></span>
<span class="normal"><a href="#__codelineno-0-359">359</a></span>
<span class="normal"><a href="#__codelineno-0-360">360</a></span>
<span class="normal"><a href="#__codelineno-0-361">361</a></span>
<span class="normal"><a href="#__codelineno-0-362">362</a></span>
<span class="normal"><a href="#__codelineno-0-363">363</a></span>
<span class="normal"><a href="#__codelineno-0-364">364</a></span>
<span class="normal"><a href="#__codelineno-0-365">365</a></span>
<span class="normal"><a href="#__codelineno-0-366">366</a></span>
<span class="normal"><a href="#__codelineno-0-367">367</a></span>
<span class="normal"><a href="#__codelineno-0-368">368</a></span>
<span class="normal"><a href="#__codelineno-0-369">369</a></span>
<span class="normal"><a href="#__codelineno-0-370">370</a></span>
<span class="normal"><a href="#__codelineno-0-371">371</a></span>
<span class="normal"><a href="#__codelineno-0-372">372</a></span>
<span class="normal"><a href="#__codelineno-0-373">373</a></span>
<span class="normal"><a href="#__codelineno-0-374">374</a></span>
<span class="normal"><a href="#__codelineno-0-375">375</a></span>
<span class="normal"><a href="#__codelineno-0-376">376</a></span>
<span class="normal"><a href="#__codelineno-0-377">377</a></span>
<span class="normal"><a href="#__codelineno-0-378">378</a></span>
<span class="normal"><a href="#__codelineno-0-379">379</a></span>
<span class="normal"><a href="#__codelineno-0-380">380</a></span>
<span class="normal"><a href="#__codelineno-0-381">381</a></span>
<span class="normal"><a href="#__codelineno-0-382">382</a></span>
<span class="normal"><a href="#__codelineno-0-383">383</a></span>
<span class="normal"><a href="#__codelineno-0-384">384</a></span>
<span class="normal"><a href="#__codelineno-0-385">385</a></span>
<span class="normal"><a href="#__codelineno-0-386">386</a></span>
<span class="normal"><a href="#__codelineno-0-387">387</a></span>
<span class="normal"><a href="#__codelineno-0-388">388</a></span>
<span class="normal"><a href="#__codelineno-0-389">389</a></span>
<span class="normal"><a href="#__codelineno-0-390">390</a></span>
<span class="normal"><a href="#__codelineno-0-391">391</a></span>
<span class="normal"><a href="#__codelineno-0-392">392</a></span>
<span class="normal"><a href="#__codelineno-0-393">393</a></span>
<span class="normal"><a href="#__codelineno-0-394">394</a></span>
<span class="normal"><a href="#__codelineno-0-395">395</a></span>
<span class="normal"><a href="#__codelineno-0-396">396</a></span>
<span class="normal"><a href="#__codelineno-0-397">397</a></span>
<span class="normal"><a href="#__codelineno-0-398">398</a></span>
<span class="normal"><a href="#__codelineno-0-399">399</a></span>
<span class="normal"><a href="#__codelineno-0-400">400</a></span>
<span class="normal"><a href="#__codelineno-0-401">401</a></span>
<span class="normal"><a href="#__codelineno-0-402">402</a></span>
<span class="normal"><a href="#__codelineno-0-403">403</a></span>
<span class="normal"><a href="#__codelineno-0-404">404</a></span>
<span class="normal"><a href="#__codelineno-0-405">405</a></span>
<span class="normal"><a href="#__codelineno-0-406">406</a></span>
<span class="normal"><a href="#__codelineno-0-407">407</a></span>
<span class="normal"><a href="#__codelineno-0-408">408</a></span>
<span class="normal"><a href="#__codelineno-0-409">409</a></span>
<span class="normal"><a href="#__codelineno-0-410">410</a></span>
<span class="normal"><a href="#__codelineno-0-411">411</a></span>
<span class="normal"><a href="#__codelineno-0-412">412</a></span>
<span class="normal"><a href="#__codelineno-0-413">413</a></span>
<span class="normal"><a href="#__codelineno-0-414">414</a></span>
<span class="normal"><a href="#__codelineno-0-415">415</a></span>
<span class="normal"><a href="#__codelineno-0-416">416</a></span>
<span class="normal"><a href="#__codelineno-0-417">417</a></span>
<span class="normal"><a href="#__codelineno-0-418">418</a></span>
<span class="normal"><a href="#__codelineno-0-419">419</a></span>
<span class="normal"><a href="#__codelineno-0-420">420</a></span>
<span class="normal"><a href="#__codelineno-0-421">421</a></span>
<span class="normal"><a href="#__codelineno-0-422">422</a></span>
<span class="normal"><a href="#__codelineno-0-423">423</a></span>
<span class="normal"><a href="#__codelineno-0-424">424</a></span>
<span class="normal"><a href="#__codelineno-0-425">425</a></span>
<span class="normal"><a href="#__codelineno-0-426">426</a></span>
<span class="normal"><a href="#__codelineno-0-427">427</a></span>
<span class="normal"><a href="#__codelineno-0-428">428</a></span>
<span class="normal"><a href="#__codelineno-0-429">429</a></span>
<span class="normal"><a href="#__codelineno-0-430">430</a></span>
<span class="normal"><a href="#__codelineno-0-431">431</a></span>
<span class="normal"><a href="#__codelineno-0-432">432</a></span>
<span class="normal"><a href="#__codelineno-0-433">433</a></span>
<span class="normal"><a href="#__codelineno-0-434">434</a></span>
<span class="normal"><a href="#__codelineno-0-435">435</a></span>
<span class="normal"><a href="#__codelineno-0-436">436</a></span>
<span class="normal"><a href="#__codelineno-0-437">437</a></span>
<span class="normal"><a href="#__codelineno-0-438">438</a></span>
<span class="normal"><a href="#__codelineno-0-439">439</a></span>
<span class="normal"><a href="#__codelineno-0-440">440</a></span>
<span class="normal"><a href="#__codelineno-0-441">441</a></span>
<span class="normal"><a href="#__codelineno-0-442">442</a></span>
<span class="normal"><a href="#__codelineno-0-443">443</a></span>
<span class="normal"><a href="#__codelineno-0-444">444</a></span>
<span class="normal"><a href="#__codelineno-0-445">445</a></span>
<span class="normal"><a href="#__codelineno-0-446">446</a></span>
<span class="normal"><a href="#__codelineno-0-447">447</a></span>
<span class="normal"><a href="#__codelineno-0-448">448</a></span>
<span class="normal"><a href="#__codelineno-0-449">449</a></span>
<span class="normal"><a href="#__codelineno-0-450">450</a></span>
<span class="normal"><a href="#__codelineno-0-451">451</a></span>
<span class="normal"><a href="#__codelineno-0-452">452</a></span>
<span class="normal"><a href="#__codelineno-0-453">453</a></span>
<span class="normal"><a href="#__codelineno-0-454">454</a></span>
<span class="normal"><a href="#__codelineno-0-455">455</a></span>
<span class="normal"><a href="#__codelineno-0-456">456</a></span>
<span class="normal"><a href="#__codelineno-0-457">457</a></span>
<span class="normal"><a href="#__codelineno-0-458">458</a></span>
<span class="normal"><a href="#__codelineno-0-459">459</a></span>
<span class="normal"><a href="#__codelineno-0-460">460</a></span>
<span class="normal"><a href="#__codelineno-0-461">461</a></span>
<span class="normal"><a href="#__codelineno-0-462">462</a></span>
<span class="normal"><a href="#__codelineno-0-463">463</a></span>
<span class="normal"><a href="#__codelineno-0-464">464</a></span>
<span class="normal"><a href="#__codelineno-0-465">465</a></span>
<span class="normal"><a href="#__codelineno-0-466">466</a></span>
<span class="normal"><a href="#__codelineno-0-467">467</a></span>
<span class="normal"><a href="#__codelineno-0-468">468</a></span>
<span class="normal"><a href="#__codelineno-0-469">469</a></span>
<span class="normal"><a href="#__codelineno-0-470">470</a></span>
<span class="normal"><a href="#__codelineno-0-471">471</a></span>
<span class="normal"><a href="#__codelineno-0-472">472</a></span>
<span class="normal"><a href="#__codelineno-0-473">473</a></span>
<span class="normal"><a href="#__codelineno-0-474">474</a></span>
<span class="normal"><a href="#__codelineno-0-475">475</a></span>
<span class="normal"><a href="#__codelineno-0-476">476</a></span>
<span class="normal"><a href="#__codelineno-0-477">477</a></span>
<span class="normal"><a href="#__codelineno-0-478">478</a></span>
<span class="normal"><a href="#__codelineno-0-479">479</a></span>
<span class="normal"><a href="#__codelineno-0-480">480</a></span>
<span class="normal"><a href="#__codelineno-0-481">481</a></span>
<span class="normal"><a href="#__codelineno-0-482">482</a></span>
<span class="normal"><a href="#__codelineno-0-483">483</a></span>
<span class="normal"><a href="#__codelineno-0-484">484</a></span>
<span class="normal"><a href="#__codelineno-0-485">485</a></span>
<span class="normal"><a href="#__codelineno-0-486">486</a></span>
<span class="normal"><a href="#__codelineno-0-487">487</a></span>
<span class="normal"><a href="#__codelineno-0-488">488</a></span>
<span class="normal"><a href="#__codelineno-0-489">489</a></span>
<span class="normal"><a href="#__codelineno-0-490">490</a></span>
<span class="normal"><a href="#__codelineno-0-491">491</a></span>
<span class="normal"><a href="#__codelineno-0-492">492</a></span>
<span class="normal"><a href="#__codelineno-0-493">493</a></span>
<span class="normal"><a href="#__codelineno-0-494">494</a></span>
<span class="normal"><a href="#__codelineno-0-495">495</a></span>
<span class="normal"><a href="#__codelineno-0-496">496</a></span>
<span class="normal"><a href="#__codelineno-0-497">497</a></span>
<span class="normal"><a href="#__codelineno-0-498">498</a></span>
<span class="normal"><a href="#__codelineno-0-499">499</a></span>
<span class="normal"><a href="#__codelineno-0-500">500</a></span>
<span class="normal"><a href="#__codelineno-0-501">501</a></span>
<span class="normal"><a href="#__codelineno-0-502">502</a></span>
<span class="normal"><a href="#__codelineno-0-503">503</a></span>
<span class="normal"><a href="#__codelineno-0-504">504</a></span>
<span class="normal"><a href="#__codelineno-0-505">505</a></span>
<span class="normal"><a href="#__codelineno-0-506">506</a></span>
<span class="normal"><a href="#__codelineno-0-507">507</a></span>
<span class="normal"><a href="#__codelineno-0-508">508</a></span>
<span class="normal"><a href="#__codelineno-0-509">509</a></span>
<span class="normal"><a href="#__codelineno-0-510">510</a></span>
<span class="normal"><a href="#__codelineno-0-511">511</a></span>
<span class="normal"><a href="#__codelineno-0-512">512</a></span>
<span class="normal"><a href="#__codelineno-0-513">513</a></span>
<span class="normal"><a href="#__codelineno-0-514">514</a></span>
<span class="normal"><a href="#__codelineno-0-515">515</a></span>
<span class="normal"><a href="#__codelineno-0-516">516</a></span>
<span class="normal"><a href="#__codelineno-0-517">517</a></span>
<span class="normal"><a href="#__codelineno-0-518">518</a></span>
<span class="normal"><a href="#__codelineno-0-519">519</a></span>
<span class="normal"><a href="#__codelineno-0-520">520</a></span>
<span class="normal"><a href="#__codelineno-0-521">521</a></span>
<span class="normal"><a href="#__codelineno-0-522">522</a></span>
<span class="normal"><a href="#__codelineno-0-523">523</a></span>
<span class="normal"><a href="#__codelineno-0-524">524</a></span>
<span class="normal"><a href="#__codelineno-0-525">525</a></span>
<span class="normal"><a href="#__codelineno-0-526">526</a></span>
<span class="normal"><a href="#__codelineno-0-527">527</a></span>
<span class="normal"><a href="#__codelineno-0-528">528</a></span>
<span class="normal"><a href="#__codelineno-0-529">529</a></span>
<span class="normal"><a href="#__codelineno-0-530">530</a></span>
<span class="normal"><a href="#__codelineno-0-531">531</a></span>
<span class="normal"><a href="#__codelineno-0-532">532</a></span>
<span class="normal"><a href="#__codelineno-0-533">533</a></span>
<span class="normal"><a href="#__codelineno-0-534">534</a></span>
<span class="normal"><a href="#__codelineno-0-535">535</a></span>
<span class="normal"><a href="#__codelineno-0-536">536</a></span>
<span class="normal"><a href="#__codelineno-0-537">537</a></span>
<span class="normal"><a href="#__codelineno-0-538">538</a></span>
<span class="normal"><a href="#__codelineno-0-539">539</a></span>
<span class="normal"><a href="#__codelineno-0-540">540</a></span>
<span class="normal"><a href="#__codelineno-0-541">541</a></span>
<span class="normal"><a href="#__codelineno-0-542">542</a></span>
<span class="normal"><a href="#__codelineno-0-543">543</a></span>
<span class="normal"><a href="#__codelineno-0-544">544</a></span>
<span class="normal"><a href="#__codelineno-0-545">545</a></span>
<span class="normal"><a href="#__codelineno-0-546">546</a></span>
<span class="normal"><a href="#__codelineno-0-547">547</a></span>
<span class="normal"><a href="#__codelineno-0-548">548</a></span>
<span class="normal"><a href="#__codelineno-0-549">549</a></span>
<span class="normal"><a href="#__codelineno-0-550">550</a></span>
<span class="normal"><a href="#__codelineno-0-551">551</a></span>
<span class="normal"><a href="#__codelineno-0-552">552</a></span>
<span class="normal"><a href="#__codelineno-0-553">553</a></span>
<span class="normal"><a href="#__codelineno-0-554">554</a></span>
<span class="normal"><a href="#__codelineno-0-555">555</a></span>
<span class="normal"><a href="#__codelineno-0-556">556</a></span>
<span class="normal"><a href="#__codelineno-0-557">557</a></span>
<span class="normal"><a href="#__codelineno-0-558">558</a></span>
<span class="normal"><a href="#__codelineno-0-559">559</a></span>
<span class="normal"><a href="#__codelineno-0-560">560</a></span>
<span class="normal"><a href="#__codelineno-0-561">561</a></span>
<span class="normal"><a href="#__codelineno-0-562">562</a></span>
<span class="normal"><a href="#__codelineno-0-563">563</a></span>
<span class="normal"><a href="#__codelineno-0-564">564</a></span>
<span class="normal"><a href="#__codelineno-0-565">565</a></span>
<span class="normal"><a href="#__codelineno-0-566">566</a></span>
<span class="normal"><a href="#__codelineno-0-567">567</a></span>
<span class="normal"><a href="#__codelineno-0-568">568</a></span>
<span class="normal"><a href="#__codelineno-0-569">569</a></span>
<span class="normal"><a href="#__codelineno-0-570">570</a></span>
<span class="normal"><a href="#__codelineno-0-571">571</a></span>
<span class="normal"><a href="#__codelineno-0-572">572</a></span>
<span class="normal"><a href="#__codelineno-0-573">573</a></span>
<span class="normal"><a href="#__codelineno-0-574">574</a></span>
<span class="normal"><a href="#__codelineno-0-575">575</a></span>
<span class="normal"><a href="#__codelineno-0-576">576</a></span>
<span class="normal"><a href="#__codelineno-0-577">577</a></span>
<span class="normal"><a href="#__codelineno-0-578">578</a></span>
<span class="normal"><a href="#__codelineno-0-579">579</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-279" name="__codelineno-0-279"></a><span class="k">def</span><span class="w"> </span><span class="nf">split</span><span class="p">(</span>
<a id="__codelineno-0-280" name="__codelineno-0-280"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-281" name="__codelineno-0-281"></a>    <span class="n">X</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span> <span class="o">|</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">|</span> <span class="n">pd</span><span class="o">.</span><span class="n">Index</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span> <span class="o">|</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">],</span>
<a id="__codelineno-0-282" name="__codelineno-0-282"></a>    <span class="n">as_pandas</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-283" name="__codelineno-0-283"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span> <span class="o">|</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<a id="__codelineno-0-284" name="__codelineno-0-284"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Split the time series data into train and test folds.</span>
<a id="__codelineno-0-285" name="__codelineno-0-285"></a>
<a id="__codelineno-0-286" name="__codelineno-0-286"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-287" name="__codelineno-0-287"></a><span class="sd">        X: Time series data or index to split. Can be a pandas Series, DataFrame,</span>
<a id="__codelineno-0-288" name="__codelineno-0-288"></a><span class="sd">            Index, or a dictionary of Series/DataFrames.</span>
<a id="__codelineno-0-289" name="__codelineno-0-289"></a><span class="sd">        as_pandas: If True, the folds are returned as a DataFrame. This is useful</span>
<a id="__codelineno-0-290" name="__codelineno-0-290"></a><span class="sd">            to visualize the folds in a more interpretable way. Defaults to False.</span>
<a id="__codelineno-0-291" name="__codelineno-0-291"></a>
<a id="__codelineno-0-292" name="__codelineno-0-292"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-293" name="__codelineno-0-293"></a><span class="sd">        A list of lists containing the indices (position) for each fold, or a</span>
<a id="__codelineno-0-294" name="__codelineno-0-294"></a><span class="sd">        DataFrame if `as_pandas=True`. Each list contains 4 lists and a boolean</span>
<a id="__codelineno-0-295" name="__codelineno-0-295"></a><span class="sd">        with the following information:</span>
<a id="__codelineno-0-296" name="__codelineno-0-296"></a>
<a id="__codelineno-0-297" name="__codelineno-0-297"></a><span class="sd">        - **fold**: fold number.</span>
<a id="__codelineno-0-298" name="__codelineno-0-298"></a><span class="sd">        - **[train_start, train_end]**: list with the start and end positions of</span>
<a id="__codelineno-0-299" name="__codelineno-0-299"></a><span class="sd">                the training set.</span>
<a id="__codelineno-0-300" name="__codelineno-0-300"></a><span class="sd">        - **[last_window_start, last_window_end]**: list with the start and end</span>
<a id="__codelineno-0-301" name="__codelineno-0-301"></a><span class="sd">                positions of the last window seen by the forecaster during training.</span>
<a id="__codelineno-0-302" name="__codelineno-0-302"></a><span class="sd">                The last window is used to generate the lags use as predictors. If</span>
<a id="__codelineno-0-303" name="__codelineno-0-303"></a><span class="sd">                `differentiation` is included, the interval is extended as many</span>
<a id="__codelineno-0-304" name="__codelineno-0-304"></a><span class="sd">                observations as the differentiation order. If the argument `window_size`</span>
<a id="__codelineno-0-305" name="__codelineno-0-305"></a><span class="sd">                is `None`, this list is empty.</span>
<a id="__codelineno-0-306" name="__codelineno-0-306"></a><span class="sd">        - **[test_start, test_end]**: list with the start and end positions of</span>
<a id="__codelineno-0-307" name="__codelineno-0-307"></a><span class="sd">                the test set. These are the observations used to evaluate the forecaster.</span>
<a id="__codelineno-0-308" name="__codelineno-0-308"></a><span class="sd">        - **[test_start_with_gap, test_end_with_gap]**: list with the start and</span>
<a id="__codelineno-0-309" name="__codelineno-0-309"></a><span class="sd">                end positions of the test set including the gap. The gap is the number</span>
<a id="__codelineno-0-310" name="__codelineno-0-310"></a><span class="sd">                of observations between the end of the training set and the start of</span>
<a id="__codelineno-0-311" name="__codelineno-0-311"></a><span class="sd">                the test set.</span>
<a id="__codelineno-0-312" name="__codelineno-0-312"></a><span class="sd">        - **fit_forecaster**: boolean indicating whether the forecaster should be</span>
<a id="__codelineno-0-313" name="__codelineno-0-313"></a><span class="sd">                fitted in this fold.</span>
<a id="__codelineno-0-314" name="__codelineno-0-314"></a>
<a id="__codelineno-0-315" name="__codelineno-0-315"></a><span class="sd">    Note:</span>
<a id="__codelineno-0-316" name="__codelineno-0-316"></a><span class="sd">        The returned values are the positions of the observations and not the</span>
<a id="__codelineno-0-317" name="__codelineno-0-317"></a><span class="sd">        actual values of the index, so they can be used to slice the data directly</span>
<a id="__codelineno-0-318" name="__codelineno-0-318"></a><span class="sd">        using iloc.</span>
<a id="__codelineno-0-319" name="__codelineno-0-319"></a>
<a id="__codelineno-0-320" name="__codelineno-0-320"></a><span class="sd">        If `as_pandas` is `True`, the folds are returned as a DataFrame with the</span>
<a id="__codelineno-0-321" name="__codelineno-0-321"></a><span class="sd">        following columns: &#39;fold&#39;, &#39;train_start&#39;, &#39;train_end&#39;, &#39;last_window_start&#39;,</span>
<a id="__codelineno-0-322" name="__codelineno-0-322"></a><span class="sd">        &#39;last_window_end&#39;, &#39;test_start&#39;, &#39;test_end&#39;, &#39;test_start_with_gap&#39;,</span>
<a id="__codelineno-0-323" name="__codelineno-0-323"></a><span class="sd">        &#39;test_end_with_gap&#39;, &#39;fit_forecaster&#39;.</span>
<a id="__codelineno-0-324" name="__codelineno-0-324"></a>
<a id="__codelineno-0-325" name="__codelineno-0-325"></a><span class="sd">        Following the python convention, the start index is inclusive and the end</span>
<a id="__codelineno-0-326" name="__codelineno-0-326"></a><span class="sd">        index is exclusive. This means that the last index is not included in the</span>
<a id="__codelineno-0-327" name="__codelineno-0-327"></a><span class="sd">        slice.</span>
<a id="__codelineno-0-328" name="__codelineno-0-328"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-329" name="__codelineno-0-329"></a>
<a id="__codelineno-0-330" name="__codelineno-0-330"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Index</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)):</span>
<a id="__codelineno-0-331" name="__codelineno-0-331"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
<a id="__codelineno-0-332" name="__codelineno-0-332"></a>            <span class="sa">f</span><span class="s2">&quot;X must be a pandas Series, DataFrame, Index or a dictionary. &quot;</span>
<a id="__codelineno-0-333" name="__codelineno-0-333"></a>            <span class="sa">f</span><span class="s2">&quot;Got </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">X</span><span class="p">)</span><span class="si">}</span><span class="s2">.&quot;</span>
<a id="__codelineno-0-334" name="__codelineno-0-334"></a>        <span class="p">)</span>
<a id="__codelineno-0-335" name="__codelineno-0-335"></a>
<a id="__codelineno-0-336" name="__codelineno-0-336"></a>    <span class="n">window_size_as_date_offset</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span>
<a id="__codelineno-0-337" name="__codelineno-0-337"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">window_size</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">tseries</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">DateOffset</span>
<a id="__codelineno-0-338" name="__codelineno-0-338"></a>    <span class="p">)</span>
<a id="__codelineno-0-339" name="__codelineno-0-339"></a>    <span class="k">if</span> <span class="n">window_size_as_date_offset</span><span class="p">:</span>
<a id="__codelineno-0-340" name="__codelineno-0-340"></a>        <span class="c1"># Calculate the window_size in steps. This is not a exact calculation</span>
<a id="__codelineno-0-341" name="__codelineno-0-341"></a>        <span class="c1"># because the offset follows the calendar rules and the distance between</span>
<a id="__codelineno-0-342" name="__codelineno-0-342"></a>        <span class="c1"># two dates may not be constant.</span>
<a id="__codelineno-0-343" name="__codelineno-0-343"></a>        <span class="n">first_valid_index</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_size</span>
<a id="__codelineno-0-344" name="__codelineno-0-344"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-345" name="__codelineno-0-345"></a>            <span class="n">window_size_idx_start</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_loc</span><span class="p">(</span><span class="n">first_valid_index</span><span class="p">)</span>
<a id="__codelineno-0-346" name="__codelineno-0-346"></a>            <span class="n">window_size_idx_end</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_loc</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<a id="__codelineno-0-347" name="__codelineno-0-347"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">window_size</span> <span class="o">=</span> <span class="n">window_size_idx_end</span> <span class="o">-</span> <span class="n">window_size_idx_start</span>
<a id="__codelineno-0-348" name="__codelineno-0-348"></a>        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
<a id="__codelineno-0-349" name="__codelineno-0-349"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-350" name="__codelineno-0-350"></a>                <span class="sa">f</span><span class="s2">&quot;The length of `y` (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)</span><span class="si">}</span><span class="s2">), must be greater than or equal &quot;</span>
<a id="__codelineno-0-351" name="__codelineno-0-351"></a>                <span class="sa">f</span><span class="s2">&quot;to the window size (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">window_size</span><span class="si">}</span><span class="s2">). This is because  &quot;</span>
<a id="__codelineno-0-352" name="__codelineno-0-352"></a>                <span class="sa">f</span><span class="s2">&quot;the offset (forecaster.offset) is larger than the available &quot;</span>
<a id="__codelineno-0-353" name="__codelineno-0-353"></a>                <span class="sa">f</span><span class="s2">&quot;data. Try to decrease the size of the offset (forecaster.offset), &quot;</span>
<a id="__codelineno-0-354" name="__codelineno-0-354"></a>                <span class="sa">f</span><span class="s2">&quot;the number of `n_offsets` (forecaster.n_offsets) or increase the &quot;</span>
<a id="__codelineno-0-355" name="__codelineno-0-355"></a>                <span class="sa">f</span><span class="s2">&quot;size of `y`.&quot;</span>
<a id="__codelineno-0-356" name="__codelineno-0-356"></a>            <span class="p">)</span>
<a id="__codelineno-0-357" name="__codelineno-0-357"></a>
<a id="__codelineno-0-358" name="__codelineno-0-358"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_train_size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-359" name="__codelineno-0-359"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-360" name="__codelineno-0-360"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-361" name="__codelineno-0-361"></a>                <span class="s2">&quot;To use split method when `initial_train_size` is None, &quot;</span>
<a id="__codelineno-0-362" name="__codelineno-0-362"></a>                <span class="s2">&quot;`window_size` must be an integer greater than 0. &quot;</span>
<a id="__codelineno-0-363" name="__codelineno-0-363"></a>                <span class="s2">&quot;Although no initial training is done and all data is used to &quot;</span>
<a id="__codelineno-0-364" name="__codelineno-0-364"></a>                <span class="s2">&quot;evaluate the model, the first `window_size` observations are &quot;</span>
<a id="__codelineno-0-365" name="__codelineno-0-365"></a>                <span class="s2">&quot;needed to create the initial predictors. Got `window_size` = None.&quot;</span>
<a id="__codelineno-0-366" name="__codelineno-0-366"></a>            <span class="p">)</span>
<a id="__codelineno-0-367" name="__codelineno-0-367"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">refit</span><span class="p">:</span>
<a id="__codelineno-0-368" name="__codelineno-0-368"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-369" name="__codelineno-0-369"></a>                <span class="s2">&quot;`refit` is only allowed when `initial_train_size` is not `None`. &quot;</span>
<a id="__codelineno-0-370" name="__codelineno-0-370"></a>                <span class="s2">&quot;Set `refit` to `False` if you want to use `initial_train_size = None`.&quot;</span>
<a id="__codelineno-0-371" name="__codelineno-0-371"></a>            <span class="p">)</span>
<a id="__codelineno-0-372" name="__codelineno-0-372"></a>        <span class="n">externally_fitted</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-373" name="__codelineno-0-373"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">initial_train_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_size</span>  <span class="c1"># Reset to None later</span>
<a id="__codelineno-0-374" name="__codelineno-0-374"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-375" name="__codelineno-0-375"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-376" name="__codelineno-0-376"></a>            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
<a id="__codelineno-0-377" name="__codelineno-0-377"></a>                <span class="s2">&quot;Last window cannot be calculated because `window_size` is None.&quot;</span><span class="p">,</span>
<a id="__codelineno-0-378" name="__codelineno-0-378"></a>                <span class="n">IgnoredArgumentWarning</span><span class="p">,</span>
<a id="__codelineno-0-379" name="__codelineno-0-379"></a>            <span class="p">)</span>
<a id="__codelineno-0-380" name="__codelineno-0-380"></a>        <span class="n">externally_fitted</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-381" name="__codelineno-0-381"></a>
<a id="__codelineno-0-382" name="__codelineno-0-382"></a>    <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_index</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<a id="__codelineno-0-383" name="__codelineno-0-383"></a>    <span class="n">idx</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">index</span><span class="p">))</span>
<a id="__codelineno-0-384" name="__codelineno-0-384"></a>    <span class="n">folds</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-385" name="__codelineno-0-385"></a>    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-386" name="__codelineno-0-386"></a>
<a id="__codelineno-0-387" name="__codelineno-0-387"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">initial_train_size</span> <span class="o">=</span> <span class="n">date_to_index_position</span><span class="p">(</span>
<a id="__codelineno-0-388" name="__codelineno-0-388"></a>        <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">,</span>
<a id="__codelineno-0-389" name="__codelineno-0-389"></a>        <span class="n">date_input</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_train_size</span><span class="p">,</span>
<a id="__codelineno-0-390" name="__codelineno-0-390"></a>        <span class="n">method</span><span class="o">=</span><span class="s2">&quot;validation&quot;</span><span class="p">,</span>
<a id="__codelineno-0-391" name="__codelineno-0-391"></a>        <span class="n">date_literal</span><span class="o">=</span><span class="s2">&quot;initial_train_size&quot;</span><span class="p">,</span>
<a id="__codelineno-0-392" name="__codelineno-0-392"></a>    <span class="p">)</span>
<a id="__codelineno-0-393" name="__codelineno-0-393"></a>
<a id="__codelineno-0-394" name="__codelineno-0-394"></a>    <span class="k">if</span> <span class="n">window_size_as_date_offset</span><span class="p">:</span>
<a id="__codelineno-0-395" name="__codelineno-0-395"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_train_size</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-396" name="__codelineno-0-396"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_train_size</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_size</span><span class="p">:</span>
<a id="__codelineno-0-397" name="__codelineno-0-397"></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-398" name="__codelineno-0-398"></a>                    <span class="sa">f</span><span class="s2">&quot;If `initial_train_size` is an integer, it must be greater than &quot;</span>
<a id="__codelineno-0-399" name="__codelineno-0-399"></a>                    <span class="sa">f</span><span class="s2">&quot;the `window_size` of the forecaster (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">window_size</span><span class="si">}</span><span class="s2">) &quot;</span>
<a id="__codelineno-0-400" name="__codelineno-0-400"></a>                    <span class="sa">f</span><span class="s2">&quot;and smaller than the length of the series (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)</span><span class="si">}</span><span class="s2">). If &quot;</span>
<a id="__codelineno-0-401" name="__codelineno-0-401"></a>                    <span class="sa">f</span><span class="s2">&quot;it is a date, it must be within this range of the index.&quot;</span>
<a id="__codelineno-0-402" name="__codelineno-0-402"></a>                <span class="p">)</span>
<a id="__codelineno-0-403" name="__codelineno-0-403"></a>
<a id="__codelineno-0-404" name="__codelineno-0-404"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">allow_incomplete_fold</span><span class="p">:</span>
<a id="__codelineno-0-405" name="__codelineno-0-405"></a>        <span class="c1"># At least one observation after the gap to allow incomplete fold</span>
<a id="__codelineno-0-406" name="__codelineno-0-406"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">index</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_train_size</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">gap</span><span class="p">:</span>
<a id="__codelineno-0-407" name="__codelineno-0-407"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-408" name="__codelineno-0-408"></a>                <span class="sa">f</span><span class="s2">&quot;The time series must have more than `initial_train_size + gap` &quot;</span>
<a id="__codelineno-0-409" name="__codelineno-0-409"></a>                <span class="sa">f</span><span class="s2">&quot;observations to create at least one fold.</span><span class="se">\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-410" name="__codelineno-0-410"></a>                <span class="sa">f</span><span class="s2">&quot;    Time series length: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">index</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-411" name="__codelineno-0-411"></a>                <span class="sa">f</span><span class="s2">&quot;    Required &gt; </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_train_size</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">gap</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-412" name="__codelineno-0-412"></a>                <span class="sa">f</span><span class="s2">&quot;    initial_train_size: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_train_size</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-413" name="__codelineno-0-413"></a>                <span class="sa">f</span><span class="s2">&quot;    gap: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">gap</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-414" name="__codelineno-0-414"></a>            <span class="p">)</span>
<a id="__codelineno-0-415" name="__codelineno-0-415"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-416" name="__codelineno-0-416"></a>        <span class="c1"># At least one complete fold</span>
<a id="__codelineno-0-417" name="__codelineno-0-417"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">index</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_train_size</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">gap</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">steps</span><span class="p">:</span>
<a id="__codelineno-0-418" name="__codelineno-0-418"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-419" name="__codelineno-0-419"></a>                <span class="sa">f</span><span class="s2">&quot;The time series must have at least `initial_train_size + gap + steps` &quot;</span>
<a id="__codelineno-0-420" name="__codelineno-0-420"></a>                <span class="sa">f</span><span class="s2">&quot;observations to create a minimum of one complete fold &quot;</span>
<a id="__codelineno-0-421" name="__codelineno-0-421"></a>                <span class="sa">f</span><span class="s2">&quot;(allow_incomplete_fold=False).</span><span class="se">\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-422" name="__codelineno-0-422"></a>                <span class="sa">f</span><span class="s2">&quot;    Time series length: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">index</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-423" name="__codelineno-0-423"></a>                <span class="sa">f</span><span class="s2">&quot;    Required &gt;= </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_train_size</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">gap</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">steps</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-424" name="__codelineno-0-424"></a>                <span class="sa">f</span><span class="s2">&quot;    initial_train_size: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_train_size</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-425" name="__codelineno-0-425"></a>                <span class="sa">f</span><span class="s2">&quot;    gap: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">gap</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-426" name="__codelineno-0-426"></a>                <span class="sa">f</span><span class="s2">&quot;    steps: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">steps</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-427" name="__codelineno-0-427"></a>            <span class="p">)</span>
<a id="__codelineno-0-428" name="__codelineno-0-428"></a>
<a id="__codelineno-0-429" name="__codelineno-0-429"></a>    <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_train_size</span> <span class="o">+</span> <span class="p">(</span><span class="n">i</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">fold_stride</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">gap</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">index</span><span class="p">):</span>
<a id="__codelineno-0-430" name="__codelineno-0-430"></a>
<a id="__codelineno-0-431" name="__codelineno-0-431"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">refit</span><span class="p">:</span>
<a id="__codelineno-0-432" name="__codelineno-0-432"></a>            <span class="c1"># NOTE: If `fixed_train_size` the train size doesn&#39;t increase but</span>
<a id="__codelineno-0-433" name="__codelineno-0-433"></a>            <span class="c1"># moves by `fold_stride` positions in each iteration. If `False`,</span>
<a id="__codelineno-0-434" name="__codelineno-0-434"></a>            <span class="c1"># the train size increases by `fold_stride` in each iteration.</span>
<a id="__codelineno-0-435" name="__codelineno-0-435"></a>            <span class="n">train_iloc_start</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-436" name="__codelineno-0-436"></a>                <span class="n">i</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fold_stride</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fixed_train_size</span> <span class="k">else</span> <span class="mi">0</span>
<a id="__codelineno-0-437" name="__codelineno-0-437"></a>            <span class="p">)</span>
<a id="__codelineno-0-438" name="__codelineno-0-438"></a>            <span class="n">train_iloc_end</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_train_size</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fold_stride</span><span class="p">)</span>
<a id="__codelineno-0-439" name="__codelineno-0-439"></a>            <span class="n">test_iloc_start</span> <span class="o">=</span> <span class="n">train_iloc_end</span>
<a id="__codelineno-0-440" name="__codelineno-0-440"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-441" name="__codelineno-0-441"></a>            <span class="c1"># NOTE: The train size doesn&#39;t increase and doesn&#39;t move.</span>
<a id="__codelineno-0-442" name="__codelineno-0-442"></a>            <span class="n">train_iloc_start</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-443" name="__codelineno-0-443"></a>            <span class="n">train_iloc_end</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_train_size</span>
<a id="__codelineno-0-444" name="__codelineno-0-444"></a>            <span class="n">test_iloc_start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_train_size</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fold_stride</span><span class="p">)</span>
<a id="__codelineno-0-445" name="__codelineno-0-445"></a>
<a id="__codelineno-0-446" name="__codelineno-0-446"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_size</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-447" name="__codelineno-0-447"></a>            <span class="n">last_window_iloc_start</span> <span class="o">=</span> <span class="n">test_iloc_start</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_size</span>
<a id="__codelineno-0-448" name="__codelineno-0-448"></a>
<a id="__codelineno-0-449" name="__codelineno-0-449"></a>        <span class="n">test_iloc_end</span> <span class="o">=</span> <span class="n">test_iloc_start</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">gap</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">steps</span>
<a id="__codelineno-0-450" name="__codelineno-0-450"></a>
<a id="__codelineno-0-451" name="__codelineno-0-451"></a>        <span class="n">partitions</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-452" name="__codelineno-0-452"></a>            <span class="n">idx</span><span class="p">[</span><span class="n">train_iloc_start</span><span class="p">:</span><span class="n">train_iloc_end</span><span class="p">],</span>
<a id="__codelineno-0-453" name="__codelineno-0-453"></a>            <span class="p">(</span>
<a id="__codelineno-0-454" name="__codelineno-0-454"></a>                <span class="n">idx</span><span class="p">[</span><span class="n">last_window_iloc_start</span><span class="p">:</span><span class="n">test_iloc_start</span><span class="p">]</span>
<a id="__codelineno-0-455" name="__codelineno-0-455"></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_size</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
<a id="__codelineno-0-456" name="__codelineno-0-456"></a>                <span class="k">else</span> <span class="p">[]</span>
<a id="__codelineno-0-457" name="__codelineno-0-457"></a>            <span class="p">),</span>
<a id="__codelineno-0-458" name="__codelineno-0-458"></a>            <span class="n">idx</span><span class="p">[</span><span class="n">test_iloc_start</span><span class="p">:</span><span class="n">test_iloc_end</span><span class="p">],</span>
<a id="__codelineno-0-459" name="__codelineno-0-459"></a>            <span class="n">idx</span><span class="p">[</span><span class="n">test_iloc_start</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">gap</span> <span class="p">:</span> <span class="n">test_iloc_end</span><span class="p">],</span>
<a id="__codelineno-0-460" name="__codelineno-0-460"></a>        <span class="p">]</span>
<a id="__codelineno-0-461" name="__codelineno-0-461"></a>        <span class="n">folds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">partitions</span><span class="p">)</span>
<a id="__codelineno-0-462" name="__codelineno-0-462"></a>        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-0-463" name="__codelineno-0-463"></a>
<a id="__codelineno-0-464" name="__codelineno-0-464"></a>    <span class="c1"># NOTE: Delete all incomplete folds at the end if not allowed</span>
<a id="__codelineno-0-465" name="__codelineno-0-465"></a>    <span class="n">n_removed_folds</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-466" name="__codelineno-0-466"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">allow_incomplete_fold</span><span class="p">:</span>
<a id="__codelineno-0-467" name="__codelineno-0-467"></a>        <span class="c1"># NOTE: While folds and the last &quot;test_index_with_gap&quot; is incomplete,</span>
<a id="__codelineno-0-468" name="__codelineno-0-468"></a>        <span class="c1"># calculating len of range objects</span>
<a id="__codelineno-0-469" name="__codelineno-0-469"></a>        <span class="k">while</span> <span class="n">folds</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">folds</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">3</span><span class="p">])</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">steps</span><span class="p">:</span>
<a id="__codelineno-0-470" name="__codelineno-0-470"></a>            <span class="n">folds</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
<a id="__codelineno-0-471" name="__codelineno-0-471"></a>            <span class="n">n_removed_folds</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-0-472" name="__codelineno-0-472"></a>
<a id="__codelineno-0-473" name="__codelineno-0-473"></a>    <span class="c1"># Replace partitions inside folds with length 0 with `None`</span>
<a id="__codelineno-0-474" name="__codelineno-0-474"></a>    <span class="n">folds</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-475" name="__codelineno-0-475"></a>        <span class="p">[</span><span class="n">partition</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">partition</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">partition</span> <span class="ow">in</span> <span class="n">fold</span><span class="p">]</span>
<a id="__codelineno-0-476" name="__codelineno-0-476"></a>        <span class="k">for</span> <span class="n">fold</span> <span class="ow">in</span> <span class="n">folds</span>
<a id="__codelineno-0-477" name="__codelineno-0-477"></a>    <span class="p">]</span>
<a id="__codelineno-0-478" name="__codelineno-0-478"></a>
<a id="__codelineno-0-479" name="__codelineno-0-479"></a>    <span class="c1"># Create a flag to know whether to train the forecaster</span>
<a id="__codelineno-0-480" name="__codelineno-0-480"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">refit</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-481" name="__codelineno-0-481"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">refit</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-482" name="__codelineno-0-482"></a>
<a id="__codelineno-0-483" name="__codelineno-0-483"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">refit</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
<a id="__codelineno-0-484" name="__codelineno-0-484"></a>        <span class="n">fit_forecaster</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">refit</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">folds</span><span class="p">)</span>
<a id="__codelineno-0-485" name="__codelineno-0-485"></a>        <span class="n">fit_forecaster</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-486" name="__codelineno-0-486"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-487" name="__codelineno-0-487"></a>        <span class="n">fit_forecaster</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">folds</span><span class="p">)</span>
<a id="__codelineno-0-488" name="__codelineno-0-488"></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">fit_forecaster</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">refit</span><span class="p">):</span>
<a id="__codelineno-0-489" name="__codelineno-0-489"></a>            <span class="n">fit_forecaster</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-490" name="__codelineno-0-490"></a>
<a id="__codelineno-0-491" name="__codelineno-0-491"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">folds</span><span class="p">)):</span>
<a id="__codelineno-0-492" name="__codelineno-0-492"></a>        <span class="n">folds</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
<a id="__codelineno-0-493" name="__codelineno-0-493"></a>        <span class="n">folds</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fit_forecaster</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
<a id="__codelineno-0-494" name="__codelineno-0-494"></a>        <span class="k">if</span> <span class="n">fit_forecaster</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
<a id="__codelineno-0-495" name="__codelineno-0-495"></a>            <span class="n">folds</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">folds</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-496" name="__codelineno-0-496"></a>
<a id="__codelineno-0-497" name="__codelineno-0-497"></a>    <span class="n">index_to_skip</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-498" name="__codelineno-0-498"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">skip_folds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-499" name="__codelineno-0-499"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">skip_folds</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">integer</span><span class="p">))</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">skip_folds</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-500" name="__codelineno-0-500"></a>            <span class="n">index_to_keep</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">folds</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">skip_folds</span><span class="p">)</span>
<a id="__codelineno-0-501" name="__codelineno-0-501"></a>            <span class="n">index_to_skip</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">setdiff1d</span><span class="p">(</span>
<a id="__codelineno-0-502" name="__codelineno-0-502"></a>                <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">folds</span><span class="p">)),</span> <span class="n">index_to_keep</span><span class="p">,</span> <span class="n">assume_unique</span><span class="o">=</span><span class="kc">True</span>
<a id="__codelineno-0-503" name="__codelineno-0-503"></a>            <span class="p">)</span>
<a id="__codelineno-0-504" name="__codelineno-0-504"></a>            <span class="n">index_to_skip</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-505" name="__codelineno-0-505"></a>                <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">index_to_skip</span>
<a id="__codelineno-0-506" name="__codelineno-0-506"></a>            <span class="p">]</span>  <span class="c1"># Required since numpy 2.0</span>
<a id="__codelineno-0-507" name="__codelineno-0-507"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">skip_folds</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
<a id="__codelineno-0-508" name="__codelineno-0-508"></a>            <span class="n">index_to_skip</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">skip_folds</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">folds</span><span class="p">)]</span>
<a id="__codelineno-0-509" name="__codelineno-0-509"></a>
<a id="__codelineno-0-510" name="__codelineno-0-510"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
<a id="__codelineno-0-511" name="__codelineno-0-511"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_print_info</span><span class="p">(</span>
<a id="__codelineno-0-512" name="__codelineno-0-512"></a>            <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">,</span>
<a id="__codelineno-0-513" name="__codelineno-0-513"></a>            <span class="n">folds</span><span class="o">=</span><span class="n">folds</span><span class="p">,</span>
<a id="__codelineno-0-514" name="__codelineno-0-514"></a>            <span class="n">externally_fitted</span><span class="o">=</span><span class="n">externally_fitted</span><span class="p">,</span>
<a id="__codelineno-0-515" name="__codelineno-0-515"></a>            <span class="n">n_removed_folds</span><span class="o">=</span><span class="n">n_removed_folds</span><span class="p">,</span>
<a id="__codelineno-0-516" name="__codelineno-0-516"></a>            <span class="n">index_to_skip</span><span class="o">=</span><span class="n">index_to_skip</span><span class="p">,</span>
<a id="__codelineno-0-517" name="__codelineno-0-517"></a>        <span class="p">)</span>
<a id="__codelineno-0-518" name="__codelineno-0-518"></a>
<a id="__codelineno-0-519" name="__codelineno-0-519"></a>    <span class="n">folds</span> <span class="o">=</span> <span class="p">[</span><span class="n">fold</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">fold</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">folds</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">index_to_skip</span><span class="p">]</span>
<a id="__codelineno-0-520" name="__codelineno-0-520"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">return_all_indexes</span><span class="p">:</span>
<a id="__codelineno-0-521" name="__codelineno-0-521"></a>        <span class="c1"># NOTE: +1 to prevent iloc pandas from deleting the last observation</span>
<a id="__codelineno-0-522" name="__codelineno-0-522"></a>        <span class="n">folds</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-523" name="__codelineno-0-523"></a>            <span class="p">[</span>
<a id="__codelineno-0-524" name="__codelineno-0-524"></a>                <span class="n">fold</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
<a id="__codelineno-0-525" name="__codelineno-0-525"></a>                <span class="p">[</span><span class="n">fold</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">fold</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span>
<a id="__codelineno-0-526" name="__codelineno-0-526"></a>                <span class="p">(</span>
<a id="__codelineno-0-527" name="__codelineno-0-527"></a>                    <span class="p">[</span><span class="n">fold</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">fold</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-528" name="__codelineno-0-528"></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_size</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
<a id="__codelineno-0-529" name="__codelineno-0-529"></a>                    <span class="k">else</span> <span class="p">[]</span>
<a id="__codelineno-0-530" name="__codelineno-0-530"></a>                <span class="p">),</span>
<a id="__codelineno-0-531" name="__codelineno-0-531"></a>                <span class="p">[</span><span class="n">fold</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">fold</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span>
<a id="__codelineno-0-532" name="__codelineno-0-532"></a>                <span class="p">[</span><span class="n">fold</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">fold</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span>
<a id="__codelineno-0-533" name="__codelineno-0-533"></a>                <span class="n">fold</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span>
<a id="__codelineno-0-534" name="__codelineno-0-534"></a>            <span class="p">]</span>
<a id="__codelineno-0-535" name="__codelineno-0-535"></a>            <span class="k">for</span> <span class="n">fold</span> <span class="ow">in</span> <span class="n">folds</span>
<a id="__codelineno-0-536" name="__codelineno-0-536"></a>        <span class="p">]</span>
<a id="__codelineno-0-537" name="__codelineno-0-537"></a>
<a id="__codelineno-0-538" name="__codelineno-0-538"></a>    <span class="k">if</span> <span class="n">externally_fitted</span><span class="p">:</span>
<a id="__codelineno-0-539" name="__codelineno-0-539"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">initial_train_size</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-540" name="__codelineno-0-540"></a>        <span class="n">folds</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-541" name="__codelineno-0-541"></a>
<a id="__codelineno-0-542" name="__codelineno-0-542"></a>    <span class="k">if</span> <span class="n">as_pandas</span><span class="p">:</span>
<a id="__codelineno-0-543" name="__codelineno-0-543"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-544" name="__codelineno-0-544"></a>            <span class="k">for</span> <span class="n">fold</span> <span class="ow">in</span> <span class="n">folds</span><span class="p">:</span>
<a id="__codelineno-0-545" name="__codelineno-0-545"></a>                <span class="n">fold</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
<a id="__codelineno-0-546" name="__codelineno-0-546"></a>
<a id="__codelineno-0-547" name="__codelineno-0-547"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">return_all_indexes</span><span class="p">:</span>
<a id="__codelineno-0-548" name="__codelineno-0-548"></a>            <span class="n">folds</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
<a id="__codelineno-0-549" name="__codelineno-0-549"></a>                <span class="n">data</span><span class="o">=</span><span class="p">[</span>
<a id="__codelineno-0-550" name="__codelineno-0-550"></a>                    <span class="p">[</span><span class="n">fold</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span><span class="o">*</span><span class="n">fold</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span> <span class="o">+</span> <span class="p">[</span><span class="n">fold</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
<a id="__codelineno-0-551" name="__codelineno-0-551"></a>                    <span class="k">for</span> <span class="n">fold</span> <span class="ow">in</span> <span class="n">folds</span>
<a id="__codelineno-0-552" name="__codelineno-0-552"></a>                <span class="p">],</span>
<a id="__codelineno-0-553" name="__codelineno-0-553"></a>                <span class="n">columns</span><span class="o">=</span><span class="p">[</span>
<a id="__codelineno-0-554" name="__codelineno-0-554"></a>                    <span class="s2">&quot;fold&quot;</span><span class="p">,</span>
<a id="__codelineno-0-555" name="__codelineno-0-555"></a>                    <span class="s2">&quot;train_start&quot;</span><span class="p">,</span>
<a id="__codelineno-0-556" name="__codelineno-0-556"></a>                    <span class="s2">&quot;train_end&quot;</span><span class="p">,</span>
<a id="__codelineno-0-557" name="__codelineno-0-557"></a>                    <span class="s2">&quot;last_window_start&quot;</span><span class="p">,</span>
<a id="__codelineno-0-558" name="__codelineno-0-558"></a>                    <span class="s2">&quot;last_window_end&quot;</span><span class="p">,</span>
<a id="__codelineno-0-559" name="__codelineno-0-559"></a>                    <span class="s2">&quot;test_start&quot;</span><span class="p">,</span>
<a id="__codelineno-0-560" name="__codelineno-0-560"></a>                    <span class="s2">&quot;test_end&quot;</span><span class="p">,</span>
<a id="__codelineno-0-561" name="__codelineno-0-561"></a>                    <span class="s2">&quot;test_start_with_gap&quot;</span><span class="p">,</span>
<a id="__codelineno-0-562" name="__codelineno-0-562"></a>                    <span class="s2">&quot;test_end_with_gap&quot;</span><span class="p">,</span>
<a id="__codelineno-0-563" name="__codelineno-0-563"></a>                    <span class="s2">&quot;fit_forecaster&quot;</span><span class="p">,</span>
<a id="__codelineno-0-564" name="__codelineno-0-564"></a>                <span class="p">],</span>
<a id="__codelineno-0-565" name="__codelineno-0-565"></a>            <span class="p">)</span>
<a id="__codelineno-0-566" name="__codelineno-0-566"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-567" name="__codelineno-0-567"></a>            <span class="n">folds</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
<a id="__codelineno-0-568" name="__codelineno-0-568"></a>                <span class="n">data</span><span class="o">=</span><span class="n">folds</span><span class="p">,</span>
<a id="__codelineno-0-569" name="__codelineno-0-569"></a>                <span class="n">columns</span><span class="o">=</span><span class="p">[</span>
<a id="__codelineno-0-570" name="__codelineno-0-570"></a>                    <span class="s2">&quot;fold&quot;</span><span class="p">,</span>
<a id="__codelineno-0-571" name="__codelineno-0-571"></a>                    <span class="s2">&quot;train_index&quot;</span><span class="p">,</span>
<a id="__codelineno-0-572" name="__codelineno-0-572"></a>                    <span class="s2">&quot;last_window_index&quot;</span><span class="p">,</span>
<a id="__codelineno-0-573" name="__codelineno-0-573"></a>                    <span class="s2">&quot;test_index&quot;</span><span class="p">,</span>
<a id="__codelineno-0-574" name="__codelineno-0-574"></a>                    <span class="s2">&quot;test_index_with_gap&quot;</span><span class="p">,</span>
<a id="__codelineno-0-575" name="__codelineno-0-575"></a>                    <span class="s2">&quot;fit_forecaster&quot;</span><span class="p">,</span>
<a id="__codelineno-0-576" name="__codelineno-0-576"></a>                <span class="p">],</span>
<a id="__codelineno-0-577" name="__codelineno-0-577"></a>            <span class="p">)</span>
<a id="__codelineno-0-578" name="__codelineno-0-578"></a>
<a id="__codelineno-0-579" name="__codelineno-0-579"></a>    <span class="k">return</span> <span class="n">folds</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><h3 id="design-philosophy-for-safety-critical-validation">Design Philosophy for Safety-Critical Validation</h3>
<p>In safety-critical forecasting (medical devices, autonomous systems, financial trading), improper validation can lead to catastrophic failures in production. TimeSeriesFold implements several defensive patterns:</p>
<ol>
<li>Temporal Integrity Enforcement: Strict chronological ordering prevents look-ahead bias that would invalidate safety assessments</li>
<li>Realistic Retraining Simulation: Configurable refit strategies mirror actual production deployment patterns</li>
<li>Gap Handling: Models the delay between data availability and prediction requirements</li>
<li>Incomplete Fold Management: Handles edge cases at data boundaries that could cause production failures</li>
</ol>
<h3 id="timeseriesfold-as-a-fallback-mechanism">TimeSeriesFold as a Fallback Mechanism</h3>
<p>The TimeSeriesFold class serves multiple roles in a defense-in-depth validation strategy:</p>
<ul>
<li>Primary Validation Layer: Provides the fundamental train/test split infrastructure for all model evaluation</li>
<li>Degradation Detection: Regular backtesting with fixed fold configurations detects model performance decay over time</li>
<li>A/B Test Infrastructure: Consistent fold generation ensures fair comparison between model versions</li>
<li>Rollback Validation: Enables testing whether reverting to an older model would improve performance</li>
<li>Stress Testing Framework: Configurable parameters allow testing models under various temporal conditions</li>
</ul>
<h3 id="understanding-fold-configuration-parameters">Understanding Fold Configuration Parameters</h3>
<p>The fold configuration directly impacts validation realism and computational cost. Key tradeoffs:</p>
<ol>
<li>initial_train_size: Larger values provide more stable models but reduce validation data</li>
<li>refit frequency: More frequent refitting increases realism but multiplies computational cost</li>
<li>fixed_train_size vs expanding window: Fixed mimics resource-constrained systems, expanding uses all available information</li>
<li>fold_stride: Smaller strides provide more evaluation points but increase overlap and computation</li>
<li>gap: Models real-world delays between data collection and prediction deployment</li>
</ol>
<h3 id="safety-critical-configuration-patterns">Safety-Critical Configuration Patterns</h3>
<p>Different safety-critical applications require different validation strategies:</p>
<ol>
<li>High-Frequency Trading: Small gaps (seconds), frequent refit, fixed window to match production constraints</li>
<li>Medical Monitoring: Expanding window (use all patient history), moderate refit, strict temporal gaps</li>
<li>Energy Grid Management: Daily/weekly refit cycles, expanding window, minimal gaps for immediate response</li>
<li>Autonomous Vehicles: Very frequent refit (continuous learning), small fixed windows for real-time constraints</li>
</ol>
<h3 id="complete-examples_1">Complete Examples</h3>
<h4 id="example-1-medical-device-validation-expanding-window-strategy">Example 1: Medical Device Validation - Expanding Window Strategy</h4>
<p>This example demonstrates validation for a medical monitoring system where patient safety depends on reliable predictions. The expanding window strategy uses all available patient history.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.ensemble</span><span class="w"> </span><span class="kn">import</span> <span class="n">RandomForestRegressor</span>
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="kn">from</span><span class="w"> </span><span class="nn">spotforecast2_safe.forecaster.recursive</span><span class="w"> </span><span class="kn">import</span> <span class="n">ForecasterRecursive</span>
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="kn">from</span><span class="w"> </span><span class="nn">spotforecast2.model_selection</span><span class="w"> </span><span class="kn">import</span> <span class="n">backtesting_forecaster</span><span class="p">,</span> <span class="n">TimeSeriesFold</span>
<a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a>
<a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a><span class="c1"># Simulate patient vital signs monitoring (heart rate)</span>
<a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a><span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">(</span><span class="mi">123</span><span class="p">)</span>
<a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a><span class="n">dates</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s2">&quot;2024-01-01&quot;</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">30</span> <span class="o">*</span> <span class="mi">24</span> <span class="o">*</span> <span class="mi">60</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s2">&quot;min&quot;</span><span class="p">)</span>  <span class="c1"># 30 days, 1-minute intervals</span>
<a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a>
<a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a><span class="c1"># Baseline heart rate with circadian rhythm and random variations</span>
<a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a><span class="n">hour_of_day</span> <span class="o">=</span> <span class="n">dates</span><span class="o">.</span><span class="n">hour</span> <span class="o">+</span> <span class="n">dates</span><span class="o">.</span><span class="n">minute</span> <span class="o">/</span> <span class="mi">60</span>
<a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a><span class="n">circadian_pattern</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="p">(</span><span class="n">hour_of_day</span> <span class="o">-</span> <span class="mi">6</span><span class="p">)</span> <span class="o">/</span> <span class="mi">24</span><span class="p">)</span>  <span class="c1"># Peak afternoon</span>
<a id="__codelineno-4-14" name="__codelineno-4-14" href="#__codelineno-4-14"></a><span class="n">baseline_hr</span> <span class="o">=</span> <span class="mi">70</span>
<a id="__codelineno-4-15" name="__codelineno-4-15" href="#__codelineno-4-15"></a><span class="n">noise</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">dates</span><span class="p">))</span>
<a id="__codelineno-4-16" name="__codelineno-4-16" href="#__codelineno-4-16"></a><span class="c1"># Simulate gradual patient deterioration</span>
<a id="__codelineno-4-17" name="__codelineno-4-17" href="#__codelineno-4-17"></a><span class="n">deterioration</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">dates</span><span class="p">))</span>
<a id="__codelineno-4-18" name="__codelineno-4-18" href="#__codelineno-4-18"></a>
<a id="__codelineno-4-19" name="__codelineno-4-19" href="#__codelineno-4-19"></a><span class="n">y</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span>
<a id="__codelineno-4-20" name="__codelineno-4-20" href="#__codelineno-4-20"></a>    <span class="n">baseline_hr</span> <span class="o">+</span> <span class="n">circadian_pattern</span> <span class="o">+</span> <span class="n">deterioration</span> <span class="o">+</span> <span class="n">noise</span><span class="p">,</span>
<a id="__codelineno-4-21" name="__codelineno-4-21" href="#__codelineno-4-21"></a>    <span class="n">index</span><span class="o">=</span><span class="n">dates</span><span class="p">,</span>
<a id="__codelineno-4-22" name="__codelineno-4-22" href="#__codelineno-4-22"></a>    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;heart_rate_bpm&quot;</span><span class="p">,</span>
<a id="__codelineno-4-23" name="__codelineno-4-23" href="#__codelineno-4-23"></a><span class="p">)</span>
<a id="__codelineno-4-24" name="__codelineno-4-24" href="#__codelineno-4-24"></a>
<a id="__codelineno-4-25" name="__codelineno-4-25" href="#__codelineno-4-25"></a><span class="c1"># Medical device configuration: Conservative, expanding window</span>
<a id="__codelineno-4-26" name="__codelineno-4-26" href="#__codelineno-4-26"></a><span class="n">forecaster</span> <span class="o">=</span> <span class="n">ForecasterRecursive</span><span class="p">(</span>
<a id="__codelineno-4-27" name="__codelineno-4-27" href="#__codelineno-4-27"></a>    <span class="n">estimator</span><span class="o">=</span><span class="n">RandomForestRegressor</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">),</span>
<a id="__codelineno-4-28" name="__codelineno-4-28" href="#__codelineno-4-28"></a>    <span class="n">lags</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span>  <span class="c1"># Last 60 minutes of data</span>
<a id="__codelineno-4-29" name="__codelineno-4-29" href="#__codelineno-4-29"></a><span class="p">)</span>
<a id="__codelineno-4-30" name="__codelineno-4-30" href="#__codelineno-4-30"></a>
<a id="__codelineno-4-31" name="__codelineno-4-31" href="#__codelineno-4-31"></a><span class="c1"># Validation strategy: Expanding window to use all patient history</span>
<a id="__codelineno-4-32" name="__codelineno-4-32" href="#__codelineno-4-32"></a><span class="n">cv</span> <span class="o">=</span> <span class="n">TimeSeriesFold</span><span class="p">(</span>
<a id="__codelineno-4-33" name="__codelineno-4-33" href="#__codelineno-4-33"></a>    <span class="n">steps</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>  <span class="c1"># Predict 30 minutes ahead</span>
<a id="__codelineno-4-34" name="__codelineno-4-34" href="#__codelineno-4-34"></a>    <span class="n">initial_train_size</span><span class="o">=</span><span class="mi">7</span> <span class="o">*</span> <span class="mi">24</span> <span class="o">*</span> <span class="mi">60</span><span class="p">,</span>  <span class="c1"># 7 days initial training</span>
<a id="__codelineno-4-35" name="__codelineno-4-35" href="#__codelineno-4-35"></a>    <span class="n">refit</span><span class="o">=</span><span class="mi">24</span> <span class="o">*</span> <span class="mi">60</span><span class="p">,</span>  <span class="c1"># Retrain daily (balance freshness vs computation)</span>
<a id="__codelineno-4-36" name="__codelineno-4-36" href="#__codelineno-4-36"></a>    <span class="n">fixed_train_size</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>  <span class="c1"># Expanding: use all patient history</span>
<a id="__codelineno-4-37" name="__codelineno-4-37" href="#__codelineno-4-37"></a>    <span class="n">fold_stride</span><span class="o">=</span><span class="mi">24</span> <span class="o">*</span> <span class="mi">60</span><span class="p">,</span>  <span class="c1"># Evaluate daily</span>
<a id="__codelineno-4-38" name="__codelineno-4-38" href="#__codelineno-4-38"></a>    <span class="n">gap</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>  <span class="c1"># 5-minute processing delay (realistic constraint)</span>
<a id="__codelineno-4-39" name="__codelineno-4-39" href="#__codelineno-4-39"></a>    <span class="n">allow_incomplete_fold</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># Don&#39;t discard recent data</span>
<a id="__codelineno-4-40" name="__codelineno-4-40" href="#__codelineno-4-40"></a>    <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-4-41" name="__codelineno-4-41" href="#__codelineno-4-41"></a><span class="p">)</span>
<a id="__codelineno-4-42" name="__codelineno-4-42" href="#__codelineno-4-42"></a>
<a id="__codelineno-4-43" name="__codelineno-4-43" href="#__codelineno-4-43"></a><span class="c1"># Inspect fold structure before running expensive backtesting</span>
<a id="__codelineno-4-44" name="__codelineno-4-44" href="#__codelineno-4-44"></a><span class="n">folds_df</span> <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">as_pandas</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-4-45" name="__codelineno-4-45" href="#__codelineno-4-45"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Fold Structure for Medical Device Validation:&quot;</span><span class="p">)</span>
<a id="__codelineno-4-46" name="__codelineno-4-46" href="#__codelineno-4-46"></a><span class="nb">print</span><span class="p">(</span><span class="n">folds_df</span><span class="p">[[</span><span class="s2">&quot;fold&quot;</span><span class="p">,</span> <span class="s2">&quot;train_start&quot;</span><span class="p">,</span> <span class="s2">&quot;train_end&quot;</span><span class="p">,</span> <span class="s2">&quot;test_start&quot;</span><span class="p">,</span> <span class="s2">&quot;test_end&quot;</span><span class="p">]])</span>
<a id="__codelineno-4-47" name="__codelineno-4-47" href="#__codelineno-4-47"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Total folds: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">folds_df</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-4-48" name="__codelineno-4-48" href="#__codelineno-4-48"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Training data grows from </span><span class="si">{</span><span class="n">folds_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;train_end&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">folds_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;train_start&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> &quot;</span>
<a id="__codelineno-4-49" name="__codelineno-4-49" href="#__codelineno-4-49"></a>      <span class="sa">f</span><span class="s2">&quot;to </span><span class="si">{</span><span class="n">folds_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;train_end&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">folds_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;train_start&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> observations&quot;</span><span class="p">)</span>
<a id="__codelineno-4-50" name="__codelineno-4-50" href="#__codelineno-4-50"></a>
<a id="__codelineno-4-51" name="__codelineno-4-51" href="#__codelineno-4-51"></a><span class="c1"># Run backtesting with the configured folds</span>
<a id="__codelineno-4-52" name="__codelineno-4-52" href="#__codelineno-4-52"></a><span class="n">metric_values</span><span class="p">,</span> <span class="n">predictions</span> <span class="o">=</span> <span class="n">backtesting_forecaster</span><span class="p">(</span>
<a id="__codelineno-4-53" name="__codelineno-4-53" href="#__codelineno-4-53"></a>    <span class="n">forecaster</span><span class="o">=</span><span class="n">forecaster</span><span class="p">,</span>
<a id="__codelineno-4-54" name="__codelineno-4-54" href="#__codelineno-4-54"></a>    <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span>
<a id="__codelineno-4-55" name="__codelineno-4-55" href="#__codelineno-4-55"></a>    <span class="n">cv</span><span class="o">=</span><span class="n">cv</span><span class="p">,</span>
<a id="__codelineno-4-56" name="__codelineno-4-56" href="#__codelineno-4-56"></a>    <span class="n">metric</span><span class="o">=</span><span class="s2">&quot;mean_absolute_error&quot;</span><span class="p">,</span>
<a id="__codelineno-4-57" name="__codelineno-4-57" href="#__codelineno-4-57"></a>    <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-4-58" name="__codelineno-4-58" href="#__codelineno-4-58"></a>    <span class="n">show_progress</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-4-59" name="__codelineno-4-59" href="#__codelineno-4-59"></a><span class="p">)</span>
<a id="__codelineno-4-60" name="__codelineno-4-60" href="#__codelineno-4-60"></a>
<a id="__codelineno-4-61" name="__codelineno-4-61" href="#__codelineno-4-61"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Medical Device Validation Results:&quot;</span><span class="p">)</span>
<a id="__codelineno-4-62" name="__codelineno-4-62" href="#__codelineno-4-62"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mean Absolute Error: </span><span class="si">{</span><span class="n">metric_values</span><span class="p">[</span><span class="s1">&#39;mean_absolute_error&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> BPM&quot;</span><span class="p">)</span>
<a id="__codelineno-4-63" name="__codelineno-4-63" href="#__codelineno-4-63"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Max Error: </span><span class="si">{</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">predictions</span><span class="o">.</span><span class="n">index</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">predictions</span><span class="p">[</span><span class="s1">&#39;pred&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> BPM&quot;</span><span class="p">)</span>
<a id="__codelineno-4-64" name="__codelineno-4-64" href="#__codelineno-4-64"></a>
<a id="__codelineno-4-65" name="__codelineno-4-65" href="#__codelineno-4-65"></a><span class="c1"># Safety check: Verify no catastrophic errors</span>
<a id="__codelineno-4-66" name="__codelineno-4-66" href="#__codelineno-4-66"></a><span class="n">max_acceptable_error</span> <span class="o">=</span> <span class="mf">10.0</span>  <span class="c1"># BPM</span>
<a id="__codelineno-4-67" name="__codelineno-4-67" href="#__codelineno-4-67"></a><span class="n">catastrophic_errors</span> <span class="o">=</span> <span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">predictions</span><span class="o">.</span><span class="n">index</span><span class="p">]</span> <span class="o">-</span> <span class="n">predictions</span><span class="p">[</span><span class="s1">&#39;pred&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">max_acceptable_error</span>
<a id="__codelineno-4-68" name="__codelineno-4-68" href="#__codelineno-4-68"></a><span class="k">if</span> <span class="n">catastrophic_errors</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
<a id="__codelineno-4-69" name="__codelineno-4-69" href="#__codelineno-4-69"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; WARNING: </span><span class="si">{</span><span class="n">catastrophic_errors</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="si">}</span><span class="s2"> predictions exceed </span><span class="si">{</span><span class="n">max_acceptable_error</span><span class="si">}</span><span class="s2"> BPM threshold&quot;</span><span class="p">)</span>
<a id="__codelineno-4-70" name="__codelineno-4-70" href="#__codelineno-4-70"></a><span class="k">else</span><span class="p">:</span>
<a id="__codelineno-4-71" name="__codelineno-4-71" href="#__codelineno-4-71"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; All predictions within </span><span class="si">{</span><span class="n">max_acceptable_error</span><span class="si">}</span><span class="s2"> BPM safety threshold&quot;</span><span class="p">)</span>
</code></pre></div>
<p>Key medical device validation elements:</p>
<ol>
<li>Expanding window: Uses complete patient history for maximum information</li>
<li>Daily retraining: Balances model freshness with computational constraints</li>
<li>Gap parameter: Models realistic processing delays in medical devices</li>
<li>Incomplete folds allowed: Ensures most recent data is evaluated</li>
<li>Safety thresholds: Explicit error bounds for clinical acceptability</li>
</ol>
<h4 id="example-2-high-frequency-trading-fixed-window-strategy">Example 2: High-Frequency Trading - Fixed Window Strategy</h4>
<p>This example demonstrates validation for a high-frequency trading system where computational resources are constrained and only recent data is relevant.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.linear_model</span><span class="w"> </span><span class="kn">import</span> <span class="n">Ridge</span>
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="kn">from</span><span class="w"> </span><span class="nn">spotforecast2_safe.forecaster.recursive</span><span class="w"> </span><span class="kn">import</span> <span class="n">ForecasterRecursive</span>
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="kn">from</span><span class="w"> </span><span class="nn">spotforecast2.model_selection</span><span class="w"> </span><span class="kn">import</span> <span class="n">backtesting_forecaster</span><span class="p">,</span> <span class="n">TimeSeriesFold</span>
<a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a>
<a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a><span class="c1"># Simulate high-frequency price data</span>
<a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a><span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">(</span><span class="mi">456</span><span class="p">)</span>
<a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a><span class="n">dates</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s2">&quot;2024-01-01 09:30&quot;</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mf">6.5</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s2">&quot;s&quot;</span><span class="p">)</span>  <span class="c1"># Trading day, 1-second bars</span>
<a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a>
<a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a><span class="c1"># Price with mean reversion and volatility clustering</span>
<a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a><span class="n">price</span> <span class="o">=</span> <span class="mf">100.0</span>
<a id="__codelineno-5-13" name="__codelineno-5-13" href="#__codelineno-5-13"></a><span class="n">prices</span> <span class="o">=</span> <span class="p">[</span><span class="n">price</span><span class="p">]</span>
<a id="__codelineno-5-14" name="__codelineno-5-14" href="#__codelineno-5-14"></a><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dates</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
<a id="__codelineno-5-15" name="__codelineno-5-15" href="#__codelineno-5-15"></a>    <span class="c1"># Mean reversion + random walk</span>
<a id="__codelineno-5-16" name="__codelineno-5-16" href="#__codelineno-5-16"></a>    <span class="n">drift</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.0001</span> <span class="o">*</span> <span class="p">(</span><span class="n">price</span> <span class="o">-</span> <span class="mf">100.0</span><span class="p">)</span>
<a id="__codelineno-5-17" name="__codelineno-5-17" href="#__codelineno-5-17"></a>    <span class="n">volatility</span> <span class="o">=</span> <span class="mf">0.01</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="nb">abs</span><span class="p">(</span><span class="n">rng</span><span class="o">.</span><span class="n">normal</span><span class="p">()))</span>
<a id="__codelineno-5-18" name="__codelineno-5-18" href="#__codelineno-5-18"></a>    <span class="n">price</span> <span class="o">+=</span> <span class="n">drift</span> <span class="o">+</span> <span class="n">rng</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">volatility</span><span class="p">)</span>
<a id="__codelineno-5-19" name="__codelineno-5-19" href="#__codelineno-5-19"></a>    <span class="n">prices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">price</span><span class="p">)</span>
<a id="__codelineno-5-20" name="__codelineno-5-20" href="#__codelineno-5-20"></a>
<a id="__codelineno-5-21" name="__codelineno-5-21" href="#__codelineno-5-21"></a><span class="n">y</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">prices</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">dates</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;price_usd&quot;</span><span class="p">)</span>
<a id="__codelineno-5-22" name="__codelineno-5-22" href="#__codelineno-5-22"></a>
<a id="__codelineno-5-23" name="__codelineno-5-23" href="#__codelineno-5-23"></a><span class="c1"># HFT configuration: Fast, fixed window</span>
<a id="__codelineno-5-24" name="__codelineno-5-24" href="#__codelineno-5-24"></a><span class="n">forecaster</span> <span class="o">=</span> <span class="n">ForecasterRecursive</span><span class="p">(</span>
<a id="__codelineno-5-25" name="__codelineno-5-25" href="#__codelineno-5-25"></a>    <span class="n">estimator</span><span class="o">=</span><span class="n">Ridge</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">),</span>  <span class="c1"># Fast linear model</span>
<a id="__codelineno-5-26" name="__codelineno-5-26" href="#__codelineno-5-26"></a>    <span class="n">lags</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span>  <span class="c1"># Last 60 seconds</span>
<a id="__codelineno-5-27" name="__codelineno-5-27" href="#__codelineno-5-27"></a><span class="p">)</span>
<a id="__codelineno-5-28" name="__codelineno-5-28" href="#__codelineno-5-28"></a>
<a id="__codelineno-5-29" name="__codelineno-5-29" href="#__codelineno-5-29"></a><span class="c1"># Validation strategy: Fixed window mimicking production constraints</span>
<a id="__codelineno-5-30" name="__codelineno-5-30" href="#__codelineno-5-30"></a><span class="n">cv</span> <span class="o">=</span> <span class="n">TimeSeriesFold</span><span class="p">(</span>
<a id="__codelineno-5-31" name="__codelineno-5-31" href="#__codelineno-5-31"></a>    <span class="n">steps</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>  <span class="c1"># Predict 10 seconds ahead</span>
<a id="__codelineno-5-32" name="__codelineno-5-32" href="#__codelineno-5-32"></a>    <span class="n">initial_train_size</span><span class="o">=</span><span class="mi">3600</span><span class="p">,</span>  <span class="c1"># 1 hour initial training</span>
<a id="__codelineno-5-33" name="__codelineno-5-33" href="#__codelineno-5-33"></a>    <span class="n">refit</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>  <span class="c1"># Retrain every 5 minutes (production-realistic)</span>
<a id="__codelineno-5-34" name="__codelineno-5-34" href="#__codelineno-5-34"></a>    <span class="n">fixed_train_size</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># Fixed: only use recent data (memory constraint)</span>
<a id="__codelineno-5-35" name="__codelineno-5-35" href="#__codelineno-5-35"></a>    <span class="n">fold_stride</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>  <span class="c1"># Evaluate every 5 minutes</span>
<a id="__codelineno-5-36" name="__codelineno-5-36" href="#__codelineno-5-36"></a>    <span class="n">gap</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>  <span class="c1"># 1-second execution delay</span>
<a id="__codelineno-5-37" name="__codelineno-5-37" href="#__codelineno-5-37"></a>    <span class="n">allow_incomplete_fold</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>  <span class="c1"># Strict: only complete folds</span>
<a id="__codelineno-5-38" name="__codelineno-5-38" href="#__codelineno-5-38"></a>    <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-5-39" name="__codelineno-5-39" href="#__codelineno-5-39"></a><span class="p">)</span>
<a id="__codelineno-5-40" name="__codelineno-5-40" href="#__codelineno-5-40"></a>
<a id="__codelineno-5-41" name="__codelineno-5-41" href="#__codelineno-5-41"></a><span class="c1"># Inspect fold structure</span>
<a id="__codelineno-5-42" name="__codelineno-5-42" href="#__codelineno-5-42"></a><span class="n">folds_df</span> <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">as_pandas</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-5-43" name="__codelineno-5-43" href="#__codelineno-5-43"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Fold Structure for HFT Validation:&quot;</span><span class="p">)</span>
<a id="__codelineno-5-44" name="__codelineno-5-44" href="#__codelineno-5-44"></a><span class="nb">print</span><span class="p">(</span><span class="n">folds_df</span><span class="p">[[</span><span class="s2">&quot;fold&quot;</span><span class="p">,</span> <span class="s2">&quot;train_start&quot;</span><span class="p">,</span> <span class="s2">&quot;train_end&quot;</span><span class="p">,</span> <span class="s2">&quot;test_start&quot;</span><span class="p">,</span> <span class="s2">&quot;test_end&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
<a id="__codelineno-5-45" name="__codelineno-5-45" href="#__codelineno-5-45"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Total folds: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">folds_df</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-5-46" name="__codelineno-5-46" href="#__codelineno-5-46"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Training window size: </span><span class="si">{</span><span class="n">folds_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;train_end&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">folds_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;train_start&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> observations (constant)&quot;</span><span class="p">)</span>
<a id="__codelineno-5-47" name="__codelineno-5-47" href="#__codelineno-5-47"></a>
<a id="__codelineno-5-48" name="__codelineno-5-48" href="#__codelineno-5-48"></a><span class="c1"># Run backtesting</span>
<a id="__codelineno-5-49" name="__codelineno-5-49" href="#__codelineno-5-49"></a><span class="n">metric_values</span><span class="p">,</span> <span class="n">predictions</span> <span class="o">=</span> <span class="n">backtesting_forecaster</span><span class="p">(</span>
<a id="__codelineno-5-50" name="__codelineno-5-50" href="#__codelineno-5-50"></a>    <span class="n">forecaster</span><span class="o">=</span><span class="n">forecaster</span><span class="p">,</span>
<a id="__codelineno-5-51" name="__codelineno-5-51" href="#__codelineno-5-51"></a>    <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span>
<a id="__codelineno-5-52" name="__codelineno-5-52" href="#__codelineno-5-52"></a>    <span class="n">cv</span><span class="o">=</span><span class="n">cv</span><span class="p">,</span>
<a id="__codelineno-5-53" name="__codelineno-5-53" href="#__codelineno-5-53"></a>    <span class="n">metric</span><span class="o">=</span><span class="s2">&quot;mean_absolute_error&quot;</span><span class="p">,</span>
<a id="__codelineno-5-54" name="__codelineno-5-54" href="#__codelineno-5-54"></a>    <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-5-55" name="__codelineno-5-55" href="#__codelineno-5-55"></a>    <span class="n">show_progress</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-5-56" name="__codelineno-5-56" href="#__codelineno-5-56"></a><span class="p">)</span>
<a id="__codelineno-5-57" name="__codelineno-5-57" href="#__codelineno-5-57"></a>
<a id="__codelineno-5-58" name="__codelineno-5-58" href="#__codelineno-5-58"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">HFT Validation Results:&quot;</span><span class="p">)</span>
<a id="__codelineno-5-59" name="__codelineno-5-59" href="#__codelineno-5-59"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mean Absolute Error: </span><span class="si">{</span><span class="n">metric_values</span><span class="p">[</span><span class="s1">&#39;mean_absolute_error&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> USD&quot;</span><span class="p">)</span>
<a id="__codelineno-5-60" name="__codelineno-5-60" href="#__codelineno-5-60"></a>
<a id="__codelineno-5-61" name="__codelineno-5-61" href="#__codelineno-5-61"></a><span class="c1"># Profitability check: Can we beat transaction costs?</span>
<a id="__codelineno-5-62" name="__codelineno-5-62" href="#__codelineno-5-62"></a><span class="n">transaction_cost</span> <span class="o">=</span> <span class="mf">0.001</span>  <span class="c1"># $0.001 per trade</span>
<a id="__codelineno-5-63" name="__codelineno-5-63" href="#__codelineno-5-63"></a><span class="n">prediction_accuracy</span> <span class="o">=</span> <span class="n">metric_values</span><span class="p">[</span><span class="s1">&#39;mean_absolute_error&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<a id="__codelineno-5-64" name="__codelineno-5-64" href="#__codelineno-5-64"></a><span class="k">if</span> <span class="n">prediction_accuracy</span> <span class="o">&lt;</span> <span class="n">transaction_cost</span><span class="p">:</span>
<a id="__codelineno-5-65" name="__codelineno-5-65" href="#__codelineno-5-65"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; Prediction accuracy (</span><span class="si">{</span><span class="n">prediction_accuracy</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">) beats transaction costs (</span><span class="si">{</span><span class="n">transaction_cost</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
<a id="__codelineno-5-66" name="__codelineno-5-66" href="#__codelineno-5-66"></a><span class="k">else</span><span class="p">:</span>
<a id="__codelineno-5-67" name="__codelineno-5-67" href="#__codelineno-5-67"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; Prediction accuracy (</span><span class="si">{</span><span class="n">prediction_accuracy</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">) exceeds transaction costs (</span><span class="si">{</span><span class="n">transaction_cost</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
<a id="__codelineno-5-68" name="__codelineno-5-68" href="#__codelineno-5-68"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  Strategy not viable for production deployment&quot;</span><span class="p">)</span>
</code></pre></div>
<p>Key HFT validation elements:</p>
<ol>
<li>Fixed window: Mimics production memory constraints and recency bias</li>
<li>Frequent retraining: Matches realistic production update cycles</li>
<li>Small gap: Models minimal execution delay</li>
<li>No incomplete folds: Ensures all evaluations use complete test sets</li>
<li>Transaction cost analysis: Economic viability check before deployment</li>
</ol>
<h4 id="example-3-overlapping-folds-for-robust-evaluation">Example 3: Overlapping Folds for Robust Evaluation</h4>
<p>This example demonstrates using overlapping folds to increase evaluation density without changing the forecast horizon.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.ensemble</span><span class="w"> </span><span class="kn">import</span> <span class="n">GradientBoostingRegressor</span>
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="kn">from</span><span class="w"> </span><span class="nn">spotforecast2_safe.forecaster.recursive</span><span class="w"> </span><span class="kn">import</span> <span class="n">ForecasterRecursive</span>
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="kn">from</span><span class="w"> </span><span class="nn">spotforecast2.model_selection</span><span class="w"> </span><span class="kn">import</span> <span class="n">backtesting_forecaster</span><span class="p">,</span> <span class="n">TimeSeriesFold</span>
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a>
<a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a><span class="c1"># Simulate industrial sensor data (temperature)</span>
<a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a><span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">(</span><span class="mi">789</span><span class="p">)</span>
<a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a><span class="n">dates</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s2">&quot;2024-01-01&quot;</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">365</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s2">&quot;D&quot;</span><span class="p">)</span>
<a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a>
<a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a><span class="c1"># Seasonal pattern + trend + noise</span>
<a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a><span class="n">day_of_year</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dates</span><span class="p">))</span>
<a id="__codelineno-6-13" name="__codelineno-6-13" href="#__codelineno-6-13"></a><span class="n">seasonal</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">day_of_year</span> <span class="o">/</span> <span class="mi">365</span><span class="p">)</span>
<a id="__codelineno-6-14" name="__codelineno-6-14" href="#__codelineno-6-14"></a><span class="n">trend</span> <span class="o">=</span> <span class="mf">0.01</span> <span class="o">*</span> <span class="n">day_of_year</span>
<a id="__codelineno-6-15" name="__codelineno-6-15" href="#__codelineno-6-15"></a><span class="n">noise</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">dates</span><span class="p">))</span>
<a id="__codelineno-6-16" name="__codelineno-6-16" href="#__codelineno-6-16"></a>
<a id="__codelineno-6-17" name="__codelineno-6-17" href="#__codelineno-6-17"></a><span class="n">y</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="mi">20</span> <span class="o">+</span> <span class="n">seasonal</span> <span class="o">+</span> <span class="n">trend</span> <span class="o">+</span> <span class="n">noise</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">dates</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;temperature_c&quot;</span><span class="p">)</span>
<a id="__codelineno-6-18" name="__codelineno-6-18" href="#__codelineno-6-18"></a>
<a id="__codelineno-6-19" name="__codelineno-6-19" href="#__codelineno-6-19"></a><span class="c1"># Industrial monitoring configuration</span>
<a id="__codelineno-6-20" name="__codelineno-6-20" href="#__codelineno-6-20"></a><span class="n">forecaster</span> <span class="o">=</span> <span class="n">ForecasterRecursive</span><span class="p">(</span>
<a id="__codelineno-6-21" name="__codelineno-6-21" href="#__codelineno-6-21"></a>    <span class="n">estimator</span><span class="o">=</span><span class="n">GradientBoostingRegressor</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">789</span><span class="p">),</span>
<a id="__codelineno-6-22" name="__codelineno-6-22" href="#__codelineno-6-22"></a>    <span class="n">lags</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>  <span class="c1"># Last 30 days</span>
<a id="__codelineno-6-23" name="__codelineno-6-23" href="#__codelineno-6-23"></a><span class="p">)</span>
<a id="__codelineno-6-24" name="__codelineno-6-24" href="#__codelineno-6-24"></a>
<a id="__codelineno-6-25" name="__codelineno-6-25" href="#__codelineno-6-25"></a><span class="c1"># Overlapping folds: More evaluation points for robust assessment</span>
<a id="__codelineno-6-26" name="__codelineno-6-26" href="#__codelineno-6-26"></a><span class="n">cv</span> <span class="o">=</span> <span class="n">TimeSeriesFold</span><span class="p">(</span>
<a id="__codelineno-6-27" name="__codelineno-6-27" href="#__codelineno-6-27"></a>    <span class="n">steps</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span>  <span class="c1"># Predict 7 days ahead</span>
<a id="__codelineno-6-28" name="__codelineno-6-28" href="#__codelineno-6-28"></a>    <span class="n">initial_train_size</span><span class="o">=</span><span class="mi">180</span><span class="p">,</span>  <span class="c1"># 6 months initial training</span>
<a id="__codelineno-6-29" name="__codelineno-6-29" href="#__codelineno-6-29"></a>    <span class="n">refit</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span>  <span class="c1"># Retrain weekly</span>
<a id="__codelineno-6-30" name="__codelineno-6-30" href="#__codelineno-6-30"></a>    <span class="n">fixed_train_size</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>  <span class="c1"># Expanding window</span>
<a id="__codelineno-6-31" name="__codelineno-6-31" href="#__codelineno-6-31"></a>    <span class="n">fold_stride</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>  <span class="c1"># Advance 1 day at a time (creates overlap!)</span>
<a id="__codelineno-6-32" name="__codelineno-6-32" href="#__codelineno-6-32"></a>    <span class="n">gap</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-6-33" name="__codelineno-6-33" href="#__codelineno-6-33"></a>    <span class="n">allow_incomplete_fold</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-6-34" name="__codelineno-6-34" href="#__codelineno-6-34"></a>    <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-6-35" name="__codelineno-6-35" href="#__codelineno-6-35"></a><span class="p">)</span>
<a id="__codelineno-6-36" name="__codelineno-6-36" href="#__codelineno-6-36"></a>
<a id="__codelineno-6-37" name="__codelineno-6-37" href="#__codelineno-6-37"></a><span class="c1"># Inspect overlapping structure</span>
<a id="__codelineno-6-38" name="__codelineno-6-38" href="#__codelineno-6-38"></a><span class="n">folds_df</span> <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">as_pandas</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-6-39" name="__codelineno-6-39" href="#__codelineno-6-39"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Overlapping Fold Structure:&quot;</span><span class="p">)</span>
<a id="__codelineno-6-40" name="__codelineno-6-40" href="#__codelineno-6-40"></a><span class="nb">print</span><span class="p">(</span><span class="n">folds_df</span><span class="p">[[</span><span class="s2">&quot;fold&quot;</span><span class="p">,</span> <span class="s2">&quot;test_start&quot;</span><span class="p">,</span> <span class="s2">&quot;test_end&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">15</span><span class="p">))</span>
<a id="__codelineno-6-41" name="__codelineno-6-41" href="#__codelineno-6-41"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Total folds: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">folds_df</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-6-42" name="__codelineno-6-42" href="#__codelineno-6-42"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Overlap: Each observation appears in up to </span><span class="si">{</span><span class="n">cv</span><span class="o">.</span><span class="n">steps</span><span class="si">}</span><span class="s2"> different test sets&quot;</span><span class="p">)</span>
<a id="__codelineno-6-43" name="__codelineno-6-43" href="#__codelineno-6-43"></a>
<a id="__codelineno-6-44" name="__codelineno-6-44" href="#__codelineno-6-44"></a><span class="c1"># Run backtesting</span>
<a id="__codelineno-6-45" name="__codelineno-6-45" href="#__codelineno-6-45"></a><span class="n">metric_values</span><span class="p">,</span> <span class="n">predictions</span> <span class="o">=</span> <span class="n">backtesting_forecaster</span><span class="p">(</span>
<a id="__codelineno-6-46" name="__codelineno-6-46" href="#__codelineno-6-46"></a>    <span class="n">forecaster</span><span class="o">=</span><span class="n">forecaster</span><span class="p">,</span>
<a id="__codelineno-6-47" name="__codelineno-6-47" href="#__codelineno-6-47"></a>    <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span>
<a id="__codelineno-6-48" name="__codelineno-6-48" href="#__codelineno-6-48"></a>    <span class="n">cv</span><span class="o">=</span><span class="n">cv</span><span class="p">,</span>
<a id="__codelineno-6-49" name="__codelineno-6-49" href="#__codelineno-6-49"></a>    <span class="n">metric</span><span class="o">=</span><span class="s2">&quot;mean_absolute_error&quot;</span><span class="p">,</span>
<a id="__codelineno-6-50" name="__codelineno-6-50" href="#__codelineno-6-50"></a>    <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-6-51" name="__codelineno-6-51" href="#__codelineno-6-51"></a>    <span class="n">show_progress</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-6-52" name="__codelineno-6-52" href="#__codelineno-6-52"></a><span class="p">)</span>
<a id="__codelineno-6-53" name="__codelineno-6-53" href="#__codelineno-6-53"></a>
<a id="__codelineno-6-54" name="__codelineno-6-54" href="#__codelineno-6-54"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Industrial Monitoring Validation Results:&quot;</span><span class="p">)</span>
<a id="__codelineno-6-55" name="__codelineno-6-55" href="#__codelineno-6-55"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mean Absolute Error: </span><span class="si">{</span><span class="n">metric_values</span><span class="p">[</span><span class="s1">&#39;mean_absolute_error&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> C&quot;</span><span class="p">)</span>
<a id="__codelineno-6-56" name="__codelineno-6-56" href="#__codelineno-6-56"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of predictions: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">predictions</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-6-57" name="__codelineno-6-57" href="#__codelineno-6-57"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of unique timestamps: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">predictions</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-6-58" name="__codelineno-6-58" href="#__codelineno-6-58"></a>
<a id="__codelineno-6-59" name="__codelineno-6-59" href="#__codelineno-6-59"></a><span class="c1"># Note: With overlapping folds, some timestamps have multiple predictions</span>
<a id="__codelineno-6-60" name="__codelineno-6-60" href="#__codelineno-6-60"></a><span class="c1"># This provides multiple independent forecasts for the same period</span>
</code></pre></div>
<p>Key overlapping fold elements:</p>
<ol>
<li>fold_stride &lt; steps: Creates overlapping test sets</li>
<li>Multiple forecasts per timestamp: Provides ensemble-like robustness assessment</li>
<li>Increased evaluation density: More data points for statistical significance</li>
<li>Computational cost: Proportional to number of folds (trade-off consideration)</li>
</ol>
<h2 id="one-step-ahead-fold-simplified-validation-for-specific-use-cases">One Step Ahead Fold: Simplified Validation for Specific Use Cases</h2>
<p>The OneStepAheadFold class provides a streamlined validation approach for one-step-ahead forecasting scenarios. Unlike TimeSeriesFold which creates multiple temporal folds, OneStepAheadFold creates a single train/test split optimized for evaluating models on all remaining data after initial training.</p>


<div class="doc doc-object doc-class">



<h2 id="spotforecast2_safe.model_selection.OneStepAheadFold" class="doc doc-heading">
            <code>spotforecast2_safe.model_selection.OneStepAheadFold</code>


</h2>


    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><span title="spotforecast2_safe.model_selection.split_base.BaseFold">BaseFold</span></code></p>



        <p>Class to split time series data into train and test folds for one-step-ahead
forecasting.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>initial_train_size</code>
            </td>
            <td>
                  <code><span title="int">int</span> | <span title="str">str</span> | <span title="pandas.Timestamp">Timestamp</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of observations used
for initial training.</p>
<ul>
<li>If an integer, the number of observations used for initial training.</li>
<li>If a date string or pandas Timestamp, it is the last date included in
  the initial training set.</li>
</ul>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>window_size</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of observations needed to generate the
autoregressive predictors. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>differentiation</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of observations to use for differentiation.
This is used to extend the <code>last_window</code> as many observations as the
differentiation order. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>return_all_indexes</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to return all indexes or only the
start and end indexes of each fold. Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>verbose</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to print information about generated folds.
Defaults to True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="spotforecast2_safe.model_selection.OneStepAheadFold.initial_train_size">initial_train_size</span></code></td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of observations used for initial training.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="spotforecast2_safe.model_selection.OneStepAheadFold.window_size">window_size</span></code></td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of observations needed to generate the
autoregressive predictors.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="spotforecast2_safe.model_selection.OneStepAheadFold.differentiation">differentiation</span></code></td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of observations to use for differentiation.
This is used to extend the <code>last_window</code> as many observations as the
differentiation order.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="spotforecast2_safe.model_selection.OneStepAheadFold.return_all_indexes">return_all_indexes</span></code></td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to return all indexes or only the start
and end indexes of each fold.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="spotforecast2_safe.model_selection.OneStepAheadFold.verbose">verbose</span></code></td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to print information about generated folds.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>spotforecast2_safe/model_selection/split_one_step.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-0-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-0-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-0-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-0-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-0-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-0-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-0-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-0-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-0-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-0-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-0-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-0-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-0-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-0-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-0-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-0-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-0-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-0-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-0-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-0-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-0-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-0-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-0-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-0-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-0-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-0-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-0-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-0-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-0-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-0-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-0-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-0-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-0-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-0-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-0-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-0-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-0-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-0-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-0-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-0-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-0-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-0-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-0-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-21" name="__codelineno-0-21"></a><span class="k">class</span><span class="w"> </span><span class="nc">OneStepAheadFold</span><span class="p">(</span><span class="n">BaseFold</span><span class="p">):</span>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-23" name="__codelineno-0-23"></a><span class="sd">    Class to split time series data into train and test folds for one-step-ahead</span>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a><span class="sd">    forecasting.</span>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a><span class="sd">        initial_train_size (int | str | pd.Timestamp): Number of observations used</span>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="sd">            for initial training.</span>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="sd">            - If an integer, the number of observations used for initial training.</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="sd">            - If a date string or pandas Timestamp, it is the last date included in</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a><span class="sd">              the initial training set.</span>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="sd">        window_size (int, optional): Number of observations needed to generate the</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="sd">            autoregressive predictors. Defaults to None.</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="sd">        differentiation (int, optional): Number of observations to use for differentiation.</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="sd">            This is used to extend the `last_window` as many observations as the</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="sd">            differentiation order. Defaults to None.</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="sd">        return_all_indexes (bool, optional): Whether to return all indexes or only the</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="sd">            start and end indexes of each fold. Defaults to False.</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a><span class="sd">        verbose (bool, optional): Whether to print information about generated folds.</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a><span class="sd">            Defaults to True.</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a><span class="sd">    Attributes:</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a><span class="sd">        initial_train_size (int): Number of observations used for initial training.</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a><span class="sd">        window_size (int): Number of observations needed to generate the</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="sd">            autoregressive predictors.</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a><span class="sd">        differentiation (int): Number of observations to use for differentiation.</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a><span class="sd">            This is used to extend the `last_window` as many observations as the</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="sd">            differentiation order.</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a><span class="sd">        return_all_indexes (bool): Whether to return all indexes or only the start</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a><span class="sd">            and end indexes of each fold.</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a><span class="sd">        verbose (bool): Whether to print information about generated folds.</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a>    <span class="c1"># Class-level type annotations for static analysis tools</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a>    <span class="n">initial_train_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a>    <span class="n">window_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a>    <span class="n">differentiation</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a>    <span class="n">return_all_indexes</span><span class="p">:</span> <span class="nb">bool</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a>    <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a>        <span class="n">initial_train_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">,</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a>        <span class="n">window_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a>        <span class="n">differentiation</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a>        <span class="n">return_all_indexes</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a>        <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a>            <span class="n">initial_train_size</span><span class="o">=</span><span class="n">initial_train_size</span><span class="p">,</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a>            <span class="n">window_size</span><span class="o">=</span><span class="n">window_size</span><span class="p">,</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a>            <span class="n">differentiation</span><span class="o">=</span><span class="n">differentiation</span><span class="p">,</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a>            <span class="n">return_all_indexes</span><span class="o">=</span><span class="n">return_all_indexes</span><span class="p">,</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>            <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a>        <span class="p">)</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a><span class="sd">        Information displayed when printed.</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a>        <span class="n">info</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a>            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;=&#39;</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a>            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;=&#39;</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a>            <span class="sa">f</span><span class="s2">&quot;Initial train size = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_train_size</span><span class="si">}</span><span class="s2">,</span><span class="se">\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>            <span class="sa">f</span><span class="s2">&quot;Window size        = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">window_size</span><span class="si">}</span><span class="s2">,</span><span class="se">\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>            <span class="sa">f</span><span class="s2">&quot;Differentiation    = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">differentiation</span><span class="si">}</span><span class="s2">,</span><span class="se">\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>            <span class="sa">f</span><span class="s2">&quot;Return all indexes = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">return_all_indexes</span><span class="si">}</span><span class="s2">,</span><span class="se">\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>            <span class="sa">f</span><span class="s2">&quot;Verbose            = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>        <span class="p">)</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>        <span class="k">return</span> <span class="n">info</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_repr_html_</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a><span class="sd">        HTML representation of the object.</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a><span class="sd">        The &quot;General Information&quot; section is expanded by default.</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>        <span class="n">style</span><span class="p">,</span> <span class="n">unique_id</span> <span class="o">=</span> <span class="n">get_style_repr_html</span><span class="p">()</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>        <span class="n">content</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a><span class="s2">        &lt;div class=&quot;container-</span><span class="si">{</span><span class="n">unique_id</span><span class="si">}</span><span class="s2">&quot;&gt;</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a><span class="s2">            &lt;p style=&quot;font-size: 1.5em; font-weight: bold; margin-block-start: 0.83em; margin-block-end: 0.83em;&quot;&gt;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&lt;/p&gt;</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a><span class="s2">            &lt;details open&gt;</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a><span class="s2">                &lt;summary&gt;General Information&lt;/summary&gt;</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a><span class="s2">                &lt;ul&gt;</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a><span class="s2">                    &lt;li&gt;&lt;strong&gt;Initial train size:&lt;/strong&gt; </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_train_size</span><span class="si">}</span><span class="s2">&lt;/li&gt;</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a><span class="s2">                    &lt;li&gt;&lt;strong&gt;Window size:&lt;/strong&gt; </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">window_size</span><span class="si">}</span><span class="s2">&lt;/li&gt;</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a><span class="s2">                    &lt;li&gt;&lt;strong&gt;Differentiation:&lt;/strong&gt; </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">differentiation</span><span class="si">}</span><span class="s2">&lt;/li&gt;</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a><span class="s2">                    &lt;li&gt;&lt;strong&gt;Return all indexes:&lt;/strong&gt; </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">return_all_indexes</span><span class="si">}</span><span class="s2">&lt;/li&gt;</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a><span class="s2">                &lt;/ul&gt;</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a><span class="s2">            &lt;/details&gt;</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a><span class="s2">        &lt;/div&gt;</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a><span class="s2">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>        <span class="k">return</span> <span class="n">style</span> <span class="o">+</span> <span class="n">content</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">split</span><span class="p">(</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>        <span class="n">X</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span> <span class="o">|</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">|</span> <span class="n">pd</span><span class="o">.</span><span class="n">Index</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span> <span class="o">|</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">],</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>        <span class="n">as_pandas</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>        <span class="n">externally_fitted</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span> <span class="o">|</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a><span class="sd">        Split the time series data into train and test folds.</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a><span class="sd">            X (pd.Series | pd.DataFrame | pd.Index | dict): Time series data or index to split.</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a><span class="sd">            as_pandas (bool, optional): If True, the folds are returned as a DataFrame.</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a><span class="sd">                This is useful to visualize the folds in a more interpretable way.</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a><span class="sd">                Defaults to False.</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a><span class="sd">            externally_fitted (Any, optional): This argument is not used in this class.</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a><span class="sd">                It is included for API consistency. Defaults to None.</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a><span class="sd">            list | pd.DataFrame: A list of lists containing the indices (position) of</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a><span class="sd">            the fold. The list contains 2 lists with the following information:</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a><span class="sd">            - fold: fold number.</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a><span class="sd">            - [train_start, train_end]: list with the start and end positions of the</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a><span class="sd">                training set.</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a><span class="sd">            - [test_start, test_end]: list with the start and end positions of the test</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a><span class="sd">                set. These are the observations used to evaluate the forecaster.</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a><span class="sd">            - fit_forecaster: boolean indicating whether the forecaster should be fitted</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a><span class="sd">                in this fold.</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a><span class="sd">            It is important to note that the returned values are the positions of the</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a><span class="sd">            observations and not the actual values of the index, so they can be used to</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a><span class="sd">            slice the data directly using iloc.</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a><span class="sd">            If `as_pandas` is `True`, the folds are returned as a DataFrame with the</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a><span class="sd">            following columns: &#39;fold&#39;, &#39;train_start&#39;, &#39;train_end&#39;, &#39;test_start&#39;,</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a><span class="sd">            &#39;test_end&#39;, &#39;fit_forecaster&#39;.</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a><span class="sd">            Following the python convention, the start index is inclusive and the end</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a><span class="sd">            index is exclusive. This means that the last index is not included in the</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a><span class="sd">            slice.</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Index</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)):</span>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a>                <span class="sa">f</span><span class="s2">&quot;X must be a pandas Series, DataFrame, Index or a dictionary. &quot;</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a>                <span class="sa">f</span><span class="s2">&quot;Got </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">X</span><span class="p">)</span><span class="si">}</span><span class="s2">.&quot;</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a>            <span class="p">)</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a>        <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_index</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">initial_train_size</span> <span class="o">=</span> <span class="n">date_to_index_position</span><span class="p">(</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a>            <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">,</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a>            <span class="n">date_input</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_train_size</span><span class="p">,</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a>            <span class="n">method</span><span class="o">=</span><span class="s2">&quot;validation&quot;</span><span class="p">,</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a>            <span class="n">date_literal</span><span class="o">=</span><span class="s2">&quot;initial_train_size&quot;</span><span class="p">,</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a>        <span class="p">)</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a>        <span class="n">fold</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a>            <span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a>            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_train_size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a>            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_train_size</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)],</span>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a>            <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a>        <span class="p">]</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_print_info</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">,</span> <span class="n">fold</span><span class="o">=</span><span class="n">fold</span><span class="p">)</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a>        <span class="c1"># NOTE: +1 to prevent iloc pandas from deleting the last observation</span>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">return_all_indexes</span><span class="p">:</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a>            <span class="n">fold</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a>                <span class="n">fold</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a>                <span class="p">[</span><span class="nb">range</span><span class="p">(</span><span class="n">fold</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">fold</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)],</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a>                <span class="p">[</span><span class="nb">range</span><span class="p">(</span><span class="n">fold</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">fold</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">])],</span>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a>                <span class="n">fold</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a>            <span class="p">]</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a>            <span class="n">fold</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a>                <span class="n">fold</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a>                <span class="p">[</span><span class="n">fold</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">fold</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a>                <span class="p">[</span><span class="n">fold</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">fold</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">]],</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a>                <span class="n">fold</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a>            <span class="p">]</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a>        <span class="k">if</span> <span class="n">as_pandas</span><span class="p">:</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">return_all_indexes</span><span class="p">:</span>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a>                <span class="n">fold</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a>                    <span class="n">data</span><span class="o">=</span><span class="p">[[</span><span class="n">fold</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span><span class="o">*</span><span class="n">fold</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span> <span class="o">+</span> <span class="p">[</span><span class="n">fold</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]],</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a>                    <span class="n">columns</span><span class="o">=</span><span class="p">[</span>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a>                        <span class="s2">&quot;fold&quot;</span><span class="p">,</span>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a>                        <span class="s2">&quot;train_start&quot;</span><span class="p">,</span>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a>                        <span class="s2">&quot;train_end&quot;</span><span class="p">,</span>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a>                        <span class="s2">&quot;test_start&quot;</span><span class="p">,</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a>                        <span class="s2">&quot;test_end&quot;</span><span class="p">,</span>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a>                        <span class="s2">&quot;fit_forecaster&quot;</span><span class="p">,</span>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a>                    <span class="p">],</span>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a>                <span class="p">)</span>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a>                <span class="n">fold</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a>                    <span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">fold</span><span class="p">],</span>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a>                    <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;fold&quot;</span><span class="p">,</span> <span class="s2">&quot;train_index&quot;</span><span class="p">,</span> <span class="s2">&quot;test_index&quot;</span><span class="p">,</span> <span class="s2">&quot;fit_forecaster&quot;</span><span class="p">],</span>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a>                <span class="p">)</span>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a>        <span class="k">return</span> <span class="n">fold</span>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_print_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Index</span><span class="p">,</span> <span class="n">fold</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a><span class="sd">        Print information about folds.</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a><span class="sd">            index (pd.Index): Index of the time series data.</span>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a><span class="sd">            fold (list): A list of lists containing the indices (position) of the fold.</span>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">differentiation</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a>            <span class="n">differentiation</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a>            <span class="n">differentiation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">differentiation</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a>        <span class="n">initial_train_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_train_size</span> <span class="o">-</span> <span class="n">differentiation</span>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a>        <span class="n">test_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">index</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">initial_train_size</span> <span class="o">+</span> <span class="n">differentiation</span><span class="p">)</span>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Information of folds&quot;</span><span class="p">)</span>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;--------------------&quot;</span><span class="p">)</span>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of observations in train: </span><span class="si">{</span><span class="n">initial_train_size</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">differentiation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a>            <span class="nb">print</span><span class="p">(</span>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a>                <span class="sa">f</span><span class="s2">&quot;    First </span><span class="si">{</span><span class="n">differentiation</span><span class="si">}</span><span class="s2"> observation/s in training set &quot;</span>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a>                <span class="sa">f</span><span class="s2">&quot;are used for differentiation&quot;</span>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a>            <span class="p">)</span>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of observations in test: </span><span class="si">{</span><span class="n">test_length</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a>        <span class="n">training_start</span> <span class="o">=</span> <span class="n">index</span><span class="p">[</span><span class="n">fold</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">differentiation</span><span class="p">]</span>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a>        <span class="n">training_end</span> <span class="o">=</span> <span class="n">index</span><span class="p">[</span><span class="n">fold</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a>        <span class="n">test_start</span> <span class="o">=</span> <span class="n">index</span><span class="p">[</span><span class="n">fold</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a>        <span class="n">test_end</span> <span class="o">=</span> <span class="n">index</span><span class="p">[</span><span class="n">fold</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Training : </span><span class="si">{</span><span class="n">training_start</span><span class="si">}</span><span class="s2"> -- </span><span class="si">{</span><span class="n">training_end</span><span class="si">}</span><span class="s2"> (n=</span><span class="si">{</span><span class="n">initial_train_size</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Test     : </span><span class="si">{</span><span class="n">test_start</span><span class="si">}</span><span class="s2"> -- </span><span class="si">{</span><span class="n">test_end</span><span class="si">}</span><span class="s2"> (n=</span><span class="si">{</span><span class="n">test_length</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="spotforecast2_safe.model_selection.OneStepAheadFold.__repr__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__repr__</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Information displayed when printed.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>spotforecast2_safe/model_selection/split_one_step.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-79">79</a></span>
<span class="normal"><a href="#__codelineno-0-80">80</a></span>
<span class="normal"><a href="#__codelineno-0-81">81</a></span>
<span class="normal"><a href="#__codelineno-0-82">82</a></span>
<span class="normal"><a href="#__codelineno-0-83">83</a></span>
<span class="normal"><a href="#__codelineno-0-84">84</a></span>
<span class="normal"><a href="#__codelineno-0-85">85</a></span>
<span class="normal"><a href="#__codelineno-0-86">86</a></span>
<span class="normal"><a href="#__codelineno-0-87">87</a></span>
<span class="normal"><a href="#__codelineno-0-88">88</a></span>
<span class="normal"><a href="#__codelineno-0-89">89</a></span>
<span class="normal"><a href="#__codelineno-0-90">90</a></span>
<span class="normal"><a href="#__codelineno-0-91">91</a></span>
<span class="normal"><a href="#__codelineno-0-92">92</a></span>
<span class="normal"><a href="#__codelineno-0-93">93</a></span>
<span class="normal"><a href="#__codelineno-0-94">94</a></span>
<span class="normal"><a href="#__codelineno-0-95">95</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a><span class="sd">    Information displayed when printed.</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a>    <span class="n">info</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a>        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;=&#39;</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a>        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;=&#39;</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a>        <span class="sa">f</span><span class="s2">&quot;Initial train size = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_train_size</span><span class="si">}</span><span class="s2">,</span><span class="se">\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>        <span class="sa">f</span><span class="s2">&quot;Window size        = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">window_size</span><span class="si">}</span><span class="s2">,</span><span class="se">\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>        <span class="sa">f</span><span class="s2">&quot;Differentiation    = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">differentiation</span><span class="si">}</span><span class="s2">,</span><span class="se">\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>        <span class="sa">f</span><span class="s2">&quot;Return all indexes = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">return_all_indexes</span><span class="si">}</span><span class="s2">,</span><span class="se">\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>        <span class="sa">f</span><span class="s2">&quot;Verbose            = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>    <span class="p">)</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>    <span class="k">return</span> <span class="n">info</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="spotforecast2_safe.model_selection.OneStepAheadFold.split" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">as_pandas</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">externally_fitted</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Split the time series data into train and test folds.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>X</code>
            </td>
            <td>
                  <code><span title="pandas.Series">Series</span> | <span title="pandas.DataFrame">DataFrame</span> | <span title="pandas.Index">Index</span> | <span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Time series data or index to split.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>as_pandas</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, the folds are returned as a DataFrame.
This is useful to visualize the folds in a more interpretable way.
Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>externally_fitted</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>This argument is not used in this class.
It is included for API consistency. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span> | <span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list | pd.DataFrame: A list of lists containing the indices (position) of</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span> | <span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the fold. The list contains 2 lists with the following information:</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span> | <span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <ul>
<li>fold: fold number.</li>
</ul>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span> | <span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <ul>
<li>[train_start, train_end]: list with the start and end positions of the
training set.</li>
</ul>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span> | <span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <ul>
<li>[test_start, test_end]: list with the start and end positions of the test
set. These are the observations used to evaluate the forecaster.</li>
</ul>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span> | <span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <ul>
<li>fit_forecaster: boolean indicating whether the forecaster should be fitted
in this fold.</li>
</ul>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span> | <span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>It is important to note that the returned values are the positions of the</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span> | <span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>observations and not the actual values of the index, so they can be used to</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span> | <span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>slice the data directly using iloc.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span> | <span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If <code>as_pandas</code> is <code>True</code>, the folds are returned as a DataFrame with the</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span> | <span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>following columns: 'fold', 'train_start', 'train_end', 'test_start',</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span> | <span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>'test_end', 'fit_forecaster'.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span> | <span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Following the python convention, the start index is inclusive and the end</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span> | <span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>index is exclusive. This means that the last index is not included in the</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span> | <span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>slice.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>spotforecast2_safe/model_selection/split_one_step.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-121" name="__codelineno-0-121"></a><span class="k">def</span><span class="w"> </span><span class="nf">split</span><span class="p">(</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>    <span class="n">X</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span> <span class="o">|</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">|</span> <span class="n">pd</span><span class="o">.</span><span class="n">Index</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span> <span class="o">|</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">],</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>    <span class="n">as_pandas</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>    <span class="n">externally_fitted</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span> <span class="o">|</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a><span class="sd">    Split the time series data into train and test folds.</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a><span class="sd">        X (pd.Series | pd.DataFrame | pd.Index | dict): Time series data or index to split.</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a><span class="sd">        as_pandas (bool, optional): If True, the folds are returned as a DataFrame.</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a><span class="sd">            This is useful to visualize the folds in a more interpretable way.</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a><span class="sd">            Defaults to False.</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a><span class="sd">        externally_fitted (Any, optional): This argument is not used in this class.</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a><span class="sd">            It is included for API consistency. Defaults to None.</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a><span class="sd">        list | pd.DataFrame: A list of lists containing the indices (position) of</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a><span class="sd">        the fold. The list contains 2 lists with the following information:</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a><span class="sd">        - fold: fold number.</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a><span class="sd">        - [train_start, train_end]: list with the start and end positions of the</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a><span class="sd">            training set.</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a><span class="sd">        - [test_start, test_end]: list with the start and end positions of the test</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a><span class="sd">            set. These are the observations used to evaluate the forecaster.</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a><span class="sd">        - fit_forecaster: boolean indicating whether the forecaster should be fitted</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a><span class="sd">            in this fold.</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a><span class="sd">        It is important to note that the returned values are the positions of the</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a><span class="sd">        observations and not the actual values of the index, so they can be used to</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a><span class="sd">        slice the data directly using iloc.</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a><span class="sd">        If `as_pandas` is `True`, the folds are returned as a DataFrame with the</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a><span class="sd">        following columns: &#39;fold&#39;, &#39;train_start&#39;, &#39;train_end&#39;, &#39;test_start&#39;,</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a><span class="sd">        &#39;test_end&#39;, &#39;fit_forecaster&#39;.</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a><span class="sd">        Following the python convention, the start index is inclusive and the end</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a><span class="sd">        index is exclusive. This means that the last index is not included in the</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a><span class="sd">        slice.</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Index</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)):</span>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a>            <span class="sa">f</span><span class="s2">&quot;X must be a pandas Series, DataFrame, Index or a dictionary. &quot;</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a>            <span class="sa">f</span><span class="s2">&quot;Got </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">X</span><span class="p">)</span><span class="si">}</span><span class="s2">.&quot;</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a>        <span class="p">)</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a>    <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_index</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">initial_train_size</span> <span class="o">=</span> <span class="n">date_to_index_position</span><span class="p">(</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a>        <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">,</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a>        <span class="n">date_input</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_train_size</span><span class="p">,</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a>        <span class="n">method</span><span class="o">=</span><span class="s2">&quot;validation&quot;</span><span class="p">,</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a>        <span class="n">date_literal</span><span class="o">=</span><span class="s2">&quot;initial_train_size&quot;</span><span class="p">,</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a>    <span class="p">)</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a>    <span class="n">fold</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a>        <span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a>        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_train_size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a>        <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_train_size</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)],</span>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a>        <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a>    <span class="p">]</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_print_info</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">,</span> <span class="n">fold</span><span class="o">=</span><span class="n">fold</span><span class="p">)</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a>    <span class="c1"># NOTE: +1 to prevent iloc pandas from deleting the last observation</span>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">return_all_indexes</span><span class="p">:</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a>        <span class="n">fold</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a>            <span class="n">fold</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a>            <span class="p">[</span><span class="nb">range</span><span class="p">(</span><span class="n">fold</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">fold</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)],</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a>            <span class="p">[</span><span class="nb">range</span><span class="p">(</span><span class="n">fold</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">fold</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">])],</span>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a>            <span class="n">fold</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a>        <span class="p">]</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a>        <span class="n">fold</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a>            <span class="n">fold</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a>            <span class="p">[</span><span class="n">fold</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">fold</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a>            <span class="p">[</span><span class="n">fold</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">fold</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">]],</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a>            <span class="n">fold</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a>        <span class="p">]</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a>    <span class="k">if</span> <span class="n">as_pandas</span><span class="p">:</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">return_all_indexes</span><span class="p">:</span>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a>            <span class="n">fold</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a>                <span class="n">data</span><span class="o">=</span><span class="p">[[</span><span class="n">fold</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span><span class="o">*</span><span class="n">fold</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span> <span class="o">+</span> <span class="p">[</span><span class="n">fold</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]],</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a>                <span class="n">columns</span><span class="o">=</span><span class="p">[</span>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a>                    <span class="s2">&quot;fold&quot;</span><span class="p">,</span>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a>                    <span class="s2">&quot;train_start&quot;</span><span class="p">,</span>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a>                    <span class="s2">&quot;train_end&quot;</span><span class="p">,</span>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a>                    <span class="s2">&quot;test_start&quot;</span><span class="p">,</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a>                    <span class="s2">&quot;test_end&quot;</span><span class="p">,</span>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a>                    <span class="s2">&quot;fit_forecaster&quot;</span><span class="p">,</span>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a>                <span class="p">],</span>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a>            <span class="p">)</span>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a>            <span class="n">fold</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a>                <span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">fold</span><span class="p">],</span>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a>                <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;fold&quot;</span><span class="p">,</span> <span class="s2">&quot;train_index&quot;</span><span class="p">,</span> <span class="s2">&quot;test_index&quot;</span><span class="p">,</span> <span class="s2">&quot;fit_forecaster&quot;</span><span class="p">],</span>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a>            <span class="p">)</span>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a>    <span class="k">return</span> <span class="n">fold</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><h3 id="design-philosophy-for-safety-critical-validation_1">Design Philosophy for Safety-Critical Validation</h3>
<p>OneStepAheadFold serves as a complementary validation strategy to TimeSeriesFold, particularly valuable in safety-critical contexts where:</p>
<ol>
<li>Rapid Model Assessment: Quick validation without multiple retraining cycles reduces time-to-deployment</li>
<li>Maximum Test Coverage: Uses all post-training data for evaluation, maximizing statistical power</li>
<li>Computational Efficiency: Single training run minimizes resource consumption in constrained environments</li>
<li>Baseline Establishment: Provides fast baseline performance metrics before more expensive cross-validation</li>
</ol>
<h3 id="onestepaheadfold-as-a-fallback-mechanism">OneStepAheadFold as a Fallback Mechanism</h3>
<p>The OneStepAheadFold class serves critical roles in a layered validation strategy:</p>
<ul>
<li>Fast Sanity Check: Quick validation before committing to expensive multi-fold cross-validation</li>
<li>Computational Fallback: When TimeSeriesFold is too expensive, OneStepAheadFold provides rapid assessment</li>
<li>Maximum Data Utilization: Evaluates on all available post-training data without gaps</li>
<li>Model Comparison Baseline: Establishes performance floor before testing retraining strategies</li>
<li>Emergency Validation: When production issues require immediate model assessment with minimal computation</li>
</ul>
<h3 id="when-to-use-onestepaheadfold-vs-timeseriesfold">When to Use OneStepAheadFold vs TimeSeriesFold</h3>
<p>Choose OneStepAheadFold when:</p>
<ol>
<li>Computational resources are severely constrained</li>
<li>You need rapid initial model assessment</li>
<li>The model will not be retrained in production (static deployment)</li>
<li>You want to maximize test set size for statistical significance</li>
<li>Establishing a performance baseline before more complex validation</li>
</ol>
<p>Choose TimeSeriesFold when:</p>
<ol>
<li>The model will be retrained in production (requires realistic refit simulation)</li>
<li>You need to assess model degradation over time</li>
<li>Computational resources allow multiple training runs</li>
<li>You want to test different retraining strategies</li>
<li>Production deployment involves rolling forecasts with periodic updates</li>
</ol>
<h3 id="understanding-the-single-split-strategy">Understanding the Single Split Strategy</h3>
<p>OneStepAheadFold creates exactly one fold:</p>
<ul>
<li>Training Set: First <code>initial_train_size</code> observations</li>
<li>Test Set: All remaining observations after training set</li>
<li>No Retraining: Model trained once, evaluated on all subsequent data</li>
<li>No Gaps: Immediate evaluation after training period ends</li>
</ul>
<p>This differs fundamentally from TimeSeriesFold's multiple overlapping or sequential folds with configurable retraining.</p>
<h3 id="complete-examples_2">Complete Examples</h3>
<h4 id="example-1-rapid-model-screening-for-safety-critical-deployment">Example 1: Rapid Model Screening for Safety-Critical Deployment</h4>
<p>This example demonstrates using OneStepAheadFold for fast initial screening of multiple model candidates before committing to expensive cross-validation.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.ensemble</span><span class="w"> </span><span class="kn">import</span> <span class="n">RandomForestRegressor</span><span class="p">,</span> <span class="n">GradientBoostingRegressor</span>
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.linear_model</span><span class="w"> </span><span class="kn">import</span> <span class="n">Ridge</span><span class="p">,</span> <span class="n">Lasso</span>
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a><span class="kn">from</span><span class="w"> </span><span class="nn">spotforecast2_safe.forecaster.recursive</span><span class="w"> </span><span class="kn">import</span> <span class="n">ForecasterRecursive</span>
<a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a><span class="kn">from</span><span class="w"> </span><span class="nn">spotforecast2.model_selection</span><span class="w"> </span><span class="kn">import</span> <span class="n">backtesting_forecaster</span><span class="p">,</span> <span class="n">OneStepAheadFold</span>
<a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a>
<a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a><span class="c1"># Simulate critical infrastructure monitoring (water pressure)</span>
<a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a><span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">(</span><span class="mi">321</span><span class="p">)</span>
<a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a><span class="n">dates</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s2">&quot;2024-01-01&quot;</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">365</span> <span class="o">*</span> <span class="mi">24</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s2">&quot;h&quot;</span><span class="p">)</span>
<a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a>
<a id="__codelineno-7-12" name="__codelineno-7-12" href="#__codelineno-7-12"></a><span class="c1"># Pressure with daily cycle and gradual degradation</span>
<a id="__codelineno-7-13" name="__codelineno-7-13" href="#__codelineno-7-13"></a><span class="n">hour_of_day</span> <span class="o">=</span> <span class="n">dates</span><span class="o">.</span><span class="n">hour</span>
<a id="__codelineno-7-14" name="__codelineno-7-14" href="#__codelineno-7-14"></a><span class="n">daily_cycle</span> <span class="o">=</span> <span class="mi">5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">hour_of_day</span> <span class="o">/</span> <span class="mi">24</span><span class="p">)</span>
<a id="__codelineno-7-15" name="__codelineno-7-15" href="#__codelineno-7-15"></a><span class="n">baseline_pressure</span> <span class="o">=</span> <span class="mi">50</span>  <span class="c1"># PSI</span>
<a id="__codelineno-7-16" name="__codelineno-7-16" href="#__codelineno-7-16"></a><span class="n">degradation</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.01</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dates</span><span class="p">))</span>  <span class="c1"># Gradual pressure loss</span>
<a id="__codelineno-7-17" name="__codelineno-7-17" href="#__codelineno-7-17"></a><span class="n">noise</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">dates</span><span class="p">))</span>
<a id="__codelineno-7-18" name="__codelineno-7-18" href="#__codelineno-7-18"></a>
<a id="__codelineno-7-19" name="__codelineno-7-19" href="#__codelineno-7-19"></a><span class="n">y</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span>
<a id="__codelineno-7-20" name="__codelineno-7-20" href="#__codelineno-7-20"></a>    <span class="n">baseline_pressure</span> <span class="o">+</span> <span class="n">daily_cycle</span> <span class="o">+</span> <span class="n">degradation</span> <span class="o">+</span> <span class="n">noise</span><span class="p">,</span>
<a id="__codelineno-7-21" name="__codelineno-7-21" href="#__codelineno-7-21"></a>    <span class="n">index</span><span class="o">=</span><span class="n">dates</span><span class="p">,</span>
<a id="__codelineno-7-22" name="__codelineno-7-22" href="#__codelineno-7-22"></a>    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;pressure_psi&quot;</span><span class="p">,</span>
<a id="__codelineno-7-23" name="__codelineno-7-23" href="#__codelineno-7-23"></a><span class="p">)</span>
<a id="__codelineno-7-24" name="__codelineno-7-24" href="#__codelineno-7-24"></a>
<a id="__codelineno-7-25" name="__codelineno-7-25" href="#__codelineno-7-25"></a><span class="c1"># Define candidate models for rapid screening</span>
<a id="__codelineno-7-26" name="__codelineno-7-26" href="#__codelineno-7-26"></a><span class="n">model_candidates</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-7-27" name="__codelineno-7-27" href="#__codelineno-7-27"></a>    <span class="s2">&quot;Ridge&quot;</span><span class="p">:</span> <span class="n">Ridge</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">),</span>
<a id="__codelineno-7-28" name="__codelineno-7-28" href="#__codelineno-7-28"></a>    <span class="s2">&quot;Lasso&quot;</span><span class="p">:</span> <span class="n">Lasso</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">),</span>
<a id="__codelineno-7-29" name="__codelineno-7-29" href="#__codelineno-7-29"></a>    <span class="s2">&quot;RandomForest&quot;</span><span class="p">:</span> <span class="n">RandomForestRegressor</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">321</span><span class="p">),</span>
<a id="__codelineno-7-30" name="__codelineno-7-30" href="#__codelineno-7-30"></a>    <span class="s2">&quot;GradientBoosting&quot;</span><span class="p">:</span> <span class="n">GradientBoostingRegressor</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">321</span><span class="p">),</span>
<a id="__codelineno-7-31" name="__codelineno-7-31" href="#__codelineno-7-31"></a><span class="p">}</span>
<a id="__codelineno-7-32" name="__codelineno-7-32" href="#__codelineno-7-32"></a>
<a id="__codelineno-7-33" name="__codelineno-7-33" href="#__codelineno-7-33"></a><span class="c1"># OneStepAheadFold: Fast screening with single train/test split</span>
<a id="__codelineno-7-34" name="__codelineno-7-34" href="#__codelineno-7-34"></a><span class="n">cv</span> <span class="o">=</span> <span class="n">OneStepAheadFold</span><span class="p">(</span>
<a id="__codelineno-7-35" name="__codelineno-7-35" href="#__codelineno-7-35"></a>    <span class="n">initial_train_size</span><span class="o">=</span><span class="mi">180</span> <span class="o">*</span> <span class="mi">24</span><span class="p">,</span>  <span class="c1"># 6 months training</span>
<a id="__codelineno-7-36" name="__codelineno-7-36" href="#__codelineno-7-36"></a>    <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-7-37" name="__codelineno-7-37" href="#__codelineno-7-37"></a><span class="p">)</span>
<a id="__codelineno-7-38" name="__codelineno-7-38" href="#__codelineno-7-38"></a>
<a id="__codelineno-7-39" name="__codelineno-7-39" href="#__codelineno-7-39"></a><span class="c1"># Inspect the single fold structure</span>
<a id="__codelineno-7-40" name="__codelineno-7-40" href="#__codelineno-7-40"></a><span class="n">folds_df</span> <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">as_pandas</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-7-41" name="__codelineno-7-41" href="#__codelineno-7-41"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;OneStepAheadFold Structure:&quot;</span><span class="p">)</span>
<a id="__codelineno-7-42" name="__codelineno-7-42" href="#__codelineno-7-42"></a><span class="nb">print</span><span class="p">(</span><span class="n">folds_df</span><span class="p">)</span>
<a id="__codelineno-7-43" name="__codelineno-7-43" href="#__codelineno-7-43"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Training observations: </span><span class="si">{</span><span class="n">folds_df</span><span class="p">[</span><span class="s1">&#39;train_end&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">folds_df</span><span class="p">[</span><span class="s1">&#39;train_start&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-7-44" name="__codelineno-7-44" href="#__codelineno-7-44"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Test observations: </span><span class="si">{</span><span class="n">folds_df</span><span class="p">[</span><span class="s1">&#39;test_end&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">folds_df</span><span class="p">[</span><span class="s1">&#39;test_start&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-7-45" name="__codelineno-7-45" href="#__codelineno-7-45"></a>
<a id="__codelineno-7-46" name="__codelineno-7-46" href="#__codelineno-7-46"></a><span class="c1"># Rapid screening of all candidates</span>
<a id="__codelineno-7-47" name="__codelineno-7-47" href="#__codelineno-7-47"></a><span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-7-48" name="__codelineno-7-48" href="#__codelineno-7-48"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Rapid Model Screening Results:&quot;</span><span class="p">)</span>
<a id="__codelineno-7-49" name="__codelineno-7-49" href="#__codelineno-7-49"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
<a id="__codelineno-7-50" name="__codelineno-7-50" href="#__codelineno-7-50"></a>
<a id="__codelineno-7-51" name="__codelineno-7-51" href="#__codelineno-7-51"></a><span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">estimator</span> <span class="ow">in</span> <span class="n">model_candidates</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-7-52" name="__codelineno-7-52" href="#__codelineno-7-52"></a>    <span class="n">forecaster</span> <span class="o">=</span> <span class="n">ForecasterRecursive</span><span class="p">(</span>
<a id="__codelineno-7-53" name="__codelineno-7-53" href="#__codelineno-7-53"></a>        <span class="n">estimator</span><span class="o">=</span><span class="n">estimator</span><span class="p">,</span>
<a id="__codelineno-7-54" name="__codelineno-7-54" href="#__codelineno-7-54"></a>        <span class="n">lags</span><span class="o">=</span><span class="mi">24</span> <span class="o">*</span> <span class="mi">7</span><span class="p">,</span>  <span class="c1"># One week of hourly data</span>
<a id="__codelineno-7-55" name="__codelineno-7-55" href="#__codelineno-7-55"></a>    <span class="p">)</span>
<a id="__codelineno-7-56" name="__codelineno-7-56" href="#__codelineno-7-56"></a>
<a id="__codelineno-7-57" name="__codelineno-7-57" href="#__codelineno-7-57"></a>    <span class="n">metric_values</span><span class="p">,</span> <span class="n">predictions</span> <span class="o">=</span> <span class="n">backtesting_forecaster</span><span class="p">(</span>
<a id="__codelineno-7-58" name="__codelineno-7-58" href="#__codelineno-7-58"></a>        <span class="n">forecaster</span><span class="o">=</span><span class="n">forecaster</span><span class="p">,</span>
<a id="__codelineno-7-59" name="__codelineno-7-59" href="#__codelineno-7-59"></a>        <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span>
<a id="__codelineno-7-60" name="__codelineno-7-60" href="#__codelineno-7-60"></a>        <span class="n">cv</span><span class="o">=</span><span class="n">cv</span><span class="p">,</span>
<a id="__codelineno-7-61" name="__codelineno-7-61" href="#__codelineno-7-61"></a>        <span class="n">metric</span><span class="o">=</span><span class="s2">&quot;mean_absolute_error&quot;</span><span class="p">,</span>
<a id="__codelineno-7-62" name="__codelineno-7-62" href="#__codelineno-7-62"></a>        <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-7-63" name="__codelineno-7-63" href="#__codelineno-7-63"></a>        <span class="n">show_progress</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-7-64" name="__codelineno-7-64" href="#__codelineno-7-64"></a>    <span class="p">)</span>
<a id="__codelineno-7-65" name="__codelineno-7-65" href="#__codelineno-7-65"></a>
<a id="__codelineno-7-66" name="__codelineno-7-66" href="#__codelineno-7-66"></a>    <span class="n">mae</span> <span class="o">=</span> <span class="n">metric_values</span><span class="p">[</span><span class="s2">&quot;mean_absolute_error&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-7-67" name="__codelineno-7-67" href="#__codelineno-7-67"></a>    <span class="n">results</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">mae</span>
<a id="__codelineno-7-68" name="__codelineno-7-68" href="#__codelineno-7-68"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">:</span><span class="s2">20s</span><span class="si">}</span><span class="s2">: MAE = </span><span class="si">{</span><span class="n">mae</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> PSI&quot;</span><span class="p">)</span>
<a id="__codelineno-7-69" name="__codelineno-7-69" href="#__codelineno-7-69"></a>
<a id="__codelineno-7-70" name="__codelineno-7-70" href="#__codelineno-7-70"></a><span class="c1"># Select best model for further validation</span>
<a id="__codelineno-7-71" name="__codelineno-7-71" href="#__codelineno-7-71"></a><span class="n">best_model</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">results</span><span class="o">.</span><span class="n">get</span><span class="p">)</span>
<a id="__codelineno-7-72" name="__codelineno-7-72" href="#__codelineno-7-72"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> Best model for detailed validation: </span><span class="si">{</span><span class="n">best_model</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-7-73" name="__codelineno-7-73" href="#__codelineno-7-73"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  MAE: </span><span class="si">{</span><span class="n">results</span><span class="p">[</span><span class="n">best_model</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> PSI&quot;</span><span class="p">)</span>
<a id="__codelineno-7-74" name="__codelineno-7-74" href="#__codelineno-7-74"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Next step: Run TimeSeriesFold cross-validation on </span><span class="si">{</span><span class="n">best_model</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-7-75" name="__codelineno-7-75" href="#__codelineno-7-75"></a>
<a id="__codelineno-7-76" name="__codelineno-7-76" href="#__codelineno-7-76"></a><span class="c1"># Safety check: Verify best model meets minimum requirements</span>
<a id="__codelineno-7-77" name="__codelineno-7-77" href="#__codelineno-7-77"></a><span class="n">max_acceptable_mae</span> <span class="o">=</span> <span class="mf">2.0</span>  <span class="c1"># PSI</span>
<a id="__codelineno-7-78" name="__codelineno-7-78" href="#__codelineno-7-78"></a><span class="k">if</span> <span class="n">results</span><span class="p">[</span><span class="n">best_model</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">max_acceptable_mae</span><span class="p">:</span>
<a id="__codelineno-7-79" name="__codelineno-7-79" href="#__codelineno-7-79"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; Best model meets safety threshold (</span><span class="si">{</span><span class="n">max_acceptable_mae</span><span class="si">}</span><span class="s2"> PSI)&quot;</span><span class="p">)</span>
<a id="__codelineno-7-80" name="__codelineno-7-80" href="#__codelineno-7-80"></a><span class="k">else</span><span class="p">:</span>
<a id="__codelineno-7-81" name="__codelineno-7-81" href="#__codelineno-7-81"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; WARNING: Best model exceeds safety threshold&quot;</span><span class="p">)</span>
<a id="__codelineno-7-82" name="__codelineno-7-82" href="#__codelineno-7-82"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Consider additional feature engineering or model development&quot;</span><span class="p">)</span>
</code></pre></div>
<p>Key rapid screening elements:</p>
<ol>
<li>Single split: Minimal computation for fast iteration</li>
<li>Multiple candidates: Screen many models quickly</li>
<li>Maximum test data: Uses all post-training data for robust assessment</li>
<li>Safety gates: Immediate feedback on viability</li>
<li>Workflow integration: Identifies candidates for deeper validation</li>
</ol>
<h4 id="example-2-static-model-deployment-validation">Example 2: Static Model Deployment Validation</h4>
<p>This example demonstrates validating a model that will be deployed without retraining, making OneStepAheadFold the appropriate validation strategy.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.ensemble</span><span class="w"> </span><span class="kn">import</span> <span class="n">GradientBoostingRegressor</span>
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a><span class="kn">from</span><span class="w"> </span><span class="nn">spotforecast2_safe.forecaster.recursive</span><span class="w"> </span><span class="kn">import</span> <span class="n">ForecasterRecursive</span>
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a><span class="kn">from</span><span class="w"> </span><span class="nn">spotforecast2.model_selection</span><span class="w"> </span><span class="kn">import</span> <span class="n">backtesting_forecaster</span><span class="p">,</span> <span class="n">OneStepAheadFold</span>
<a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a>
<a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a><span class="c1"># Simulate embedded sensor system (temperature) with limited compute for retraining</span>
<a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a><span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">(</span><span class="mi">654</span><span class="p">)</span>
<a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a><span class="n">dates</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s2">&quot;2024-01-01&quot;</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">730</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s2">&quot;D&quot;</span><span class="p">)</span>  <span class="c1"># 2 years</span>
<a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a>
<a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a><span class="c1"># Seasonal temperature pattern</span>
<a id="__codelineno-8-12" name="__codelineno-8-12" href="#__codelineno-8-12"></a><span class="n">day_of_year</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dates</span><span class="p">))</span> <span class="o">%</span> <span class="mi">365</span>
<a id="__codelineno-8-13" name="__codelineno-8-13" href="#__codelineno-8-13"></a><span class="n">seasonal</span> <span class="o">=</span> <span class="mi">15</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">day_of_year</span> <span class="o">/</span> <span class="mi">365</span><span class="p">)</span>
<a id="__codelineno-8-14" name="__codelineno-8-14" href="#__codelineno-8-14"></a><span class="n">baseline_temp</span> <span class="o">=</span> <span class="mi">20</span>
<a id="__codelineno-8-15" name="__codelineno-8-15" href="#__codelineno-8-15"></a><span class="n">noise</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">dates</span><span class="p">))</span>
<a id="__codelineno-8-16" name="__codelineno-8-16" href="#__codelineno-8-16"></a>
<a id="__codelineno-8-17" name="__codelineno-8-17" href="#__codelineno-8-17"></a><span class="n">y</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">baseline_temp</span> <span class="o">+</span> <span class="n">seasonal</span> <span class="o">+</span> <span class="n">noise</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">dates</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;temperature_c&quot;</span><span class="p">)</span>
<a id="__codelineno-8-18" name="__codelineno-8-18" href="#__codelineno-8-18"></a>
<a id="__codelineno-8-19" name="__codelineno-8-19" href="#__codelineno-8-19"></a><span class="c1"># Embedded system: Model will be deployed statically (no retraining capability)</span>
<a id="__codelineno-8-20" name="__codelineno-8-20" href="#__codelineno-8-20"></a><span class="n">forecaster</span> <span class="o">=</span> <span class="n">ForecasterRecursive</span><span class="p">(</span>
<a id="__codelineno-8-21" name="__codelineno-8-21" href="#__codelineno-8-21"></a>    <span class="n">estimator</span><span class="o">=</span><span class="n">GradientBoostingRegressor</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">654</span><span class="p">),</span>
<a id="__codelineno-8-22" name="__codelineno-8-22" href="#__codelineno-8-22"></a>    <span class="n">lags</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>  <span class="c1"># Last 30 days</span>
<a id="__codelineno-8-23" name="__codelineno-8-23" href="#__codelineno-8-23"></a><span class="p">)</span>
<a id="__codelineno-8-24" name="__codelineno-8-24" href="#__codelineno-8-24"></a>
<a id="__codelineno-8-25" name="__codelineno-8-25" href="#__codelineno-8-25"></a><span class="c1"># OneStepAheadFold: Matches static deployment (train once, predict forever)</span>
<a id="__codelineno-8-26" name="__codelineno-8-26" href="#__codelineno-8-26"></a><span class="n">cv</span> <span class="o">=</span> <span class="n">OneStepAheadFold</span><span class="p">(</span>
<a id="__codelineno-8-27" name="__codelineno-8-27" href="#__codelineno-8-27"></a>    <span class="n">initial_train_size</span><span class="o">=</span><span class="mi">365</span><span class="p">,</span>  <span class="c1"># Train on first year</span>
<a id="__codelineno-8-28" name="__codelineno-8-28" href="#__codelineno-8-28"></a>    <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-8-29" name="__codelineno-8-29" href="#__codelineno-8-29"></a><span class="p">)</span>
<a id="__codelineno-8-30" name="__codelineno-8-30" href="#__codelineno-8-30"></a>
<a id="__codelineno-8-31" name="__codelineno-8-31" href="#__codelineno-8-31"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Static Deployment Validation:&quot;</span><span class="p">)</span>
<a id="__codelineno-8-32" name="__codelineno-8-32" href="#__codelineno-8-32"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
<a id="__codelineno-8-33" name="__codelineno-8-33" href="#__codelineno-8-33"></a>
<a id="__codelineno-8-34" name="__codelineno-8-34" href="#__codelineno-8-34"></a><span class="c1"># Validate on entire second year (simulates production behavior)</span>
<a id="__codelineno-8-35" name="__codelineno-8-35" href="#__codelineno-8-35"></a><span class="n">metric_values</span><span class="p">,</span> <span class="n">predictions</span> <span class="o">=</span> <span class="n">backtesting_forecaster</span><span class="p">(</span>
<a id="__codelineno-8-36" name="__codelineno-8-36" href="#__codelineno-8-36"></a>    <span class="n">forecaster</span><span class="o">=</span><span class="n">forecaster</span><span class="p">,</span>
<a id="__codelineno-8-37" name="__codelineno-8-37" href="#__codelineno-8-37"></a>    <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span>
<a id="__codelineno-8-38" name="__codelineno-8-38" href="#__codelineno-8-38"></a>    <span class="n">cv</span><span class="o">=</span><span class="n">cv</span><span class="p">,</span>
<a id="__codelineno-8-39" name="__codelineno-8-39" href="#__codelineno-8-39"></a>    <span class="n">metric</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;mean_absolute_error&quot;</span><span class="p">,</span> <span class="s2">&quot;mean_squared_error&quot;</span><span class="p">],</span>
<a id="__codelineno-8-40" name="__codelineno-8-40" href="#__codelineno-8-40"></a>    <span class="n">interval</span><span class="o">=</span><span class="mf">0.90</span><span class="p">,</span>  <span class="c1"># 90% prediction interval</span>
<a id="__codelineno-8-41" name="__codelineno-8-41" href="#__codelineno-8-41"></a>    <span class="n">interval_method</span><span class="o">=</span><span class="s2">&quot;conformal&quot;</span><span class="p">,</span>
<a id="__codelineno-8-42" name="__codelineno-8-42" href="#__codelineno-8-42"></a>    <span class="n">use_in_sample_residuals</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-8-43" name="__codelineno-8-43" href="#__codelineno-8-43"></a>    <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-8-44" name="__codelineno-8-44" href="#__codelineno-8-44"></a>    <span class="n">show_progress</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-8-45" name="__codelineno-8-45" href="#__codelineno-8-45"></a><span class="p">)</span>
<a id="__codelineno-8-46" name="__codelineno-8-46" href="#__codelineno-8-46"></a>
<a id="__codelineno-8-47" name="__codelineno-8-47" href="#__codelineno-8-47"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Static Model Performance (Year 2):&quot;</span><span class="p">)</span>
<a id="__codelineno-8-48" name="__codelineno-8-48" href="#__codelineno-8-48"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mean Absolute Error: </span><span class="si">{</span><span class="n">metric_values</span><span class="p">[</span><span class="s1">&#39;mean_absolute_error&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> C&quot;</span><span class="p">)</span>
<a id="__codelineno-8-49" name="__codelineno-8-49" href="#__codelineno-8-49"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;RMSE: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">metric_values</span><span class="p">[</span><span class="s1">&#39;mean_squared_error&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> C&quot;</span><span class="p">)</span>
<a id="__codelineno-8-50" name="__codelineno-8-50" href="#__codelineno-8-50"></a>
<a id="__codelineno-8-51" name="__codelineno-8-51" href="#__codelineno-8-51"></a><span class="c1"># Temporal degradation analysis: Check if performance degrades over time</span>
<a id="__codelineno-8-52" name="__codelineno-8-52" href="#__codelineno-8-52"></a><span class="c1"># Split test period into quarters</span>
<a id="__codelineno-8-53" name="__codelineno-8-53" href="#__codelineno-8-53"></a><span class="n">test_predictions</span> <span class="o">=</span> <span class="n">predictions</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="__codelineno-8-54" name="__codelineno-8-54" href="#__codelineno-8-54"></a><span class="n">n_test</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">test_predictions</span><span class="p">)</span>
<a id="__codelineno-8-55" name="__codelineno-8-55" href="#__codelineno-8-55"></a><span class="n">quarter_size</span> <span class="o">=</span> <span class="n">n_test</span> <span class="o">//</span> <span class="mi">4</span>
<a id="__codelineno-8-56" name="__codelineno-8-56" href="#__codelineno-8-56"></a>
<a id="__codelineno-8-57" name="__codelineno-8-57" href="#__codelineno-8-57"></a><span class="n">quarterly_mae</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-8-58" name="__codelineno-8-58" href="#__codelineno-8-58"></a><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
<a id="__codelineno-8-59" name="__codelineno-8-59" href="#__codelineno-8-59"></a>    <span class="n">start_idx</span> <span class="o">=</span> <span class="n">i</span> <span class="o">*</span> <span class="n">quarter_size</span>
<a id="__codelineno-8-60" name="__codelineno-8-60" href="#__codelineno-8-60"></a>    <span class="n">end_idx</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">quarter_size</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">3</span> <span class="k">else</span> <span class="n">n_test</span>
<a id="__codelineno-8-61" name="__codelineno-8-61" href="#__codelineno-8-61"></a>    <span class="n">quarter_preds</span> <span class="o">=</span> <span class="n">test_predictions</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">start_idx</span><span class="p">:</span><span class="n">end_idx</span><span class="p">]</span>
<a id="__codelineno-8-62" name="__codelineno-8-62" href="#__codelineno-8-62"></a>    <span class="n">quarter_actual</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">quarter_preds</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>
<a id="__codelineno-8-63" name="__codelineno-8-63" href="#__codelineno-8-63"></a>    <span class="n">quarter_mae</span> <span class="o">=</span> <span class="p">(</span><span class="n">quarter_actual</span> <span class="o">-</span> <span class="n">quarter_preds</span><span class="p">[</span><span class="s2">&quot;pred&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<a id="__codelineno-8-64" name="__codelineno-8-64" href="#__codelineno-8-64"></a>    <span class="n">quarterly_mae</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">quarter_mae</span><span class="p">)</span>
<a id="__codelineno-8-65" name="__codelineno-8-65" href="#__codelineno-8-65"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Quarter </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2"> MAE: </span><span class="si">{</span><span class="n">quarter_mae</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> C&quot;</span><span class="p">)</span>
<a id="__codelineno-8-66" name="__codelineno-8-66" href="#__codelineno-8-66"></a>
<a id="__codelineno-8-67" name="__codelineno-8-67" href="#__codelineno-8-67"></a><span class="c1"># Degradation check: Is performance stable over time?</span>
<a id="__codelineno-8-68" name="__codelineno-8-68" href="#__codelineno-8-68"></a><span class="n">mae_trend</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="n">quarterly_mae</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-8-69" name="__codelineno-8-69" href="#__codelineno-8-69"></a><span class="k">if</span> <span class="n">mae_trend</span> <span class="o">&gt;</span> <span class="mf">0.1</span><span class="p">:</span>
<a id="__codelineno-8-70" name="__codelineno-8-70" href="#__codelineno-8-70"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> WARNING: Performance degrading over time (trend: +</span><span class="si">{</span><span class="n">mae_trend</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> C/quarter)&quot;</span><span class="p">)</span>
<a id="__codelineno-8-71" name="__codelineno-8-71" href="#__codelineno-8-71"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  Consider implementing periodic retraining capability&quot;</span><span class="p">)</span>
<a id="__codelineno-8-72" name="__codelineno-8-72" href="#__codelineno-8-72"></a><span class="k">else</span><span class="p">:</span>
<a id="__codelineno-8-73" name="__codelineno-8-73" href="#__codelineno-8-73"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> Performance stable over time (trend: </span><span class="si">{</span><span class="n">mae_trend</span><span class="si">:</span><span class="s2">+.3f</span><span class="si">}</span><span class="s2"> C/quarter)&quot;</span><span class="p">)</span>
<a id="__codelineno-8-74" name="__codelineno-8-74" href="#__codelineno-8-74"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  Static deployment validated for production&quot;</span><span class="p">)</span>
<a id="__codelineno-8-75" name="__codelineno-8-75" href="#__codelineno-8-75"></a>
<a id="__codelineno-8-76" name="__codelineno-8-76" href="#__codelineno-8-76"></a><span class="c1"># Coverage stability check</span>
<a id="__codelineno-8-77" name="__codelineno-8-77" href="#__codelineno-8-77"></a><span class="n">coverage</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-8-78" name="__codelineno-8-78" href="#__codelineno-8-78"></a>    <span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">predictions</span><span class="o">.</span><span class="n">index</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">predictions</span><span class="p">[</span><span class="s2">&quot;lower_bound&quot;</span><span class="p">])</span>
<a id="__codelineno-8-79" name="__codelineno-8-79" href="#__codelineno-8-79"></a>    <span class="o">&amp;</span> <span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">predictions</span><span class="o">.</span><span class="n">index</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">predictions</span><span class="p">[</span><span class="s2">&quot;upper_bound&quot;</span><span class="p">])</span>
<a id="__codelineno-8-80" name="__codelineno-8-80" href="#__codelineno-8-80"></a><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<a id="__codelineno-8-81" name="__codelineno-8-81" href="#__codelineno-8-81"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Prediction Interval Coverage: </span><span class="si">{</span><span class="n">coverage</span><span class="si">:</span><span class="s2">.1%</span><span class="si">}</span><span class="s2"> (target: 90%)&quot;</span><span class="p">)</span>
</code></pre></div>
<p>Key static deployment elements:</p>
<ol>
<li>Single training: Matches production constraint (no retraining)</li>
<li>Long test period: Validates sustained performance</li>
<li>Temporal degradation analysis: Detects performance decay</li>
<li>Coverage stability: Ensures uncertainty estimates remain calibrated</li>
<li>Deployment decision: Clear criteria for static vs dynamic deployment</li>
</ol>
<h4 id="example-3-emergency-production-validation">Example 3: Emergency Production Validation</h4>
<p>This example demonstrates using OneStepAheadFold for rapid validation when production issues require immediate model assessment.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.ensemble</span><span class="w"> </span><span class="kn">import</span> <span class="n">RandomForestRegressor</span>
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="kn">from</span><span class="w"> </span><span class="nn">spotforecast2_safe.forecaster.recursive</span><span class="w"> </span><span class="kn">import</span> <span class="n">ForecasterRecursive</span>
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="kn">from</span><span class="w"> </span><span class="nn">spotforecast2.model_selection</span><span class="w"> </span><span class="kn">import</span> <span class="n">backtesting_forecaster</span><span class="p">,</span> <span class="n">OneStepAheadFold</span>
<a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a><span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a>
<a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a><span class="c1"># Simulate production scenario: Model performance suddenly degraded</span>
<a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a><span class="c1"># Need to quickly validate if rolling back to previous model version helps</span>
<a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a><span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">(</span><span class="mi">987</span><span class="p">)</span>
<a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a><span class="n">dates</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s2">&quot;2024-01-01&quot;</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s2">&quot;D&quot;</span><span class="p">)</span>
<a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a>
<a id="__codelineno-9-13" name="__codelineno-9-13" href="#__codelineno-9-13"></a><span class="c1"># Simulated production data with recent distribution shift</span>
<a id="__codelineno-9-14" name="__codelineno-9-14" href="#__codelineno-9-14"></a><span class="n">baseline</span> <span class="o">=</span> <span class="mi">100</span>
<a id="__codelineno-9-15" name="__codelineno-9-15" href="#__codelineno-9-15"></a><span class="n">trend</span> <span class="o">=</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dates</span><span class="p">))</span>
<a id="__codelineno-9-16" name="__codelineno-9-16" href="#__codelineno-9-16"></a><span class="c1"># Distribution shift in last 30 days</span>
<a id="__codelineno-9-17" name="__codelineno-9-17" href="#__codelineno-9-17"></a><span class="n">shift</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dates</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-9-18" name="__codelineno-9-18" href="#__codelineno-9-18"></a><span class="n">noise</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">dates</span><span class="p">))</span>
<a id="__codelineno-9-19" name="__codelineno-9-19" href="#__codelineno-9-19"></a>
<a id="__codelineno-9-20" name="__codelineno-9-20" href="#__codelineno-9-20"></a><span class="n">y</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">baseline</span> <span class="o">+</span> <span class="n">trend</span> <span class="o">+</span> <span class="n">shift</span> <span class="o">+</span> <span class="n">noise</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">dates</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;metric&quot;</span><span class="p">)</span>
<a id="__codelineno-9-21" name="__codelineno-9-21" href="#__codelineno-9-21"></a>
<a id="__codelineno-9-22" name="__codelineno-9-22" href="#__codelineno-9-22"></a><span class="c1"># Emergency scenario: Current model failing, test rollback candidate quickly</span>
<a id="__codelineno-9-23" name="__codelineno-9-23" href="#__codelineno-9-23"></a><span class="n">rollback_model</span> <span class="o">=</span> <span class="n">ForecasterRecursive</span><span class="p">(</span>
<a id="__codelineno-9-24" name="__codelineno-9-24" href="#__codelineno-9-24"></a>    <span class="n">estimator</span><span class="o">=</span><span class="n">RandomForestRegressor</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">987</span><span class="p">),</span>  <span class="c1"># Faster</span>
<a id="__codelineno-9-25" name="__codelineno-9-25" href="#__codelineno-9-25"></a>    <span class="n">lags</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span>
<a id="__codelineno-9-26" name="__codelineno-9-26" href="#__codelineno-9-26"></a><span class="p">)</span>
<a id="__codelineno-9-27" name="__codelineno-9-27" href="#__codelineno-9-27"></a>
<a id="__codelineno-9-28" name="__codelineno-9-28" href="#__codelineno-9-28"></a><span class="c1"># OneStepAheadFold: Fastest possible validation</span>
<a id="__codelineno-9-29" name="__codelineno-9-29" href="#__codelineno-9-29"></a><span class="n">cv</span> <span class="o">=</span> <span class="n">OneStepAheadFold</span><span class="p">(</span>
<a id="__codelineno-9-30" name="__codelineno-9-30" href="#__codelineno-9-30"></a>    <span class="n">initial_train_size</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span>  <span class="c1"># Train on pre-shift data</span>
<a id="__codelineno-9-31" name="__codelineno-9-31" href="#__codelineno-9-31"></a>    <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>  <span class="c1"># Suppress output for speed</span>
<a id="__codelineno-9-32" name="__codelineno-9-32" href="#__codelineno-9-32"></a><span class="p">)</span>
<a id="__codelineno-9-33" name="__codelineno-9-33" href="#__codelineno-9-33"></a>
<a id="__codelineno-9-34" name="__codelineno-9-34" href="#__codelineno-9-34"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Emergency Production Validation:&quot;</span><span class="p">)</span>
<a id="__codelineno-9-35" name="__codelineno-9-35" href="#__codelineno-9-35"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
<a id="__codelineno-9-36" name="__codelineno-9-36" href="#__codelineno-9-36"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Scenario: Production model failing, testing rollback candidate...&quot;</span><span class="p">)</span>
<a id="__codelineno-9-37" name="__codelineno-9-37" href="#__codelineno-9-37"></a>
<a id="__codelineno-9-38" name="__codelineno-9-38" href="#__codelineno-9-38"></a><span class="c1"># Time the validation</span>
<a id="__codelineno-9-39" name="__codelineno-9-39" href="#__codelineno-9-39"></a><span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<a id="__codelineno-9-40" name="__codelineno-9-40" href="#__codelineno-9-40"></a>
<a id="__codelineno-9-41" name="__codelineno-9-41" href="#__codelineno-9-41"></a><span class="n">metric_values</span><span class="p">,</span> <span class="n">predictions</span> <span class="o">=</span> <span class="n">backtesting_forecaster</span><span class="p">(</span>
<a id="__codelineno-9-42" name="__codelineno-9-42" href="#__codelineno-9-42"></a>    <span class="n">forecaster</span><span class="o">=</span><span class="n">rollback_model</span><span class="p">,</span>
<a id="__codelineno-9-43" name="__codelineno-9-43" href="#__codelineno-9-43"></a>    <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span>
<a id="__codelineno-9-44" name="__codelineno-9-44" href="#__codelineno-9-44"></a>    <span class="n">cv</span><span class="o">=</span><span class="n">cv</span><span class="p">,</span>
<a id="__codelineno-9-45" name="__codelineno-9-45" href="#__codelineno-9-45"></a>    <span class="n">metric</span><span class="o">=</span><span class="s2">&quot;mean_absolute_error&quot;</span><span class="p">,</span>
<a id="__codelineno-9-46" name="__codelineno-9-46" href="#__codelineno-9-46"></a>    <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-9-47" name="__codelineno-9-47" href="#__codelineno-9-47"></a>    <span class="n">show_progress</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-9-48" name="__codelineno-9-48" href="#__codelineno-9-48"></a><span class="p">)</span>
<a id="__codelineno-9-49" name="__codelineno-9-49" href="#__codelineno-9-49"></a>
<a id="__codelineno-9-50" name="__codelineno-9-50" href="#__codelineno-9-50"></a><span class="n">validation_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
<a id="__codelineno-9-51" name="__codelineno-9-51" href="#__codelineno-9-51"></a>
<a id="__codelineno-9-52" name="__codelineno-9-52" href="#__codelineno-9-52"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Validation completed in </span><span class="si">{</span><span class="n">validation_time</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> seconds&quot;</span><span class="p">)</span>
<a id="__codelineno-9-53" name="__codelineno-9-53" href="#__codelineno-9-53"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Rollback Model MAE: </span><span class="si">{</span><span class="n">metric_values</span><span class="p">[</span><span class="s1">&#39;mean_absolute_error&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-9-54" name="__codelineno-9-54" href="#__codelineno-9-54"></a>
<a id="__codelineno-9-55" name="__codelineno-9-55" href="#__codelineno-9-55"></a><span class="c1"># Compare to current production model performance (simulated)</span>
<a id="__codelineno-9-56" name="__codelineno-9-56" href="#__codelineno-9-56"></a><span class="n">current_production_mae</span> <span class="o">=</span> <span class="mf">15.0</span>  <span class="c1"># Degraded performance</span>
<a id="__codelineno-9-57" name="__codelineno-9-57" href="#__codelineno-9-57"></a><span class="n">rollback_mae</span> <span class="o">=</span> <span class="n">metric_values</span><span class="p">[</span><span class="s2">&quot;mean_absolute_error&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-9-58" name="__codelineno-9-58" href="#__codelineno-9-58"></a>
<a id="__codelineno-9-59" name="__codelineno-9-59" href="#__codelineno-9-59"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Production Comparison:&quot;</span><span class="p">)</span>
<a id="__codelineno-9-60" name="__codelineno-9-60" href="#__codelineno-9-60"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Current Model MAE:  </span><span class="si">{</span><span class="n">current_production_mae</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-9-61" name="__codelineno-9-61" href="#__codelineno-9-61"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Rollback Model MAE: </span><span class="si">{</span><span class="n">rollback_mae</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-9-62" name="__codelineno-9-62" href="#__codelineno-9-62"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Improvement:        </span><span class="si">{</span><span class="n">current_production_mae</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">rollback_mae</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">rollback_mae</span><span class="o">/</span><span class="n">current_production_mae</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">%)&quot;</span><span class="p">)</span>
<a id="__codelineno-9-63" name="__codelineno-9-63" href="#__codelineno-9-63"></a>
<a id="__codelineno-9-64" name="__codelineno-9-64" href="#__codelineno-9-64"></a><span class="c1"># Emergency decision criteria</span>
<a id="__codelineno-9-65" name="__codelineno-9-65" href="#__codelineno-9-65"></a><span class="k">if</span> <span class="n">rollback_mae</span> <span class="o">&lt;</span> <span class="n">current_production_mae</span> <span class="o">*</span> <span class="mf">0.8</span><span class="p">:</span>  <span class="c1"># 20% improvement threshold</span>
<a id="__codelineno-9-66" name="__codelineno-9-66" href="#__codelineno-9-66"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> RECOMMENDATION: APPROVE rollback&quot;</span><span class="p">)</span>
<a id="__codelineno-9-67" name="__codelineno-9-67" href="#__codelineno-9-67"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Significant improvement detected&quot;</span><span class="p">)</span>
<a id="__codelineno-9-68" name="__codelineno-9-68" href="#__codelineno-9-68"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Proceed with rollback to restore service&quot;</span><span class="p">)</span>
<a id="__codelineno-9-69" name="__codelineno-9-69" href="#__codelineno-9-69"></a><span class="k">else</span><span class="p">:</span>
<a id="__codelineno-9-70" name="__codelineno-9-70" href="#__codelineno-9-70"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> RECOMMENDATION: REJECT rollback&quot;</span><span class="p">)</span>
<a id="__codelineno-9-71" name="__codelineno-9-71" href="#__codelineno-9-71"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Insufficient improvement&quot;</span><span class="p">)</span>
<a id="__codelineno-9-72" name="__codelineno-9-72" href="#__codelineno-9-72"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Investigate root cause instead of rollback&quot;</span><span class="p">)</span>
<a id="__codelineno-9-73" name="__codelineno-9-73" href="#__codelineno-9-73"></a>
<a id="__codelineno-9-74" name="__codelineno-9-74" href="#__codelineno-9-74"></a><span class="c1"># Quick diagnostic: Where is the rollback model failing?</span>
<a id="__codelineno-9-75" name="__codelineno-9-75" href="#__codelineno-9-75"></a><span class="n">errors</span> <span class="o">=</span> <span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">predictions</span><span class="o">.</span><span class="n">index</span><span class="p">]</span> <span class="o">-</span> <span class="n">predictions</span><span class="p">[</span><span class="s2">&quot;pred&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span>
<a id="__codelineno-9-76" name="__codelineno-9-76" href="#__codelineno-9-76"></a><span class="n">worst_period_start</span> <span class="o">=</span> <span class="n">errors</span><span class="o">.</span><span class="n">idxmax</span><span class="p">()</span>
<a id="__codelineno-9-77" name="__codelineno-9-77" href="#__codelineno-9-77"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Worst prediction period: </span><span class="si">{</span><span class="n">worst_period_start</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-9-78" name="__codelineno-9-78" href="#__codelineno-9-78"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error magnitude: </span><span class="si">{</span><span class="n">errors</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
<p>Key emergency validation elements:</p>
<ol>
<li>Speed priority: Minimal computation for rapid decision</li>
<li>Rollback testing: Quick assessment of previous model version</li>
<li>Clear decision criteria: Quantitative thresholds for action</li>
<li>Diagnostic information: Identifies failure modes</li>
<li>Production context: Balances speed vs thoroughness appropriately</li>
</ol>
<h3 id="computational-efficiency-comparison">Computational Efficiency Comparison</h3>
<p>OneStepAheadFold vs TimeSeriesFold computational cost:</p>
<ul>
<li>OneStepAheadFold: 1 model training + 1 prediction pass</li>
<li>TimeSeriesFold (10 folds, refit=True): 10 model trainings + 10 prediction passes</li>
<li>TimeSeriesFold (10 folds, refit=False): 1 model training + 10 prediction passes</li>
</ul>
<p>For expensive models or large datasets, OneStepAheadFold can be 10-100x faster than TimeSeriesFold with refit=True.</p>
<h2 id="grid-search">Grid Search</h2>


<div class="doc doc-object doc-module">



<h2 id="spotforecast2.model_selection.grid_search" class="doc doc-heading">
            <code>spotforecast2.model_selection.grid_search</code>


</h2>

    <div class="doc doc-contents first">










<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="spotforecast2.model_selection.grid_search.grid_search_forecaster" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">grid_search_forecaster</span><span class="p">(</span><span class="n">forecaster</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">cv</span><span class="p">,</span> <span class="n">param_grid</span><span class="p">,</span> <span class="n">metric</span><span class="p">,</span> <span class="n">exog</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lags_grid</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">return_best</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">show_progress</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">suppress_warnings</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">output_file</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Exhaustive grid search over parameter values for a Forecaster.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/spotforecast2/model_selection/grid_search.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-276">276</a></span>
<span class="normal"><a href="#__codelineno-0-277">277</a></span>
<span class="normal"><a href="#__codelineno-0-278">278</a></span>
<span class="normal"><a href="#__codelineno-0-279">279</a></span>
<span class="normal"><a href="#__codelineno-0-280">280</a></span>
<span class="normal"><a href="#__codelineno-0-281">281</a></span>
<span class="normal"><a href="#__codelineno-0-282">282</a></span>
<span class="normal"><a href="#__codelineno-0-283">283</a></span>
<span class="normal"><a href="#__codelineno-0-284">284</a></span>
<span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span>
<span class="normal"><a href="#__codelineno-0-287">287</a></span>
<span class="normal"><a href="#__codelineno-0-288">288</a></span>
<span class="normal"><a href="#__codelineno-0-289">289</a></span>
<span class="normal"><a href="#__codelineno-0-290">290</a></span>
<span class="normal"><a href="#__codelineno-0-291">291</a></span>
<span class="normal"><a href="#__codelineno-0-292">292</a></span>
<span class="normal"><a href="#__codelineno-0-293">293</a></span>
<span class="normal"><a href="#__codelineno-0-294">294</a></span>
<span class="normal"><a href="#__codelineno-0-295">295</a></span>
<span class="normal"><a href="#__codelineno-0-296">296</a></span>
<span class="normal"><a href="#__codelineno-0-297">297</a></span>
<span class="normal"><a href="#__codelineno-0-298">298</a></span>
<span class="normal"><a href="#__codelineno-0-299">299</a></span>
<span class="normal"><a href="#__codelineno-0-300">300</a></span>
<span class="normal"><a href="#__codelineno-0-301">301</a></span>
<span class="normal"><a href="#__codelineno-0-302">302</a></span>
<span class="normal"><a href="#__codelineno-0-303">303</a></span>
<span class="normal"><a href="#__codelineno-0-304">304</a></span>
<span class="normal"><a href="#__codelineno-0-305">305</a></span>
<span class="normal"><a href="#__codelineno-0-306">306</a></span>
<span class="normal"><a href="#__codelineno-0-307">307</a></span>
<span class="normal"><a href="#__codelineno-0-308">308</a></span>
<span class="normal"><a href="#__codelineno-0-309">309</a></span>
<span class="normal"><a href="#__codelineno-0-310">310</a></span>
<span class="normal"><a href="#__codelineno-0-311">311</a></span>
<span class="normal"><a href="#__codelineno-0-312">312</a></span>
<span class="normal"><a href="#__codelineno-0-313">313</a></span>
<span class="normal"><a href="#__codelineno-0-314">314</a></span>
<span class="normal"><a href="#__codelineno-0-315">315</a></span>
<span class="normal"><a href="#__codelineno-0-316">316</a></span>
<span class="normal"><a href="#__codelineno-0-317">317</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-276" name="__codelineno-0-276"></a><span class="k">def</span><span class="w"> </span><span class="nf">grid_search_forecaster</span><span class="p">(</span>
<a id="__codelineno-0-277" name="__codelineno-0-277"></a>    <span class="n">forecaster</span><span class="p">:</span> <span class="nb">object</span><span class="p">,</span>
<a id="__codelineno-0-278" name="__codelineno-0-278"></a>    <span class="n">y</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span>
<a id="__codelineno-0-279" name="__codelineno-0-279"></a>    <span class="n">cv</span><span class="p">:</span> <span class="n">TimeSeriesFold</span> <span class="o">|</span> <span class="n">OneStepAheadFold</span><span class="p">,</span>
<a id="__codelineno-0-280" name="__codelineno-0-280"></a>    <span class="n">param_grid</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
<a id="__codelineno-0-281" name="__codelineno-0-281"></a>    <span class="n">metric</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Callable</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="n">Callable</span><span class="p">],</span>
<a id="__codelineno-0-282" name="__codelineno-0-282"></a>    <span class="n">exog</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span> <span class="o">|</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-283" name="__codelineno-0-283"></a>    <span class="n">lags_grid</span><span class="p">:</span> <span class="p">(</span>
<a id="__codelineno-0-284" name="__codelineno-0-284"></a>        <span class="nb">list</span><span class="p">[</span><span class="nb">int</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="nb">range</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span>
<a id="__codelineno-0-285" name="__codelineno-0-285"></a>        <span class="o">|</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="nb">range</span><span class="p">[</span><span class="nb">int</span><span class="p">]]]</span>
<a id="__codelineno-0-286" name="__codelineno-0-286"></a>        <span class="o">|</span> <span class="kc">None</span>
<a id="__codelineno-0-287" name="__codelineno-0-287"></a>    <span class="p">)</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-288" name="__codelineno-0-288"></a>    <span class="n">return_best</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-289" name="__codelineno-0-289"></a>    <span class="n">n_jobs</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;auto&quot;</span><span class="p">,</span>
<a id="__codelineno-0-290" name="__codelineno-0-290"></a>    <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-291" name="__codelineno-0-291"></a>    <span class="n">show_progress</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-292" name="__codelineno-0-292"></a>    <span class="n">suppress_warnings</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-293" name="__codelineno-0-293"></a>    <span class="n">output_file</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-294" name="__codelineno-0-294"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<a id="__codelineno-0-295" name="__codelineno-0-295"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-296" name="__codelineno-0-296"></a><span class="sd">    Exhaustive grid search over parameter values for a Forecaster.</span>
<a id="__codelineno-0-297" name="__codelineno-0-297"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-298" name="__codelineno-0-298"></a>
<a id="__codelineno-0-299" name="__codelineno-0-299"></a>    <span class="n">param_grid</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">ParameterGrid</span><span class="p">(</span><span class="n">param_grid</span><span class="p">))</span>
<a id="__codelineno-0-300" name="__codelineno-0-300"></a>
<a id="__codelineno-0-301" name="__codelineno-0-301"></a>    <span class="n">results</span> <span class="o">=</span> <span class="n">_evaluate_grid_hyperparameters</span><span class="p">(</span>
<a id="__codelineno-0-302" name="__codelineno-0-302"></a>        <span class="n">forecaster</span><span class="o">=</span><span class="n">forecaster</span><span class="p">,</span>
<a id="__codelineno-0-303" name="__codelineno-0-303"></a>        <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span>
<a id="__codelineno-0-304" name="__codelineno-0-304"></a>        <span class="n">cv</span><span class="o">=</span><span class="n">cv</span><span class="p">,</span>
<a id="__codelineno-0-305" name="__codelineno-0-305"></a>        <span class="n">param_grid</span><span class="o">=</span><span class="n">param_grid</span><span class="p">,</span>
<a id="__codelineno-0-306" name="__codelineno-0-306"></a>        <span class="n">metric</span><span class="o">=</span><span class="n">metric</span><span class="p">,</span>
<a id="__codelineno-0-307" name="__codelineno-0-307"></a>        <span class="n">exog</span><span class="o">=</span><span class="n">exog</span><span class="p">,</span>
<a id="__codelineno-0-308" name="__codelineno-0-308"></a>        <span class="n">lags_grid</span><span class="o">=</span><span class="n">lags_grid</span><span class="p">,</span>
<a id="__codelineno-0-309" name="__codelineno-0-309"></a>        <span class="n">return_best</span><span class="o">=</span><span class="n">return_best</span><span class="p">,</span>
<a id="__codelineno-0-310" name="__codelineno-0-310"></a>        <span class="n">n_jobs</span><span class="o">=</span><span class="n">n_jobs</span><span class="p">,</span>
<a id="__codelineno-0-311" name="__codelineno-0-311"></a>        <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
<a id="__codelineno-0-312" name="__codelineno-0-312"></a>        <span class="n">show_progress</span><span class="o">=</span><span class="n">show_progress</span><span class="p">,</span>
<a id="__codelineno-0-313" name="__codelineno-0-313"></a>        <span class="n">suppress_warnings</span><span class="o">=</span><span class="n">suppress_warnings</span><span class="p">,</span>
<a id="__codelineno-0-314" name="__codelineno-0-314"></a>        <span class="n">output_file</span><span class="o">=</span><span class="n">output_file</span><span class="p">,</span>
<a id="__codelineno-0-315" name="__codelineno-0-315"></a>    <span class="p">)</span>
<a id="__codelineno-0-316" name="__codelineno-0-316"></a>
<a id="__codelineno-0-317" name="__codelineno-0-317"></a>    <span class="k">return</span> <span class="n">results</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><h2 id="spotoptim-search">spotoptim Search</h2>


<div class="doc doc-object doc-module">



<h2 id="spotforecast2.model_selection.spotoptim_search" class="doc doc-heading">
            <code>spotforecast2.model_selection.spotoptim_search</code>


</h2>

    <div class="doc doc-contents first">

        <p>Hyperparameter search functions for forecasters using SpotOptim.</p>










<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="spotforecast2.model_selection.spotoptim_search.spotoptim_search_forecaster" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">spotoptim_search_forecaster</span><span class="p">(</span><span class="n">forecaster</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">cv</span><span class="p">,</span> <span class="n">search_space</span><span class="p">,</span> <span class="n">metric</span><span class="p">,</span> <span class="n">exog</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">n_trials</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">n_initial</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">,</span> <span class="n">return_best</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">show_progress</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">suppress_warnings</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">output_file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">kwargs_spotoptim</span><span class="o">=</span><span class="p">{})</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Hyperparameter optimization for a Forecaster using SpotOptim.</p>
<p>Performs hyperparameter search using the SpotOptim library for a
Forecaster object. Validation is done using time series backtesting with
the provided cross-validation strategy.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>forecaster</code>
            </td>
            <td>
                  <code><span title="object">object</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Forecaster model. Can be ForecasterRecursive, ForecasterDirect,
or any compatible forecaster class.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>y</code>
            </td>
            <td>
                  <code><span title="pandas.Series">Series</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Training time series values. Must be a pandas Series with a
datetime or numeric index.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>cv</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="spotforecast2.model_selection.split_ts_cv.TimeSeriesFold" href="#spotforecast2.model_selection.split_ts_cv.TimeSeriesFold">TimeSeriesFold</a> | <a class="autorefs autorefs-internal" title="spotforecast2_safe.model_selection.OneStepAheadFold" href="#spotforecast2_safe.model_selection.OneStepAheadFold">OneStepAheadFold</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Cross-validation strategy with information needed to split the data
into folds. Must be an instance of TimeSeriesFold or OneStepAheadFold.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>search_space</code>
            </td>
            <td>
                  <code><span title="spotoptim.hyperparameters.ParameterSet">ParameterSet</span> | <span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Hyperparameter search space. Can be either:
- ParameterSet: A ParameterSet object from spotoptim.hyperparameters
  defining parameters with their types, bounds, and transformations.
- Dict: A dictionary with keys 'bounds', 'var_type', 'var_name', 'var_trans'
  (SpotOptim format), or a mapping of parameter names to (low, high) tuples.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>metric</code>
            </td>
            <td>
                  <code><span title="str">str</span> | <span title="typing.Callable">Callable</span> | <span title="list">list</span>[<span title="str">str</span> | <span title="typing.Callable">Callable</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Metric(s) to quantify model goodness of fit.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>exog</code>
            </td>
            <td>
                  <code><span title="pandas.Series">Series</span> | <span title="pandas.DataFrame">DataFrame</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Exogenous variable(s) included as predictors. Default is None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>n_trials</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Total number of evaluations (initial + sequential iterations).
Default is 10.</p>
              </div>
            </td>
            <td>
                  <code>10</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>n_initial</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of initial random points to sample before starting
sequential optimization. Default is 5.</p>
              </div>
            </td>
            <td>
                  <code>5</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>random_state</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Seed for sampling reproducibility. Default is 123.</p>
              </div>
            </td>
            <td>
                  <code>123</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>return_best</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, refit the forecaster using the best parameters
found on the whole dataset at the end. Default is True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>n_jobs</code>
            </td>
            <td>
                  <code><span title="int">int</span> | <span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of parallel jobs. If -1, uses all cores. If 'auto',
automatically determines the number of jobs. Default is 'auto'.</p>
              </div>
            </td>
            <td>
                  <code>&#39;auto&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>verbose</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, print optimization progress. Default is False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>show_progress</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to show progress (currently handled by verbose).
Default is True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>suppress_warnings</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, suppress spotforecast warnings. Default is False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>output_file</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Filename or full path to save results as TSV. Default is None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>kwargs_spotoptim</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Additional keyword arguments passed to SpotOptim().
Default is {}.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="tuple">tuple</span>[<span title="pandas.DataFrame">DataFrame</span>, <span title="object">object</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>tuple[pd.DataFrame, object]: A tuple containing:
- results: DataFrame with columns 'lags', 'params', metric values,
  and individual parameter columns. Sorted by the first metric.
- optimizer: SpotOptim object containing the optimization results.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If exog length doesn't match y length when return_best=True.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="TypeError">TypeError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If cv is not an instance of TimeSeriesFold or OneStepAheadFold.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/spotforecast2/model_selection/spotoptim_search.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-73" name="__codelineno-0-73"></a><span class="k">def</span><span class="w"> </span><span class="nf">spotoptim_search_forecaster</span><span class="p">(</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a>    <span class="n">forecaster</span><span class="p">:</span> <span class="nb">object</span><span class="p">,</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a>    <span class="n">y</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>    <span class="n">cv</span><span class="p">:</span> <span class="n">TimeSeriesFold</span> <span class="o">|</span> <span class="n">OneStepAheadFold</span><span class="p">,</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a>    <span class="n">search_space</span><span class="p">:</span> <span class="n">ParameterSet</span> <span class="o">|</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a>    <span class="n">metric</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Callable</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="n">Callable</span><span class="p">],</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a>    <span class="n">exog</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span> <span class="o">|</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a>    <span class="n">n_trials</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a>    <span class="n">n_initial</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a>    <span class="n">random_state</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">123</span><span class="p">,</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a>    <span class="n">return_best</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a>    <span class="n">n_jobs</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;auto&quot;</span><span class="p">,</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a>    <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>    <span class="n">show_progress</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a>    <span class="n">suppress_warnings</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a>    <span class="n">output_file</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>    <span class="n">kwargs_spotoptim</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="nb">object</span><span class="p">]:</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a><span class="sd">    Hyperparameter optimization for a Forecaster using SpotOptim.</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a><span class="sd">    Performs hyperparameter search using the SpotOptim library for a</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a><span class="sd">    Forecaster object. Validation is done using time series backtesting with</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a><span class="sd">    the provided cross-validation strategy.</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a><span class="sd">        forecaster: Forecaster model. Can be ForecasterRecursive, ForecasterDirect,</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a><span class="sd">            or any compatible forecaster class.</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a><span class="sd">        y: Training time series values. Must be a pandas Series with a</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a><span class="sd">            datetime or numeric index.</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a><span class="sd">        cv: Cross-validation strategy with information needed to split the data</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a><span class="sd">            into folds. Must be an instance of TimeSeriesFold or OneStepAheadFold.</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a><span class="sd">        search_space: Hyperparameter search space. Can be either:</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a><span class="sd">            - ParameterSet: A ParameterSet object from spotoptim.hyperparameters</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a><span class="sd">              defining parameters with their types, bounds, and transformations.</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a><span class="sd">            - Dict: A dictionary with keys &#39;bounds&#39;, &#39;var_type&#39;, &#39;var_name&#39;, &#39;var_trans&#39;</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a><span class="sd">              (SpotOptim format), or a mapping of parameter names to (low, high) tuples.</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a><span class="sd">        metric: Metric(s) to quantify model goodness of fit.</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a><span class="sd">        exog: Exogenous variable(s) included as predictors. Default is None.</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a><span class="sd">        n_trials: Total number of evaluations (initial + sequential iterations).</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a><span class="sd">            Default is 10.</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a><span class="sd">        n_initial: Number of initial random points to sample before starting</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a><span class="sd">            sequential optimization. Default is 5.</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a><span class="sd">        random_state: Seed for sampling reproducibility. Default is 123.</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a><span class="sd">        return_best: If True, refit the forecaster using the best parameters</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a><span class="sd">            found on the whole dataset at the end. Default is True.</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a><span class="sd">        n_jobs: Number of parallel jobs. If -1, uses all cores. If &#39;auto&#39;,</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a><span class="sd">            automatically determines the number of jobs. Default is &#39;auto&#39;.</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a><span class="sd">        verbose: If True, print optimization progress. Default is False.</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a><span class="sd">        show_progress: Whether to show progress (currently handled by verbose).</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a><span class="sd">            Default is True.</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a><span class="sd">        suppress_warnings: If True, suppress spotforecast warnings. Default is False.</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a><span class="sd">        output_file: Filename or full path to save results as TSV. Default is None.</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a><span class="sd">        kwargs_spotoptim: Additional keyword arguments passed to SpotOptim().</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a><span class="sd">            Default is {}.</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a><span class="sd">        tuple[pd.DataFrame, object]: A tuple containing:</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a><span class="sd">            - results: DataFrame with columns &#39;lags&#39;, &#39;params&#39;, metric values,</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a><span class="sd">              and individual parameter columns. Sorted by the first metric.</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a><span class="sd">            - optimizer: SpotOptim object containing the optimization results.</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a><span class="sd">    Raises:</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a><span class="sd">        ValueError: If exog length doesn&#39;t match y length when return_best=True.</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a><span class="sd">        TypeError: If cv is not an instance of TimeSeriesFold or OneStepAheadFold.</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>    <span class="k">if</span> <span class="n">return_best</span> <span class="ow">and</span> <span class="n">exog</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">exog</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)):</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>            <span class="sa">f</span><span class="s2">&quot;`exog` must have same number of samples as `y`. &quot;</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>            <span class="sa">f</span><span class="s2">&quot;length `exog`: (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">exog</span><span class="p">)</span><span class="si">}</span><span class="s2">), length `y`: (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>        <span class="p">)</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a>    <span class="n">results</span><span class="p">,</span> <span class="n">optimizer</span> <span class="o">=</span> <span class="n">_spotoptim_search</span><span class="p">(</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>        <span class="n">forecaster</span><span class="o">=</span><span class="n">forecaster</span><span class="p">,</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a>        <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>        <span class="n">cv</span><span class="o">=</span><span class="n">cv</span><span class="p">,</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a>        <span class="n">exog</span><span class="o">=</span><span class="n">exog</span><span class="p">,</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>        <span class="n">search_space</span><span class="o">=</span><span class="n">search_space</span><span class="p">,</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a>        <span class="n">metric</span><span class="o">=</span><span class="n">metric</span><span class="p">,</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a>        <span class="n">n_trials</span><span class="o">=</span><span class="n">n_trials</span><span class="p">,</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a>        <span class="n">n_initial</span><span class="o">=</span><span class="n">n_initial</span><span class="p">,</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a>        <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">,</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a>        <span class="n">return_best</span><span class="o">=</span><span class="n">return_best</span><span class="p">,</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a>        <span class="n">n_jobs</span><span class="o">=</span><span class="n">n_jobs</span><span class="p">,</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a>        <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a>        <span class="n">suppress_warnings</span><span class="o">=</span><span class="n">suppress_warnings</span><span class="p">,</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a>        <span class="n">output_file</span><span class="o">=</span><span class="n">output_file</span><span class="p">,</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a>        <span class="n">kwargs_spotoptim</span><span class="o">=</span><span class="n">kwargs_spotoptim</span><span class="p">,</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a>    <span class="p">)</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a>    <span class="k">return</span> <span class="n">results</span><span class="p">,</span> <span class="n">optimizer</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><h2 id="bayesian-search">Bayesian Search</h2>


<div class="doc doc-object doc-module">



<h2 id="spotforecast2.model_selection.bayesian_search" class="doc doc-heading">
            <code>spotforecast2.model_selection.bayesian_search</code>


</h2>

    <div class="doc doc-contents first">

        <p>Bayesian hyperparameter search functions for forecasters using Optuna.</p>










<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="spotforecast2.model_selection.bayesian_search.bayesian_search_forecaster" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">bayesian_search_forecaster</span><span class="p">(</span><span class="n">forecaster</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">cv</span><span class="p">,</span> <span class="n">search_space</span><span class="p">,</span> <span class="n">metric</span><span class="p">,</span> <span class="n">exog</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">n_trials</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">,</span> <span class="n">return_best</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">show_progress</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">suppress_warnings</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">output_file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">kwargs_create_study</span><span class="o">=</span><span class="p">{},</span> <span class="n">kwargs_study_optimize</span><span class="o">=</span><span class="p">{})</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Bayesian hyperparameter optimization for a Forecaster using Optuna.</p>
<p>Performs Bayesian hyperparameter search using the Optuna library for a
Forecaster object. Validation is done using time series backtesting with
the provided cross-validation strategy.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>forecaster</code>
            </td>
            <td>
                  <code><span title="object">object</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Forecaster model. Can be ForecasterRecursive, ForecasterDirect,
or any compatible forecaster class.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>y</code>
            </td>
            <td>
                  <code><span title="pandas.Series">Series</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Training time series values. Must be a pandas Series with a
datetime or numeric index.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>cv</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="spotforecast2.model_selection.split_ts_cv.TimeSeriesFold" href="#spotforecast2.model_selection.split_ts_cv.TimeSeriesFold">TimeSeriesFold</a> | <a class="autorefs autorefs-internal" title="spotforecast2_safe.model_selection.OneStepAheadFold" href="#spotforecast2_safe.model_selection.OneStepAheadFold">OneStepAheadFold</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Cross-validation strategy with information needed to split the data
into folds. Must be an instance of TimeSeriesFold or OneStepAheadFold.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>search_space</code>
            </td>
            <td>
                  <code><span title="typing.Callable">Callable</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Callable function with argument <code>trial</code> that returns
a dictionary with parameter names (str) as keys and Trial objects
from optuna (trial.suggest_float, trial.suggest_int,
trial.suggest_categorical) as values. Can optionally include 'lags'
key to search over different lag configurations.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>metric</code>
            </td>
            <td>
                  <code><span title="str">str</span> | <span title="typing.Callable">Callable</span> | <span title="list">list</span>[<span title="str">str</span> | <span title="typing.Callable">Callable</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Metric(s) to quantify model goodness of fit. Can be:
- str: One of 'mean_squared_error', 'mean_absolute_error',
  'mean_absolute_percentage_error', 'mean_squared_log_error',
  'mean_absolute_scaled_error', 'root_mean_squared_scaled_error'.
- Callable: Function with arguments (y_true, y_pred) or
  (y_true, y_pred, y_train) that returns a float.
- list: List containing multiple strings and/or Callables.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>exog</code>
            </td>
            <td>
                  <code><span title="pandas.Series">Series</span> | <span title="pandas.DataFrame">DataFrame</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Exogenous variable(s) included as predictors. Must have the
same number of observations as <code>y</code> and aligned so that y[i] is
regressed on exog[i]. Default is None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>n_trials</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of parameter settings sampled during optimization.
Default is 10.</p>
              </div>
            </td>
            <td>
                  <code>10</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>random_state</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Seed for sampling reproducibility. When passing a custom
sampler in kwargs_create_study, set the seed within the sampler
(e.g., {'sampler': TPESampler(seed=145)}). Default is 123.</p>
              </div>
            </td>
            <td>
                  <code>123</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>return_best</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, refit the forecaster using the best parameters
found on the whole dataset at the end. Default is True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>n_jobs</code>
            </td>
            <td>
                  <code><span title="int">int</span> | <span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of parallel jobs. If -1, uses all cores. If 'auto',
uses spotforecast.skforecast.utils.select_n_jobs_backtesting to
automatically determine the number of jobs. Default is 'auto'.</p>
              </div>
            </td>
            <td>
                  <code>&#39;auto&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>verbose</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, print number of folds used for cross-validation.
Default is False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>show_progress</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to show an Optuna progress bar during
optimization. Default is True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>suppress_warnings</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, suppress spotforecast warnings during
hyperparameter search. Default is False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>output_file</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Filename or full path to save results as TSV. If None,
results are not saved to file. Default is None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>kwargs_create_study</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Additional keyword arguments passed to
optuna.create_study(). If not specified, direction is set to
'minimize' and TPESampler(seed=123) is used. Default is {}.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>kwargs_study_optimize</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Additional keyword arguments passed to
study.optimize(). Default is {}.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="tuple">tuple</span>[<span title="pandas.DataFrame">DataFrame</span>, <span title="object">object</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>tuple[pd.DataFrame, object]: A tuple containing:
- results: DataFrame with columns 'lags', 'params', metric values,
  and individual parameter columns. Sorted by the first metric.
- best_trial: Best optimization result as an optuna.FrozenTrial
  object containing the best parameters and metric value.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If exog length doesn't match y length when return_best=True.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="TypeError">TypeError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If cv is not an instance of TimeSeriesFold or OneStepAheadFold.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If metric list contains duplicate metric names.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/spotforecast2/model_selection/bayesian_search.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-0-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-0-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-0-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-0-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-0-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-0-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-0-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-0-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-0-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-0-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-0-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-0-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-0-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-0-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-0-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-0-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-0-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-0-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-0-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-0-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-0-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-0-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-0-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-41" name="__codelineno-0-41"></a><span class="k">def</span><span class="w"> </span><span class="nf">bayesian_search_forecaster</span><span class="p">(</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a>    <span class="n">forecaster</span><span class="p">:</span> <span class="nb">object</span><span class="p">,</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a>    <span class="n">y</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a>    <span class="n">cv</span><span class="p">:</span> <span class="n">TimeSeriesFold</span> <span class="o">|</span> <span class="n">OneStepAheadFold</span><span class="p">,</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a>    <span class="n">search_space</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a>    <span class="n">metric</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Callable</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="n">Callable</span><span class="p">],</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a>    <span class="n">exog</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span> <span class="o">|</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a>    <span class="n">n_trials</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a>    <span class="n">random_state</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">123</span><span class="p">,</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a>    <span class="n">return_best</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a>    <span class="n">n_jobs</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;auto&quot;</span><span class="p">,</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a>    <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a>    <span class="n">show_progress</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a>    <span class="n">suppress_warnings</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a>    <span class="n">output_file</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a>    <span class="n">kwargs_create_study</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a>    <span class="n">kwargs_study_optimize</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="nb">object</span><span class="p">]:</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="sd">    Bayesian hyperparameter optimization for a Forecaster using Optuna.</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a><span class="sd">    Performs Bayesian hyperparameter search using the Optuna library for a</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="sd">    Forecaster object. Validation is done using time series backtesting with</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a><span class="sd">    the provided cross-validation strategy.</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a><span class="sd">        forecaster: Forecaster model. Can be ForecasterRecursive, ForecasterDirect,</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a><span class="sd">            or any compatible forecaster class.</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a><span class="sd">        y: Training time series values. Must be a pandas Series with a</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a><span class="sd">            datetime or numeric index.</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a><span class="sd">        cv: Cross-validation strategy with information needed to split the data</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a><span class="sd">            into folds. Must be an instance of TimeSeriesFold or OneStepAheadFold.</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a><span class="sd">        search_space: Callable function with argument `trial` that returns</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="sd">            a dictionary with parameter names (str) as keys and Trial objects</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="sd">            from optuna (trial.suggest_float, trial.suggest_int,</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a><span class="sd">            trial.suggest_categorical) as values. Can optionally include &#39;lags&#39;</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a><span class="sd">            key to search over different lag configurations.</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="sd">        metric: Metric(s) to quantify model goodness of fit. Can be:</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="sd">            - str: One of &#39;mean_squared_error&#39;, &#39;mean_absolute_error&#39;,</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a><span class="sd">              &#39;mean_absolute_percentage_error&#39;, &#39;mean_squared_log_error&#39;,</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a><span class="sd">              &#39;mean_absolute_scaled_error&#39;, &#39;root_mean_squared_scaled_error&#39;.</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="sd">            - Callable: Function with arguments (y_true, y_pred) or</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a><span class="sd">              (y_true, y_pred, y_train) that returns a float.</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a><span class="sd">            - list: List containing multiple strings and/or Callables.</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a><span class="sd">        exog: Exogenous variable(s) included as predictors. Must have the</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a><span class="sd">            same number of observations as `y` and aligned so that y[i] is</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a><span class="sd">            regressed on exog[i]. Default is None.</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a><span class="sd">        n_trials: Number of parameter settings sampled during optimization.</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a><span class="sd">            Default is 10.</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a><span class="sd">        random_state: Seed for sampling reproducibility. When passing a custom</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a><span class="sd">            sampler in kwargs_create_study, set the seed within the sampler</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a><span class="sd">            (e.g., {&#39;sampler&#39;: TPESampler(seed=145)}). Default is 123.</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a><span class="sd">        return_best: If True, refit the forecaster using the best parameters</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a><span class="sd">            found on the whole dataset at the end. Default is True.</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a><span class="sd">        n_jobs: Number of parallel jobs. If -1, uses all cores. If &#39;auto&#39;,</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a><span class="sd">            uses spotforecast.skforecast.utils.select_n_jobs_backtesting to</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a><span class="sd">            automatically determine the number of jobs. Default is &#39;auto&#39;.</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a><span class="sd">        verbose: If True, print number of folds used for cross-validation.</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a><span class="sd">            Default is False.</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a><span class="sd">        show_progress: Whether to show an Optuna progress bar during</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a><span class="sd">            optimization. Default is True.</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a><span class="sd">        suppress_warnings: If True, suppress spotforecast warnings during</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a><span class="sd">            hyperparameter search. Default is False.</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a><span class="sd">        output_file: Filename or full path to save results as TSV. If None,</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a><span class="sd">            results are not saved to file. Default is None.</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a><span class="sd">        kwargs_create_study: Additional keyword arguments passed to</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a><span class="sd">            optuna.create_study(). If not specified, direction is set to</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a><span class="sd">            &#39;minimize&#39; and TPESampler(seed=123) is used. Default is {}.</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a><span class="sd">        kwargs_study_optimize: Additional keyword arguments passed to</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a><span class="sd">            study.optimize(). Default is {}.</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a><span class="sd">        tuple[pd.DataFrame, object]: A tuple containing:</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a><span class="sd">            - results: DataFrame with columns &#39;lags&#39;, &#39;params&#39;, metric values,</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a><span class="sd">              and individual parameter columns. Sorted by the first metric.</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a><span class="sd">            - best_trial: Best optimization result as an optuna.FrozenTrial</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a><span class="sd">              object containing the best parameters and metric value.</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a><span class="sd">    Raises:</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a><span class="sd">        ValueError: If exog length doesn&#39;t match y length when return_best=True.</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a><span class="sd">        TypeError: If cv is not an instance of TimeSeriesFold or OneStepAheadFold.</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a><span class="sd">        ValueError: If metric list contains duplicate metric names.</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>    <span class="k">if</span> <span class="n">return_best</span> <span class="ow">and</span> <span class="n">exog</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">exog</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)):</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>            <span class="sa">f</span><span class="s2">&quot;`exog` must have same number of samples as `y`. &quot;</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a>            <span class="sa">f</span><span class="s2">&quot;length `exog`: (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">exog</span><span class="p">)</span><span class="si">}</span><span class="s2">), length `y`: (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a>        <span class="p">)</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a>    <span class="n">results</span><span class="p">,</span> <span class="n">best_trial</span> <span class="o">=</span> <span class="n">_bayesian_search_optuna</span><span class="p">(</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>        <span class="n">forecaster</span><span class="o">=</span><span class="n">forecaster</span><span class="p">,</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>        <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>        <span class="n">cv</span><span class="o">=</span><span class="n">cv</span><span class="p">,</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>        <span class="n">exog</span><span class="o">=</span><span class="n">exog</span><span class="p">,</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>        <span class="n">search_space</span><span class="o">=</span><span class="n">search_space</span><span class="p">,</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a>        <span class="n">metric</span><span class="o">=</span><span class="n">metric</span><span class="p">,</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a>        <span class="n">n_trials</span><span class="o">=</span><span class="n">n_trials</span><span class="p">,</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>        <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">,</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>        <span class="n">return_best</span><span class="o">=</span><span class="n">return_best</span><span class="p">,</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>        <span class="n">n_jobs</span><span class="o">=</span><span class="n">n_jobs</span><span class="p">,</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>        <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>        <span class="n">show_progress</span><span class="o">=</span><span class="n">show_progress</span><span class="p">,</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a>        <span class="n">suppress_warnings</span><span class="o">=</span><span class="n">suppress_warnings</span><span class="p">,</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a>        <span class="n">output_file</span><span class="o">=</span><span class="n">output_file</span><span class="p">,</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>        <span class="n">kwargs_create_study</span><span class="o">=</span><span class="n">kwargs_create_study</span><span class="p">,</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a>        <span class="n">kwargs_study_optimize</span><span class="o">=</span><span class="n">kwargs_study_optimize</span><span class="p">,</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>    <span class="p">)</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>    <span class="k">return</span> <span class="n">results</span><span class="p">,</span> <span class="n">best_trial</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><h2 id="random-search">Random Search</h2>


<div class="doc doc-object doc-module">



<h2 id="spotforecast2.model_selection.random_search" class="doc doc-heading">
            <code>spotforecast2.model_selection.random_search</code>


</h2>

    <div class="doc doc-contents first">

        <p>Random search hyperparameter optimization for forecasters.</p>










<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="spotforecast2.model_selection.random_search.random_search_forecaster" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">random_search_forecaster</span><span class="p">(</span><span class="n">forecaster</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">cv</span><span class="p">,</span> <span class="n">param_distributions</span><span class="p">,</span> <span class="n">metric</span><span class="p">,</span> <span class="n">exog</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lags_grid</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">n_iter</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">123</span><span class="p">,</span> <span class="n">return_best</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">show_progress</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">suppress_warnings</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">output_file</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Random search over parameter distributions for a Forecaster.</p>
<p>Performs random sampling of parameter settings from distributions for a
Forecaster object. Validation is done using time series backtesting with
the provided cross-validation strategy. This is more efficient than grid
search when exploring large parameter spaces.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>forecaster</code>
            </td>
            <td>
                  <code><span title="object">object</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Forecaster model (ForecasterRecursive or ForecasterDirect).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>y</code>
            </td>
            <td>
                  <code><span title="pandas.Series">Series</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Training time series.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>cv</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="spotforecast2.model_selection.split_ts_cv.TimeSeriesFold" href="#spotforecast2.model_selection.split_ts_cv.TimeSeriesFold">TimeSeriesFold</a> | <a class="autorefs autorefs-internal" title="spotforecast2_safe.model_selection.OneStepAheadFold" href="#spotforecast2_safe.model_selection.OneStepAheadFold">OneStepAheadFold</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Cross-validation strategy (TimeSeriesFold or OneStepAheadFold)
with information needed to split the data into folds.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>param_distributions</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary with parameter names (str) as keys
and distributions or lists of parameters to try as values.
Use scipy.stats distributions for continuous parameters.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>metric</code>
            </td>
            <td>
                  <code><span title="str">str</span> | <span title="typing.Callable">Callable</span> | <span title="list">list</span>[<span title="str">str</span> | <span title="typing.Callable">Callable</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Metric(s) to quantify model goodness of fit. If str:
'mean_squared_error', 'mean_absolute_error',
'mean_absolute_percentage_error', 'mean_squared_log_error',
'mean_absolute_scaled_error', 'root_mean_squared_scaled_error'.
If Callable: Function with arguments (y_true, y_pred, y_train)
that returns a float. If list: Multiple strings and/or Callables.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>exog</code>
            </td>
            <td>
                  <code><span title="pandas.Series">Series</span> | <span title="pandas.DataFrame">DataFrame</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Exogenous variable(s) included as predictors. Must have the
same number of observations as y and aligned so that y[i] is
regressed on exog[i]. Default is None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>lags_grid</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="int">int</span> | <span title="list">list</span>[<span title="int">int</span>] | <span title="numpy.ndarray">ndarray</span>[<span title="int">int</span>] | <span title="range">range</span>[<span title="int">int</span>]] | <span title="dict">dict</span>[<span title="str">str</span>, <span title="list">list</span>[<span title="int">int</span> | <span title="list">list</span>[<span title="int">int</span>] | <span title="numpy.ndarray">ndarray</span>[<span title="int">int</span>] | <span title="range">range</span>[<span title="int">int</span>]]] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Lists of lags to try. Can be int, lists, numpy ndarray,
or range objects. If dict, keys are used as labels in results
DataFrame. Default is None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>n_iter</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of parameter settings sampled per lags configuration.
Trades off runtime vs solution quality. Default is 10.</p>
              </div>
            </td>
            <td>
                  <code>10</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>random_state</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Seed for random sampling for reproducible output.
Default is 123.</p>
              </div>
            </td>
            <td>
                  <code>123</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>return_best</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, refit the forecaster using best parameters
on the whole dataset. Default is True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>n_jobs</code>
            </td>
            <td>
                  <code><span title="int">int</span> | <span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of jobs to run in parallel. If -1, uses all cores.
If 'auto', uses select_n_jobs_backtesting. Default is 'auto'.</p>
              </div>
            </td>
            <td>
                  <code>&#39;auto&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>verbose</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, print number of folds used for cv. Default is False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>show_progress</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to show a progress bar. Default is True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>suppress_warnings</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, suppress spotforecast warnings during
hyperparameter search. Default is False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>output_file</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Filename or full path to save results as TSV. If None,
results are not saved to file. Default is None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Results for each parameter combination with columns: lags (lags</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>configuration), lags_label (descriptive label), params (parameters</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>configuration), metric (metric value), and additional columns with</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>param=value pairs.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <p>Basic random search with continuous parameter distributions:</p>
    <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.linear_model</span><span class="w"> </span><span class="kn">import</span> <span class="n">Ridge</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">scipy.stats</span><span class="w"> </span><span class="kn">import</span> <span class="n">uniform</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">spotforecast2_safe.forecaster.recursive</span><span class="w"> </span><span class="kn">import</span> <span class="n">ForecasterRecursive</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">spotforecast2.model_selection</span><span class="w"> </span><span class="kn">import</span> <span class="n">TimeSeriesFold</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">spotforecast2.model_selection.random_search</span><span class="w"> </span><span class="kn">import</span> <span class="n">random_search_forecaster</span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="gp">&gt;&gt;&gt;</span>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Create sample data</span>
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">123</span><span class="p">)</span>
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">y</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
<a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a><span class="gp">&gt;&gt;&gt;</span>
<a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Set up forecaster and cross-validation</span>
<a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">forecaster</span> <span class="o">=</span> <span class="n">ForecasterRecursive</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">Ridge</span><span class="p">(),</span> <span class="n">lags</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">cv</span> <span class="o">=</span> <span class="n">TimeSeriesFold</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">initial_train_size</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">refit</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a><span class="gp">&gt;&gt;&gt;</span>
<a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Define parameter distributions with scipy.stats</span>
<a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">param_distributions</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a><span class="gp">... </span>    <span class="s1">&#39;estimator__alpha&#39;</span><span class="p">:</span> <span class="n">uniform</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">)</span>  <span class="c1"># Uniform between 0.1 and 10.1</span>
<a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a><span class="gp">... </span><span class="p">}</span>
<a id="__codelineno-0-21" name="__codelineno-0-21" href="#__codelineno-0-21"></a><span class="gp">&gt;&gt;&gt;</span>
<a id="__codelineno-0-22" name="__codelineno-0-22" href="#__codelineno-0-22"></a><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Run random search</span>
<a id="__codelineno-0-23" name="__codelineno-0-23" href="#__codelineno-0-23"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">results</span> <span class="o">=</span> <span class="n">random_search_forecaster</span><span class="p">(</span>
<a id="__codelineno-0-24" name="__codelineno-0-24" href="#__codelineno-0-24"></a><span class="gp">... </span>    <span class="n">forecaster</span><span class="o">=</span><span class="n">forecaster</span><span class="p">,</span>
<a id="__codelineno-0-25" name="__codelineno-0-25" href="#__codelineno-0-25"></a><span class="gp">... </span>    <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span>
<a id="__codelineno-0-26" name="__codelineno-0-26" href="#__codelineno-0-26"></a><span class="gp">... </span>    <span class="n">cv</span><span class="o">=</span><span class="n">cv</span><span class="p">,</span>
<a id="__codelineno-0-27" name="__codelineno-0-27" href="#__codelineno-0-27"></a><span class="gp">... </span>    <span class="n">param_distributions</span><span class="o">=</span><span class="n">param_distributions</span><span class="p">,</span>
<a id="__codelineno-0-28" name="__codelineno-0-28" href="#__codelineno-0-28"></a><span class="gp">... </span>    <span class="n">metric</span><span class="o">=</span><span class="s1">&#39;mean_squared_error&#39;</span><span class="p">,</span>
<a id="__codelineno-0-29" name="__codelineno-0-29" href="#__codelineno-0-29"></a><span class="gp">... </span>    <span class="n">n_iter</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
<a id="__codelineno-0-30" name="__codelineno-0-30" href="#__codelineno-0-30"></a><span class="gp">... </span>    <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span>
<a id="__codelineno-0-31" name="__codelineno-0-31" href="#__codelineno-0-31"></a><span class="gp">... </span>    <span class="n">return_best</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-32" name="__codelineno-0-32" href="#__codelineno-0-32"></a><span class="gp">... </span>    <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-33" name="__codelineno-0-33" href="#__codelineno-0-33"></a><span class="gp">... </span>    <span class="n">show_progress</span><span class="o">=</span><span class="kc">False</span>
<a id="__codelineno-0-34" name="__codelineno-0-34" href="#__codelineno-0-34"></a><span class="gp">... </span><span class="p">)</span>
<a id="__codelineno-0-35" name="__codelineno-0-35" href="#__codelineno-0-35"></a><span class="gp">&gt;&gt;&gt;</span>
<a id="__codelineno-0-36" name="__codelineno-0-36" href="#__codelineno-0-36"></a><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Check results</span>
<a id="__codelineno-0-37" name="__codelineno-0-37" href="#__codelineno-0-37"></a><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-0-38" name="__codelineno-0-38" href="#__codelineno-0-38"></a><span class="go">5</span>
<a id="__codelineno-0-39" name="__codelineno-0-39" href="#__codelineno-0-39"></a><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;estimator__alpha&#39;</span> <span class="ow">in</span> <span class="n">results</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
<a id="__codelineno-0-40" name="__codelineno-0-40" href="#__codelineno-0-40"></a><span class="go">True</span>
<a id="__codelineno-0-41" name="__codelineno-0-41" href="#__codelineno-0-41"></a><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;mean_squared_error&#39;</span> <span class="ow">in</span> <span class="n">results</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
<a id="__codelineno-0-42" name="__codelineno-0-42" href="#__codelineno-0-42"></a><span class="go">True</span>
</code></pre></div>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/spotforecast2/model_selection/random_search.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-0-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-0-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-0-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-0-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-0-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-0-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-0-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-0-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-0-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-0-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-0-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-0-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-0-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-0-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-0-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-0-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-0-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-0-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-0-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-0-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-0-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-0-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-0-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-0-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-0-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-0-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-0-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-0-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-0-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-0-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-0-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-0-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-0-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-0-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-0-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-0-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-0-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-0-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-0-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-0-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-0-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-0-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-0-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-0-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-0-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-0-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-18" name="__codelineno-0-18"></a><span class="k">def</span><span class="w"> </span><span class="nf">random_search_forecaster</span><span class="p">(</span>
<a id="__codelineno-0-19" name="__codelineno-0-19"></a>    <span class="n">forecaster</span><span class="p">:</span> <span class="nb">object</span><span class="p">,</span>
<a id="__codelineno-0-20" name="__codelineno-0-20"></a>    <span class="n">y</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span>
<a id="__codelineno-0-21" name="__codelineno-0-21"></a>    <span class="n">cv</span><span class="p">:</span> <span class="n">TimeSeriesFold</span> <span class="o">|</span> <span class="n">OneStepAheadFold</span><span class="p">,</span>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a>    <span class="n">param_distributions</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
<a id="__codelineno-0-23" name="__codelineno-0-23"></a>    <span class="n">metric</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Callable</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="n">Callable</span><span class="p">],</span>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a>    <span class="n">exog</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span> <span class="o">|</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a>    <span class="n">lags_grid</span><span class="p">:</span> <span class="p">(</span>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a>        <span class="nb">list</span><span class="p">[</span><span class="nb">int</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="nb">range</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a>        <span class="o">|</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="nb">range</span><span class="p">[</span><span class="nb">int</span><span class="p">]]]</span>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a>        <span class="o">|</span> <span class="kc">None</span>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a>    <span class="p">)</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a>    <span class="n">n_iter</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a>    <span class="n">random_state</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">123</span><span class="p">,</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a>    <span class="n">return_best</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a>    <span class="n">n_jobs</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;auto&quot;</span><span class="p">,</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a>    <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a>    <span class="n">show_progress</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a>    <span class="n">suppress_warnings</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a>    <span class="n">output_file</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Random search over parameter distributions for a Forecaster.</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a><span class="sd">    Performs random sampling of parameter settings from distributions for a</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a><span class="sd">    Forecaster object. Validation is done using time series backtesting with</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a><span class="sd">    the provided cross-validation strategy. This is more efficient than grid</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a><span class="sd">    search when exploring large parameter spaces.</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a><span class="sd">        forecaster: Forecaster model (ForecasterRecursive or ForecasterDirect).</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a><span class="sd">        y: Training time series.</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="sd">        cv: Cross-validation strategy (TimeSeriesFold or OneStepAheadFold)</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a><span class="sd">            with information needed to split the data into folds.</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a><span class="sd">        param_distributions: Dictionary with parameter names (str) as keys</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a><span class="sd">            and distributions or lists of parameters to try as values.</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="sd">            Use scipy.stats distributions for continuous parameters.</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="sd">        metric: Metric(s) to quantify model goodness of fit. If str:</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="sd">            &#39;mean_squared_error&#39;, &#39;mean_absolute_error&#39;,</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a><span class="sd">            &#39;mean_absolute_percentage_error&#39;, &#39;mean_squared_log_error&#39;,</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="sd">            &#39;mean_absolute_scaled_error&#39;, &#39;root_mean_squared_scaled_error&#39;.</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="sd">            If Callable: Function with arguments (y_true, y_pred, y_train)</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="sd">            that returns a float. If list: Multiple strings and/or Callables.</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="sd">        exog: Exogenous variable(s) included as predictors. Must have the</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a><span class="sd">            same number of observations as y and aligned so that y[i] is</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a><span class="sd">            regressed on exog[i]. Default is None.</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="sd">        lags_grid: Lists of lags to try. Can be int, lists, numpy ndarray,</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a><span class="sd">            or range objects. If dict, keys are used as labels in results</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a><span class="sd">            DataFrame. Default is None.</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a><span class="sd">        n_iter: Number of parameter settings sampled per lags configuration.</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a><span class="sd">            Trades off runtime vs solution quality. Default is 10.</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a><span class="sd">        random_state: Seed for random sampling for reproducible output.</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a><span class="sd">            Default is 123.</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a><span class="sd">        return_best: If True, refit the forecaster using best parameters</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a><span class="sd">            on the whole dataset. Default is True.</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a><span class="sd">        n_jobs: Number of jobs to run in parallel. If -1, uses all cores.</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a><span class="sd">            If &#39;auto&#39;, uses select_n_jobs_backtesting. Default is &#39;auto&#39;.</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="sd">        verbose: If True, print number of folds used for cv. Default is False.</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="sd">        show_progress: Whether to show a progress bar. Default is True.</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a><span class="sd">        suppress_warnings: If True, suppress spotforecast warnings during</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a><span class="sd">            hyperparameter search. Default is False.</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="sd">        output_file: Filename or full path to save results as TSV. If None,</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="sd">            results are not saved to file. Default is None.</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="sd">        Results for each parameter combination with columns: lags (lags</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a><span class="sd">        configuration), lags_label (descriptive label), params (parameters</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a><span class="sd">        configuration), metric (metric value), and additional columns with</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a><span class="sd">        param=value pairs.</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a><span class="sd">    Examples:</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a><span class="sd">        Basic random search with continuous parameter distributions:</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a><span class="sd">        &gt;&gt;&gt; import pandas as pd</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a><span class="sd">        &gt;&gt;&gt; import numpy as np</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a><span class="sd">        &gt;&gt;&gt; from sklearn.linear_model import Ridge</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a><span class="sd">        &gt;&gt;&gt; from scipy.stats import uniform</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a><span class="sd">        &gt;&gt;&gt; from spotforecast2_safe.forecaster.recursive import ForecasterRecursive</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a><span class="sd">        &gt;&gt;&gt; from spotforecast2.model_selection import TimeSeriesFold</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a><span class="sd">        &gt;&gt;&gt; from spotforecast2.model_selection.random_search import random_search_forecaster</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a><span class="sd">        &gt;&gt;&gt;</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a><span class="sd">        &gt;&gt;&gt; # Create sample data</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a><span class="sd">        &gt;&gt;&gt; np.random.seed(123)</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a><span class="sd">        &gt;&gt;&gt; y = pd.Series(np.random.randn(50), name=&#39;y&#39;)</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a><span class="sd">        &gt;&gt;&gt;</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a><span class="sd">        &gt;&gt;&gt; # Set up forecaster and cross-validation</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a><span class="sd">        &gt;&gt;&gt; forecaster = ForecasterRecursive(estimator=Ridge(), lags=3)</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a><span class="sd">        &gt;&gt;&gt; cv = TimeSeriesFold(steps=3, initial_train_size=20, refit=False)</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a><span class="sd">        &gt;&gt;&gt;</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a><span class="sd">        &gt;&gt;&gt; # Define parameter distributions with scipy.stats</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a><span class="sd">        &gt;&gt;&gt; param_distributions = {</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a><span class="sd">        ...     &#39;estimator__alpha&#39;: uniform(0.1, 10.0)  # Uniform between 0.1 and 10.1</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a><span class="sd">        ... }</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a><span class="sd">        &gt;&gt;&gt;</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a><span class="sd">        &gt;&gt;&gt; # Run random search</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a><span class="sd">        &gt;&gt;&gt; results = random_search_forecaster(</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a><span class="sd">        ...     forecaster=forecaster,</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a><span class="sd">        ...     y=y,</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a><span class="sd">        ...     cv=cv,</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a><span class="sd">        ...     param_distributions=param_distributions,</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a><span class="sd">        ...     metric=&#39;mean_squared_error&#39;,</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a><span class="sd">        ...     n_iter=5,</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a><span class="sd">        ...     random_state=42,</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a><span class="sd">        ...     return_best=False,</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a><span class="sd">        ...     verbose=False,</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a><span class="sd">        ...     show_progress=False</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a><span class="sd">        ... )</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a><span class="sd">        &gt;&gt;&gt;</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a><span class="sd">        &gt;&gt;&gt; # Check results</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a><span class="sd">        &gt;&gt;&gt; print(results.shape[0])</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a><span class="sd">        5</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a><span class="sd">        &gt;&gt;&gt; print(&#39;estimator__alpha&#39; in results.columns)</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a><span class="sd">        True</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a><span class="sd">        &gt;&gt;&gt; print(&#39;mean_squared_error&#39; in results.columns)</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a><span class="sd">        True</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>    <span class="n">param_grid</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>        <span class="n">ParameterSampler</span><span class="p">(</span><span class="n">param_distributions</span><span class="p">,</span> <span class="n">n_iter</span><span class="o">=</span><span class="n">n_iter</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">)</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>    <span class="p">)</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a>    <span class="n">results</span> <span class="o">=</span> <span class="n">_evaluate_grid_hyperparameters</span><span class="p">(</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a>        <span class="n">forecaster</span><span class="o">=</span><span class="n">forecaster</span><span class="p">,</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>        <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>        <span class="n">cv</span><span class="o">=</span><span class="n">cv</span><span class="p">,</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>        <span class="n">param_grid</span><span class="o">=</span><span class="n">param_grid</span><span class="p">,</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>        <span class="n">metric</span><span class="o">=</span><span class="n">metric</span><span class="p">,</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>        <span class="n">exog</span><span class="o">=</span><span class="n">exog</span><span class="p">,</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a>        <span class="n">lags_grid</span><span class="o">=</span><span class="n">lags_grid</span><span class="p">,</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a>        <span class="n">return_best</span><span class="o">=</span><span class="n">return_best</span><span class="p">,</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>        <span class="n">n_jobs</span><span class="o">=</span><span class="n">n_jobs</span><span class="p">,</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a>        <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>        <span class="n">show_progress</span><span class="o">=</span><span class="n">show_progress</span><span class="p">,</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a>        <span class="n">suppress_warnings</span><span class="o">=</span><span class="n">suppress_warnings</span><span class="p">,</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>        <span class="n">output_file</span><span class="o">=</span><span class="n">output_file</span><span class="p">,</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a>    <span class="p">)</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a>    <span class="k">return</span> <span class="n">results</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../forecaster/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Forecaster">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Forecaster
              </div>
            </div>
          </a>
        
        
          
          <a href="../stats/" class="md-footer__link md-footer__link--next" aria-label="Next: Stats">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Stats
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2024-2026 bartzbeielstein
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        
<div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/sequential-parameter-optimization/spotforecast2" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../..", "features": ["navigation.tabs", "navigation.sections", "navigation.expand", "content.code.copy", "content.code.annotate", "navigation.top", "navigation.footer"], "search": "../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
    
  </body>
</html>